<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-backend/java/Javaå¹¶å‘ç¼–ç¨‹">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Java å¹¶å‘ç¼–ç¨‹ | æŠ€æœ¯å°åŒ Â·ç¬”è®°</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://notes.frankfeekr.cn/docs/backend/java/Javaå¹¶å‘ç¼–ç¨‹"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Java å¹¶å‘ç¼–ç¨‹ | æŠ€æœ¯å°åŒ Â·ç¬”è®°"><meta data-rh="true" name="description" content="å‰è¨€"><meta data-rh="true" property="og:description" content="å‰è¨€"><link data-rh="true" rel="icon" href="/img/Landscape.svg"><link data-rh="true" rel="canonical" href="https://notes.frankfeekr.cn/docs/backend/java/Javaå¹¶å‘ç¼–ç¨‹"><link data-rh="true" rel="alternate" href="https://notes.frankfeekr.cn/docs/backend/java/Javaå¹¶å‘ç¼–ç¨‹" hreflang="en"><link data-rh="true" rel="alternate" href="https://notes.frankfeekr.cn/docs/backend/java/Javaå¹¶å‘ç¼–ç¨‹" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="æŠ€æœ¯å°åŒ Â·ç¬”è®° RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="æŠ€æœ¯å°åŒ Â·ç¬”è®° Atom Feed"><link rel="stylesheet" href="/assets/css/styles.78affc86.css">
<link rel="preload" href="/assets/js/runtime~main.038b63a9.js" as="script">
<link rel="preload" href="/assets/js/main.e83d61b7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/idea.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/idea.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">æŠ€æœ¯å°åŒ Â·ç¬”è®°</b></a><a class="navbar__item navbar__link" href="/docs/introduction/readme">å‰è¨€</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">åå°æ¶æ„</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/backend/java/JavaåŸºç¡€">Java åŸºç¡€çŸ¥è¯†</a></li><li><a class="dropdown__link" href="/docs/backend/python/">Python åŸºç¡€çŸ¥è¯†</a></li><li><a class="dropdown__link" href="/docs/backend/intro">æ€»è§ˆ</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">å‰ç«¯æŠ€æœ¯</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/frontend/es6/é¡¹ç›®å‡†å¤‡/å‰è¨€">ECMAScript2015~2020è¯­æ³•å…¨è§£æ</a></li><li><a class="dropdown__link" href="/docs/frontend/angular/">Angualr</a></li><li><a class="dropdown__link" href="/docs/category/ecmascript20152020è¯­æ³•å…¨è§£æ">æ€»è§ˆ</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/tools/Visual Studio Code">æŠ€æœ¯å·¥å…·</a><a class="navbar__item navbar__link" href="/docs/about/readme">å…³äºæœ¬ç«™</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">å¸¸ç”¨å·¥å…·</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/search">ğŸ” æœ¬ç«™æœç´¢</a></li><li><a href="https://www.emojiall.com/zh-hans/all-emojis" target="_blank" rel="noopener noreferrer" class="dropdown__link">ğŸ˜„ EMOJIALL<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://tools.frankfeekr.cn/" target="_blank" rel="noopener noreferrer" class="dropdown__link">ğŸ§­ LinTools - å¼€å‘è€…çš„åœ¨çº¿å¯¼èˆª<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://frankfeekr.cn/" target="_blank" rel="noopener noreferrer" class="dropdown__link">ğŸ‘¨â€ğŸ’» frankfeekr.cn - æˆ‘çš„åšå®¢<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li><a href="https://github.com/frank-lam/frankfeekr-notes/actions" target="_blank" rel="noopener noreferrer" class="dropdown__link">âš¡ï¸frankfeekr-notes/actions<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/frank-lam/frankfeekr-notes/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link">frankfeekr-notes/issues<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/frank-lam/todolist/issues/10" target="_blank" rel="noopener noreferrer" class="dropdown__link">todolist/issues/10<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/frank-lam/todolist/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link">todolist/issues<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/frank-lam/fullstack-tutorial" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/idea.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/idea.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"><b>æŠ€æœ¯å°åŒ Â·ç¬”è®°</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/backend/java/JavaåŸºç¡€">Java åŸºç¡€çŸ¥è¯†</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/backend/java/Javaé›†åˆæ¡†æ¶">Java é›†åˆæ¡†æ¶</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/backend/java/Javaå¹¶å‘ç¼–ç¨‹">Java å¹¶å‘ç¼–ç¨‹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/backend/java/Java-IO">Java IO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/backend/java/Javaè™šæ‹Ÿæœº">Java è™šæ‹Ÿæœº</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/backend/java/Javaè®¾è®¡æ¨¡å¼">Java è®¾è®¡æ¨¡å¼</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/backend/java/JavaWeb">Java Web</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/backend/java/ç³»ç»Ÿæ¶æ„">ç³»ç»Ÿæ¶æ„</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/backend/java/Overview">Overview</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Java å¹¶å‘ç¼–ç¨‹</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Java å¹¶å‘ç¼–ç¨‹</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å‰è¨€">å‰è¨€<a href="#å‰è¨€" class="hash-link" aria-label="Direct link to å‰è¨€" title="Direct link to å‰è¨€">â€‹</a></h2><p>åœ¨æœ¬æ–‡å°†æ€»ç»“å¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹ä¸­çš„å¸¸è§é¢è¯•é¢˜ï¼Œä¸»è¦æ ¸å¿ƒçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸã€çº¿ç¨‹é€šä¿¡ã€å¹¶å‘åŒ…éƒ¨åˆ†ã€‚ä¸»è¦åˆ†æˆ â€œå¹¶å‘ç¼–ç¨‹â€ å’Œ â€œé¢è¯•æŒ‡å—â€ ä¸¤ éƒ¨åˆ†ï¼Œåœ¨é¢è¯•æŒ‡å—ä¸­å°†è®¨è®ºå¹¶å‘ç›¸å…³é¢ç»ã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ç¬¬ä¸€éƒ¨åˆ†å¹¶å‘ç¼–ç¨‹">ç¬¬ä¸€éƒ¨åˆ†ï¼šå¹¶å‘ç¼–ç¨‹<a href="#ç¬¬ä¸€éƒ¨åˆ†å¹¶å‘ç¼–ç¨‹" class="hash-link" aria-label="Direct link to ç¬¬ä¸€éƒ¨åˆ†ï¼šå¹¶å‘ç¼–ç¨‹" title="Direct link to ç¬¬ä¸€éƒ¨åˆ†ï¼šå¹¶å‘ç¼–ç¨‹">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-çº¿ç¨‹çŠ¶æ€è½¬æ¢">1. çº¿ç¨‹çŠ¶æ€è½¬æ¢<a href="#1-çº¿ç¨‹çŠ¶æ€è½¬æ¢" class="hash-link" aria-label="Direct link to 1. çº¿ç¨‹çŠ¶æ€è½¬æ¢" title="Direct link to 1. çº¿ç¨‹çŠ¶æ€è½¬æ¢">â€‹</a></h3><div align="center"> <img loading="lazy" src="assets/ace830df-9919-48ca-91b5-60b193f593d2.png" width="" class="img_ev3q"></div><p>è¿™é‡Œç¬”è€…ä¹Ÿç»˜åˆ¶äº†ä¸€å¼ ä¸­æ–‡ç‰ˆçš„å›¾ï¼Œ<a href="https://raw.githubusercontent.com/frank-lam/2019_campus_apply/master/notes/JavaArchitecture/assets/1536767960941.png" target="_blank" rel="noopener noreferrer">ç‚¹å‡»æŸ¥çœ‹</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="æ–°å»ºnew">æ–°å»ºï¼ˆNewï¼‰<a href="#æ–°å»ºnew" class="hash-link" aria-label="Direct link to æ–°å»ºï¼ˆNewï¼‰" title="Direct link to æ–°å»ºï¼ˆNewï¼‰">â€‹</a></h4><p>åˆ›å»ºåå°šæœªå¯åŠ¨ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å¯è¿è¡Œrunnable">å¯è¿è¡Œï¼ˆRunnableï¼‰<a href="#å¯è¿è¡Œrunnable" class="hash-link" aria-label="Direct link to å¯è¿è¡Œï¼ˆRunnableï¼‰" title="Direct link to å¯è¿è¡Œï¼ˆRunnableï¼‰">â€‹</a></h4><p>å¯èƒ½æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½æ­£åœ¨ç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚</p><p>åŒ…å«äº†æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ä¸­çš„ è¿è¡Œï¼ˆRunning ï¼‰ å’Œ å°±ç»ªï¼ˆReadyï¼‰ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="é˜»å¡blocking">é˜»å¡ï¼ˆBlockingï¼‰<a href="#é˜»å¡blocking" class="hash-link" aria-label="Direct link to é˜»å¡ï¼ˆBlockingï¼‰" title="Direct link to é˜»å¡ï¼ˆBlockingï¼‰">â€‹</a></h4><p>è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œæ˜¯åœ¨å¤šä¸ªçº¿ç¨‹æœ‰åŒæ­¥æ“ä½œçš„åœºæ™¯ï¼Œæ¯”å¦‚æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„ synchronized å—çš„æ‰§è¡Œé‡Šæ”¾ï¼Œæˆ–è€…å¯é‡å…¥çš„ synchronized å—é‡Œåˆ«äººè°ƒç”¨ wait() æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹åœ¨ç­‰å¾…è¿›å…¥ä¸´ç•ŒåŒºã€‚ </p><p>é˜»å¡å¯ä»¥åˆ†ä¸ºï¼šç­‰å¾…é˜»å¡ï¼ŒåŒæ­¥é˜»å¡ï¼Œå…¶ä»–é˜»å¡</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="æ— é™æœŸç­‰å¾…waiting">æ— é™æœŸç­‰å¾…ï¼ˆWaitingï¼‰<a href="#æ— é™æœŸç­‰å¾…waiting" class="hash-link" aria-label="Direct link to æ— é™æœŸç­‰å¾…ï¼ˆWaitingï¼‰" title="Direct link to æ— é™æœŸç­‰å¾…ï¼ˆWaitingï¼‰">â€‹</a></h4><p>ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œå¦åˆ™ä¸ä¼šè¢«åˆ†é… CPU æ—¶é—´ç‰‡ã€‚</p><table><thead><tr><th>è¿›å…¥æ–¹æ³•</th><th>é€€å‡ºæ–¹æ³•</th></tr></thead><tbody><tr><td>æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•</td><td>Object.notify() / Object.notifyAll()</td></tr><tr><td>æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•</td><td>è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</td></tr><tr><td>LockSupport.park() æ–¹æ³•</td><td>-</td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="é™æœŸç­‰å¾…timed-waiting">é™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰<a href="#é™æœŸç­‰å¾…timed-waiting" class="hash-link" aria-label="Direct link to é™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰" title="Direct link to é™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰">â€‹</a></h4><p>æ— éœ€ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’ã€‚</p><p>è°ƒç”¨ Thread.sleep() æ–¹æ³•ä½¿çº¿ç¨‹è¿›å…¥é™æœŸç­‰å¾…çŠ¶æ€æ—¶ï¼Œå¸¸å¸¸ç”¨ â€œ<strong>ä½¿ä¸€ä¸ªçº¿ç¨‹ç¡çœ </strong>â€ è¿›è¡Œæè¿°ã€‚</p><p>è°ƒç”¨ Object.wait() æ–¹æ³•ä½¿çº¿ç¨‹è¿›å…¥é™æœŸç­‰å¾…æˆ–è€…æ— é™æœŸç­‰å¾…æ—¶ï¼Œå¸¸å¸¸ç”¨ â€œ<strong>æŒ‚èµ·ä¸€ä¸ªçº¿ç¨‹</strong>â€ è¿›è¡Œæè¿°ã€‚</p><p><strong>ç¡çœ å’ŒæŒ‚èµ·</strong>æ˜¯ç”¨æ¥æè¿°<strong>è¡Œä¸º</strong>ï¼Œè€Œ<strong>é˜»å¡</strong>å’Œç­‰å¾…ç”¨æ¥æè¿°<strong>çŠ¶æ€</strong>ã€‚</p><p>é˜»å¡å’Œç­‰å¾…çš„åŒºåˆ«åœ¨äºï¼Œé˜»å¡æ˜¯è¢«åŠ¨çš„ï¼Œå®ƒæ˜¯åœ¨ç­‰å¾…è·å–ä¸€ä¸ªæ’å®ƒé”ã€‚è€Œç­‰å¾…æ˜¯ä¸»åŠ¨çš„ï¼Œé€šè¿‡è°ƒç”¨ Thread.sleep() å’Œ Object.wait() ç­‰æ–¹æ³•è¿›å…¥ã€‚</p><table><thead><tr><th>è¿›å…¥æ–¹æ³•</th><th>é€€å‡ºæ–¹æ³•</th></tr></thead><tbody><tr><td>Thread.sleep() æ–¹æ³•</td><td>æ—¶é—´ç»“æŸ</td></tr><tr><td>è®¾ç½®äº† Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•</td><td>æ—¶é—´ç»“æŸ / Object.notify() / Object.notifyAll()</td></tr><tr><td>è®¾ç½®äº† Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•</td><td>æ—¶é—´ç»“æŸ / è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</td></tr><tr><td>LockSupport.parkNanos() æ–¹æ³•</td><td>-</td></tr><tr><td>LockSupport.parkUntil() æ–¹æ³•</td><td>-</td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="æ­»äº¡terminated">æ­»äº¡ï¼ˆTerminatedï¼‰<a href="#æ­»äº¡terminated" class="hash-link" aria-label="Direct link to æ­»äº¡ï¼ˆTerminatedï¼‰" title="Direct link to æ­»äº¡ï¼ˆTerminatedï¼‰">â€‹</a></h4><ul><li>çº¿ç¨‹å› ä¸º run æ–¹æ³•æ­£å¸¸é€€å‡ºè€Œè‡ªç„¶æ­»äº¡</li><li>å› ä¸ºä¸€ä¸ªæ²¡æœ‰æ•è·çš„å¼‚å¸¸ç»ˆæ­¢äº† run æ–¹æ³•è€Œæ„å¤–æ­»äº¡</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-javaå®ç°å¤šçº¿ç¨‹çš„æ–¹å¼åŠä¸‰ç§æ–¹å¼çš„åŒºåˆ«">2. Javaå®ç°å¤šçº¿ç¨‹çš„æ–¹å¼åŠä¸‰ç§æ–¹å¼çš„åŒºåˆ«<a href="#2-javaå®ç°å¤šçº¿ç¨‹çš„æ–¹å¼åŠä¸‰ç§æ–¹å¼çš„åŒºåˆ«" class="hash-link" aria-label="Direct link to 2. Javaå®ç°å¤šçº¿ç¨‹çš„æ–¹å¼åŠä¸‰ç§æ–¹å¼çš„åŒºåˆ«" title="Direct link to 2. Javaå®ç°å¤šçº¿ç¨‹çš„æ–¹å¼åŠä¸‰ç§æ–¹å¼çš„åŒºåˆ«">â€‹</a></h3><p>æœ‰ä¸‰ç§ä½¿ç”¨çº¿ç¨‹çš„æ–¹æ³•ï¼š</p><ul><li>å®ç° Runnable æ¥å£ï¼›</li><li>å®ç° Callable æ¥å£ï¼›</li><li>ç»§æ‰¿ Thread ç±»ã€‚</li></ul><p>å®ç° Runnable å’Œ Callable æ¥å£çš„ç±»åªèƒ½å½“åšä¸€ä¸ªå¯ä»¥åœ¨çº¿ç¨‹ä¸­è¿è¡Œçš„ä»»åŠ¡ï¼Œä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„çº¿ç¨‹ï¼Œå› æ­¤æœ€åè¿˜éœ€è¦é€šè¿‡ Thread æ¥è°ƒç”¨ã€‚å¯ä»¥è¯´ä»»åŠ¡æ˜¯é€šè¿‡çº¿ç¨‹é©±åŠ¨ä»è€Œæ‰§è¡Œçš„ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å®ç°-runnable-æ¥å£">å®ç° Runnable æ¥å£<a href="#å®ç°-runnable-æ¥å£" class="hash-link" aria-label="Direct link to å®ç° Runnable æ¥å£" title="Direct link to å®ç° Runnable æ¥å£">â€‹</a></h4><p>éœ€è¦å®ç° run() æ–¹æ³•ã€‚</p><p>é€šè¿‡ Thread è°ƒç”¨ start() æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyRunnable</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Runnable</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyRunnable</span><span class="token plain"> instance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyRunnable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> thread </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">instance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å®ç°-callable-æ¥å£">å®ç° Callable æ¥å£<a href="#å®ç°-callable-æ¥å£" class="hash-link" aria-label="Direct link to å®ç° Callable æ¥å£" title="Direct link to å®ç° Callable æ¥å£">â€‹</a></h4><p>ä¸ Runnable ç›¸æ¯”ï¼ŒCallable å¯ä»¥æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼é€šè¿‡ FutureTask è¿›è¡Œå°è£…ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyCallable</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Callable</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">123</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutionException</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyCallable</span><span class="token plain"> mc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyCallable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">FutureTask</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> ft </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">FutureTask</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">mc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> thread </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ft</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ft</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ç»§æ‰¿-thread-ç±»">ç»§æ‰¿ Thread ç±»<a href="#ç»§æ‰¿-thread-ç±»" class="hash-link" aria-label="Direct link to ç»§æ‰¿ Thread ç±»" title="Direct link to ç»§æ‰¿ Thread ç±»">â€‹</a></h4><p>åŒæ ·ä¹Ÿæ˜¯éœ€è¦å®ç° run() æ–¹æ³•ï¼Œå› ä¸º Thread ç±»ä¹Ÿå®ç°äº† Runable æ¥å£ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyThread</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyThread</span><span class="token plain"> mt </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    mt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å®ç°æ¥å£-vs-ç»§æ‰¿-thread">å®ç°æ¥å£ VS ç»§æ‰¿ Thread<a href="#å®ç°æ¥å£-vs-ç»§æ‰¿-thread" class="hash-link" aria-label="Direct link to å®ç°æ¥å£ VS ç»§æ‰¿ Thread" title="Direct link to å®ç°æ¥å£ VS ç»§æ‰¿ Thread">â€‹</a></h4><p>å®ç°æ¥å£ä¼šæ›´å¥½ä¸€äº›ï¼Œå› ä¸ºï¼š</p><ul><li>Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œå› æ­¤ç»§æ‰¿äº† Thread ç±»å°±æ— æ³•ç»§æ‰¿å…¶å®ƒç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼›</li><li>ç±»å¯èƒ½åªè¦æ±‚å¯æ‰§è¡Œå°±è¡Œï¼Œç»§æ‰¿æ•´ä¸ª Thread ç±»å¼€é”€è¿‡å¤§ã€‚</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ä¸‰ç§æ–¹å¼çš„åŒºåˆ«">ä¸‰ç§æ–¹å¼çš„åŒºåˆ«<a href="#ä¸‰ç§æ–¹å¼çš„åŒºåˆ«" class="hash-link" aria-label="Direct link to ä¸‰ç§æ–¹å¼çš„åŒºåˆ«" title="Direct link to ä¸‰ç§æ–¹å¼çš„åŒºåˆ«">â€‹</a></h4><ul><li>å®ç° Runnable æ¥å£å¯ä»¥é¿å… Java å•ç»§æ‰¿ç‰¹æ€§è€Œå¸¦æ¥çš„å±€é™ï¼›å¢å¼ºç¨‹åºçš„å¥å£®æ€§ï¼Œä»£ç èƒ½å¤Ÿè¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œä»£ç ä¸æ•°æ®æ˜¯ç‹¬ç«‹çš„ï¼›é€‚åˆå¤šä¸ªç›¸åŒç¨‹åºä»£ç çš„çº¿ç¨‹åŒºå¤„ç†åŒä¸€èµ„æºçš„æƒ…å†µã€‚ </li><li>ç»§æ‰¿ Thread ç±»å’Œå®ç° Runnable æ–¹æ³•å¯åŠ¨çº¿ç¨‹éƒ½æ˜¯ä½¿ç”¨ start() æ–¹æ³•ï¼Œç„¶å JVM è™šæ‹Ÿæœºå°†æ­¤çº¿ç¨‹æ”¾åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ï¼Œå¦‚æœæœ‰å¤„ç†æœºå¯ç”¨ï¼Œåˆ™æ‰§è¡Œ run() æ–¹æ³•ã€‚ </li><li>å®ç° Callable æ¥å£è¦å®ç° call() æ–¹æ³•ï¼Œå¹¶ä¸”çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åä¼šæœ‰è¿”å›å€¼ã€‚å…¶ä»–çš„ä¸¤ç§éƒ½æ˜¯é‡å†™ run() æ–¹æ³•ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚ </li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-åŸºç¡€çº¿ç¨‹æœºåˆ¶">3. åŸºç¡€çº¿ç¨‹æœºåˆ¶<a href="#3-åŸºç¡€çº¿ç¨‹æœºåˆ¶" class="hash-link" aria-label="Direct link to 3. åŸºç¡€çº¿ç¨‹æœºåˆ¶" title="Direct link to 3. åŸºç¡€çº¿ç¨‹æœºåˆ¶">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="executor">Executor<a href="#executor" class="hash-link" aria-label="Direct link to Executor" title="Direct link to Executor">â€‹</a></h4><p>Executor ç®¡ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼Œè€Œæ— éœ€ç¨‹åºå‘˜æ˜¾å¼åœ°ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™é‡Œçš„å¼‚æ­¥æ˜¯æŒ‡å¤šä¸ªä»»åŠ¡çš„æ‰§è¡Œäº’ä¸å¹²æ‰°ï¼Œä¸éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œã€‚</p><p>ä¸»è¦æœ‰ä¸‰ç§ Executorï¼š</p><ul><li>CachedThreadPoolï¼šä¸€ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼›</li><li>FixedThreadPoolï¼šæ‰€æœ‰ä»»åŠ¡åªèƒ½ä½¿ç”¨å›ºå®šå¤§å°çš„çº¿ç¨‹ï¼›</li><li>SingleThreadExecutorï¼šç›¸å½“äºå¤§å°ä¸º 1 çš„ FixedThreadPoolã€‚</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyRunnable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">shutdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ä¸ºä»€ä¹ˆå¼•å…¥Executorçº¿ç¨‹æ± æ¡†æ¶ï¼Ÿ</strong></p><p>new Thread() çš„ç¼ºç‚¹</p><ul><li>æ¯æ¬¡ new Thread() è€—è´¹æ€§èƒ½ </li><li>è°ƒç”¨ new Thread() åˆ›å»ºçš„çº¿ç¨‹ç¼ºä¹ç®¡ç†ï¼Œè¢«ç§°ä¸ºé‡çº¿ç¨‹ï¼Œè€Œä¸”å¯ä»¥æ— é™åˆ¶åˆ›å»ºï¼Œä¹‹é—´ç›¸äº’ç«äº‰ï¼Œä¼šå¯¼è‡´è¿‡å¤šå ç”¨ç³»ç»Ÿèµ„æºå¯¼è‡´ç³»ç»Ÿç˜«ç—ªã€‚ </li><li>ä¸åˆ©äºæ‰©å±•ï¼Œæ¯”å¦‚å¦‚å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€çº¿ç¨‹ä¸­æ–­</li></ul><p>é‡‡ç”¨çº¿ç¨‹æ± çš„ä¼˜ç‚¹</p><ul><li>é‡ç”¨å­˜åœ¨çš„çº¿ç¨‹ï¼Œå‡å°‘å¯¹è±¡åˆ›å»ºã€æ¶ˆäº¡çš„å¼€é”€ï¼Œæ€§èƒ½ä½³ </li><li>å¯æœ‰æ•ˆæ§åˆ¶æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼Œæé«˜ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ç‡ï¼ŒåŒæ—¶é¿å…è¿‡å¤šèµ„æºç«äº‰ï¼Œé¿å…å µå¡ </li><li>æä¾›å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€å•çº¿ç¨‹ã€å¹¶å‘æ•°æ§åˆ¶ç­‰åŠŸèƒ½</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="daemonå®ˆæŠ¤çº¿ç¨‹">Daemonï¼ˆå®ˆæŠ¤çº¿ç¨‹ï¼‰<a href="#daemonå®ˆæŠ¤çº¿ç¨‹" class="hash-link" aria-label="Direct link to Daemonï¼ˆå®ˆæŠ¤çº¿ç¨‹ï¼‰" title="Direct link to Daemonï¼ˆå®ˆæŠ¤çº¿ç¨‹ï¼‰">â€‹</a></h4><p>Java ä¸­æœ‰ä¸¤ç±»çº¿ç¨‹ï¼šUser Thread (ç”¨æˆ·çº¿ç¨‹)ã€Daemon Thread (å®ˆæŠ¤çº¿ç¨‹)</p><p>ç”¨æˆ·çº¿ç¨‹å³è¿è¡Œåœ¨å‰å°çš„çº¿ç¨‹ï¼Œè€Œå®ˆæŠ¤çº¿ç¨‹æ˜¯è¿è¡Œåœ¨åå°çš„çº¿ç¨‹ã€‚ å®ˆæŠ¤çº¿ç¨‹ä½œç”¨æ˜¯ä¸ºå…¶ä»–å‰å°çº¿ç¨‹çš„è¿è¡Œæä¾›ä¾¿åˆ©æœåŠ¡ï¼Œè€Œä¸”ä»…åœ¨æ™®é€šã€éå®ˆæŠ¤çº¿ç¨‹ä»ç„¶è¿è¡Œæ—¶æ‰éœ€è¦ï¼Œæ¯”å¦‚åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ã€‚å½“ JVM æ£€æµ‹ä»…å‰©ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œè€Œç”¨æˆ·çº¿ç¨‹éƒ½å·²ç»é€€å‡ºè¿è¡Œæ—¶ï¼ŒJVM å°±ä¼šé€€å‡ºï¼Œå› ä¸ºæ²¡æœ‰å¦‚æœæ²¡æœ‰äº†è¢«å®ˆæŠ¤è¿™ï¼Œä¹Ÿå°±æ²¡æœ‰ç»§ç»­è¿è¡Œç¨‹åºçš„å¿…è¦äº†ã€‚å¦‚æœæœ‰éå®ˆæŠ¤çº¿ç¨‹ä»ç„¶å­˜æ´»ï¼ŒJVM å°±ä¸ä¼šé€€å‡ºã€‚</p><p>å®ˆæŠ¤çº¿ç¨‹å¹¶éåªæœ‰è™šæ‹Ÿæœºå†…éƒ¨æä¾›ï¼Œç”¨æˆ·åœ¨ç¼–å†™ç¨‹åºæ—¶ä¹Ÿå¯ä»¥è‡ªå·±è®¾ç½®å®ˆæŠ¤çº¿ç¨‹ã€‚ç”¨æˆ·å¯ä»¥ç”¨ Thread çš„ setDaemon(true) æ–¹æ³•è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</p><p>è™½ç„¶å®ˆæŠ¤çº¿ç¨‹å¯èƒ½éå¸¸æœ‰ç”¨ï¼Œä½†å¿…é¡»å°å¿ƒç¡®ä¿å…¶ä»–æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹æ¶ˆäº¡æ—¶ï¼Œä¸ä¼šç”±äºå®ƒçš„ç»ˆæ­¢è€Œäº§ç”Ÿä»»ä½•å±å®³ã€‚å› ä¸ºä½ ä¸å¯èƒ½çŸ¥é“åœ¨æ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹é€€å‡ºè¿è¡Œå‰ï¼Œå®ˆæŠ¤çº¿ç¨‹æ˜¯å¦å·²ç»å®Œæˆäº†é¢„æœŸçš„æœåŠ¡ä»»åŠ¡ã€‚ä¸€æ—¦æ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹é€€å‡ºäº†ï¼Œè™šæ‹Ÿæœºä¹Ÿå°±é€€å‡ºè¿è¡Œäº†ã€‚ å› æ­¤ï¼Œä¸è¦åœ¨å®ˆæŠ¤çº¿ç¨‹ä¸­æ‰§è¡Œä¸šåŠ¡é€»è¾‘æ“ä½œï¼ˆæ¯”å¦‚å¯¹æ•°æ®çš„è¯»å†™ç­‰ï¼‰ã€‚</p><p> <strong>å¦å¤–æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</strong></p><ul><li>setDaemon(true) å¿…é¡»åœ¨è°ƒç”¨çº¿ç¨‹çš„ start() æ–¹æ³•ä¹‹å‰è®¾ç½®ï¼Œå¦åˆ™ä¼šè·‘å‡º IllegalThreadStateException å¼‚å¸¸ã€‚</li><li>åœ¨å®ˆæŠ¤çº¿ç¨‹ä¸­äº§ç”Ÿçš„æ–°çº¿ç¨‹ä¹Ÿæ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚</li><li>ä¸è¦è®¤ä¸ºæ‰€æœ‰çš„åº”ç”¨éƒ½å¯ä»¥åˆ†é…ç»™å®ˆæŠ¤çº¿ç¨‹æ¥è¿›è¡ŒæœåŠ¡ï¼Œæ¯”å¦‚è¯»å†™æ“ä½œæˆ–è€…è®¡ç®—é€»è¾‘ã€‚</li></ul><p>å®ˆæŠ¤çº¿ç¨‹æ˜¯ç¨‹åºè¿è¡Œæ—¶åœ¨åå°æä¾›æœåŠ¡çš„çº¿ç¨‹ï¼Œä¸å±äºç¨‹åºä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚</p><p>å½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ—¶ï¼Œç¨‹åºä¹Ÿå°±ç»ˆæ­¢ï¼ŒåŒæ—¶ä¼šæ€æ­»æ‰€æœ‰å®ˆæŠ¤çº¿ç¨‹ã€‚</p><p>main() å±äºéå®ˆæŠ¤çº¿ç¨‹ã€‚</p><p>ä½¿ç”¨ setDaemon() æ–¹æ³•å°†ä¸€ä¸ªçº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> thread </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyRunnable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setDaemon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="sleep">sleep()<a href="#sleep" class="hash-link" aria-label="Direct link to sleep()" title="Direct link to sleep()">â€‹</a></h4><p>Thread.sleep(millisec) æ–¹æ³•ä¼šä¼‘çœ å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œmillisec å•ä½ä¸ºæ¯«ç§’ã€‚</p><p>sleep() å¯èƒ½ä¼šæŠ›å‡º InterruptedExceptionï¼Œå› ä¸ºå¼‚å¸¸ä¸èƒ½è·¨çº¿ç¨‹ä¼ æ’­å› main() ä¸­ï¼Œå› æ­¤å¿…é¡»åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚çº¿ç¨‹ä¸­æŠ›å‡ºçš„å…¶å®ƒå¼‚å¸¸ä¹ŸåŒæ ·éœ€è¦åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sleep</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="yield">yield()<a href="#yield" class="hash-link" aria-label="Direct link to yield()" title="Direct link to yield()">â€‹</a></h4><p>å¯¹é™æ€æ–¹æ³• Thread.yield() çš„è°ƒç”¨å£°æ˜äº†<strong>å½“å‰çº¿ç¨‹å·²ç»å®Œæˆäº†ç”Ÿå‘½å‘¨æœŸä¸­æœ€é‡è¦çš„éƒ¨åˆ†</strong>ï¼Œå¯ä»¥åˆ‡æ¢ç»™å…¶å®ƒçº¿ç¨‹æ¥æ‰§è¡Œã€‚è¯¥æ–¹æ³•åªæ˜¯å¯¹çº¿ç¨‹è°ƒåº¦å™¨çš„ä¸€ä¸ªå»ºè®®ï¼Œè€Œä¸”ä¹Ÿåªæ˜¯å»ºè®®å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„å…¶å®ƒçº¿ç¨‹å¯ä»¥è¿è¡Œã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">yield</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="çº¿ç¨‹é˜»å¡">çº¿ç¨‹é˜»å¡<a href="#çº¿ç¨‹é˜»å¡" class="hash-link" aria-label="Direct link to çº¿ç¨‹é˜»å¡" title="Direct link to çº¿ç¨‹é˜»å¡">â€‹</a></h4><p>çº¿ç¨‹å¯ä»¥é˜»å¡äºå››ç§çŠ¶æ€ï¼š</p><ul><li>å½“çº¿ç¨‹æ‰§è¡Œ Thread.sleep() æ—¶ï¼Œå®ƒä¸€ç›´é˜»å¡åˆ°æŒ‡å®šçš„æ¯«ç§’æ—¶é—´ä¹‹åï¼Œæˆ–è€…é˜»å¡è¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰“æ–­ï¼›</li><li>å½“çº¿ç¨‹ç¢°åˆ°ä¸€æ¡ wait() è¯­å¥æ—¶ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡åˆ°æ¥åˆ°é€šçŸ¥ notify()ã€è¢«ä¸­æ–­æˆ–ç»è¿‡äº†æŒ‡å®šæ¯«ç§’æ—¶é—´ä¸ºæ­¢ï¼ˆè‹¥åˆ¶å®šäº†è¶…æ—¶å€¼çš„è¯ï¼‰</li><li>çº¿ç¨‹é˜»å¡ä¸ä¸åŒ I/O çš„æ–¹å¼æœ‰å¤šç§ã€‚å¸¸è§çš„ä¸€ç§æ–¹å¼æ˜¯ InputStream çš„ read() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸€ç›´é˜»å¡åˆ°ä»æµä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ä¸ºæ­¢ï¼Œå®ƒå¯ä»¥æ— é™é˜»å¡ï¼Œå› æ­¤ä¸èƒ½æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼›</li><li>çº¿ç¨‹ä¹Ÿå¯ä»¥é˜»å¡ç­‰å¾…è·å–æŸä¸ªå¯¹è±¡é”çš„æ’ä»–æ€§è®¿é—®æƒé™ï¼ˆå³ç­‰å¾…è·å¾— synchronized è¯­å¥å¿…é¡»çš„é”æ—¶é˜»å¡ï¼‰ã€‚</li></ul><blockquote><p>æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰çš„é˜»å¡çŠ¶æ€éƒ½æ˜¯å¯ä¸­æ–­çš„ï¼Œä»¥ä¸Šé˜»å¡çŠ¶æ€çš„å‰ä¸¤ç§å¯ä»¥è¢«ä¸­æ–­ï¼Œåä¸¤ç§ä¸ä¼šå¯¹ä¸­æ–­åšå‡ºååº”</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-ä¸­æ–­">4. ä¸­æ–­<a href="#4-ä¸­æ–­" class="hash-link" aria-label="Direct link to 4. ä¸­æ–­" title="Direct link to 4. ä¸­æ–­">â€‹</a></h3><p>ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šè‡ªåŠ¨ç»“æŸï¼Œå¦‚æœåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¼šæå‰ç»“æŸã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="interruptedexception">InterruptedException<a href="#interruptedexception" class="hash-link" aria-label="Direct link to InterruptedException" title="Direct link to InterruptedException">â€‹</a></h4><p>é€šè¿‡è°ƒç”¨ä¸€ä¸ªçº¿ç¨‹çš„ interrupt() æ¥ä¸­æ–­è¯¥çº¿ç¨‹ï¼Œå¦‚æœè¯¥çº¿ç¨‹å¤„äº<strong>é˜»å¡ã€é™æœŸç­‰å¾…æˆ–è€…æ— é™æœŸç­‰å¾…</strong>çŠ¶æ€ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º InterruptedExceptionï¼Œä»è€Œæå‰ç»“æŸè¯¥çº¿ç¨‹ã€‚ä½†æ˜¯ä¸èƒ½ä¸­æ–­ I/O é˜»å¡å’Œ synchronized é”é˜»å¡ã€‚</p><p>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œåœ¨ main() ä¸­å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¹‹åå†ä¸­æ–­å®ƒï¼Œç”±äºçº¿ç¨‹ä¸­è°ƒç”¨äº† Thread.sleep() æ–¹æ³•ï¼Œå› æ­¤ä¼šæŠ›å‡ºä¸€ä¸ª InterruptedExceptionï¼Œä»è€Œæå‰ç»“æŸçº¿ç¨‹ï¼Œä¸æ‰§è¡Œä¹‹åçš„è¯­å¥ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyThread1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sleep</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Thread run&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> thread1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyThread1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    thread1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    thread1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">interrupt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Main run&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token class-name" style="color:rgb(255, 203, 107)">Main</span><span class="token plain"> run</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">lang</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> sleep interrupted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">lang</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sleep</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Native</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Method</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lambda$main$</span><span class="token function" style="color:rgb(130, 170, 255)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptExample</span><span class="token plain">$$</span><span class="token class-name" style="color:rgb(255, 203, 107)">Lambda</span><span class="token plain">$</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">713338599.</span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Unknown</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">lang</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">745</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="interrupted">interrupted()<a href="#interrupted" class="hash-link" aria-label="Direct link to interrupted()" title="Direct link to interrupted()">â€‹</a></h4><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹çš„ run() æ–¹æ³•æ‰§è¡Œä¸€ä¸ªæ— é™å¾ªç¯ï¼Œå¹¶ä¸”æ²¡æœ‰æ‰§è¡Œ sleep() ç­‰ä¼šæŠ›å‡º InterruptedException çš„æ“ä½œï¼Œé‚£ä¹ˆè°ƒç”¨çº¿ç¨‹çš„ interrupt() æ–¹æ³•å°±æ— æ³•ä½¿çº¿ç¨‹æå‰ç»“æŸã€‚</p><p>ä½†æ˜¯è°ƒç”¨ interrupt() æ–¹æ³•ä¼šè®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°ï¼Œæ­¤æ—¶è°ƒç”¨ interrupted() æ–¹æ³•ä¼šè¿”å› trueã€‚å› æ­¤å¯ä»¥åœ¨å¾ªç¯ä½“ä¸­ä½¿ç”¨ interrupted() æ–¹æ³•æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å¤„äºä¸­æ–­çŠ¶æ€ï¼Œä»è€Œæå‰ç»“æŸçº¿ç¨‹ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyThread2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token function" style="color:rgb(130, 170, 255)">interrupted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Thread end&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token known-class-name class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> throws </span><span class="token maybe-class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">Thread</span><span class="token plain"> thread2 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyThread2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    thread2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    thread2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">interrupt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Thread end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="executor-çš„ä¸­æ–­æ“ä½œ">Executor çš„ä¸­æ–­æ“ä½œ<a href="#executor-çš„ä¸­æ–­æ“ä½œ" class="hash-link" aria-label="Direct link to Executor çš„ä¸­æ–­æ“ä½œ" title="Direct link to Executor çš„ä¸­æ–­æ“ä½œ">â€‹</a></h4><p>è°ƒç”¨ Executor çš„ shutdown() æ–¹æ³•ä¼šç­‰å¾…çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åå†å…³é—­ï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨çš„æ˜¯ shutdownNow() æ–¹æ³•ï¼Œåˆ™ç›¸å½“äºè°ƒç”¨æ¯ä¸ªçº¿ç¨‹çš„ interrupt() æ–¹æ³•ã€‚</p><p>ä»¥ä¸‹ä½¿ç”¨ Lambda åˆ›å»ºçº¿ç¨‹ï¼Œç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªåŒ¿åå†…éƒ¨çº¿ç¨‹ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sleep</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Thread run&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">shutdownNow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Main run&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token class-name" style="color:rgb(255, 203, 107)">Main</span><span class="token plain"> run</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">lang</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> sleep interrupted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">lang</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sleep</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Native</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Method</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorInterruptExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lambda$main$</span><span class="token function" style="color:rgb(130, 170, 255)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorInterruptExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorInterruptExample</span><span class="token plain">$$</span><span class="token class-name" style="color:rgb(255, 203, 107)">Lambda</span><span class="token plain">$</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">1160460865.</span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Unknown</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">util</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">concurrent</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadPoolExecutor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">runWorker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadPoolExecutor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">1142</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">util</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">concurrent</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadPoolExecutor</span><span class="token plain">$</span><span class="token class-name" style="color:rgb(255, 203, 107)">Worker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadPoolExecutor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">617</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">lang</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">745</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦‚æœåªæƒ³ä¸­æ–­ Executor ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ submit() æ–¹æ³•æ¥æäº¤ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª Future&lt;?&gt; å¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨è¯¥å¯¹è±¡çš„ cancel(true) æ–¹æ³•å°±å¯ä»¥ä¸­æ–­çº¿ç¨‹ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token class-name" style="color:rgb(255, 203, 107)">Future</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics operator" style="color:rgb(137, 221, 255)">?</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> future </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">submit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">future</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">cancel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-äº’æ–¥åŒæ­¥">5. äº’æ–¥åŒæ­¥<a href="#5-äº’æ–¥åŒæ­¥" class="hash-link" aria-label="Direct link to 5. äº’æ–¥åŒæ­¥" title="Direct link to 5. äº’æ–¥åŒæ­¥">â€‹</a></h3><p>Java æä¾›äº†ä¸¤ç§é”æœºåˆ¶æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®ï¼Œç¬¬ä¸€ä¸ªæ˜¯ JVM å®ç°çš„ synchronizedï¼Œè€Œå¦ä¸€ä¸ªæ˜¯ JDK å®ç°çš„ ReentrantLockã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="synchronized">synchronized<a href="#synchronized" class="hash-link" aria-label="Direct link to synchronized" title="Direct link to synchronized">â€‹</a></h4><p><strong>1. åŒæ­¥ä¸€ä¸ªä»£ç å—</strong></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å®ƒåªä½œç”¨äºåŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœè°ƒç”¨ä¸¤ä¸ªå¯¹è±¡ä¸Šçš„åŒæ­¥ä»£ç å—ï¼Œå°±ä¸ä¼šè¿›è¡ŒåŒæ­¥ã€‚</p><p>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œä½¿ç”¨ ExecutorService æ‰§è¡Œäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œç”±äºè°ƒç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥ä»£ç å—ï¼Œå› æ­¤è¿™ä¸¤ä¸ªçº¿ç¨‹ä¼šè¿›è¡ŒåŒæ­¥ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥è¯­å¥å—æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±å¿…é¡»ç­‰å¾…ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">func1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token plain"> e1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> e1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">func1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> e1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">func1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œä¸¤ä¸ªçº¿ç¨‹è°ƒç”¨äº†ä¸åŒå¯¹è±¡çš„åŒæ­¥ä»£ç å—ï¼Œå› æ­¤è¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¸éœ€è¦åŒæ­¥ã€‚ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œä¸¤ä¸ªçº¿ç¨‹äº¤å‰æ‰§è¡Œã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token plain"> e1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token plain"> e2 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> e1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">func1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> e2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">func1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">0 0 1 1 2 2 3 3 4 4 5 5 6 6 7 7 8 8 9 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>2. åŒæ­¥ä¸€ä¸ªæ–¹æ³•</strong></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> func </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å®ƒå’ŒåŒæ­¥ä»£ç å—ä¸€æ ·ï¼Œä½œç”¨äºåŒä¸€ä¸ªå¯¹è±¡ã€‚</p><p><strong>3. åŒæ­¥ä¸€ä¸ªç±»</strong></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">class</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä½œç”¨äºæ•´ä¸ªç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªçº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡ä¸Šçš„è¿™ç§åŒæ­¥è¯­å¥ï¼Œä¹Ÿä¼šè¿›è¡ŒåŒæ­¥ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">func2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">class</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token plain"> e1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token plain"> e2 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SynchronizedExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> e1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">func2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> e2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">func2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>4. åŒæ­¥ä¸€ä¸ªé™æ€æ–¹æ³•</strong></p><ul><li>éé™æ€åŒæ­¥å‡½æ•°çš„é”æ˜¯ï¼šthis</li><li>é™æ€çš„åŒæ­¥å‡½æ•°çš„é”æ˜¯ï¼šå­—èŠ‚ç å¯¹è±¡</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fun</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä½œç”¨äºæ•´ä¸ªç±»ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="reentrantlock">ReentrantLock<a href="#reentrantlock" class="hash-link" aria-label="Direct link to ReentrantLock" title="Direct link to ReentrantLock">â€‹</a></h4><p>é‡å…¥é”ï¼ˆReentrantLockï¼‰æ˜¯ä¸€ç§é€’å½’æ— é˜»å¡çš„åŒæ­¥æœºåˆ¶ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">LockExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Lock</span><span class="token plain"> lock </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ReentrantLock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">unlock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ç¡®ä¿é‡Šæ”¾é”ï¼Œä»è€Œé¿å…å‘ç”Ÿæ­»é”ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">LockExample</span><span class="token plain"> lockExample </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">LockExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> lockExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> lockExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ReentrantLock æ˜¯ java.util.concurrentï¼ˆJ.U.Cï¼‰åŒ…ä¸­çš„é”ï¼Œç›¸æ¯”äº synchronizedï¼Œå®ƒå¤šäº†ä»¥ä¸‹é«˜çº§åŠŸèƒ½ï¼š</p><p><strong>1. ç­‰å¾…å¯ä¸­æ–­</strong></p><p>å½“æŒæœ‰é”çš„çº¿ç¨‹é•¿æœŸä¸é‡Šæ”¾é”çš„æ—¶å€™ï¼Œæ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚</p><p><strong>2. å¯å®ç°å…¬å¹³é”</strong></p><p>å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åŒä¸€ä¸ªé”æ—¶ï¼Œå¿…é¡»æŒ‰ç…§ç”³è¯·é”çš„æ—¶é—´é¡ºåºæ¥ä¾æ¬¡è·å¾—é”ã€‚</p><p>synchronized ä¸­çš„é”æ˜¯éå…¬å¹³çš„ï¼ŒReentrantLock é»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯éå…¬å¹³çš„ï¼Œä½†å¯ä»¥é€šè¿‡å¸¦å¸ƒå°”å€¼çš„æ„é€ å‡½æ•°è¦æ±‚ä½¿ç”¨å…¬å¹³é”ã€‚</p><p><strong>3. é”ç»‘å®šå¤šä¸ªæ¡ä»¶</strong></p><p>ä¸€ä¸ª ReentrantLock å¯¹è±¡å¯ä»¥åŒæ—¶ç»‘å®šå¤šä¸ª Condition å¯¹è±¡ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="synchronized-å’Œ-reentrantlock-æ¯”è¾ƒ">synchronized å’Œ ReentrantLock æ¯”è¾ƒ<a href="#synchronized-å’Œ-reentrantlock-æ¯”è¾ƒ" class="hash-link" aria-label="Direct link to synchronized å’Œ ReentrantLock æ¯”è¾ƒ" title="Direct link to synchronized å’Œ ReentrantLock æ¯”è¾ƒ">â€‹</a></h4><p><strong>1. é”çš„å®ç°</strong></p><p>synchronized æ˜¯ JVM å®ç°çš„ï¼Œè€Œ ReentrantLock æ˜¯ JDK å®ç°çš„ã€‚</p><p><strong>2. æ€§èƒ½</strong></p><p>æ–°ç‰ˆæœ¬ Java å¯¹ synchronized è¿›è¡Œäº†å¾ˆå¤šä¼˜åŒ–ï¼Œä¾‹å¦‚è‡ªæ—‹é”ç­‰ã€‚ç›®å‰æ¥çœ‹å®ƒå’Œ ReentrantLock çš„æ€§èƒ½åŸºæœ¬æŒå¹³äº†ï¼Œå› æ­¤æ€§èƒ½å› ç´ ä¸å†æ˜¯é€‰æ‹© ReentrantLock çš„ç†ç”±ã€‚synchronized æœ‰æ›´å¤§çš„æ€§èƒ½ä¼˜åŒ–ç©ºé—´ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘ synchronizedã€‚</p><p><strong>3. åŠŸèƒ½</strong></p><p>ReentrantLock å¤šäº†ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚</p><p><strong>4. ä½¿ç”¨é€‰æ‹©</strong></p><p>é™¤ééœ€è¦ä½¿ç”¨ ReentrantLock çš„é«˜çº§åŠŸèƒ½ï¼Œå¦åˆ™ä¼˜å…ˆä½¿ç”¨ synchronizedã€‚è¿™æ˜¯å› ä¸º synchronized æ˜¯ JVM å®ç°çš„ä¸€ç§é”æœºåˆ¶ï¼ŒJVM åŸç”Ÿåœ°æ”¯æŒå®ƒï¼Œè€Œ ReentrantLock ä¸æ˜¯æ‰€æœ‰çš„ JDK ç‰ˆæœ¬éƒ½æ”¯æŒã€‚å¹¶ä¸”ä½¿ç”¨ synchronized ä¸ç”¨æ‹…å¿ƒæ²¡æœ‰é‡Šæ”¾é”è€Œå¯¼è‡´æ­»é”é—®é¢˜ï¼Œå› ä¸º JVM ä¼šç¡®ä¿é”çš„é‡Šæ”¾ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="synchronizedä¸lockçš„åŒºåˆ«ä½¿ç”¨åœºæ™¯çœ‹è¿‡synchronizedçš„æºç æ²¡">synchronizedä¸lockçš„åŒºåˆ«ï¼Œä½¿ç”¨åœºæ™¯ã€‚çœ‹è¿‡synchronizedçš„æºç æ²¡ï¼Ÿ<a href="#synchronizedä¸lockçš„åŒºåˆ«ä½¿ç”¨åœºæ™¯çœ‹è¿‡synchronizedçš„æºç æ²¡" class="hash-link" aria-label="Direct link to synchronizedä¸lockçš„åŒºåˆ«ï¼Œä½¿ç”¨åœºæ™¯ã€‚çœ‹è¿‡synchronizedçš„æºç æ²¡ï¼Ÿ" title="Direct link to synchronizedä¸lockçš„åŒºåˆ«ï¼Œä½¿ç”¨åœºæ™¯ã€‚çœ‹è¿‡synchronizedçš„æºç æ²¡ï¼Ÿ">â€‹</a></h4><ul><li>ï¼ˆç”¨æ³•ï¼‰synchronizedï¼ˆéšå¼é”ï¼‰ï¼šåœ¨éœ€è¦åŒæ­¥çš„å¯¹è±¡ä¸­åŠ å…¥æ­¤æ§åˆ¶ï¼Œsynchronized å¯ä»¥åŠ åœ¨æ–¹æ³•ä¸Šï¼Œä¹Ÿå¯ä»¥åŠ åœ¨ç‰¹å®šä»£ç å—ä¸­ï¼Œæ‹¬å·ä¸­è¡¨ç¤ºéœ€è¦é”çš„å¯¹è±¡ã€‚ </li><li>ï¼ˆç”¨æ³•ï¼‰lockï¼ˆæ˜¾ç¤ºé”ï¼‰ï¼šéœ€è¦æ˜¾ç¤ºæŒ‡å®šèµ·å§‹ä½ç½®å’Œç»ˆæ­¢ä½ç½®ã€‚ä¸€èˆ¬ä½¿ç”¨ ReentrantLock ç±»åšä¸ºé”ï¼Œå¤šä¸ªçº¿ç¨‹ä¸­å¿…é¡»è¦ä½¿ç”¨ä¸€ä¸ª ReentrantLock ç±»åšä¸ºå¯¹è±¡æ‰èƒ½ä¿è¯é”çš„ç”Ÿæ•ˆã€‚ä¸”åœ¨åŠ é”å’Œè§£é”å¤„éœ€è¦é€šè¿‡ lock() å’Œ unlock() æ˜¾ç¤ºæŒ‡å‡ºã€‚æ‰€ä»¥ä¸€èˆ¬ä¼šåœ¨ finally å—ä¸­å†™ unlock() ä»¥é˜²æ­»é”ã€‚ </li><li>ï¼ˆæ€§èƒ½ï¼‰synchronized æ˜¯æ‰˜ç®¡ç»™ JVM æ‰§è¡Œçš„ï¼Œè€Œ lock æ˜¯ Java å†™çš„æ§åˆ¶é”çš„ä»£ç ã€‚åœ¨ Java1.5 ä¸­ï¼Œsynchronize æ˜¯æ€§èƒ½ä½æ•ˆçš„ã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªé‡é‡çº§æ“ä½œï¼Œéœ€è¦è°ƒç”¨æ“ä½œæ¥å£ï¼Œå¯¼è‡´æœ‰å¯èƒ½åŠ é”æ¶ˆè€—çš„ç³»ç»Ÿæ—¶é—´æ¯”åŠ é”ä»¥å¤–çš„æ“ä½œè¿˜å¤šã€‚ç›¸æ¯”ä¹‹ä¸‹ä½¿ç”¨ Java æä¾›çš„ Lock å¯¹è±¡ï¼Œæ€§èƒ½æ›´é«˜ä¸€äº›ã€‚ä½†æ˜¯åˆ°äº† Java1.6 ï¼Œå‘ç”Ÿäº†å˜åŒ–ã€‚synchronize åœ¨è¯­ä¹‰ä¸Šå¾ˆæ¸…æ™°ï¼Œå¯ä»¥è¿›è¡Œå¾ˆå¤šä¼˜åŒ–ï¼Œæœ‰<u>é€‚åº”è‡ªæ—‹ï¼Œé”æ¶ˆé™¤ï¼Œé”ç²—åŒ–ï¼Œè½»é‡çº§é”ï¼Œåå‘é”</u>ç­‰ç­‰ã€‚å¯¼è‡´ åœ¨ Java1.6 ä¸Š synchronize çš„æ€§èƒ½å¹¶ä¸æ¯” Lock å·®ã€‚ </li><li>ï¼ˆæœºåˆ¶ï¼‰<strong>synchronized åŸå§‹é‡‡ç”¨çš„æ˜¯ CPU æ‚²è§‚é”æœºåˆ¶ï¼Œå³çº¿ç¨‹è·å¾—çš„æ˜¯ç‹¬å é”ã€‚Lock ä¹Ÿå±äºæ‚²è§‚é”</strong>ã€‚ç‹¬å é”æ„å‘³ç€å…¶ä»–çº¿ç¨‹åªèƒ½ä¾é é˜»å¡æ¥ç­‰å¾…çº¿ç¨‹é‡Šæ”¾é”ã€‚ç›¸å¯¹è€Œè¨€ä¹è§‚é”æ¯æ¬¡ä¸åŠ é”ï¼Œè€Œæ˜¯å‡è®¾æ²¡æœ‰å†²çªè€Œå»å®ŒæˆæŸé¡¹æ“ä½œï¼Œå¦‚æœå› ä¸ºå†²çªå¤±è´¥å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚ä¹è§‚é”å®ç°çš„æœºåˆ¶å°±æ˜¯ CAS æ“ä½œï¼ˆCompare and Swapï¼‰ã€‚ </li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ä»€ä¹ˆæ˜¯cas">ä»€ä¹ˆæ˜¯CAS<a href="#ä»€ä¹ˆæ˜¯cas" class="hash-link" aria-label="Direct link to ä»€ä¹ˆæ˜¯CAS" title="Direct link to ä»€ä¹ˆæ˜¯CAS">â€‹</a></h4><blockquote><p>è˜‘è‡è¡—é¢è¯•ï¼Œè¿™é‡Œç®€å•è®ºè¿°ä¸€ä¸‹</p></blockquote><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å…¥é—¨ä¾‹å­">å…¥é—¨ä¾‹å­<a href="#å…¥é—¨ä¾‹å­" class="hash-link" aria-label="Direct link to å…¥é—¨ä¾‹å­" title="Direct link to å…¥é—¨ä¾‹å­">â€‹</a></h5><p>åœ¨ Java å¹¶å‘åŒ…ä¸­æœ‰è¿™æ ·ä¸€ä¸ªåŒ…ï¼Œjava.util.concurrent.atomicï¼Œè¯¥åŒ…æ˜¯å¯¹ Java éƒ¨åˆ†æ•°æ®ç±»å‹çš„åŸå­å°è£…ï¼Œåœ¨åŸæœ‰æ•°æ®ç±»å‹çš„åŸºç¡€ä¸Šï¼Œæä¾›äº†åŸå­æ€§çš„æ“ä½œæ–¹æ³•ï¼Œä¿è¯äº†çº¿ç¨‹å®‰å…¨ã€‚ä¸‹é¢ä»¥ AtomicInteger ä¸ºä¾‹ï¼Œæ¥çœ‹ä¸€ä¸‹æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">incrementAndGet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> current </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> next </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> current </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">compareAndSet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">current</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">decrementAndGet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> current </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> next </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> current </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">compareAndSet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">current</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä»¥è¿™ä¸¤ä¸ªæ–¹æ³•ä¸ºä¾‹ï¼ŒincrementAndGet æ–¹æ³•ç›¸å½“äºåŸå­æ€§çš„ ++iï¼ŒdecrementAndGet æ–¹æ³•ç›¸å½“äºåŸå­æ€§çš„ --iï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¸­éƒ½æ²¡æœ‰ä½¿ç”¨é˜»å¡å¼çš„æ–¹å¼æ¥ä¿è¯åŸå­æ€§ï¼ˆå¦‚ Synchronized ï¼‰ï¼Œé‚£å®ƒä»¬æ˜¯å¦‚ä½•ä¿è¯åŸå­æ€§çš„å‘¢ï¼Œä¸‹é¢å¼•å‡º CASã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="compare-and-swap">Compare And Swap<a href="#compare-and-swap" class="hash-link" aria-label="Direct link to Compare And Swap" title="Direct link to Compare And Swap">â€‹</a></h5><p>CAS æŒ‡çš„æ˜¯ç°ä»£ CPU å¹¿æ³›æ”¯æŒçš„ä¸€ç§å¯¹å†…å­˜ä¸­çš„å…±äº«æ•°æ®è¿›è¡Œæ“ä½œçš„ä¸€ç§ç‰¹æ®ŠæŒ‡ä»¤ã€‚è¿™ä¸ªæŒ‡ä»¤ä¼šå¯¹å†…å­˜ä¸­çš„å…±äº«æ•°æ®åšåŸå­çš„è¯»å†™æ“ä½œã€‚</p><p>ç®€å•ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæŒ‡ä»¤çš„æ“ä½œè¿‡ç¨‹ï¼š</p><ul><li>é¦–å…ˆï¼ŒCPU ä¼šå°†å†…å­˜ä¸­å°†è¦è¢«æ›´æ”¹çš„æ•°æ®ä¸æœŸæœ›çš„å€¼åšæ¯”è¾ƒã€‚</li><li>ç„¶åï¼Œå½“è¿™ä¸¤ä¸ªå€¼ç›¸ç­‰æ—¶ï¼ŒCPU æ‰ä¼šå°†å†…å­˜ä¸­çš„æ•°å€¼æ›¿æ¢ä¸ºæ–°çš„å€¼ã€‚å¦åˆ™ä¾¿ä¸åšæ“ä½œã€‚</li><li>æœ€åï¼ŒCPU ä¼šå°†æ—§çš„æ•°å€¼è¿”å›ã€‚</li></ul><p>è¿™ä¸€ç³»åˆ—çš„æ“ä½œæ˜¯åŸå­çš„ã€‚å®ƒä»¬è™½ç„¶çœ‹ä¼¼å¤æ‚ï¼Œä½†å´æ˜¯ Java 5 å¹¶å‘æœºåˆ¶ä¼˜äºåŸæœ‰é”æœºåˆ¶çš„æ ¹æœ¬ã€‚ç®€å•æ¥è¯´ï¼ŒCAS çš„å«ä¹‰æ˜¯ï¼šæˆ‘è®¤ä¸ºåŸæœ‰çš„å€¼åº”è¯¥æ˜¯ä»€ä¹ˆï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†åŸæœ‰çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¦åˆ™ä¸åšä¿®æ”¹ï¼Œå¹¶å‘Šè¯‰æˆ‘åŸæ¥çš„å€¼æ˜¯å¤šå°‘ã€‚
â€‹       ç®€å•çš„æ¥è¯´ï¼ŒCAS æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œå†…å­˜å€¼ Vï¼Œæ—§çš„é¢„æœŸå€¼ Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼ Bã€‚å½“ä¸”ä»…å½“é¢„æœŸå€¼ A å’Œå†…å­˜å€¼ V ç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼ V ä¿®æ”¹ä¸º Bï¼Œå¦åˆ™è¿”å› Vã€‚è¿™æ˜¯ä¸€ç§ä¹è§‚é”çš„æ€è·¯ï¼Œå®ƒç›¸ä¿¡åœ¨å®ƒä¿®æ”¹ä¹‹å‰ï¼Œæ²¡æœ‰å…¶å®ƒçº¿ç¨‹å»ä¿®æ”¹å®ƒï¼›è€Œ Synchronized æ˜¯ä¸€ç§æ‚²è§‚é”ï¼Œå®ƒè®¤ä¸ºåœ¨å®ƒä¿®æ”¹ä¹‹å‰ï¼Œä¸€å®šä¼šæœ‰å…¶å®ƒçº¿ç¨‹å»ä¿®æ”¹å®ƒï¼Œæ‚²è§‚é”æ•ˆç‡å¾ˆä½ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”">ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”<a href="#ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”" class="hash-link" aria-label="Direct link to ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”" title="Direct link to ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”">â€‹</a></h4><ul><li>ä¸ºä»€ä¹ˆéœ€è¦é”ï¼ˆå¹¶å‘æ§åˆ¶ï¼‰<ul><li>åœ¨å¤šç”¨æˆ·ç¯å¢ƒä¸­ï¼Œåœ¨åŒä¸€æ—¶é—´å¯èƒ½ä¼šæœ‰å¤šä¸ªç”¨æˆ·æ›´æ–°ç›¸åŒçš„è®°å½•ï¼Œè¿™ä¼šäº§ç”Ÿå†²çªã€‚è¿™å°±æ˜¯è‘—åçš„å¹¶å‘æ€§é—®é¢˜ã€‚</li><li>å…¸å‹çš„å†²çªæœ‰ï¼š<ul><li>ä¸¢å¤±æ›´æ–°ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°è¦†ç›–äº†å…¶å®ƒäº‹åŠ¡çš„æ›´æ–°ç»“æœï¼Œå°±æ˜¯æ‰€è°“çš„æ›´æ–°ä¸¢å¤±ã€‚ä¾‹å¦‚ï¼šç”¨æˆ· A æŠŠå€¼ä» 6 æ”¹ä¸º 2ï¼Œç”¨æˆ· B æŠŠå€¼ä» 2 æ”¹ä¸º 6ï¼Œåˆ™ç”¨æˆ· A ä¸¢å¤±äº†ä»–çš„æ›´æ–°ã€‚</li><li>è„è¯»ï¼šå½“ä¸€ä¸ªäº‹åŠ¡è¯»å–å…¶å®ƒå®Œæˆä¸€åŠäº‹åŠ¡çš„è®°å½•æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè„è¯»å–ã€‚ä¾‹å¦‚ï¼šç”¨æˆ· A,B çœ‹åˆ°çš„å€¼éƒ½æ˜¯6ï¼Œç”¨æˆ· B æŠŠå€¼æ”¹ä¸º 2ï¼Œç”¨æˆ· A è¯»åˆ°çš„å€¼ä»ä¸º 6ã€‚</li></ul></li><li>ä¸ºäº†è§£å†³è¿™äº›å¹¶å‘å¸¦æ¥çš„é—®é¢˜ã€‚ æˆ‘ä»¬éœ€è¦å¼•å…¥å¹¶å‘æ§åˆ¶æœºåˆ¶ã€‚</li></ul></li><li>å¹¶å‘æ§åˆ¶æœºåˆ¶<ul><li><strong>æ‚²è§‚é”ï¼šå‡å®šä¼šå‘ç”Ÿå¹¶å‘å†²çª</strong>ï¼Œç‹¬å é”ï¼Œå±è”½ä¸€åˆ‡å¯èƒ½è¿åæ•°æ®å®Œæ•´æ€§çš„æ“ä½œã€‚</li><li><strong>ä¹è§‚é”ï¼šå‡è®¾ä¸ä¼šå‘ç”Ÿå¹¶å‘å†²çª</strong>ï¼Œåªåœ¨æäº¤æ“ä½œæ—¶æ£€æŸ¥æ˜¯å¦è¿åæ•°æ®å®Œæ•´æ€§ã€‚ä¹è§‚é”ä¸èƒ½è§£å†³è„è¯»çš„é—®é¢˜ã€‚</li></ul></li></ul><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="https://www.cnblogs.com/0201zcr/p/4782283.html" target="_blank" rel="noopener noreferrer">ä¹è§‚é”ä¸æ‚²è§‚é”â€”â€”è§£å†³å¹¶å‘é—®é¢˜ - WhyWin - åšå®¢å›­</a></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="synchronizedå¯¹è±¡é”å’Œstatic-synchronizedç±»é”åŒºåˆ«">Synchronizedï¼ˆå¯¹è±¡é”ï¼‰å’ŒStatic Synchronizedï¼ˆç±»é”ï¼‰åŒºåˆ«<a href="#synchronizedå¯¹è±¡é”å’Œstatic-synchronizedç±»é”åŒºåˆ«" class="hash-link" aria-label="Direct link to Synchronizedï¼ˆå¯¹è±¡é”ï¼‰å’ŒStatic Synchronizedï¼ˆç±»é”ï¼‰åŒºåˆ«" title="Direct link to Synchronizedï¼ˆå¯¹è±¡é”ï¼‰å’ŒStatic Synchronizedï¼ˆç±»é”ï¼‰åŒºåˆ«">â€‹</a></h4><ul><li><p>ä¸€ä¸ªæ˜¯å®ä¾‹é”ï¼ˆé”åœ¨æŸä¸€ä¸ªå®ä¾‹å¯¹è±¡ä¸Šï¼Œå¦‚æœè¯¥ç±»æ˜¯å•ä¾‹ï¼Œé‚£ä¹ˆè¯¥é”ä¹Ÿå…·æœ‰å…¨å±€é”çš„æ¦‚å¿µï¼‰ï¼Œä¸€ä¸ªæ˜¯å…¨å±€é”ï¼ˆè¯¥é”é’ˆå¯¹çš„æ˜¯ç±»ï¼Œæ— è®ºå®ä¾‹å¤šå°‘ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆçº¿ç¨‹éƒ½å…±äº«è¯¥é”ï¼‰ã€‚</p><p>å®ä¾‹é”å¯¹åº”çš„å°±æ˜¯ synchronizedå…³ é”®å­—ï¼Œè€Œç±»é”ï¼ˆå…¨å±€é”ï¼‰å¯¹åº”çš„å°±æ˜¯ static synchronizedï¼ˆæˆ–è€…æ˜¯é”åœ¨è¯¥ç±»çš„ class æˆ–è€… classloader å¯¹è±¡ä¸Šï¼‰ã€‚</p></li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * static synchronized å’Œsynchronizedçš„åŒºåˆ«ï¼</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> * å…³é”®æ˜¯åŒºåˆ«ç¬¬å››ç§æƒ…å†µï¼</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">StaticSynchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">     * synchronizedæ–¹æ³•</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">isSynA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;isSynA&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">isSynB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;isSynB&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">     * static synchronizedæ–¹æ³•</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cSynA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cSynA&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cSynB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cSynB&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">StaticSynchronized</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">StaticSynchronized</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">StaticSynchronized</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">StaticSynchronized</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">         *  x.isSynA()ä¸x.isSynB(); ä¸èƒ½åŒæ—¶è®¿é—®(åŒä¸€ä¸ªå¯¹è±¡è®¿é—®synchronizedæ–¹æ³•)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">         *  x.isSynA()ä¸y.isSynB(); èƒ½åŒæ—¶è®¿é—®(ä¸åŒå¯¹è±¡è®¿é—®synchronizedæ–¹æ³•)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">         *  x.cSynA()ä¸y.cSynB(); ä¸èƒ½åŒæ—¶è®¿é—®(ä¸åŒå¯¹è±¡ä¹Ÿä¸èƒ½è®¿é—®static synchronizedæ–¹æ³•)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">         *  x.isSynA()ä¸y.cSynA(); èƒ½åŒæ—¶è®¿é—®(static synchronizedæ–¹æ³•å ç”¨çš„æ˜¯ç±»é”ï¼Œ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">         *                        è€Œè®¿é—®synchronizedæ–¹æ³•å ç”¨çš„æ˜¯å¯¹è±¡é”ï¼Œä¸å­˜åœ¨äº’æ–¥ç°è±¡)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">         */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-çº¿ç¨‹ä¹‹é—´çš„åä½œ">6. çº¿ç¨‹ä¹‹é—´çš„åä½œ<a href="#6-çº¿ç¨‹ä¹‹é—´çš„åä½œ" class="hash-link" aria-label="Direct link to 6. çº¿ç¨‹ä¹‹é—´çš„åä½œ" title="Direct link to 6. çº¿ç¨‹ä¹‹é—´çš„åä½œ">â€‹</a></h3><p>å½“å¤šä¸ªçº¿ç¨‹å¯ä»¥ä¸€èµ·å·¥ä½œå»è§£å†³æŸä¸ªé—®é¢˜æ—¶ï¼Œå¦‚æœæŸäº›éƒ¨åˆ†å¿…é¡»åœ¨å…¶å®ƒéƒ¨åˆ†ä¹‹å‰å®Œæˆï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹çº¿ç¨‹è¿›è¡Œåè°ƒã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="join">join()<a href="#join" class="hash-link" aria-label="Direct link to join()" title="Direct link to join()">â€‹</a></h4><p>åœ¨çº¿ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œè€Œä¸æ˜¯å¿™ç­‰å¾…ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹ç»“æŸã€‚</p><p>å¯¹äºä»¥ä¸‹ä»£ç ï¼Œè™½ç„¶ b çº¿ç¨‹å…ˆå¯åŠ¨ï¼Œä½†æ˜¯å› ä¸ºåœ¨ b çº¿ç¨‹ä¸­è°ƒç”¨äº† a çº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œb çº¿ç¨‹ä¼šç­‰å¾… a çº¿ç¨‹ç»“æŸæ‰ç»§ç»­æ‰§è¡Œï¼Œå› æ­¤æœ€åèƒ½å¤Ÿä¿è¯ a çº¿ç¨‹çš„è¾“å‡ºå…ˆäº b çº¿ç¨‹çš„è¾“å‡ºã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">JoinExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">A</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;A&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">B</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">A</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">A</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;B&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">A</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">B</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">JoinExample</span><span class="token plain"> example </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">JoinExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">A</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">B</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="wait-notify-notifyall">wait() notify() notifyAll()<a href="#wait-notify-notifyall" class="hash-link" aria-label="Direct link to wait() notify() notifyAll()" title="Direct link to wait() notify() notifyAll()">â€‹</a></h4><p>è°ƒç”¨ wait() ä½¿å¾—çº¿ç¨‹ç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…æ—¶ä¼šè¢«æŒ‚èµ·ï¼Œå½“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œä½¿å¾—è¿™ä¸ªæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå…¶å®ƒçº¿ç¨‹ä¼šè°ƒç”¨ notify()ï¼ˆéšæœºå«é†’ä¸€ä¸ªï¼‰ æˆ–è€… notifyAll() ï¼ˆå«é†’æ‰€æœ‰ wait çº¿ç¨‹ï¼Œäº‰å¤ºæ—¶é—´ç‰‡çš„çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼‰æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ã€‚</p><p>å®ƒä»¬éƒ½å±äº Object çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸å±äº Threadã€‚</p><p>åªèƒ½ç”¨åœ¨<strong>åŒæ­¥æ–¹æ³•</strong>æˆ–è€…<strong>åŒæ­¥æ§åˆ¶å—</strong>ä¸­ä½¿ç”¨ï¼å¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡º IllegalMonitorStateExeceptionã€‚</p><p>ä½¿ç”¨ wait() æŒ‚èµ·æœŸé—´ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾é”ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæ²¡æœ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±æ— æ³•è¿›å…¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ï¼Œé‚£ä¹ˆå°±æ— æ³•æ‰§è¡Œ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ï¼Œé€ æˆæ­»é”ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">WaitNotifyExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">before</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;before&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">notifyAll</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">after</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">wait</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;after&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">WaitNotifyExample</span><span class="token plain"> example </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">WaitNotifyExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">after</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">before</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">before</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">after</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="await-signal-signalall">await() signal() signalAll()<a href="#await-signal-signalall" class="hash-link" aria-label="Direct link to await() signal() signalAll()" title="Direct link to await() signal() signalAll()">â€‹</a></h4><p>java.util.concurrent ç±»åº“ä¸­æä¾›äº† Condition ç±»æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åè°ƒï¼Œå¯ä»¥åœ¨ Condition ä¸Šè°ƒç”¨ await() æ–¹æ³•ä½¿çº¿ç¨‹ç­‰å¾…ï¼Œå…¶å®ƒçº¿ç¨‹è°ƒç”¨ signal() æˆ– signalAll() æ–¹æ³•å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚ç›¸æ¯”äº wait() è¿™ç§ç­‰å¾…æ–¹å¼ï¼Œawait() å¯ä»¥æŒ‡å®šç­‰å¾…çš„æ¡ä»¶ï¼Œå› æ­¤æ›´åŠ çµæ´»ã€‚</p><p>ä½¿ç”¨ Lock æ¥è·å–ä¸€ä¸ª Condition å¯¹è±¡ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AwaitSignalExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Lock</span><span class="token plain"> lock </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ReentrantLock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Condition</span><span class="token plain"> condition </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCondition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">before</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;before&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            condition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">signalAll</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">unlock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">after</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            condition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">await</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;after&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">unlock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">AwaitSignalExample</span><span class="token plain"> example </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AwaitSignalExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">after</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">before</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">before</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">after</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="sleepå’Œwaitæœ‰ä»€ä¹ˆåŒºåˆ«">sleepå’Œwaitæœ‰ä»€ä¹ˆåŒºåˆ«<a href="#sleepå’Œwaitæœ‰ä»€ä¹ˆåŒºåˆ«" class="hash-link" aria-label="Direct link to sleepå’Œwaitæœ‰ä»€ä¹ˆåŒºåˆ«" title="Direct link to sleepå’Œwaitæœ‰ä»€ä¹ˆåŒºåˆ«">â€‹</a></h4><ul><li>sleep å’Œ wait<ul><li>wait() æ˜¯ Object çš„æ–¹æ³•ï¼Œè€Œ sleep() æ˜¯ Thread çš„é™æ€æ–¹æ³•ï¼›</li><li>wait() ä¼šé‡Šæ”¾é”ï¼Œsleep() ä¸ä¼šã€‚</li></ul></li><li>æœ‰ä»€ä¹ˆåŒºåˆ«<ul><li>sleep() æ–¹æ³•ï¼ˆä¼‘çœ ï¼‰æ˜¯çº¿ç¨‹ç±»ï¼ˆThreadï¼‰çš„é™æ€æ–¹æ³•ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹æš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´ï¼Œå°†æ‰§è¡Œæœºä¼šï¼ˆCPUï¼‰è®©ç»™å…¶ä»–çº¿ç¨‹ï¼Œä½†æ˜¯å¯¹è±¡çš„é”ä¾ç„¶ä¿æŒï¼Œå› æ­¤ä¼‘çœ æ—¶é—´ç»“æŸåä¼šè‡ªåŠ¨æ¢å¤ï¼ˆçº¿ç¨‹å›åˆ°å°±ç»ªçŠ¶æ€ï¼‰ã€‚ </li><li>wait() æ˜¯ Object ç±»çš„æ–¹æ³•ï¼Œè°ƒç”¨å¯¹è±¡çš„ wait() æ–¹æ³•å¯¼è‡´å½“å‰çº¿ç¨‹æ”¾å¼ƒå¯¹è±¡çš„é”ï¼ˆçº¿ç¨‹æš‚åœæ‰§è¡Œï¼‰ï¼Œè¿›å…¥å¯¹è±¡çš„ç­‰å¾…æ± ï¼ˆwait poolï¼‰ï¼Œåªæœ‰è°ƒç”¨å¯¹è±¡çš„ notify() æ–¹æ³•ï¼ˆæˆ– notifyAll() æ–¹æ³•ï¼‰æ—¶æ‰èƒ½å”¤é†’ç­‰å¾…æ± ä¸­çš„çº¿ç¨‹è¿›å…¥ç­‰é”æ± ï¼ˆlock poolï¼‰ï¼Œå¦‚æœçº¿ç¨‹é‡æ–°è·å¾—å¯¹è±¡çš„é”å°±å¯ä»¥è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ </li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7-juc---aqs">7. J.U.C - AQS<a href="#7-juc---aqs" class="hash-link" aria-label="Direct link to 7. J.U.C - AQS" title="Direct link to 7. J.U.C - AQS">â€‹</a></h3><p>AQS æ˜¯  AbstractQueuedSynchronizer çš„ç®€ç§°ï¼Œjava.util.concurrentï¼ˆJ.U.Cï¼‰å¤§å¤§æé«˜äº†å¹¶å‘æ€§èƒ½ï¼ŒAQS (AbstractQueuedSynchronizer) è¢«è®¤ä¸ºæ˜¯ J.U.C çš„æ ¸å¿ƒã€‚å®ƒæä¾›äº†ä¸€ä¸ªåŸºäº FIFO é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—å¯ä»¥ç”¨æ¥æ„å»ºé”æˆ–è€…å…¶ä»–ç›¸å…³çš„åŒæ­¥è£…ç½®çš„åŸºç¡€æ¡†æ¶ã€‚ä¸‹å›¾æ˜¯ AQS åº•å±‚çš„æ•°æ®ç»“æ„ï¼š</p><div align="center"><img loading="lazy" src="assets/616953-20160403170136176-573839888.png" width="600" class="img_ev3q"></div><p>å®ƒåº•å±‚ä½¿ç”¨çš„æ˜¯åŒå‘åˆ—è¡¨ï¼Œæ˜¯é˜Ÿåˆ—çš„ä¸€ç§å®ç° , å› æ­¤ä¹Ÿå¯ä»¥å°†å®ƒå½“æˆä¸€ç§é˜Ÿåˆ—ã€‚</p><ul><li>Sync queue æ˜¯åŒæ­¥åˆ—è¡¨ï¼Œå®ƒæ˜¯åŒå‘åˆ—è¡¨ , åŒ…æ‹¬ headï¼Œtail èŠ‚ç‚¹ã€‚å…¶ä¸­ head èŠ‚ç‚¹ä¸»è¦ç”¨æ¥åç»­çš„è°ƒåº¦ ;</li><li>Condition queue æ˜¯å•å‘é“¾è¡¨ , ä¸æ˜¯å¿…é¡»çš„ , åªæœ‰å½“ç¨‹åºä¸­éœ€è¦ Condition çš„æ—¶å€™ï¼Œæ‰ä¼šå­˜åœ¨è¿™ä¸ªå•å‘é“¾è¡¨ , å¹¶ä¸”å¯èƒ½ä¼šæœ‰å¤šä¸ª Condition queueã€‚</li></ul><p>ç®€å•çš„æ¥è¯´ï¼š</p><ul><li><p>AQSå…¶å®å°±æ˜¯ä¸€ä¸ªå¯ä»¥ç»™æˆ‘ä»¬å®ç°é”çš„<strong>æ¡†æ¶</strong></p></li><li><p>å†…éƒ¨å®ç°çš„å…³é”®æ˜¯ï¼š<strong>å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ã€state çŠ¶æ€</strong></p></li><li><p>å®šä¹‰äº†å†…éƒ¨ç±» ConditionObject</p></li><li><p>æ‹¥æœ‰ä¸¤ç§çº¿ç¨‹æ¨¡å¼</p></li><li><ul><li>ç‹¬å æ¨¡å¼</li><li>å…±äº«æ¨¡å¼</li></ul></li><li><p>åœ¨ LOCK åŒ…ä¸­çš„ç›¸å…³é”ï¼ˆå¸¸ç”¨çš„æœ‰ ReentrantLockã€ ReadWriteLock ï¼‰éƒ½æ˜¯åŸºäº AQS æ¥æ„å»º</p></li><li><p>ä¸€èˆ¬æˆ‘ä»¬å« AQS ä¸ºåŒæ­¥å™¨ã€‚</p></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="countdownlatch">CountdownLatch<a href="#countdownlatch" class="hash-link" aria-label="Direct link to CountdownLatch" title="Direct link to CountdownLatch">â€‹</a></h4><p>CountDownLatch ç±»ä½äº java.util.concurrent åŒ…ä¸‹ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å®ç°ç±»ä¼¼è®¡æ•°å™¨çš„åŠŸèƒ½ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªä»»åŠ¡ Aï¼Œå®ƒè¦ç­‰å¾…å…¶ä»– 4 ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½æ‰§è¡Œï¼Œæ­¤æ—¶å°±å¯ä»¥åˆ©ç”¨ CountDownLatch æ¥å®ç°è¿™ç§åŠŸèƒ½äº†ã€‚</p><p>ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨ cntï¼Œæ¯æ¬¡è°ƒç”¨ countDown() æ–¹æ³•ä¼šè®©è®¡æ•°å™¨çš„å€¼å‡ 1ï¼Œå‡åˆ° 0 çš„æ—¶å€™ï¼Œé‚£äº›å› ä¸ºè°ƒç”¨ await() æ–¹æ³•è€Œåœ¨ç­‰å¾…çš„çº¿ç¨‹å°±ä¼šè¢«å”¤é†’ã€‚</p><div align="center"> <img loading="lazy" src="assets/CountdownLatch.png" width="" class="img_ev3q"></div><p>CountDownLatch ç±»åªæä¾›äº†ä¸€ä¸ªæ„é€ å™¨ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CountDownLatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å‚æ•°countä¸ºè®¡æ•°å€¼</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç„¶åä¸‹é¢è¿™ 3 ä¸ªæ–¹æ³•æ˜¯ CountDownLatch ç±»ä¸­æœ€é‡è¦çš„æ–¹æ³•ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//è°ƒç”¨await()æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œå®ƒä¼šç­‰å¾…ç›´åˆ°countå€¼ä¸º0æ‰ç»§ç»­æ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">await</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å’Œawait()ç±»ä¼¼ï¼Œåªä¸è¿‡ç­‰å¾…ä¸€å®šçš„æ—¶é—´åcountå€¼è¿˜æ²¡å˜ä¸º0çš„è¯å°±ä¼šç»§ç»­æ‰§è¡Œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">await</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">TimeUnit</span><span class="token plain"> unit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å°†countå€¼å‡1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">countDown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­å¤§å®¶å°±æ¸…æ¥š CountDownLatch çš„ç”¨æ³•äº†ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Test</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CountDownLatch</span><span class="token plain"> latch </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CountDownLatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;å­çº¿ç¨‹&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">currentThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;æ­£åœ¨æ‰§è¡Œ&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sleep</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;å­çº¿ç¨‹&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">currentThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;æ‰§è¡Œå®Œæ¯•&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    latch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">countDown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;å­çº¿ç¨‹&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">currentThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;æ­£åœ¨æ‰§è¡Œ&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sleep</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;å­çº¿ç¨‹&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">currentThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;æ‰§è¡Œå®Œæ¯•&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    latch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">countDown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ç­‰å¾…2ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            latch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">await</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2ä¸ªå­çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ‰§è¡Œç»“æœï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">çº¿ç¨‹Thread-0æ­£åœ¨æ‰§è¡Œ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">çº¿ç¨‹Thread-1æ­£åœ¨æ‰§è¡Œ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ç­‰å¾…2ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">çº¿ç¨‹Thread-0æ‰§è¡Œå®Œæ¯•</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">çº¿ç¨‹Thread-1æ‰§è¡Œå®Œæ¯•</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2ä¸ªå­çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cyclicbarrier">CyclicBarrier<a href="#cyclicbarrier" class="hash-link" aria-label="Direct link to CyclicBarrier" title="Direct link to CyclicBarrier">â€‹</a></h4><p>ç”¨æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œåªæœ‰å½“å¤šä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾æ—¶ï¼Œè¿™äº›çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</p><p>å’Œ CountdownLatch ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ç»´æŠ¤è®¡æ•°å™¨æ¥å®ç°çš„ã€‚ä½†æ˜¯å®ƒçš„è®¡æ•°å™¨æ˜¯é€’å¢çš„ï¼Œæ¯æ¬¡æ‰§è¡Œ await() æ–¹æ³•ä¹‹åï¼Œè®¡æ•°å™¨ä¼šåŠ  1ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼å’Œè®¾ç½®çš„å€¼ç›¸ç­‰ï¼Œç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚å’Œ CountdownLatch çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼ŒCyclicBarrier çš„è®¡æ•°å™¨å¯ä»¥å¾ªç¯ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒæ‰å«åšå¾ªç¯å±éšœã€‚</p><p>ä¸‹å›¾åº”è¯¥ä»ä¸‹å¾€ä¸Šçœ‹æ‰æ­£ç¡®ã€‚</p><div align="center"><img loading="lazy" src="assets/CyclicBarrier.png" width="" class="img_ev3q"></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CyclicBarrierExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> totalThread </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">CyclicBarrier</span><span class="token plain"> cyclicBarrier </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CyclicBarrier</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">totalThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> totalThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;before..&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    cyclicBarrier</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">await</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">BrokenBarrierException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;after..&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">shutdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">before..before..before..before..before..before..before..before..before..before..after..after..after..after..after..after..after..after..after..after..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="semaphore">Semaphore<a href="#semaphore" class="hash-link" aria-label="Direct link to Semaphore" title="Direct link to Semaphore">â€‹</a></h4><p>Semaphore å°±æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„ä¿¡å·é‡ï¼Œå¯ä»¥æ§åˆ¶å¯¹äº’æ–¥èµ„æºçš„è®¿é—®çº¿ç¨‹æ•°ã€‚Semaphore å¯ä»¥æ§åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°ï¼Œé€šè¿‡ acquire() è·å–ä¸€ä¸ªè®¸å¯ï¼Œå¦‚æœæ²¡æœ‰å°±ç­‰å¾…ï¼Œè€Œ release() é‡Šæ”¾ä¸€ä¸ªè®¸å¯ã€‚</p><div align="center"><img loading="lazy" src="assets/Semaphore.png" width="" class="img_ev3q"></div><br><p>Semaphore ç±»ä½äº java.util.concurrent åŒ…ä¸‹ï¼Œå®ƒæä¾›äº†2ä¸ªæ„é€ å™¨ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Semaphore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">permits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">          </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å‚æ•°permitsè¡¨ç¤ºè®¸å¯æ•°ç›®ï¼Œå³åŒæ—¶å¯ä»¥å…è®¸å¤šå°‘çº¿ç¨‹è¿›è¡Œè®¿é—®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sync </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">NonfairSync</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">permits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Semaphore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">permits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> fair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//è¿™ä¸ªå¤šäº†ä¸€ä¸ªå‚æ•°fairè¡¨ç¤ºæ˜¯å¦æ˜¯å…¬å¹³çš„ï¼Œå³ç­‰å¾…æ—¶é—´è¶Šä¹…çš„è¶Šå…ˆè·å–è®¸å¯    </span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sync </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">FairSync</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">permits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">NonfairSync</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">permits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸‹é¢è¯´ä¸€ä¸‹ Semaphore ç±»ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆæ˜¯ acquire()ã€release() æ–¹æ³•ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//è·å–ä¸€ä¸ªè®¸å¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">acquire</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//è·å–permitsä¸ªè®¸å¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">acquire</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">permits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//é‡Šæ”¾ä¸€ä¸ªè®¸å¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//é‡Šæ”¾permitsä¸ªè®¸å¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">permits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ã€€ã€€acquire() ç”¨æ¥è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥æ— è®¸å¯èƒ½å¤Ÿè·å¾—ï¼Œåˆ™ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å¾—è®¸å¯ã€‚</p><p>ã€€ã€€release() ç”¨æ¥é‡Šæ”¾è®¸å¯ã€‚æ³¨æ„ï¼Œåœ¨é‡Šæ”¾è®¸å¯ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·è·å¾—è®¸å¯ã€‚</p><p>è¿™ 4 ä¸ªæ–¹æ³•éƒ½ä¼šè¢«é˜»å¡ï¼Œå¦‚æœæƒ³ç«‹å³å¾—åˆ°æ‰§è¡Œç»“æœï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ ä¸ªæ–¹æ³•ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å°è¯•è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™ç«‹å³è¿”å›false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tryAcquire</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å°è¯•è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥åœ¨æŒ‡å®šçš„æ—¶é—´å†…è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œå¦åˆ™åˆ™ç«‹å³è¿”å›false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tryAcquire</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">TimeUnit</span><span class="token plain"> unit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å°è¯•è·å–permitsä¸ªè®¸å¯ï¼Œè‹¥è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™ç«‹å³è¿”å›false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tryAcquire</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">permits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å°è¯•è·å–permitsä¸ªè®¸å¯ï¼Œè‹¥åœ¨æŒ‡å®šçš„æ—¶é—´å†…è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œå¦åˆ™åˆ™ç«‹å³è¿”å›false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tryAcquire</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">permits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">TimeUnit</span><span class="token plain"> unit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ã€€ã€€å¦å¤–è¿˜å¯ä»¥é€šè¿‡ availablePermits() æ–¹æ³•å¾—åˆ°å¯ç”¨çš„è®¸å¯æ•°ç›®ã€‚</p><p>ã€€ã€€ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸€ä¸‹ Semaphore çš„å…·ä½“ä½¿ç”¨ï¼š</p><p>ã€€ã€€å‡è‹¥ä¸€ä¸ªå·¥å‚æœ‰ 5 å°æœºå™¨ï¼Œä½†æ˜¯æœ‰ 8 ä¸ªå·¥äººï¼Œä¸€å°æœºå™¨åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå·¥äººä½¿ç”¨ï¼Œåªæœ‰ä½¿ç”¨å®Œäº†ï¼Œå…¶ä»–å·¥äººæ‰èƒ½ç»§ç»­ä½¿ç”¨ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Semaphore æ¥å®ç°ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Test</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">N</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å·¥äººæ•°        </span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Semaphore</span><span class="token plain"> semaphore </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Semaphore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//æœºå™¨æ•°ç›®       </span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">N</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Worker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> semaphore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Worker</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Semaphore</span><span class="token plain"> semaphore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Worker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Semaphore</span><span class="token plain"> semaphore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">num </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">semaphore </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> semaphore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                semaphore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">acquire</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;å·¥äºº&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">num </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;å ç”¨ä¸€ä¸ªæœºå™¨åœ¨ç”Ÿäº§...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sleep</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;å·¥äºº&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">num </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;é‡Šæ”¾å‡ºæœºå™¨&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                semaphore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ‰§è¡Œç»“æœï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº0å ç”¨ä¸€ä¸ªæœºå™¨åœ¨ç”Ÿäº§...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº1å ç”¨ä¸€ä¸ªæœºå™¨åœ¨ç”Ÿäº§...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº2å ç”¨ä¸€ä¸ªæœºå™¨åœ¨ç”Ÿäº§...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº4å ç”¨ä¸€ä¸ªæœºå™¨åœ¨ç”Ÿäº§...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº5å ç”¨ä¸€ä¸ªæœºå™¨åœ¨ç”Ÿäº§...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº0é‡Šæ”¾å‡ºæœºå™¨</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº2é‡Šæ”¾å‡ºæœºå™¨</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº3å ç”¨ä¸€ä¸ªæœºå™¨åœ¨ç”Ÿäº§...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº7å ç”¨ä¸€ä¸ªæœºå™¨åœ¨ç”Ÿäº§...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº4é‡Šæ”¾å‡ºæœºå™¨</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº5é‡Šæ”¾å‡ºæœºå™¨</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº1é‡Šæ”¾å‡ºæœºå™¨</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº6å ç”¨ä¸€ä¸ªæœºå™¨åœ¨ç”Ÿäº§...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº3é‡Šæ”¾å‡ºæœºå™¨</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº7é‡Šæ”¾å‡ºæœºå™¨</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">å·¥äºº6é‡Šæ”¾å‡ºæœºå™¨</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="æ€»ç»“">æ€»ç»“<a href="#æ€»ç»“" class="hash-link" aria-label="Direct link to æ€»ç»“" title="Direct link to æ€»ç»“">â€‹</a></h4><p>ä¸‹é¢å¯¹ä¸Šé¢è¯´çš„ä¸‰ä¸ªè¾…åŠ©ç±»è¿›è¡Œä¸€ä¸ªæ€»ç»“ï¼š</p><ul><li>CountDownLatch å’Œ CyclicBarrier éƒ½èƒ½å¤Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„ç­‰å¾…ï¼Œåªä¸è¿‡å®ƒä»¬ä¾§é‡ç‚¹ä¸åŒï¼š<ul><li>CountDownLatch ä¸€èˆ¬ç”¨äºæŸä¸ªçº¿ç¨‹Aç­‰å¾…è‹¥å¹²ä¸ªå…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼Œå®ƒæ‰æ‰§è¡Œï¼›</li><li>CyclicBarrier ä¸€èˆ¬ç”¨äºä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ï¼Œç„¶åè¿™ä¸€ç»„çº¿ç¨‹å†åŒæ—¶æ‰§è¡Œï¼›</li><li>å¦å¤–ï¼ŒCountDownLatch æ˜¯ä¸èƒ½å¤Ÿé‡ç”¨çš„ï¼Œè€Œ CyclicBarrier æ˜¯å¯ä»¥é‡ç”¨çš„ã€‚</li></ul></li><li>Semaphore å…¶å®å’Œé”æœ‰ç‚¹ç±»ä¼¼ï¼Œå®ƒä¸€èˆ¬ç”¨äºæ§åˆ¶å¯¹æŸç»„èµ„æºçš„è®¿é—®æƒé™ã€‚</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8-juc---å…¶å®ƒç»„ä»¶">8. J.U.C - å…¶å®ƒç»„ä»¶<a href="#8-juc---å…¶å®ƒç»„ä»¶" class="hash-link" aria-label="Direct link to 8. J.U.C - å…¶å®ƒç»„ä»¶" title="Direct link to 8. J.U.C - å…¶å®ƒç»„ä»¶">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="futuretask">FutureTask<a href="#futuretask" class="hash-link" aria-label="Direct link to FutureTask" title="Direct link to FutureTask">â€‹</a></h4><p>åœ¨ä»‹ç» Callable æ—¶æˆ‘ä»¬çŸ¥é“å®ƒå¯ä»¥æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼é€šè¿‡ Future è¿›è¡Œå°è£…ã€‚FutureTask å®ç°äº† RunnableFuture æ¥å£ï¼Œè¯¥æ¥å£ç»§æ‰¿è‡ª Runnable å’Œ Future æ¥å£ï¼Œè¿™ä½¿å¾— FutureTask æ—¢å¯ä»¥å½“åšä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æœ‰è¿”å›å€¼ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">FutureTask</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">V</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">implements</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">RunnableFuture</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">V</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">RunnableFuture</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">V</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Runnable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Future</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">V</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>FutureTask å¯ç”¨äºå¼‚æ­¥è·å–æ‰§è¡Œç»“æœæˆ–å–æ¶ˆæ‰§è¡Œä»»åŠ¡çš„åœºæ™¯ã€‚å½“ä¸€ä¸ªè®¡ç®—ä»»åŠ¡éœ€è¦æ‰§è¡Œå¾ˆé•¿æ—¶é—´ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ FutureTask æ¥å°è£…è¿™ä¸ªä»»åŠ¡ï¼Œä¸»çº¿ç¨‹åœ¨å®Œæˆè‡ªå·±çš„ä»»åŠ¡ä¹‹åå†å»è·å–ç»“æœã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">FutureTaskExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutionException</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">FutureTask</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> futureTask </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">FutureTask</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Callable</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sleep</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    result </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> computeThread </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">futureTask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        computeThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> otherThread </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;other task is running...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sleep</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        otherThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">futureTask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">other task is running</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">4950</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="blockingqueue">BlockingQueue<a href="#blockingqueue" class="hash-link" aria-label="Direct link to BlockingQueue" title="Direct link to BlockingQueue">â€‹</a></h4><p>java.util.concurrent.BlockingQueue æ¥å£æœ‰ä»¥ä¸‹é˜»å¡é˜Ÿåˆ—çš„å®ç°ï¼š</p><ul><li><strong>FIFO é˜Ÿåˆ—</strong> ï¼šLinkedBlockingQueueã€ArrayBlockingQueueï¼ˆå›ºå®šé•¿åº¦ï¼‰</li><li><strong>ä¼˜å…ˆçº§é˜Ÿåˆ—</strong> ï¼šPriorityBlockingQueue</li></ul><p>æä¾›äº†é˜»å¡çš„ take() å’Œ put() æ–¹æ³•ï¼šå¦‚æœé˜Ÿåˆ—ä¸ºç©º take() å°†é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å†…å®¹ï¼›å¦‚æœé˜Ÿåˆ—ä¸ºæ»¡ put() å°†é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—æœ‰ç©ºé—²ä½ç½®ã€‚</p><p><strong>ä½¿ç”¨ BlockingQueue å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</strong></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ProducerConsumer</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">BlockingQueue</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">String</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> queue </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ArrayBlockingQueue</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Producer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                queue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">put</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;product&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;produce..&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Consumer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> product </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">take</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">printStackTrace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;consume..&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Producer</span><span class="token plain"> producer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Producer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        producer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Consumer</span><span class="token plain"> consumer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Consumer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        consumer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Producer</span><span class="token plain"> producer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Producer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        producer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">produce..produce..consume..consume..produce..consume..produce..consume..produce..consume..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="forkjoin">ForkJoin<a href="#forkjoin" class="hash-link" aria-label="Direct link to ForkJoin" title="Direct link to ForkJoin">â€‹</a></h4><p>ä¸»è¦ç”¨äºå¹¶è¡Œè®¡ç®—ä¸­ï¼Œå’Œ MapReduce åŸç†ç±»ä¼¼ï¼Œéƒ½æ˜¯æŠŠå¤§çš„è®¡ç®—ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°ä»»åŠ¡å¹¶è¡Œè®¡ç®—ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ForkJoinExample</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">RecursiveTask</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> threshold </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> first</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> last</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ForkJoinExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> first</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> last</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">first </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> first</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">last </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> last</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">protected</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">compute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">last </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> first </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> threshold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ä»»åŠ¡è¶³å¤Ÿå°åˆ™ç›´æ¥è®¡ç®—</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> first</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> last</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                result </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ‹†åˆ†æˆå°ä»»åŠ¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> middle </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> first </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">last </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> first</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">ForkJoinExample</span><span class="token plain"> leftTask </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ForkJoinExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">first</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> middle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">ForkJoinExample</span><span class="token plain"> rightTask </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ForkJoinExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">middle </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> last</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            leftTask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fork</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            rightTask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">fork</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            result </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> leftTask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> rightTask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token known-class-name class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> throws </span><span class="token maybe-class-name">ExecutionException</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">ForkJoinExample</span><span class="token plain"> example </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ForkJoinExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">ForkJoinPool</span><span class="token plain"> forkJoinPool </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ForkJoinPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">Future</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> forkJoinPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">submit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ForkJoin ä½¿ç”¨ ForkJoinPool æ¥å¯åŠ¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ•°é‡å–å†³äº CPU æ ¸æ•°ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ForkJoinPool</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AbstractExecutorService</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ForkJoinPool å®ç°äº†å·¥ä½œçªƒå–ç®—æ³•æ¥æé«˜ CPU çš„åˆ©ç”¨ç‡ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½ç»´æŠ¤äº†ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚å·¥ä½œçªƒå–ç®—æ³•å…è®¸ç©ºé—²çš„çº¿ç¨‹ä»å…¶å®ƒçº¿ç¨‹çš„åŒç«¯é˜Ÿåˆ—ä¸­çªƒå–ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚çªƒå–çš„ä»»åŠ¡å¿…é¡»æ˜¯æœ€æ™šçš„ä»»åŠ¡ï¼Œé¿å…å’Œé˜Ÿåˆ—æ‰€å±çº¿ç¨‹å‘ç”Ÿç«äº‰ã€‚ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒThread2 ä» Thread1 çš„é˜Ÿåˆ—ä¸­æ‹¿å‡ºæœ€æ™šçš„ Task1 ä»»åŠ¡ï¼ŒThread1 ä¼šæ‹¿å‡º Task2 æ¥æ‰§è¡Œï¼Œè¿™æ ·å°±é¿å…å‘ç”Ÿç«äº‰ã€‚ä½†æ˜¯å¦‚æœé˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªä»»åŠ¡æ—¶è¿˜æ˜¯ä¼šå‘ç”Ÿç«äº‰ã€‚</p><div align="center"><img loading="lazy" src="assets/fork-and-join.jpg" width="600" class="img_ev3q"></div><br><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9-çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹">9. çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹<a href="#9-çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹" class="hash-link" aria-label="Direct link to 9. çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹" title="Direct link to 9. çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹">â€‹</a></h3><p>å¦‚æœå¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå…±äº«æ•°æ®è¿›è¡Œè®¿é—®è€Œä¸é‡‡å–åŒæ­¥æ“ä½œçš„è¯ï¼Œé‚£ä¹ˆæ“ä½œçš„ç»“æœæ˜¯ä¸ä¸€è‡´çš„ã€‚</p><p>ä»¥ä¸‹ä»£ç æ¼”ç¤ºäº† 1000 ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ cnt æ‰§è¡Œè‡ªå¢æ“ä½œï¼Œæ“ä½œç»“æŸä¹‹åå®ƒçš„å€¼ä¸º 997 è€Œä¸æ˜¯ 1000ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadUnsafeExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> cnt </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cnt</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> cnt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> threadSize </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadUnsafeExample</span><span class="token plain"> example </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadUnsafeExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CountDownLatch</span><span class="token plain"> countDownLatch </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CountDownLatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">threadSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> threadSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            countDownLatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">countDown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    countDownLatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">await</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">shutdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">997</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="10-java-å†…å­˜æ¨¡å‹jmm">10. Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰<a href="#10-java-å†…å­˜æ¨¡å‹jmm" class="hash-link" aria-label="Direct link to 10. Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰" title="Direct link to 10. Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰">â€‹</a></h3><p>Java å†…å­˜æ¨¡å‹è¯•å›¾å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®© Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜">ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜<a href="#ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜" class="hash-link" aria-label="Direct link to ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜" title="Direct link to ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜">â€‹</a></h4><p>å¤„ç†å™¨ä¸Šçš„å¯„å­˜å™¨çš„è¯»å†™çš„é€Ÿåº¦æ¯”å†…å­˜å¿«å‡ ä¸ªæ•°é‡çº§ï¼Œä¸ºäº†è§£å†³è¿™ç§é€Ÿåº¦çŸ›ç›¾ï¼Œåœ¨å®ƒä»¬ä¹‹é—´åŠ å…¥äº†é«˜é€Ÿç¼“å­˜ã€‚</p><p>åŠ å…¥é«˜é€Ÿç¼“å­˜å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šç¼“å­˜ä¸€è‡´æ€§ã€‚å¦‚æœå¤šä¸ªç¼“å­˜å…±äº«åŒä¸€å—ä¸»å†…å­˜åŒºåŸŸï¼Œé‚£ä¹ˆå¤šä¸ªç¼“å­˜çš„æ•°æ®å¯èƒ½ä¼šä¸ä¸€è‡´ï¼Œéœ€è¦ä¸€äº›åè®®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><div align="center"> <img loading="lazy" src="assets/1195582-20180508173147029-1341787720.png" width="700" class="img_ev3q"></div><p>æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨<strong>ä¸»å†…å­˜</strong>ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„<strong>å·¥ä½œå†…å­˜</strong>ï¼Œå·¥ä½œå†…å­˜å­˜å‚¨åœ¨é«˜é€Ÿç¼“å­˜æˆ–è€…å¯„å­˜å™¨ä¸­ï¼Œä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ã€‚</p><p>çº¿ç¨‹åªèƒ½ç›´æ¥æ“ä½œå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„å˜é‡å€¼ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚</p><p><strong>Javaå†…å­˜æ¨¡å‹å’Œç¡¬ä»¶å…³ç³»å›¾</strong></p><div align="center"> <img loading="lazy" src="assets/v2-4015322359279c5568263aeb7f41c36d.jpg" width="600" class="img_ev3q"></div><p><strong>Javaå†…å­˜æ¨¡å‹æŠ½è±¡ç»“æ„å›¾</strong></p><div align="center"><img loading="lazy" src="assets/1135283-20170403195814660-1521573510.png" width="400" class="img_ev3q"></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å†…å­˜é—´äº¤äº’æ“ä½œ">å†…å­˜é—´äº¤äº’æ“ä½œ<a href="#å†…å­˜é—´äº¤äº’æ“ä½œ" class="hash-link" aria-label="Direct link to å†…å­˜é—´äº¤äº’æ“ä½œ" title="Direct link to å†…å­˜é—´äº¤äº’æ“ä½œ">â€‹</a></h4><p>Java å†…å­˜æ¨¡å‹å®šä¹‰äº† 8 ä¸ªæ“ä½œæ¥å®Œæˆä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„äº¤äº’æ“ä½œã€‚</p><div align="center"> <img loading="lazy" src="assets/536c6dfd-305a-4b95-b12c-28ca5e8aa043.png" width="650" class="img_ev3q"></div><ul><li>readï¼šæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°å·¥ä½œå†…å­˜ä¸­</li><li>loadï¼šåœ¨ read ä¹‹åæ‰§è¡Œï¼ŒæŠŠ read å¾—åˆ°çš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­</li><li>useï¼šæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“</li><li>assignï¼šæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡</li><li>storeï¼šæŠŠå·¥ä½œå†…å­˜çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­</li><li>writeï¼šåœ¨ store ä¹‹åæ‰§è¡Œï¼ŒæŠŠ store å¾—åˆ°çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­</li><li>lockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çŠ¶æ€</li><li>unlockï¼šä½œç”¨äºä¸»å†…å­˜å˜é‡ï¼ŒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®š</li></ul><p>å¦‚æœè¦æŠŠä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜ä¸­å¤åˆ¶åˆ°å·¥ä½œå†…å­˜ï¼Œå°±éœ€è¦æŒ‰é¡ºå¯»åœ°æ‰§è¡Œ read å’Œ load æ“ä½œï¼Œå¦‚æœæŠŠå˜é‡ä»å·¥ä½œå†…å­˜ä¸­åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼Œå°±è¦æŒ‰é¡ºåºåœ°æ‰§è¡Œ store å’Œ write æ“ä½œã€‚Javaå†…å­˜æ¨¡å‹åªè¦æ±‚ä¸Šè¿°æ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œè€Œæ²¡æœ‰ä¿è¯å¿…é¡»æ˜¯è¿ç»­æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯ read å’Œ load ä¹‹é—´ï¼Œstore å’Œ write ä¹‹é—´æ˜¯å¯ä»¥æ’å…¥å…¶ä»–æŒ‡ä»¤çš„ï¼Œå¦‚å¯¹ä¸»å†…å­˜ä¸­çš„å˜é‡aã€bè¿›è¡Œè®¿é—®æ—¶ï¼Œå¯èƒ½çš„é¡ºåºæ˜¯read aï¼Œread bï¼Œload bï¼Œ load aã€‚</p><p><strong>Javaå†…å­˜æ¨¡å‹è¿˜è§„å®šäº†åœ¨æ‰§è¡Œä¸Šè¿°8ç§åŸºæœ¬æ“ä½œæ—¶ï¼Œå¿…é¡»æ»¡è¶³å¦‚ä¸‹è§„åˆ™ï¼š</strong></p><ul><li>ä¸å…è®¸ read å’Œ loadã€store å’Œ write æ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°</li><li>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘ assign çš„æ“ä½œï¼Œå³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åå¿…é¡»åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­</li><li>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› åœ°ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•assignæ“ä½œï¼‰æŠŠæ•°æ®ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¸­</li><li>ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­è¯ç”Ÿï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆload æˆ– assignï¼‰çš„å˜é‡ã€‚å³å°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½ use å’Œ store æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œè¿‡äº† assign å’Œ load æ“ä½œã€‚</li><li>ä¸€ä¸ªå˜é‡åœ¨åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œï¼Œlock å’Œ unlockå¿…é¡»æˆå¯¹å‡ºç°</li><li>å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ lock æ“ä½œï¼Œå°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰éœ€è¦é‡æ–°æ‰§è¡Œ load æˆ– assign æ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼</li><li>å¦‚æœä¸€ä¸ªå˜é‡äº‹å…ˆæ²¡æœ‰è¢« lock æ“ä½œé”å®šï¼Œåˆ™ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œ unlock æ“ä½œï¼›ä¹Ÿä¸å…è®¸å» unlock ä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”å®šçš„å˜é‡ã€‚</li><li>å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼ˆæ‰§è¡Œ store å’Œ write æ“ä½œï¼‰ã€‚</li></ul><p>å‚è€ƒèµ„æ–™ï¼š</p><p><a href="https://www.cnblogs.com/yzwall/p/6661528.html" target="_blank" rel="noopener noreferrer">volatileå…³é”®å­—ä¸Javaå†…å­˜æ¨¡å‹(JMM) - yzwall - åšå®¢å›­</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§">å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§<a href="#å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§" class="hash-link" aria-label="Direct link to å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§" title="Direct link to å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§">â€‹</a></h4><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-åŸå­æ€§">1. åŸå­æ€§<a href="#1-åŸå­æ€§" class="hash-link" aria-label="Direct link to 1. åŸå­æ€§" title="Direct link to 1. åŸå­æ€§">â€‹</a></h5><ul><li>æ¦‚å¿µ<ul><li>äº‹ç‰©æœ‰åŸå­æ€§ï¼Œè¿™ä¸ªæ¦‚å¿µå¤§æ¦‚éƒ½æ¸…æ¥šï¼Œå³ä¸€ä¸ªæ“ä½œæˆ–å¤šä¸ªæ“ä½œè¦ä¹ˆæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸è¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼Œè¦ä¹ˆä¸æ‰§è¡Œã€‚</li></ul></li><li>å¦‚ä½•å®ç°åŸå­æ€§ï¼Ÿ<ul><li>é€šè¿‡åŒæ­¥ä»£ç å— synchronized æˆ–è€… local é”æ¥ç¡®ä¿åŸå­æ€§</li></ul></li></ul><p>Java å†…å­˜æ¨¡å‹ä¿è¯äº† readã€loadã€useã€assignã€storeã€writeã€lock å’Œ unlock æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œä¾‹å¦‚å¯¹ä¸€ä¸ª int ç±»å‹çš„å˜é‡æ‰§è¡Œ assign èµ‹å€¼æ“ä½œï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯åŸå­æ€§çš„ã€‚ä½†æ˜¯ Java å†…å­˜æ¨¡å‹å…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢« volatile ä¿®é¥°çš„ 64 ä½æ•°æ®ï¼ˆlongï¼Œdoubleï¼‰çš„è¯»å†™æ“ä½œåˆ’åˆ†ä¸ºä¸¤æ¬¡ 32 ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³ loadã€storeã€read å’Œ write æ“ä½œå¯ä»¥ä¸å…·å¤‡åŸå­æ€§ã€‚</p><p>æœ‰ä¸€ä¸ªé”™è¯¯è®¤è¯†å°±æ˜¯ï¼Œint ç­‰åŸå­æ€§çš„å˜é‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å‰é¢çš„çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œcnt å˜é‡å±äº int ç±»å‹å˜é‡ï¼Œ1000 ä¸ªçº¿ç¨‹å¯¹å®ƒè¿›è¡Œè‡ªå¢æ“ä½œä¹‹åï¼Œå¾—åˆ°çš„å€¼ä¸º 997 è€Œä¸æ˜¯ 1000ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿è®¨è®ºï¼Œå°†å†…å­˜é—´çš„äº¤äº’æ“ä½œç®€åŒ–ä¸º 3 ä¸ªï¼šloadã€assignã€storeã€‚</p><p>ä¸‹å›¾æ¼”ç¤ºäº†ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ cnt å˜é‡è¿›è¡Œæ“ä½œï¼Œloadã€assignã€store è¿™ä¸€ç³»åˆ—æ“ä½œæ•´ä½“ä¸Šçœ‹ä¸å…·å¤‡åŸå­æ€§ï¼Œé‚£ä¹ˆåœ¨ T1 ä¿®æ”¹ cnt å¹¶ä¸”è¿˜æ²¡æœ‰å°†ä¿®æ”¹åçš„å€¼å†™å…¥ä¸»å†…å­˜ï¼ŒT2 ä¾ç„¶å¯ä»¥è¯»å…¥è¯¥å˜é‡çš„å€¼ã€‚å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹è™½ç„¶æ‰§è¡Œäº†ä¸¤æ¬¡è‡ªå¢è¿ç®—ï¼Œä½†æ˜¯ä¸»å†…å­˜ä¸­ cnt çš„å€¼æœ€åä¸º 1 è€Œä¸æ˜¯ 2ã€‚å› æ­¤å¯¹ int ç±»å‹è¯»å†™æ“ä½œæ»¡è¶³åŸå­æ€§åªæ˜¯è¯´æ˜ loadã€assignã€store è¿™äº›å•ä¸ªæ“ä½œå…·å¤‡åŸå­æ€§ã€‚</p><div align="center"><img loading="lazy" src="assets/ef8eab00-1d5e-4d99-a7c2-d6d68ea7fe92-1534148019548.png" width="400" class="img_ev3q"></div><br><p>AtomicInteger èƒ½ä¿è¯å¤šä¸ªçº¿ç¨‹ä¿®æ”¹çš„åŸå­æ€§ã€‚</p><div align="center"><img loading="lazy" src="assets/952afa9a-458b-44ce-bba9-463e60162945-1534148027104.png" width="400" class="img_ev3q"></div><br><p>ä½¿ç”¨ AtomicInteger é‡å†™ä¹‹å‰çº¿ç¨‹ä¸å®‰å…¨çš„ä»£ç ä¹‹åå¾—åˆ°ä»¥ä¸‹çº¿ç¨‹å®‰å…¨å®ç°ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicInteger</span><span class="token plain"> cnt </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicInteger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cnt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">incrementAndGet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> cnt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> threadSize </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicExample</span><span class="token plain"> example </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// åªä¿®æ”¹è¿™æ¡è¯­å¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CountDownLatch</span><span class="token plain"> countDownLatch </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CountDownLatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">threadSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> threadSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            countDownLatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">countDown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    countDownLatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">await</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">shutdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">1000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é™¤äº†ä½¿ç”¨åŸå­ç±»ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ synchronized äº’æ–¥é”æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚å®ƒå¯¹åº”çš„å†…å­˜é—´äº¤äº’æ“ä½œä¸ºï¼šlock å’Œ unlockï¼Œåœ¨è™šæ‹Ÿæœºå®ç°ä¸Šå¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤ä¸º monitorenter å’Œ monitorexitã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicSynchronizedExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> cnt </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cnt</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> cnt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> threadSize </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicSynchronizedExample</span><span class="token plain"> example </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicSynchronizedExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CountDownLatch</span><span class="token plain"> countDownLatch </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CountDownLatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">threadSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> threadSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            countDownLatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">countDown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    countDownLatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">await</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">shutdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">1000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-å¯è§æ€§">2. å¯è§æ€§<a href="#2-å¯è§æ€§" class="hash-link" aria-label="Direct link to 2. å¯è§æ€§" title="Direct link to 2. å¯è§æ€§">â€‹</a></h5><p>å¯è§æ€§æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚Java å†…å­˜æ¨¡å‹æ˜¯é€šè¿‡åœ¨å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜ï¼Œåœ¨å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼æ¥å®ç°å¯è§æ€§çš„ã€‚</p><p>ä¸»è¦æœ‰æœ‰ä¸‰ç§å®ç°å¯è§æ€§çš„æ–¹å¼ï¼š</p><ul><li>volatile</li><li>synchronizedï¼Œå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»æŠŠå˜é‡å€¼åŒæ­¥å›ä¸»å†…å­˜ã€‚</li><li>finalï¼Œè¢« final å…³é”®å­—ä¿®é¥°çš„å­—æ®µåœ¨æ„é€ å™¨ä¸­ä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œå¹¶ä¸”æ²¡æœ‰å‘ç”Ÿ this é€ƒé€¸ï¼ˆå…¶å®ƒçº¿ç¨‹é€šè¿‡ this å¼•ç”¨è®¿é—®åˆ°åˆå§‹åŒ–äº†ä¸€åŠçš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±èƒ½çœ‹è§ final å­—æ®µçš„å€¼ã€‚</li></ul><p>å¯¹å‰é¢çš„çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹ä¸­çš„ cnt å˜é‡ä½¿ç”¨ volatile ä¿®é¥°ï¼Œä¸èƒ½è§£å†³çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼Œå› ä¸º volatile å¹¶ä¸èƒ½ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-æœ‰åºæ€§">3. æœ‰åºæ€§<a href="#3-æœ‰åºæ€§" class="hash-link" aria-label="Direct link to 3. æœ‰åºæ€§" title="Direct link to 3. æœ‰åºæ€§">â€‹</a></h5><p>æœ‰åºæ€§æ˜¯æŒ‡ï¼šåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ã€‚åœ¨ä¸€ä¸ªçº¿ç¨‹è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ï¼Œæ— åºæ˜¯å› ä¸ºå‘ç”Ÿäº†æŒ‡ä»¤é‡æ’åºã€‚</p><p>åœ¨ Java å†…å­˜æ¨¡å‹ä¸­ï¼Œå…è®¸ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œé‡æ’åºè¿‡ç¨‹ä¸ä¼šå½±å“åˆ°å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œï¼Œå´ä¼šå½±å“åˆ°å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚</p><p>volatile å…³é”®å­—é€šè¿‡æ·»åŠ å†…å­˜å±éšœçš„æ–¹å¼æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œå³é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤æ”¾åˆ°å†…å­˜å±éšœä¹‹å‰ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡ synchronized æ¥ä¿è¯æœ‰åºæ€§ï¼Œå®ƒä¿è¯æ¯ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œç›¸å½“äºæ˜¯è®©çº¿ç¨‹é¡ºåºæ‰§è¡ŒåŒæ­¥ä»£ç ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="æŒ‡ä»¤é‡æ’åº">æŒ‡ä»¤é‡æ’åº<a href="#æŒ‡ä»¤é‡æ’åº" class="hash-link" aria-label="Direct link to æŒ‡ä»¤é‡æ’åº" title="Direct link to æŒ‡ä»¤é‡æ’åº">â€‹</a></h4><p>åœ¨æ‰§è¡Œç¨‹åºæ—¶ä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æ’åºã€‚</p><p>æŒ‡ä»¤é‡æ’åºåŒ…æ‹¬ï¼š<strong>ç¼–è¯‘å™¨é‡æ’åº</strong>å’Œ<strong>å¤„ç†å™¨é‡æ’åº</strong></p><p>é‡æ’åºåˆ†ä¸‰ç§ç±»å‹ï¼š</p><ol><li><strong>ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åº</strong>ã€‚ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚</li><li><strong>æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åº</strong>ã€‚ç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯ï¼ˆInstruction-Level Parallelismï¼Œ ILPï¼‰æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚</li><li><strong>å†…å­˜ç³»ç»Ÿçš„é‡æ’åº</strong>ã€‚ç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»/å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œã€‚</li></ol><p>ä» Java æºä»£ç åˆ°æœ€ç»ˆå®é™…æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ï¼Œä¼šåˆ†åˆ«ç»å†ä¸‹é¢ä¸‰ç§é‡æ’åºï¼š</p><div align="center"><img loading="lazy" src="assets/33-1534150864535.png" width="" class="img_ev3q"></div><p><strong>ä¸Šè¿°çš„ 1 å±äºç¼–è¯‘å™¨é‡æ’åºï¼Œ2 å’Œ 3 å±äºå¤„ç†å™¨é‡æ’åº</strong>ã€‚è¿™äº›é‡æ’åºéƒ½å¯èƒ½ä¼šå¯¼è‡´å¤šçº¿ç¨‹ç¨‹åºå‡ºç°å†…å­˜å¯è§æ€§é—®é¢˜ã€‚å¯¹äºç¼–è¯‘å™¨ï¼ŒJMM çš„ç¼–è¯‘å™¨é‡æ’åºè§„åˆ™ä¼šç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºï¼ˆä¸æ˜¯æ‰€æœ‰çš„ç¼–è¯‘å™¨é‡æ’åºéƒ½è¦ç¦æ­¢ï¼‰ã€‚å¯¹äºå¤„ç†å™¨é‡æ’åºï¼ŒJMM çš„å¤„ç†å™¨é‡æ’åºè§„åˆ™ä¼šè¦æ±‚ Java ç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—æ—¶ï¼Œæ’å…¥ç‰¹å®šç±»å‹çš„å†…å­˜å±éšœï¼ˆmemory barriersï¼Œintel ç§°ä¹‹ä¸º memory fenceï¼‰æŒ‡ä»¤ï¼Œé€šè¿‡å†…å­˜å±éšœæŒ‡ä»¤æ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºï¼ˆä¸æ˜¯æ‰€æœ‰çš„å¤„ç†å™¨é‡æ’åºéƒ½è¦ç¦æ­¢ï¼‰ã€‚</p><p>JMM å±äºè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå®ƒç¡®ä¿åœ¨ä¸åŒçš„ç¼–è¯‘å™¨å’Œä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šï¼Œé€šè¿‡ç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºå’Œå¤„ç†å™¨é‡æ’åºï¼Œä¸ºç¨‹åºå‘˜æä¾›ä¸€è‡´çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="æ•°æ®ä¾èµ–æ€§">æ•°æ®ä¾èµ–æ€§<a href="#æ•°æ®ä¾èµ–æ€§" class="hash-link" aria-label="Direct link to æ•°æ®ä¾èµ–æ€§" title="Direct link to æ•°æ®ä¾èµ–æ€§">â€‹</a></h5><p>å¦‚æœä¸¤ä¸ªæ“ä½œè®¿é—®åŒä¸€ä¸ªå˜é‡ï¼Œä¸”è¿™ä¸¤ä¸ªæ“ä½œä¸­æœ‰ä¸€ä¸ªä¸ºå†™æ“ä½œï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å°±å­˜åœ¨æ•°æ®ä¾èµ–æ€§ã€‚æ•°æ®ä¾èµ–åˆ†ä¸‹åˆ—ä¸‰ç§ç±»å‹ï¼š</p><table><thead><tr><th>åç§°</th><th>ä»£ç ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å†™åè¯»</td><td>a = 1;b = a;</td><td>å†™ä¸€ä¸ªå˜é‡ä¹‹åï¼Œå†è¯»è¿™ä¸ªä½ç½®ã€‚</td></tr><tr><td>å†™åå†™</td><td>a = 1;a = 2;</td><td>å†™ä¸€ä¸ªå˜é‡ä¹‹åï¼Œå†å†™è¿™ä¸ªå˜é‡ã€‚</td></tr><tr><td>è¯»åå†™</td><td>a = b;b = 1;</td><td>è¯»ä¸€ä¸ªå˜é‡ä¹‹åï¼Œå†å†™è¿™ä¸ªå˜é‡ã€‚</td></tr></tbody></table><p>ä¸Šé¢ä¸‰ç§æƒ…å†µï¼Œåªè¦é‡æ’åºä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºï¼Œç¨‹åºçš„æ‰§è¡Œç»“æœå°†ä¼šè¢«æ”¹å˜ã€‚</p><p>å‰é¢æåˆ°è¿‡ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹æ“ä½œåšé‡æ’åºã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨åœ¨é‡æ’åºæ—¶ï¼Œä¼šéµå®ˆæ•°æ®ä¾èµ–æ€§ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šæ”¹å˜å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºã€‚</p><p>æ³¨æ„ï¼Œè¿™é‡Œæ‰€è¯´çš„æ•°æ®ä¾èµ–æ€§ä»…é’ˆå¯¹å•ä¸ªå¤„ç†å™¨ä¸­æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—å’Œå•ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œï¼Œä¸åŒå¤„ç†å™¨ä¹‹é—´å’Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ä¸è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨è€ƒè™‘ã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="as-if-serialè¯­ä¹‰">as-if-serialè¯­ä¹‰<a href="#as-if-serialè¯­ä¹‰" class="hash-link" aria-label="Direct link to as-if-serialè¯­ä¹‰" title="Direct link to as-if-serialè¯­ä¹‰">â€‹</a></h5><p>as-if-serial è¯­ä¹‰çš„æ„æ€æŒ‡ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åºï¼ˆç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰ï¼Œï¼ˆå•çº¿ç¨‹ï¼‰ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚ç¼–è¯‘å™¨ï¼Œruntime å’Œ å¤„ç†å™¨ éƒ½å¿…é¡»éµå®ˆ as-if-serial è¯­ä¹‰ã€‚</p><p>ä¸ºäº†éµå®ˆ as-if-serial è¯­ä¹‰ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åºï¼Œå› ä¸ºè¿™ç§é‡æ’åºä¼šæ”¹å˜æ‰§è¡Œç»“æœã€‚ä½†æ˜¯ï¼Œå¦‚æœæ“ä½œä¹‹é—´ä¸å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œè¿™äº›æ“ä½œå¯èƒ½è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨é‡æ’åºã€‚ä¸ºäº†å…·ä½“è¯´æ˜ï¼Œè¯·çœ‹ä¸‹é¢è®¡ç®—åœ†é¢ç§¯çš„ä»£ç ç¤ºä¾‹ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">double</span><span class="token plain"> pi  </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3.14</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//A</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">double</span><span class="token plain"> r   </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//B</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">double</span><span class="token plain"> area </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> pi </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> r </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//C</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸Šé¢ä¸‰ä¸ªæ“ä½œçš„æ•°æ®ä¾èµ–å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><div align="center"><img loading="lazy" src="assets/11.png" width="" class="img_ev3q"></div><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒA å’Œ C ä¹‹é—´å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼ŒåŒæ—¶ B å’Œ C ä¹‹é—´ä¹Ÿå­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ã€‚å› æ­¤åœ¨æœ€ç»ˆæ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ä¸­ï¼ŒC ä¸èƒ½è¢«é‡æ’åºåˆ° A å’Œ B çš„å‰é¢ï¼ˆC æ’åˆ° A å’Œ B çš„å‰é¢ï¼Œç¨‹åºçš„ç»“æœå°†ä¼šè¢«æ”¹å˜ï¼‰ã€‚ä½† A å’Œ B ä¹‹é—´æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯ä»¥é‡æ’åº A å’Œ B ä¹‹é—´çš„æ‰§è¡Œé¡ºåºã€‚ä¸‹å›¾æ˜¯è¯¥ç¨‹åºçš„ä¸¤ç§æ‰§è¡Œé¡ºåºï¼š</p><div align="center"><img loading="lazy" src="assets/22.png" width="" class="img_ev3q"></div><p>as-if-serial è¯­ä¹‰æŠŠå•çº¿ç¨‹ç¨‹åºä¿æŠ¤äº†èµ·æ¥ï¼Œéµå®ˆ as-if-serial è¯­ä¹‰çš„ç¼–è¯‘å™¨ï¼Œruntime å’Œå¤„ç†å™¨å…±åŒä¸ºç¼–å†™å•çº¿ç¨‹ç¨‹åºçš„ç¨‹åºå‘˜åˆ›å»ºäº†ä¸€ä¸ªå¹»è§‰ï¼šå•çº¿ç¨‹ç¨‹åºæ˜¯æŒ‰ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œçš„ã€‚as-if-serial è¯­ä¹‰ä½¿å•çº¿ç¨‹ç¨‹åºå‘˜æ— éœ€æ‹…å¿ƒé‡æ’åºä¼šå¹²æ‰°ä»–ä»¬ï¼Œä¹Ÿæ— éœ€æ‹…å¿ƒå†…å­˜å¯è§æ€§é—®é¢˜ã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ç¨‹åºé¡ºåºè§„åˆ™">ç¨‹åºé¡ºåºè§„åˆ™<a href="#ç¨‹åºé¡ºåºè§„åˆ™" class="hash-link" aria-label="Direct link to ç¨‹åºé¡ºåºè§„åˆ™" title="Direct link to ç¨‹åºé¡ºåºè§„åˆ™">â€‹</a></h5><p>æ ¹æ® happens- before çš„ç¨‹åºé¡ºåºè§„åˆ™ï¼Œä¸Šé¢è®¡ç®—åœ†çš„é¢ç§¯çš„ç¤ºä¾‹ä»£ç å­˜åœ¨ä¸‰ä¸ª happens- before å…³ç³»ï¼š</p><ol><li>A happens- before Bï¼›</li><li>B happens- before Cï¼›</li><li>A happens- before Cï¼›</li></ol><p>è¿™é‡Œçš„ç¬¬ 3 ä¸ª happens- before å…³ç³»ï¼Œæ˜¯æ ¹æ® happens- before çš„ä¼ é€’æ€§æ¨å¯¼å‡ºæ¥çš„ã€‚</p><p>è¿™é‡Œ A happens- before Bï¼Œä½†å®é™…æ‰§è¡Œæ—¶ B å´å¯ä»¥æ’åœ¨ A ä¹‹å‰æ‰§è¡Œï¼ˆçœ‹ä¸Šé¢çš„é‡æ’åºåçš„æ‰§è¡Œé¡ºåºï¼‰ã€‚å¦‚æœA happens- before Bï¼ŒJMM å¹¶ä¸è¦æ±‚ A ä¸€å®šè¦åœ¨ B ä¹‹å‰æ‰§è¡Œã€‚JMM ä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æœï¼‰å¯¹åä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚è¿™é‡Œæ“ä½œ A çš„æ‰§è¡Œç»“æœä¸éœ€è¦å¯¹æ“ä½œ B å¯è§ï¼›è€Œä¸”é‡æ’åºæ“ä½œ A å’Œæ“ä½œ B åçš„æ‰§è¡Œç»“æœï¼Œä¸æ“ä½œ A å’Œæ“ä½œ B æŒ‰ happens- before é¡ºåºæ‰§è¡Œçš„ç»“æœä¸€è‡´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ JMM ä¼šè®¤ä¸ºè¿™ç§é‡æ’åºå¹¶ä¸éæ³•ï¼ˆnot illegalï¼‰ï¼ŒJMM å…è®¸è¿™ç§é‡æ’åºã€‚</p><p>åœ¨è®¡ç®—æœºä¸­ï¼Œè½¯ä»¶æŠ€æœ¯å’Œç¡¬ä»¶æŠ€æœ¯æœ‰ä¸€ä¸ªå…±åŒçš„ç›®æ ‡ï¼šåœ¨ä¸æ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½çš„å¼€å‘å¹¶è¡Œåº¦ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨éµä»è¿™ä¸€ç›®æ ‡ï¼Œä» happens- before çš„å®šä¹‰æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒJMM åŒæ ·éµä»è¿™ä¸€ç›®æ ‡ã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“">é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“<a href="#é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“" class="hash-link" aria-label="Direct link to é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“" title="Direct link to é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“">â€‹</a></h5><p>ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œé‡æ’åºæ˜¯å¦ä¼šæ”¹å˜å¤šçº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœã€‚è¯·çœ‹ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ReorderExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> flag </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">writer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        a </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">                   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        flag </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">             </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">reader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">flag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">                </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">  a </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            â€¦â€¦</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>flag å˜é‡æ˜¯ä¸ªæ ‡è®°ï¼Œç”¨æ¥æ ‡è¯†å˜é‡ a æ˜¯å¦å·²è¢«å†™å…¥ã€‚è¿™é‡Œå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ A å’Œ Bï¼ŒAé¦–å…ˆæ‰§è¡Œ writer() æ–¹æ³•ï¼Œéšå B çº¿ç¨‹æ¥ç€æ‰§è¡Œ reader() æ–¹æ³•ã€‚çº¿ç¨‹ B åœ¨æ‰§è¡Œæ“ä½œ 4 æ—¶ï¼Œèƒ½å¦çœ‹åˆ°çº¿ç¨‹ A åœ¨æ“ä½œ 1 å¯¹å…±äº«å˜é‡ a çš„å†™å…¥ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼šä¸ä¸€å®šèƒ½çœ‹åˆ°ã€‚</p><p>ç”±äºæ“ä½œ 1 å’Œæ“ä½œ 2 æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯ä»¥å¯¹è¿™ä¸¤ä¸ªæ“ä½œé‡æ’åºï¼›åŒæ ·ï¼Œæ“ä½œ 3 å’Œæ“ä½œ 4 æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¹Ÿå¯ä»¥å¯¹è¿™ä¸¤ä¸ªæ“ä½œé‡æ’åºã€‚è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œå½“æ“ä½œ 1 å’Œæ“ä½œ 2 é‡æ’åºæ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœï¼Ÿè¯·çœ‹ä¸‹é¢çš„ç¨‹åºæ‰§è¡Œæ—¶åºå›¾ï¼š</p><div align="center"><img loading="lazy" src="assets/33.png" width="" class="img_ev3q"></div><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ“ä½œ 1 å’Œæ“ä½œ 2 åšäº†é‡æ’åºã€‚ç¨‹åºæ‰§è¡Œæ—¶ï¼Œçº¿ç¨‹ A é¦–å…ˆå†™æ ‡è®°å˜é‡ flagï¼Œéšåçº¿ç¨‹ B è¯»è¿™ä¸ªå˜é‡ã€‚ç”±äºæ¡ä»¶åˆ¤æ–­ä¸ºçœŸï¼Œçº¿ç¨‹ B å°†è¯»å–å˜é‡ aã€‚æ­¤æ—¶ï¼Œå˜é‡ a è¿˜æ ¹æœ¬æ²¡æœ‰è¢«çº¿ç¨‹ A å†™å…¥ï¼Œåœ¨è¿™é‡Œå¤šçº¿ç¨‹ç¨‹åºçš„è¯­ä¹‰è¢«é‡æ’åºç ´åäº†ï¼</p><p>â€»æ³¨ï¼šæœ¬æ–‡ç»Ÿä¸€ç”¨çº¢è‰²çš„è™šç®­çº¿è¡¨ç¤ºé”™è¯¯çš„è¯»æ“ä½œï¼Œç”¨ç»¿è‰²çš„è™šç®­çº¿è¡¨ç¤ºæ­£ç¡®çš„è¯»æ“ä½œã€‚</p><p>ä¸‹é¢å†è®©æˆ‘ä»¬çœ‹çœ‹ï¼Œå½“æ“ä½œ 3 å’Œæ“ä½œ 4 é‡æ’åºæ—¶ä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœï¼ˆå€ŸåŠ©è¿™ä¸ªé‡æ’åºï¼Œå¯ä»¥é¡ºä¾¿è¯´æ˜æ§åˆ¶ä¾èµ–æ€§ï¼‰ã€‚ä¸‹é¢æ˜¯æ“ä½œ 3 å’Œæ“ä½œ 4 é‡æ’åºåï¼Œç¨‹åºçš„æ‰§è¡Œæ—¶åºå›¾ï¼š</p><div align="center"><img loading="lazy" src="assets/44.png" width="" class="img_ev3q"></div><p>åœ¨ç¨‹åºä¸­ï¼Œæ“ä½œ 3 å’Œæ“ä½œ 4 å­˜åœ¨æ§åˆ¶ä¾èµ–å…³ç³»ã€‚å½“ä»£ç ä¸­å­˜åœ¨æ§åˆ¶ä¾èµ–æ€§æ—¶ï¼Œä¼šå½±å“æŒ‡ä»¤åºåˆ—æ‰§è¡Œçš„å¹¶è¡Œåº¦ã€‚ä¸ºæ­¤ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¼šé‡‡ç”¨çŒœæµ‹ï¼ˆSpeculationï¼‰æ‰§è¡Œæ¥å…‹æœæ§åˆ¶ç›¸å…³æ€§å¯¹å¹¶è¡Œåº¦çš„å½±å“ã€‚ä»¥å¤„ç†å™¨çš„çŒœæµ‹æ‰§è¡Œä¸ºä¾‹ï¼Œæ‰§è¡Œçº¿ç¨‹ B çš„å¤„ç†å™¨å¯ä»¥æå‰è¯»å–å¹¶è®¡ç®— a*aï¼Œç„¶åæŠŠè®¡ç®—ç»“æœä¸´æ—¶ä¿å­˜åˆ°ä¸€ä¸ªåä¸ºé‡æ’åºç¼“å†²ï¼ˆreorder buffer ROBï¼‰çš„ç¡¬ä»¶ç¼“å­˜ä¸­ã€‚å½“æ¥ä¸‹æ¥æ“ä½œ3çš„æ¡ä»¶åˆ¤æ–­ä¸ºçœŸæ—¶ï¼Œå°±æŠŠè¯¥è®¡ç®—ç»“æœå†™å…¥å˜é‡ i ä¸­ã€‚</p><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒçŒœæµ‹æ‰§è¡Œå®è´¨ä¸Šå¯¹æ“ä½œ 3 å’Œ 4 åšäº†é‡æ’åºã€‚é‡æ’åºåœ¨è¿™é‡Œç ´åäº†å¤šçº¿ç¨‹ç¨‹åºçš„è¯­ä¹‰ï¼</p><p>åœ¨å•çº¿ç¨‹ç¨‹åºä¸­ï¼Œå¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œé‡æ’åºï¼Œä¸ä¼šæ”¹å˜æ‰§è¡Œç»“æœï¼ˆè¿™ä¹Ÿæ˜¯ as-if-serial è¯­ä¹‰å…è®¸å¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œåšé‡æ’åºçš„åŸå› ï¼‰ï¼›ä½†åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œå¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œé‡æ’åºï¼Œå¯èƒ½ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><p><a href="http://www.infoq.com/cn/articles/java-memory-model-1" target="_blank" rel="noopener noreferrer">æ·±å…¥ç†è§£Javaå†…å­˜æ¨¡å‹ï¼ˆä¸€ï¼‰â€”â€”åŸºç¡€</a></p></li><li><p><a href="http://www.infoq.com/cn/articles/java-memory-model-2" target="_blank" rel="noopener noreferrer">æ·±å…¥ç†è§£Javaå†…å­˜æ¨¡å‹ï¼ˆäºŒï¼‰â€”â€”é‡æ’åº</a></p></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å…ˆè¡Œå‘ç”ŸåŸåˆ™happens-before">å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼ˆhappens-beforeï¼‰<a href="#å…ˆè¡Œå‘ç”ŸåŸåˆ™happens-before" class="hash-link" aria-label="Direct link to å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼ˆhappens-beforeï¼‰" title="Direct link to å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼ˆhappens-beforeï¼‰">â€‹</a></h4><p>Happens-before æ˜¯ç”¨æ¥æŒ‡å®šä¸¤ä¸ªæ“ä½œä¹‹é—´çš„æ‰§è¡Œé¡ºåºã€‚æä¾›è·¨çº¿ç¨‹çš„å†…å­˜å¯è§æ€§ã€‚</p><p>åœ¨ Java å†…å­˜æ¨¡å‹ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å¿…ç„¶å­˜åœ¨ happens-before å…³ç³»ã€‚</p><p>ä¸Šé¢æåˆ°äº†å¯ä»¥ç”¨ volatile å’Œ synchronized æ¥ä¿è¯æœ‰åºæ€§ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJVM è¿˜è§„å®šäº†å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼Œè®©ä¸€ä¸ªæ“ä½œæ— éœ€æ§åˆ¶å°±èƒ½å…ˆäºå¦ä¸€ä¸ªæ“ä½œå®Œæˆã€‚</p><p>ä¸»è¦æœ‰ä»¥ä¸‹è¿™äº›åŸåˆ™ï¼š</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-å•ä¸€çº¿ç¨‹åŸåˆ™">1. å•ä¸€çº¿ç¨‹åŸåˆ™<a href="#1-å•ä¸€çº¿ç¨‹åŸåˆ™" class="hash-link" aria-label="Direct link to 1. å•ä¸€çº¿ç¨‹åŸåˆ™" title="Direct link to 1. å•ä¸€çº¿ç¨‹åŸåˆ™">â€‹</a></h5><blockquote><p>Single Thread rule</p></blockquote><p>åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼Œåœ¨ç¨‹åºå‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢çš„æ“ä½œã€‚</p><div align="center"><img loading="lazy" src="assets/single-thread-rule-1534148720379.png" width="" class="img_ev3q"></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-ç®¡ç¨‹é”å®šè§„åˆ™">2. ç®¡ç¨‹é”å®šè§„åˆ™<a href="#2-ç®¡ç¨‹é”å®šè§„åˆ™" class="hash-link" aria-label="Direct link to 2. ç®¡ç¨‹é”å®šè§„åˆ™" title="Direct link to 2. ç®¡ç¨‹é”å®šè§„åˆ™">â€‹</a></h5><blockquote><p>Monitor Lock Rule</p></blockquote><p>å¯¹ä¸€ä¸ªé”çš„è§£é”ï¼ˆunlock ï¼‰ï¼Œæ€»æ˜¯ happens-before äºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”ï¼ˆlockï¼‰</p><div align="center"><img loading="lazy" src="assets/monitor-lock-rule-1534148737603.png" width="" class="img_ev3q"></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-volatile-å˜é‡è§„åˆ™">3. volatile å˜é‡è§„åˆ™<a href="#3-volatile-å˜é‡è§„åˆ™" class="hash-link" aria-label="Direct link to 3. volatile å˜é‡è§„åˆ™" title="Direct link to 3. volatile å˜é‡è§„åˆ™">â€‹</a></h5><blockquote><p>Volatile Variable Rule</p></blockquote><p>å¯¹ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚</p><div align="center"><img loading="lazy" src="assets/volatile-variable-rule-1534148747964.png" width="600" class="img_ev3q"></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-çº¿ç¨‹å¯åŠ¨è§„åˆ™">4. çº¿ç¨‹å¯åŠ¨è§„åˆ™<a href="#4-çº¿ç¨‹å¯åŠ¨è§„åˆ™" class="hash-link" aria-label="Direct link to 4. çº¿ç¨‹å¯åŠ¨è§„åˆ™" title="Direct link to 4. çº¿ç¨‹å¯åŠ¨è§„åˆ™">â€‹</a></h5><blockquote><p>Thread Start Rule</p></blockquote><p>Thread å¯¹è±¡çš„ start() æ–¹æ³•è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œã€‚</p><div align="center"><img loading="lazy" src="assets/thread-start-rule-1534148760654.png" width="600" class="img_ev3q"></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-çº¿ç¨‹åŠ å…¥è§„åˆ™">5. çº¿ç¨‹åŠ å…¥è§„åˆ™<a href="#5-çº¿ç¨‹åŠ å…¥è§„åˆ™" class="hash-link" aria-label="Direct link to 5. çº¿ç¨‹åŠ å…¥è§„åˆ™" title="Direct link to 5. çº¿ç¨‹åŠ å…¥è§„åˆ™">â€‹</a></h5><blockquote><p>Thread Join Rule</p></blockquote><p>Thread å¯¹è±¡çš„ç»“æŸå…ˆè¡Œå‘ç”Ÿäº join() æ–¹æ³•è¿”å›ã€‚</p><div align="center"><img loading="lazy" src="assets/thread-join-rule-1534148774041.png" width="" class="img_ev3q"></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-çº¿ç¨‹ä¸­æ–­è§„åˆ™">6. çº¿ç¨‹ä¸­æ–­è§„åˆ™<a href="#6-çº¿ç¨‹ä¸­æ–­è§„åˆ™" class="hash-link" aria-label="Direct link to 6. çº¿ç¨‹ä¸­æ–­è§„åˆ™" title="Direct link to 6. çº¿ç¨‹ä¸­æ–­è§„åˆ™">â€‹</a></h5><blockquote><p>Thread Interruption Rule</p></blockquote><p>å¯¹çº¿ç¨‹ interrupt() æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡ interrupted() æ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ä¸­æ–­å‘ç”Ÿã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7-å¯¹è±¡ç»ˆç»“è§„åˆ™">7. å¯¹è±¡ç»ˆç»“è§„åˆ™<a href="#7-å¯¹è±¡ç»ˆç»“è§„åˆ™" class="hash-link" aria-label="Direct link to 7. å¯¹è±¡ç»ˆç»“è§„åˆ™" title="Direct link to 7. å¯¹è±¡ç»ˆç»“è§„åˆ™">â€‹</a></h5><blockquote><p>Finalizer Rule</p></blockquote><p>ä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆï¼ˆæ„é€ å‡½æ•°æ‰§è¡Œç»“æŸï¼‰å…ˆè¡Œå‘ç”Ÿäºå®ƒçš„ finalize() æ–¹æ³•çš„å¼€å§‹ã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8-ä¼ é€’æ€§">8. ä¼ é€’æ€§<a href="#8-ä¼ é€’æ€§" class="hash-link" aria-label="Direct link to 8. ä¼ é€’æ€§" title="Direct link to 8. ä¼ é€’æ€§">â€‹</a></h5><blockquote><p>Transitivity</p></blockquote><p>å¦‚æœæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Bï¼Œæ“ä½œ B å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Cï¼Œé‚£ä¹ˆæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Cã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11-çº¿ç¨‹å®‰å…¨">11. çº¿ç¨‹å®‰å…¨<a href="#11-çº¿ç¨‹å®‰å…¨" class="hash-link" aria-label="Direct link to 11. çº¿ç¨‹å®‰å…¨" title="Direct link to 11. çº¿ç¨‹å®‰å…¨">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="çº¿ç¨‹å®‰å…¨å®šä¹‰">çº¿ç¨‹å®‰å…¨å®šä¹‰<a href="#çº¿ç¨‹å®‰å…¨å®šä¹‰" class="hash-link" aria-label="Direct link to çº¿ç¨‹å®‰å…¨å®šä¹‰" title="Direct link to çº¿ç¨‹å®‰å…¨å®šä¹‰">â€‹</a></h4><p>ä¸€ä¸ªç±»åœ¨å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å®‰å…¨è°ƒç”¨æ—¶å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="çº¿ç¨‹å®‰å…¨åˆ†ç±»">çº¿ç¨‹å®‰å…¨åˆ†ç±»<a href="#çº¿ç¨‹å®‰å…¨åˆ†ç±»" class="hash-link" aria-label="Direct link to çº¿ç¨‹å®‰å…¨åˆ†ç±»" title="Direct link to çº¿ç¨‹å®‰å…¨åˆ†ç±»">â€‹</a></h4><p>çº¿ç¨‹å®‰å…¨ä¸æ˜¯ä¸€ä¸ªéçœŸå³å‡çš„å‘½é¢˜ï¼Œå¯ä»¥å°†å…±äº«æ•°æ®æŒ‰ç…§å®‰å…¨ç¨‹åº¦çš„å¼ºå¼±é¡ºåºåˆ†æˆä»¥ä¸‹äº”ç±»ï¼šä¸å¯å˜ã€ç»å¯¹çº¿ç¨‹å®‰å…¨ã€ç›¸å¯¹çº¿ç¨‹å®‰å…¨ã€çº¿ç¨‹å…¼å®¹å’Œçº¿ç¨‹å¯¹ç«‹ã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-ä¸å¯å˜">1. ä¸å¯å˜<a href="#1-ä¸å¯å˜" class="hash-link" aria-label="Direct link to 1. ä¸å¯å˜" title="Direct link to 1. ä¸å¯å˜">â€‹</a></h5><p><strong>ä¸å¯å˜ï¼ˆImmutableï¼‰çš„å¯¹è±¡ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ï¼Œæ— è®ºæ˜¯å¯¹è±¡çš„æ–¹æ³•å®ç°è¿˜æ˜¯æ–¹æ³•çš„è°ƒç”¨è€…ï¼Œéƒ½ä¸éœ€è¦å†é‡‡å–ä»»ä½•çš„çº¿ç¨‹å®‰å…¨ä¿éšœæªæ–½ï¼Œåªè¦ä¸€ä¸ªä¸å¯å˜çš„å¯¹è±¡è¢«æ­£ç¡®åœ°æ„å»ºå‡ºæ¥ï¼Œé‚£å…¶å¤–éƒ¨çš„å¯è§çŠ¶æ€æ°¸è¿œä¹Ÿä¸ä¼šæ”¹å˜ï¼Œæ°¸è¿œä¹Ÿä¸ä¼šçœ‹åˆ°å®ƒåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹ä¸­å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ã€‚</p><p>ä¸å¯å˜çš„ç±»å‹ï¼š</p><ul><li>final å…³é”®å­—ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼›</li><li>String</li><li>æšä¸¾ç±»å‹</li><li>Number éƒ¨åˆ†å­ç±»ï¼Œå¦‚ Long å’Œ Double ç­‰æ•°å€¼åŒ…è£…ç±»å‹ï¼ŒBigInteger å’Œ BigDecimal ç­‰å¤§æ•°æ®ç±»å‹ã€‚ä½†åŒä¸º Number çš„å­ç±»å‹çš„åŸå­ç±» AtomicInteger å’Œ AtomicLong åˆ™å¹¶éä¸å¯å˜çš„ã€‚</li></ul><p>å¯¹äºé›†åˆç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ Collections.unmodifiableXXX() æ–¹æ³•æ¥è·å–ä¸€ä¸ªä¸å¯å˜çš„é›†åˆã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ImmutableExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Map</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">String</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> map </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">HashMap</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Map</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">String</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> unmodifiableMap </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Collections</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">unmodifiableMap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        unmodifiableMap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">put</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token class-name" style="color:rgb(255, 203, 107)">Exception</span><span class="token plain"> in thread </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;main&quot;</span><span class="token plain"> </span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">lang</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">UnsupportedOperationException</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">util</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Collections</span><span class="token plain">$</span><span class="token class-name" style="color:rgb(255, 203, 107)">UnmodifiableMap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">put</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Collections</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">1457</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name" style="color:rgb(255, 203, 107)">ImmutableExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">ImmutableExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Collections.unmodifiableXXX() å…ˆå¯¹åŸå§‹çš„é›†åˆè¿›è¡Œæ‹·è´ï¼Œéœ€è¦å¯¹é›†åˆè¿›è¡Œä¿®æ”¹çš„æ–¹æ³•éƒ½ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">V</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">put</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">K</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">V</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">throw</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">UnsupportedOperationException</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œåº”å½“å°½é‡ä½¿å¯¹è±¡æˆä¸ºä¸å¯å˜ï¼Œæ¥æ»¡è¶³çº¿ç¨‹å®‰å…¨ã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-ç»å¯¹çº¿ç¨‹å®‰å…¨">2. ç»å¯¹çº¿ç¨‹å®‰å…¨<a href="#2-ç»å¯¹çº¿ç¨‹å®‰å…¨" class="hash-link" aria-label="Direct link to 2. ç»å¯¹çº¿ç¨‹å®‰å…¨" title="Direct link to 2. ç»å¯¹çº¿ç¨‹å®‰å…¨">â€‹</a></h5><p>ä¸ç®¡è¿è¡Œæ—¶ç¯å¢ƒå¦‚ä½•ï¼Œè°ƒç”¨è€…éƒ½ä¸éœ€è¦ä»»ä½•é¢å¤–çš„åŒæ­¥æªæ–½ã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-ç›¸å¯¹çº¿ç¨‹å®‰å…¨">3. ç›¸å¯¹çº¿ç¨‹å®‰å…¨<a href="#3-ç›¸å¯¹çº¿ç¨‹å®‰å…¨" class="hash-link" aria-label="Direct link to 3. ç›¸å¯¹çº¿ç¨‹å®‰å…¨" title="Direct link to 3. ç›¸å¯¹çº¿ç¨‹å®‰å…¨">â€‹</a></h5><p>ç›¸å¯¹çš„çº¿ç¨‹å®‰å…¨éœ€è¦ä¿è¯å¯¹è¿™ä¸ªå¯¹è±¡å•ç‹¬çš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ä¸éœ€è¦åšé¢å¤–çš„ä¿éšœæªæ–½ï¼Œä½†æ˜¯å¯¹äºä¸€äº›ç‰¹å®šé¡ºåºçš„è¿ç»­è°ƒç”¨ï¼Œå°±å¯èƒ½éœ€è¦åœ¨è°ƒç”¨ç«¯ä½¿ç”¨é¢å¤–çš„åŒæ­¥æ‰‹æ®µæ¥ä¿è¯è°ƒç”¨çš„æ­£ç¡®æ€§ã€‚</p><p>åœ¨ Java è¯­è¨€ä¸­ï¼Œå¤§éƒ¨åˆ†çš„çº¿ç¨‹å®‰å…¨ç±»éƒ½å±äºè¿™ç§ç±»å‹ï¼Œä¾‹å¦‚ Vectorã€HashTableã€Collections çš„ synchronizedCollection() æ–¹æ³•åŒ…è£…çš„é›†åˆç­‰ã€‚</p><p>å¯¹äºä¸‹é¢çš„ä»£ç ï¼Œå¦‚æœåˆ é™¤å…ƒç´ çš„çº¿ç¨‹åˆ é™¤äº†ä¸€ä¸ªå…ƒç´ ï¼Œè€Œè·å–å…ƒç´ çš„çº¿ç¨‹è¯•å›¾è®¿é—®ä¸€ä¸ªå·²ç»è¢«åˆ é™¤çš„å…ƒç´ ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º ArrayIndexOutOfBoundsExceptionã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">VectorUnsafeExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Vector</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Integer</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> vector </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Vector</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">shutdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token class-name" style="color:rgb(255, 203, 107)">Exception</span><span class="token plain"> in thread </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Thread-159738&quot;</span><span class="token plain"> </span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">lang</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">ArrayIndexOutOfBoundsException</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Array</span><span class="token plain"> index out of range</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">util</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">831</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name" style="color:rgb(255, 203, 107)">VectorUnsafeExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lambda$main$</span><span class="token function" style="color:rgb(130, 170, 255)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">VectorUnsafeExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">14</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name" style="color:rgb(255, 203, 107)">VectorUnsafeExample</span><span class="token plain">$$</span><span class="token class-name" style="color:rgb(255, 203, 107)">Lambda</span><span class="token plain">$</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">713338599.</span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Unknown</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    at </span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">java</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name namespace" style="color:rgb(178, 204, 214)">lang</span><span class="token class-name namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">745</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦‚æœè¦ä¿è¯ä¸Šé¢çš„ä»£ç èƒ½æ­£ç¡®æ‰§è¡Œä¸‹å»ï¼Œå°±éœ€è¦å¯¹åˆ é™¤å…ƒç´ å’Œè·å–å…ƒç´ çš„ä»£ç è¿›è¡ŒåŒæ­¥ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-çº¿ç¨‹å…¼å®¹">4. çº¿ç¨‹å…¼å®¹<a href="#4-çº¿ç¨‹å…¼å®¹" class="hash-link" aria-label="Direct link to 4. çº¿ç¨‹å…¼å®¹" title="Direct link to 4. çº¿ç¨‹å…¼å®¹">â€‹</a></h5><p>çº¿ç¨‹å…¼å®¹æ˜¯æŒ‡å¯¹è±¡æœ¬èº«å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åœ¨è°ƒç”¨ç«¯æ­£ç¡®åœ°ä½¿ç”¨åŒæ­¥æ‰‹æ®µæ¥ä¿è¯å¯¹è±¡åœ¨å¹¶å‘ç¯å¢ƒä¸­å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ï¼Œæˆ‘ä»¬å¹³å¸¸è¯´ä¸€ä¸ªç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œç»å¤§å¤šæ•°æ—¶å€™æŒ‡çš„æ˜¯è¿™ä¸€ç§æƒ…å†µã€‚Java API ä¸­å¤§éƒ¨åˆ†çš„ç±»éƒ½æ˜¯å±äºçº¿ç¨‹å…¼å®¹çš„ï¼Œå¦‚ä¸å‰é¢çš„ Vector å’Œ HashTable ç›¸å¯¹åº”çš„é›†åˆç±» ArrayList å’Œ HashMap ç­‰ã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-çº¿ç¨‹å¯¹ç«‹">5. çº¿ç¨‹å¯¹ç«‹<a href="#5-çº¿ç¨‹å¯¹ç«‹" class="hash-link" aria-label="Direct link to 5. çº¿ç¨‹å¯¹ç«‹" title="Direct link to 5. çº¿ç¨‹å¯¹ç«‹">â€‹</a></h5><p>çº¿ç¨‹å¯¹ç«‹æ˜¯æŒ‡æ— è®ºè°ƒç”¨ç«¯æ˜¯å¦é‡‡å–äº†åŒæ­¥æªæ–½ï¼Œéƒ½æ— æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¹¶å‘ä½¿ç”¨çš„ä»£ç ã€‚ç”±äº Java è¯­è¨€å¤©ç”Ÿå°±å…·å¤‡å¤šçº¿ç¨‹ç‰¹æ€§ï¼Œçº¿ç¨‹å¯¹ç«‹è¿™ç§æ’æ–¥å¤šçº¿ç¨‹çš„ä»£ç æ˜¯å¾ˆå°‘å‡ºç°çš„ï¼Œè€Œä¸”é€šå¸¸éƒ½æ˜¯æœ‰å®³çš„ï¼Œåº”å½“å°½é‡é¿å…ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•">çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•<a href="#çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•" class="hash-link" aria-label="Direct link to çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•" title="Direct link to çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•">â€‹</a></h4><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-é˜»å¡åŒæ­¥äº’æ–¥åŒæ­¥">1. é˜»å¡åŒæ­¥ï¼ˆäº’æ–¥åŒæ­¥ï¼‰<a href="#1-é˜»å¡åŒæ­¥äº’æ–¥åŒæ­¥" class="hash-link" aria-label="Direct link to 1. é˜»å¡åŒæ­¥ï¼ˆäº’æ–¥åŒæ­¥ï¼‰" title="Direct link to 1. é˜»å¡åŒæ­¥ï¼ˆäº’æ–¥åŒæ­¥ï¼‰">â€‹</a></h5><p>synchronized å’Œ ReentrantLockã€‚</p><p>äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯è¿›è¡Œçº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤è¿™ç§åŒæ­¥ä¹Ÿç§°ä¸ºé˜»å¡åŒæ­¥ã€‚</p><p>äº’æ–¥åŒæ­¥å±äºä¸€ç§<strong>æ‚²è§‚çš„å¹¶å‘ç­–ç•¥</strong>ï¼Œæ€»æ˜¯è®¤ä¸ºåªè¦ä¸å»åšæ­£ç¡®çš„åŒæ­¥æªæ–½ï¼Œé‚£å°±è‚¯å®šä¼šå‡ºç°é—®é¢˜ã€‚æ— è®ºå…±äº«æ•°æ®æ˜¯å¦çœŸçš„ä¼šå‡ºç°ç«äº‰ï¼Œå®ƒéƒ½è¦è¿›è¡ŒåŠ é”ï¼ˆè¿™é‡Œè®¨è®ºçš„æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œå®é™…ä¸Šè™šæ‹Ÿæœºä¼šä¼˜åŒ–æ‰å¾ˆå¤§ä¸€éƒ¨åˆ†ä¸å¿…è¦çš„åŠ é”ï¼‰ã€ç”¨æˆ·æ€æ ¸å¿ƒæ€è½¬æ¢ã€ç»´æŠ¤é”è®¡æ•°å™¨å’Œæ£€æŸ¥æ˜¯å¦æœ‰è¢«é˜»å¡çš„çº¿ç¨‹éœ€è¦å”¤é†’ç­‰æ“ä½œã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-éé˜»å¡åŒæ­¥">2. éé˜»å¡åŒæ­¥<a href="#2-éé˜»å¡åŒæ­¥" class="hash-link" aria-label="Direct link to 2. éé˜»å¡åŒæ­¥" title="Direct link to 2. éé˜»å¡åŒæ­¥">â€‹</a></h5><p>éšç€ç¡¬ä»¶æŒ‡ä»¤é›†çš„å‘å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäºå†²çªæ£€æµ‹çš„<strong>ä¹è§‚å¹¶å‘ç­–ç•¥</strong>ï¼šå…ˆè¿›è¡Œæ“ä½œï¼Œå¦‚æœæ²¡æœ‰å…¶å®ƒçº¿ç¨‹äº‰ç”¨å…±äº«æ•°æ®ï¼Œé‚£æ“ä½œå°±æˆåŠŸäº†ï¼Œå¦åˆ™é‡‡å–è¡¥å¿æªæ–½ï¼ˆä¸æ–­åœ°é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ï¼‰ã€‚è¿™ç§ä¹è§‚çš„å¹¶å‘ç­–ç•¥çš„è®¸å¤šå®ç°éƒ½ä¸éœ€è¦æŠŠçº¿ç¨‹æŒ‚èµ·ï¼Œå› æ­¤è¿™ç§åŒæ­¥æ“ä½œç§°ä¸ºéé˜»å¡åŒæ­¥ã€‚</p><p>ä¹è§‚é”éœ€è¦æ“ä½œå’Œå†²çªæ£€æµ‹è¿™ä¸¤ä¸ªæ­¥éª¤å…·å¤‡åŸå­æ€§ï¼Œè¿™é‡Œå°±ä¸èƒ½å†ä½¿ç”¨äº’æ–¥åŒæ­¥æ¥ä¿è¯äº†ï¼Œåªèƒ½é ç¡¬ä»¶æ¥å®Œæˆã€‚</p><p>ç¡¬ä»¶æ”¯æŒçš„åŸå­æ€§æ“ä½œæœ€å…¸å‹çš„æ˜¯ï¼š<strong>æ¯”è¾ƒå¹¶äº¤æ¢</strong>ï¼ˆCompare-and-Swapï¼ŒCASï¼‰ã€‚CAS æŒ‡ä»¤éœ€è¦æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯<strong>å†…å­˜åœ°å€ Vã€æ—§çš„é¢„æœŸå€¼ A å’Œæ–°å€¼ B</strong>ã€‚å½“æ‰§è¡Œæ“ä½œæ—¶ï¼Œåªæœ‰å½“ V çš„å€¼ç­‰äº Aï¼Œæ‰å°† V çš„å€¼æ›´æ–°ä¸º Bã€‚</p><p>J.U.C åŒ…é‡Œé¢çš„æ•´æ•°åŸå­ç±» AtomicIntegerï¼Œå…¶ä¸­çš„ compareAndSet() å’Œ getAndIncrement() ç­‰æ–¹æ³•éƒ½ä½¿ç”¨äº† Unsafe ç±»çš„ CAS æ“ä½œã€‚</p><p>ä»¥ä¸‹ä»£ç ä½¿ç”¨äº† AtomicInteger æ‰§è¡Œäº†è‡ªå¢çš„æ“ä½œã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicInteger</span><span class="token plain"> cnt </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicInteger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cnt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">incrementAndGet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä»¥ä¸‹ä»£ç æ˜¯ incrementAndGet() çš„æºç ï¼Œå®ƒè°ƒç”¨äº† unsafe çš„ getAndAddInt() ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">incrementAndGet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> unsafe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getAndAddInt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> valueOffset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä»¥ä¸‹ä»£ç æ˜¯ getAndAddInt() æºç ï¼Œvar1 æŒ‡ç¤ºå¯¹è±¡å†…å­˜åœ°å€ï¼Œvar2 æŒ‡ç¤ºè¯¥å­—æ®µç›¸å¯¹å¯¹è±¡å†…å­˜åœ°å€çš„åç§»ï¼Œvar4 æŒ‡ç¤ºæ“ä½œéœ€è¦åŠ çš„æ•°å€¼ï¼Œè¿™é‡Œä¸º 1ã€‚é€šè¿‡ getIntVolatile(var1, var2) å¾—åˆ°æ—§çš„é¢„æœŸå€¼ï¼Œé€šè¿‡è°ƒç”¨ compareAndSwapInt() æ¥è¿›è¡Œ CAS æ¯”è¾ƒï¼Œå¦‚æœè¯¥å­—æ®µå†…å­˜åœ°å€ä¸­çš„å€¼ ==var5ï¼Œé‚£ä¹ˆå°±æ›´æ–°å†…å­˜åœ°å€ä¸º var1+var2 çš„å˜é‡ä¸º var5+var4ã€‚</p><p>å¯ä»¥çœ‹åˆ° getAndAddInt() åœ¨ä¸€ä¸ªå¾ªç¯ä¸­è¿›è¡Œï¼Œå‘ç”Ÿå†²çªçš„åšæ³•æ˜¯ä¸æ–­çš„è¿›è¡Œé‡è¯•ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getAndAddInt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Object</span><span class="token plain"> var1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> var2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> var4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> var5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        var5 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getIntVolatile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">var1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> var2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">compareAndSwapInt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">var1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> var2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> var5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> var5 </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> var4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> var5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ABA ï¼šå¦‚æœä¸€ä¸ªå˜é‡åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå®ƒçš„å€¼è¢«æ”¹æˆäº† Bï¼Œåæ¥åˆè¢«æ”¹å›ä¸º Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«æ”¹å˜è¿‡ã€‚</p><p>J.U.C åŒ…æä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸå­å¼•ç”¨ç±» AtomicStampedReference æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„ç‰ˆæœ¬æ¥ä¿è¯ CAS çš„æ­£ç¡®æ€§ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ ABA é—®é¢˜ä¸ä¼šå½±å“ç¨‹åºå¹¶å‘çš„æ­£ç¡®æ€§ï¼Œå¦‚æœéœ€è¦è§£å†³ ABA é—®é¢˜ï¼Œæ”¹ç”¨ä¼ ç»Ÿçš„äº’æ–¥åŒæ­¥å¯èƒ½ä¼šæ¯”åŸå­ç±»æ›´é«˜æ•ˆã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-æ— åŒæ­¥æ–¹æ¡ˆ">3. æ— åŒæ­¥æ–¹æ¡ˆ<a href="#3-æ— åŒæ­¥æ–¹æ¡ˆ" class="hash-link" aria-label="Direct link to 3. æ— åŒæ­¥æ–¹æ¡ˆ" title="Direct link to 3. æ— åŒæ­¥æ–¹æ¡ˆ">â€‹</a></h5><p>è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸æ˜¯ä¸€å®šå°±è¦è¿›è¡ŒåŒæ­¥ï¼Œä¸¤è€…æ²¡æœ‰å› æœå…³ç³»ã€‚åŒæ­¥åªæ˜¯ä¿è¯å…±äº«æ•°æ®äº‰ç”¨æ—¶çš„æ­£ç¡®æ€§çš„æ‰‹æ®µï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æœ¬æ¥å°±ä¸æ¶‰åŠå…±äº«æ•°æ®ï¼Œé‚£å®ƒè‡ªç„¶å°±æ— é¡»ä»»ä½•åŒæ­¥æªæ–½å»ä¿è¯æ­£ç¡®æ€§ï¼Œå› æ­¤ä¼šæœ‰ä¸€äº›ä»£ç å¤©ç”Ÿå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ä¸€å¯é‡å…¥ä»£ç reentrant-code">ï¼ˆä¸€ï¼‰å¯é‡å…¥ä»£ç ï¼ˆReentrant Codeï¼‰<a href="#ä¸€å¯é‡å…¥ä»£ç reentrant-code" class="hash-link" aria-label="Direct link to ï¼ˆä¸€ï¼‰å¯é‡å…¥ä»£ç ï¼ˆReentrant Codeï¼‰" title="Direct link to ï¼ˆä¸€ï¼‰å¯é‡å…¥ä»£ç ï¼ˆReentrant Codeï¼‰">â€‹</a></h6><p>è¿™ç§ä»£ç ä¹Ÿå«åšçº¯ä»£ç ï¼ˆPure Codeï¼‰ï¼Œå¯ä»¥åœ¨ä»£ç æ‰§è¡Œçš„ä»»ä½•æ—¶åˆ»ä¸­æ–­å®ƒï¼Œè½¬è€Œå»æ‰§è¡Œå¦å¤–ä¸€æ®µä»£ç ï¼ˆåŒ…æ‹¬é€’å½’è°ƒç”¨å®ƒæœ¬èº«ï¼‰ï¼Œè€Œåœ¨æ§åˆ¶æƒè¿”å›åï¼ŒåŸæ¥çš„ç¨‹åºä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ã€‚</p><p>å¯é‡å…¥ä»£ç æœ‰ä¸€äº›å…±åŒçš„ç‰¹å¾ï¼Œä¾‹å¦‚ä¸ä¾èµ–å­˜å‚¨åœ¨å †ä¸Šçš„æ•°æ®å’Œå…¬ç”¨çš„ç³»ç»Ÿèµ„æºã€ç”¨åˆ°çš„çŠ¶æ€é‡éƒ½ç”±å‚æ•°ä¸­ä¼ å…¥ã€ä¸è°ƒç”¨éå¯é‡å…¥çš„æ–¹æ³•ç­‰ã€‚</p><h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="äºŒæ ˆå°é—­">ï¼ˆäºŒï¼‰æ ˆå°é—­<a href="#äºŒæ ˆå°é—­" class="hash-link" aria-label="Direct link to ï¼ˆäºŒï¼‰æ ˆå°é—­" title="Direct link to ï¼ˆäºŒï¼‰æ ˆå°é—­">â€‹</a></h6><p>å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªæ–¹æ³•çš„å±€éƒ¨å˜é‡æ—¶ï¼Œä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå±€éƒ¨å˜é‡å­˜å‚¨åœ¨æ ˆä¸­ï¼Œå±äºçº¿ç¨‹ç§æœ‰çš„ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token import namespace" style="color:rgb(178, 204, 214)">java</span><span class="token import namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import namespace" style="color:rgb(178, 204, 214)">util</span><span class="token import namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import namespace" style="color:rgb(178, 204, 214)">concurrent</span><span class="token import namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token import namespace" style="color:rgb(178, 204, 214)">java</span><span class="token import namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import namespace" style="color:rgb(178, 204, 214)">util</span><span class="token import namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import namespace" style="color:rgb(178, 204, 214)">concurrent</span><span class="token import namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token import class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">StackClosedExample</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">add100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> cnt </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            cnt</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cnt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">StackClosedExample</span><span class="token plain"> example </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">StackClosedExample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> executorService </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newCachedThreadPool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">add100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> example</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">add100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    executorService</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">shutdown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ä¸‰çº¿ç¨‹æœ¬åœ°å­˜å‚¨thread-local-storage">ï¼ˆä¸‰ï¼‰çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰<a href="#ä¸‰çº¿ç¨‹æœ¬åœ°å­˜å‚¨thread-local-storage" class="hash-link" aria-label="Direct link to ï¼ˆä¸‰ï¼‰çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰" title="Direct link to ï¼ˆä¸‰ï¼‰çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰">â€‹</a></h6><p>å¦‚æœä¸€æ®µä»£ç ä¸­æ‰€éœ€è¦çš„æ•°æ®å¿…é¡»ä¸å…¶ä»–ä»£ç å…±äº«ï¼Œé‚£å°±çœ‹çœ‹è¿™äº›å…±äº«æ•°æ®çš„ä»£ç æ˜¯å¦èƒ½ä¿è¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚å¦‚æœèƒ½ä¿è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå…±äº«æ•°æ®çš„å¯è§èŒƒå›´é™åˆ¶åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œè¿™æ ·ï¼Œæ— é¡»åŒæ­¥ä¹Ÿèƒ½ä¿è¯çº¿ç¨‹ä¹‹é—´ä¸å‡ºç°æ•°æ®äº‰ç”¨çš„é—®é¢˜ã€‚</p><p>ç¬¦åˆè¿™ç§ç‰¹ç‚¹çš„åº”ç”¨å¹¶ä¸å°‘è§ï¼Œå¤§éƒ¨åˆ†ä½¿ç”¨æ¶ˆè´¹é˜Ÿåˆ—çš„æ¶æ„æ¨¡å¼ï¼ˆå¦‚â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å¼ï¼‰éƒ½ä¼šå°†äº§å“çš„æ¶ˆè´¹è¿‡ç¨‹å°½é‡åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ¶ˆè´¹å®Œï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªåº”ç”¨å®ä¾‹å°±æ˜¯ç»å…¸ Web äº¤äº’æ¨¡å‹ä¸­çš„ â€œ<strong>ä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªæœåŠ¡å™¨çº¿ç¨‹</strong>â€ï¼ˆThread-per-Requestï¼‰çš„å¤„ç†æ–¹å¼ï¼Œè¿™ç§å¤„ç†æ–¹å¼çš„å¹¿æ³›åº”ç”¨ä½¿å¾—å¾ˆå¤š Web æœåŠ¡ç«¯åº”ç”¨éƒ½å¯ä»¥ä½¿ç”¨çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>å¯ä»¥ä½¿ç”¨ java.lang.ThreadLocal ç±»æ¥å®ç°çº¿ç¨‹æœ¬åœ°å­˜å‚¨åŠŸèƒ½ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¾‹é¢˜ï¼Œè¯·å‚è€ƒæ•´ç†ï¼š</p><p><a href="https://www.nowcoder.com/questionTerminal/b82e4a85a66e4dc488a5ab49094976e9?orderByHotValue=0&amp;pos=73&amp;mutiTagIds=171" target="_blank" rel="noopener noreferrer">å…³äºThreadLocalç±»ä»¥ä¸‹è¯´æ³•æ­£ç¡®çš„æ˜¯?<em>è¿…é›·ç¬”è¯•é¢˜</em>ç‰›å®¢ç½‘</a></p><p><strong>ç¤ºä¾‹ç”¨æ³•</strong></p><p>å…ˆé€šè¿‡ä¸‹é¢è¿™ä¸ªå®ä¾‹æ¥ç†è§£ ThreadLocal çš„ç”¨æ³•ã€‚å…ˆå£°æ˜ä¸€ä¸ª ThreadLocal å¯¹è±¡ï¼Œå­˜å‚¨å¸ƒå°”ç±»å‹çš„æ•°å€¼ã€‚ç„¶ååˆ†åˆ«åœ¨mainçº¿ç¨‹ã€Thread1ã€Thread2ä¸­ä¸º ThreadLocal å¯¹è±¡è®¾ç½®ä¸åŒçš„æ•°å€¼ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocalDemo</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å£°æ˜ ThreadLocalå¯¹è±¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocal</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Boolean</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> mThreadLocal </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocal</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Boolean</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// åœ¨ä¸»çº¿ç¨‹ã€å­çº¿ç¨‹1ã€å­çº¿ç¨‹2ä¸­å»è®¾ç½®è®¿é—®å®ƒçš„å€¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        mThreadLocal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Main &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> mThreadLocal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Thread#1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                mThreadLocal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Thread#1 &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> mThreadLocal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Thread#2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token class-name" style="color:rgb(255, 203, 107)">System</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Thread#2 &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> mThreadLocal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ‰“å°çš„ç»“æœè¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">MainThread true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Thread#1 false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Thread#2 null</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¯ä»¥çœ‹è§ï¼Œåœ¨ä¸åŒçº¿ç¨‹å¯¹åŒä¸€ä¸ª ThreadLocalå¯¹è±¡è®¾ç½®æ•°å€¼ï¼Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å–å‡ºæ¥çš„å€¼ä¸ä¸€æ ·ã€‚æ¥ä¸‹æ¥å°±åˆ†æä¸€ä¸‹æºç ï¼Œçœ‹çœ‹å…¶å†…éƒ¨ç»“æ„ã€‚</p><p><strong>ç»“æ„æ¦‚è§ˆ</strong></p><div align="center"><img loading="lazy" src="assets/006dXScfgy1fj7s01fjqpj30ng0jbabn.jpg" width="500" class="img_ev3q"></div><br><p>æ¸…æ™°çš„çœ‹åˆ°ä¸€ä¸ªçº¿ç¨‹ Thread ä¸­å­˜åœ¨ä¸€ä¸ª ThreadLocalMapï¼ŒThreadLocalMap ä¸­çš„ key å¯¹åº” ThreadLocalï¼Œåœ¨æ­¤å¤„å¯è§ Map å¯ä»¥å­˜å‚¨å¤šä¸ª key å³ (ThreadLocal)ã€‚å¦å¤– Value å°±å¯¹åº”ç€åœ¨ ThreadLocal ä¸­å­˜å‚¨çš„ Valueã€‚</p><p>å› æ­¤æ€»ç»“å‡ºï¼šæ¯ä¸ª Thread ä¸­éƒ½å…·å¤‡ä¸€ä¸ª ThreadLocalMapï¼Œè€Œ ThreadLocalMap å¯ä»¥å­˜å‚¨ä»¥ ThreadLocal ä¸ºkeyçš„é”®å€¼å¯¹ã€‚è¿™é‡Œè§£é‡Šäº†ä¸ºä»€ä¹ˆæ¯ä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ª ThreadLocalï¼Œå¾—åˆ°çš„ç¡®æ˜¯ä¸åŒçš„æ•°å€¼ã€‚å¦‚æœæ­¤å¤„ä½ è§‰å¾—æœ‰ç‚¹çªå…€ï¼Œæ¥ä¸‹æ¥çœ‹æºç åˆ†æï¼</p><p><strong>æºç åˆ†æ</strong></p><p><strong>1. ThreadLocal#set</strong></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">T</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">currentThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ ¹æ®å½“å‰çº¿ç¨‹çš„å¯¹è±¡è·å–å…¶å†…éƒ¨Map</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocalMap</span><span class="token plain"> map </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getMap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ³¨é‡Š1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">map </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">createMap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œå¤§éƒ¨åˆ†è§£é‡Šå·²ç»åœ¨ä»£ç ä¸­åšå‡ºï¼Œæ³¨æ„<code>æ³¨é‡Š1</code>å¤„ï¼Œå¾—åˆ° map å¯¹è±¡ä¹‹åï¼Œç”¨çš„ <code>this</code> ä½œä¸º  keyï¼Œthis åœ¨è¿™é‡Œä»£è¡¨çš„æ˜¯å½“å‰çº¿ç¨‹çš„ ThreadLocal å¯¹è±¡ã€‚ å¦å¤–å°±æ˜¯ç¬¬äºŒå¥æ ¹æ® getMap è·å–ä¸€ä¸ª ThreadLocalMapï¼Œå…¶ä¸­getMap ä¸­ä¼ å…¥äº†å‚æ•° t (å½“å‰çº¿ç¨‹å¯¹è±¡)ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè·å–æ¯ä¸ªçº¿ç¨‹çš„ <code>ThreadLocal</code> äº†ã€‚ </p><p>ç»§ç»­è·Ÿè¿›åˆ° ThreadLocalMap ä¸­æŸ¥çœ‹ set æ–¹æ³•ï¼š</p><p><strong>2. ThreadLocalMap</strong></p><p>ThreadLocalMap æ˜¯ ThreadLocal çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œåœ¨åˆ†æå…¶ set æ–¹æ³•ä¹‹å‰ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å…¶ç±»ç»“æ„å’Œæˆå‘˜å˜é‡ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocalMap</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Entryç±»ç»§æ‰¿äº†WeakReference&lt;ThreadLocal&lt;?&gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å³æ¯ä¸ªEntryå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªThreadLocalçš„å¼±å¼•ç”¨ï¼ˆä½œä¸ºkeyï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜æ³„éœ²ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ä¸€æ—¦çº¿ç¨‹ç»“æŸï¼Œkeyå˜ä¸ºä¸€ä¸ªä¸å¯è¾¾çš„å¯¹è±¡ï¼Œè¿™ä¸ªEntryå°±å¯ä»¥è¢«GCäº†ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Entry</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">WeakReference</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">ThreadLocal</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics operator" style="color:rgb(137, 221, 255)">?</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/** The value associated with this ThreadLocal. */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token class-name" style="color:rgb(255, 203, 107)">Object</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token class-name" style="color:rgb(255, 203, 107)">Entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocal</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics operator" style="color:rgb(137, 221, 255)">?</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Object</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             </span><span class="token keyword" style="font-style:italic">super</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">k</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             value </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ThreadLocalMap çš„åˆå§‹å®¹é‡ï¼Œå¿…é¡»ä¸º2çš„å€æ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">INITIAL_CAPACITY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// resizedæ—¶å€™éœ€è¦çš„table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// tableä¸­çš„entryä¸ªæ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> size </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ‰©å®¹æ•°å€¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> threshold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Default to 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸€èµ·çœ‹ä¸€ä¸‹å…¶å¸¸ç”¨çš„æ„é€ å‡½æ•°ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocalMap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocal</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics operator" style="color:rgb(137, 221, 255)">?</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> firstKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Object</span><span class="token plain"> firstValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    table </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">INITIAL_CAPACITY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> firstKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">threadLocalHashCode </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">INITIAL_CAPACITY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">firstKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> firstValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    size </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">setThreshold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">INITIAL_CAPACITY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æœ¬ ThreadLocal å®ä¾‹ (this)ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯è¦ä¿å­˜çš„çº¿ç¨‹æœ¬åœ°å˜é‡ã€‚æ„é€ å‡½æ•°é¦–å…ˆåˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º16çš„ Entry æ•°ç»„ï¼Œç„¶åè®¡ç®—å‡º firstKey å¯¹åº”çš„å“ˆå¸Œå€¼ï¼Œç„¶åå­˜å‚¨åˆ° table ä¸­ï¼Œå¹¶è®¾ç½® size å’Œ thresholdã€‚</p><p>æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œè®¡ç®— hash çš„æ—¶å€™é‡Œé¢é‡‡ç”¨äº† hashCode &amp; (size - 1) çš„ç®—æ³•ï¼Œè¿™ç›¸å½“äºå–æ¨¡è¿ç®— hashCode % size çš„ä¸€ä¸ªæ›´é«˜æ•ˆçš„å®ç°ï¼ˆå’ŒHashMapä¸­çš„æ€è·¯ç›¸åŒï¼‰ã€‚æ­£æ˜¯å› ä¸ºè¿™ç§ç®—æ³•ï¼Œæˆ‘ä»¬è¦æ±‚ sizeå¿…é¡»æ˜¯ 2 çš„æŒ‡æ•°ï¼Œå› ä¸ºè¿™å¯ä»¥ä½¿å¾— hash å‘ç”Ÿå†²çªçš„æ¬¡æ•°å‡å°ã€‚</p><p><strong>3. ThreadLocalMap#set</strong></p><p>ThreadLocal ä¸­ put å‡½æ•°æœ€ç»ˆè°ƒç”¨äº† ThreadLocalMap ä¸­çš„ set å‡½æ•°ï¼Œè·Ÿè¿›å»çœ‹ä¸€çœ‹ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocal</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics operator" style="color:rgb(137, 221, 255)">?</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Object</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> tab </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> len </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> tab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">threadLocalHashCode </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">len</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Entry</span><span class="token plain"> e </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> tab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         e </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å†²çªäº†</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         e </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> tab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">nextIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocal</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics operator" style="color:rgb(137, 221, 255)">?</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> k </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">k </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">value </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">k </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">replaceStaleEntry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> sz </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token function" style="color:rgb(130, 170, 255)">cleanSomeSlots</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> sz </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> threshold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">rehash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­å¦‚æœ Entry åœ¨å­˜æ”¾è¿‡ç¨‹ä¸­å†²çªäº†ï¼Œè°ƒç”¨ nextIndex æ¥å¤„ç†ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ˜¯å¦è¿˜è®°å¾— hashmap ä¸­å¯¹å¾…å†²çªçš„å¤„ç†ï¼Ÿè¿™é‡Œå¥½åƒæ˜¯å¦ä¸€ç§å¥—è·¯ï¼šåªè¦ i çš„æ•°å€¼å°äº lenï¼Œå°±åŠ 1å–å€¼ï¼Œå®˜æ–¹æœ¯è¯­ç§°ä¸ºï¼šçº¿æ€§æ¢æµ‹æ³•ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">nextIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä»¥ä¸Šæ­¥éª¤okäº†ä¹‹åï¼Œå†æ¬¡å…³æ³¨ä¸€ä¸‹æºç ä¸­çš„ cleanSomeSlotsï¼Œè¯¥å‡½æ•°ä¸»è¦çš„ä½œç”¨å°±æ˜¯æ¸…ç†æ— ç”¨çš„ entryï¼Œé¿å…å‡ºç°å†…å­˜æ³„éœ²ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cleanSomeSlots</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> removed </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> tab </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> len </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> tab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">nextIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Entry</span><span class="token plain"> e </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> tab</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            n </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            removed </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">expungeStaleEntry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">n </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> removed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>4. ThreadLocal#get</strong></p><p>çœ‹å®Œäº† set å‡½æ•°ï¼Œè‚¯å®šæ˜¯è¦å…³æ³¨ get çš„ï¼Œæºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">T</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// è·å–Threadå¯¹è±¡t</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">currentThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// è·å–tä¸­çš„map</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocalMap</span><span class="token plain"> map </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getMap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">map </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocalMap</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Entry</span><span class="token plain"> e </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getEntry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@SuppressWarnings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;unchecked&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">T</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å¦‚æœtä¸­çš„mapä¸ºç©º</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setInitialValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦‚æœ map ä¸º nullï¼Œå°±è¿”å› setInitialValue() è¿™ä¸ªæ–¹æ³•ï¼Œè·Ÿè¿›è¿™ä¸ªæ–¹æ³•çœ‹ä¸€ä¸‹ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">T</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setInitialValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token class-name" style="color:rgb(255, 203, 107)">T</span><span class="token plain"> value </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">initialValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">currentThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadLocalMap</span><span class="token plain"> map </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getMap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">map </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token function" style="color:rgb(130, 170, 255)">createMap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æœ€åè¿”å›çš„æ˜¯ valueï¼Œè€Œ value æ¥è‡ª <code>initialValue() </code>ï¼Œè¿›å…¥è¿™ä¸ªæºç ä¸­æŸ¥çœ‹ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">protected</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">T</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">initialValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åŸæ¥å¦‚æ­¤ï¼Œå¦‚æœä¸è®¾ç½® ThreadLocal çš„æ•°å€¼ï¼Œé»˜è®¤å°±æ˜¯ nullï¼Œæ¥è‡ªäºæ­¤ã€‚</p><p>ThreadLocal ä»ç†è®ºä¸Šè®²å¹¶ä¸æ˜¯ç”¨æ¥è§£å†³å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜çš„ï¼Œå› ä¸ºæ ¹æœ¬ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ã€‚åœ¨ä¸€äº›åœºæ™¯ (å°¤å…¶æ˜¯ä½¿ç”¨çº¿ç¨‹æ± ) ä¸‹ï¼Œç”±äº ThreadLocal.ThreadLocalMap çš„åº•å±‚æ•°æ®ç»“æ„å¯¼è‡´ ThreadLocal æœ‰å†…å­˜æ³„æ¼çš„æƒ…å†µï¼Œå°½å¯èƒ½åœ¨æ¯æ¬¡ä½¿ç”¨ ThreadLocal åæ‰‹åŠ¨è°ƒç”¨ remove()ï¼Œä»¥é¿å…å‡ºç° ThreadLocal ç»å…¸çš„å†…å­˜æ³„æ¼ç”šè‡³æ˜¯é€ æˆè‡ªèº«ä¸šåŠ¡æ··ä¹±çš„é£é™©ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="https://allenwu.itscoder.com/threadlocal-source" target="_blank" rel="noopener noreferrer">æ·±å…¥ç†è§£ Java ä¹‹ ThreadLocal å·¥ä½œåŸç†</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12-é”ä¼˜åŒ–">12. é”ä¼˜åŒ–<a href="#12-é”ä¼˜åŒ–" class="hash-link" aria-label="Direct link to 12. é”ä¼˜åŒ–" title="Direct link to 12. é”ä¼˜åŒ–">â€‹</a></h3><p>è¿™é‡Œçš„é”ä¼˜åŒ–ä¸»è¦æ˜¯æŒ‡è™šæ‹Ÿæœºå¯¹ synchronized çš„ä¼˜åŒ–ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="è‡ªæ—‹é”">è‡ªæ—‹é”<a href="#è‡ªæ—‹é”" class="hash-link" aria-label="Direct link to è‡ªæ—‹é”" title="Direct link to è‡ªæ—‹é”">â€‹</a></h4><p>äº’æ–¥åŒæ­¥çš„è¿›å…¥é˜»å¡çŠ¶æ€çš„å¼€é”€éƒ½å¾ˆå¤§ï¼Œåº”è¯¥å°½é‡é¿å…ã€‚åœ¨è®¸å¤šåº”ç”¨ä¸­ï¼Œå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€åªä¼šæŒç»­å¾ˆçŸ­çš„ä¸€æ®µæ—¶é—´ã€‚è‡ªæ—‹é”çš„æ€æƒ³æ˜¯è®©ä¸€ä¸ªçº¿ç¨‹åœ¨è¯·æ±‚ä¸€ä¸ªå…±äº«æ•°æ®çš„é”æ—¶æ‰§è¡Œå¿™å¾ªç¯ï¼ˆè‡ªæ—‹ï¼‰ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…èƒ½è·å¾—é”ï¼Œå°±å¯ä»¥é¿å…è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><p>è‡ªæ—‹é”è™½ç„¶èƒ½é¿å…è¿›å…¥é˜»å¡çŠ¶æ€ä»è€Œå‡å°‘å¼€é”€ï¼Œä½†æ˜¯å®ƒéœ€è¦è¿›è¡Œå¿™å¾ªç¯æ“ä½œå ç”¨ CPU æ—¶é—´ï¼Œå®ƒåªé€‚ç”¨äºå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€å¾ˆçŸ­çš„åœºæ™¯ã€‚</p><p>åœ¨ JDK 1.6 ä¸­å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ã€‚è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ¬¡æ•°ä¸å†å›ºå®šäº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ¬¡æ•°åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="é”æ¶ˆé™¤">é”æ¶ˆé™¤<a href="#é”æ¶ˆé™¤" class="hash-link" aria-label="Direct link to é”æ¶ˆé™¤" title="Direct link to é”æ¶ˆé™¤">â€‹</a></h4><p>é”æ¶ˆé™¤æ˜¯æŒ‡å¯¹äºè¢«æ£€æµ‹å‡ºä¸å¯èƒ½å­˜åœ¨ç«äº‰çš„å…±äº«æ•°æ®çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚</p><p>é”æ¶ˆé™¤ä¸»è¦æ˜¯é€šè¿‡<strong>é€ƒé€¸åˆ†æ</strong>æ¥æ”¯æŒï¼Œå¦‚æœå †ä¸Šçš„å…±äº«æ•°æ®ä¸å¯èƒ½é€ƒé€¸å‡ºå»è¢«å…¶å®ƒçº¿ç¨‹è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠå®ƒä»¬å½“æˆç§æœ‰æ•°æ®å¯¹å¾…ï¼Œä¹Ÿå°±å¯ä»¥å°†å®ƒä»¬çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚</p><p>å¯¹äºä¸€äº›çœ‹èµ·æ¥æ²¡æœ‰åŠ é”çš„ä»£ç ï¼Œå…¶å®éšå¼çš„åŠ äº†å¾ˆå¤šé”ã€‚ä¾‹å¦‚ä¸‹é¢çš„å­—ç¬¦ä¸²æ‹¼æ¥ä»£ç å°±éšå¼åŠ äº†é”ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">concatString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> s1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> s2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> s1 </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> s2 </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>String æ˜¯ä¸€ä¸ªä¸å¯å˜çš„ç±»ï¼Œç¼–è¯‘å™¨ä¼šå¯¹ String çš„æ‹¼æ¥è‡ªåŠ¨ä¼˜åŒ–ã€‚åœ¨ JDK 1.5 ä¹‹å‰ï¼Œä¼šè½¬åŒ–ä¸º StringBuffer å¯¹è±¡çš„è¿ç»­ append() æ“ä½œï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">concatString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> s1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> s2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">String</span><span class="token plain"> s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">StringBuffer</span><span class="token plain"> sb </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">StringBuffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> sb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">toString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¯ä¸ª append() æ–¹æ³•ä¸­éƒ½æœ‰ä¸€ä¸ªåŒæ­¥å—ã€‚è™šæ‹Ÿæœºè§‚å¯Ÿå˜é‡ sbï¼Œå¾ˆå¿«å°±ä¼šå‘ç°å®ƒçš„åŠ¨æ€ä½œç”¨åŸŸè¢«é™åˆ¶åœ¨ concatString() æ–¹æ³•å†…éƒ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œsb çš„æ‰€æœ‰å¼•ç”¨æ°¸è¿œä¸ä¼šâ€œé€ƒé€¸â€åˆ° concatString() æ–¹æ³•ä¹‹å¤–ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®åˆ°å®ƒï¼Œå› æ­¤å¯ä»¥è¿›è¡Œæ¶ˆé™¤ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="é”ç²—åŒ–">é”ç²—åŒ–<a href="#é”ç²—åŒ–" class="hash-link" aria-label="Direct link to é”ç²—åŒ–" title="Direct link to é”ç²—åŒ–">â€‹</a></h4><p>å¦‚æœä¸€ç³»åˆ—çš„è¿ç»­æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åå¤åŠ é”å’Œè§£é”ï¼Œé¢‘ç¹çš„åŠ é”æ“ä½œå°±ä¼šå¯¼è‡´æ€§èƒ½æŸè€—ã€‚</p><p>ä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä»£ç ä¸­è¿ç»­çš„ append() æ–¹æ³•å°±å±äºè¿™ç±»æƒ…å†µã€‚å¦‚æœè™šæ‹Ÿæœºæ¢æµ‹åˆ°ç”±è¿™æ ·çš„ä¸€ä¸²é›¶ç¢çš„æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œå°†ä¼šæŠŠåŠ é”çš„èŒƒå›´æ‰©å±•ï¼ˆç²—åŒ–ï¼‰åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ã€‚å¯¹äºä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä»£ç å°±æ˜¯æ‰©å±•åˆ°ç¬¬ä¸€ä¸ª append() æ“ä½œä¹‹å‰ç›´è‡³æœ€åä¸€ä¸ª append() æ“ä½œä¹‹åï¼Œè¿™æ ·åªéœ€è¦åŠ é”ä¸€æ¬¡å°±å¯ä»¥äº†ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="è½»é‡çº§é”">è½»é‡çº§é”<a href="#è½»é‡çº§é”" class="hash-link" aria-label="Direct link to è½»é‡çº§é”" title="Direct link to è½»é‡çº§é”">â€‹</a></h4><p>JDK 1.6 å¼•å…¥äº†åå‘é”å’Œè½»é‡çº§é”ï¼Œä»è€Œè®©é”æ‹¥æœ‰äº†å››ä¸ªçŠ¶æ€ï¼šæ— é”çŠ¶æ€ï¼ˆunlockedï¼‰ã€åå‘é”çŠ¶æ€ï¼ˆbiasbleï¼‰ã€è½»é‡çº§é”çŠ¶æ€ï¼ˆlightweight lockedï¼‰å’Œé‡é‡çº§é”çŠ¶æ€ï¼ˆinflatedï¼‰ã€‚</p><p>ä»¥ä¸‹æ˜¯ HotSpot è™šæ‹Ÿæœºå¯¹è±¡å¤´çš„å†…å­˜å¸ƒå±€ï¼Œè¿™äº›æ•°æ®è¢«ç§°ä¸º mark wordã€‚å…¶ä¸­ tag bits å¯¹åº”äº†äº”ä¸ªçŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€åœ¨å³ä¾§çš„ state è¡¨æ ¼ä¸­ç»™å‡ºï¼Œåº”è¯¥æ³¨æ„çš„æ˜¯ state è¡¨æ ¼ä¸æ˜¯å­˜å‚¨åœ¨å¯¹è±¡å¤´ä¸­çš„ã€‚é™¤äº† marked for gc çŠ¶æ€ï¼Œå…¶å®ƒå››ä¸ªçŠ¶æ€å·²ç»åœ¨å‰é¢ä»‹ç»è¿‡äº†ã€‚</p><div align="center"><img loading="lazy" src="assets/bb6a49be-00f2-4f27-a0ce-4ed764bc605c-1534158631668.png" width="600" class="img_ev3q"></div><br><p>ä¸‹å›¾å·¦ä¾§æ˜¯ä¸€ä¸ªçº¿ç¨‹çš„è™šæ‹Ÿæœºæ ˆï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†ç§°ä¸º Lock Record çš„åŒºåŸŸï¼Œè¿™æ˜¯åœ¨è½»é‡çº§é”è¿è¡Œè¿‡ç¨‹åˆ›å»ºçš„ï¼Œç”¨äºå­˜æ”¾é”å¯¹è±¡çš„ Mark Wordã€‚è€Œå³ä¾§å°±æ˜¯ä¸€ä¸ªé”å¯¹è±¡ï¼ŒåŒ…å«äº† Mark Word å’Œå…¶å®ƒä¿¡æ¯ã€‚</p><div align="center"><img loading="lazy" src="assets/051e436c-0e46-4c59-8f67-52d89d656182-1534158643175.png" width="500" class="img_ev3q"></div><p>è½»é‡çº§é”æ˜¯ç›¸å¯¹äºä¼ ç»Ÿçš„é‡é‡çº§é”è€Œè¨€ï¼Œå®ƒä½¿ç”¨ CAS æ“ä½œæ¥é¿å…é‡é‡çº§é”ä½¿ç”¨äº’æ–¥é‡çš„å¼€é”€ã€‚å¯¹äºç»å¤§éƒ¨åˆ†çš„é”ï¼Œåœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸå†…éƒ½æ˜¯ä¸å­˜åœ¨ç«äº‰çš„ï¼Œå› æ­¤ä¹Ÿå°±ä¸éœ€è¦éƒ½ä½¿ç”¨äº’æ–¥é‡è¿›è¡ŒåŒæ­¥ï¼Œå¯ä»¥å…ˆé‡‡ç”¨ CAS æ“ä½œè¿›è¡ŒåŒæ­¥ï¼Œå¦‚æœ CAS å¤±è´¥äº†å†æ”¹ç”¨äº’æ–¥é‡è¿›è¡ŒåŒæ­¥ã€‚</p><p>å½“å°è¯•è·å–ä¸€ä¸ªé”å¯¹è±¡æ—¶ï¼Œå¦‚æœé”å¯¹è±¡æ ‡è®°ä¸º 0 01ï¼Œè¯´æ˜é”å¯¹è±¡çš„é”æœªé”å®šï¼ˆunlockedï¼‰çŠ¶æ€ã€‚æ­¤æ—¶è™šæ‹Ÿæœºåœ¨å½“å‰çº¿ç¨‹æ ˆä¸­åˆ›å»º Lock Recordï¼Œç„¶åä½¿ç”¨ CAS æ“ä½œå°†å¯¹è±¡çš„ Mark Word æ›´æ–°ä¸º Lock Record æŒ‡é’ˆã€‚å¦‚æœ CAS æ“ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è·å–äº†è¯¥å¯¹è±¡ä¸Šçš„é”ï¼Œå¹¶ä¸”å¯¹è±¡çš„ Mark Word çš„é”æ ‡è®°å˜ä¸º 00ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡å¤„äºè½»é‡çº§é”çŠ¶æ€ã€‚</p><div align="center"><img loading="lazy" src="assets/baaa681f-7c52-4198-a5ae-303b9386cf47-1534158703049.png" width="500" class="img_ev3q"></div><p>å¦‚æœ CAS æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„ Mark Word æ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„è™šæ‹Ÿæœºæ ˆï¼Œå¦‚æœæ˜¯çš„è¯è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªé”å¯¹è±¡ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜è¿™ä¸ªé”å¯¹è±¡å·²ç»è¢«å…¶ä»–çº¿ç¨‹çº¿ç¨‹æŠ¢å äº†ã€‚å¦‚æœæœ‰ä¸¤æ¡ä»¥ä¸Šçš„çº¿ç¨‹äº‰ç”¨åŒä¸€ä¸ªé”ï¼Œé‚£è½»é‡çº§é”å°±ä¸å†æœ‰æ•ˆï¼Œè¦è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="åå‘é”">åå‘é”<a href="#åå‘é”" class="hash-link" aria-label="Direct link to åå‘é”" title="Direct link to åå‘é”">â€‹</a></h4><p>åå‘é”çš„æ€æƒ³æ˜¯åå‘äºè®©ç¬¬ä¸€ä¸ªè·å–é”å¯¹è±¡çš„çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹åœ¨ä¹‹åè·å–è¯¥é”å°±ä¸å†éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œç”šè‡³è¿ CAS æ“ä½œä¹Ÿä¸å†éœ€è¦ã€‚</p><p>å½“é”å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«çº¿ç¨‹è·å¾—çš„æ—¶å€™ï¼Œè¿›å…¥åå‘çŠ¶æ€ï¼Œæ ‡è®°ä¸º 1 01ã€‚åŒæ—¶ä½¿ç”¨ CAS æ“ä½œå°†çº¿ç¨‹ ID è®°å½•åˆ° Mark Word ä¸­ï¼Œå¦‚æœ CAS æ“ä½œæˆåŠŸï¼Œè¿™ä¸ªçº¿ç¨‹ä»¥åæ¯æ¬¡è¿›å…¥è¿™ä¸ªé”ç›¸å…³çš„åŒæ­¥å—å°±ä¸éœ€è¦å†è¿›è¡Œä»»ä½•åŒæ­¥æ“ä½œã€‚</p><p>å½“æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»å°è¯•è·å–è¿™ä¸ªé”å¯¹è±¡æ—¶ï¼Œåå‘çŠ¶æ€å°±å®£å‘Šç»“æŸï¼Œæ­¤æ—¶æ’¤é”€åå‘ï¼ˆRevoke Biasï¼‰åæ¢å¤åˆ°æœªé”å®šçŠ¶æ€æˆ–è€…è½»é‡çº§é”çŠ¶æ€ã€‚</p><div align="center"><img loading="lazy" src="assets/390c913b-5f31-444f-bbdb-2b88b688e7ce-1534158712253.jpg" width="600" class="img_ev3q"></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13-å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½çš„å®è·µ">13. å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½çš„å®è·µ<a href="#13-å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½çš„å®è·µ" class="hash-link" aria-label="Direct link to 13. å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½çš„å®è·µ" title="Direct link to 13. å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½çš„å®è·µ">â€‹</a></h3><ul><li>ç»™çº¿ç¨‹èµ·ä¸ªæœ‰æ„ä¹‰çš„åå­—ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿æ‰¾ Bugã€‚</li><li>ç¼©å°åŒæ­¥èŒƒå›´ï¼Œä¾‹å¦‚å¯¹äº synchronizedï¼Œåº”è¯¥å°½é‡ä½¿ç”¨åŒæ­¥å—è€Œä¸æ˜¯åŒæ­¥æ–¹æ³•ã€‚</li><li>å¤šç”¨åŒæ­¥ç±»å°‘ç”¨ wait() å’Œ notify()ã€‚é¦–å…ˆï¼ŒCountDownLatch, CyclicBarrier, Semaphore å’Œ Exchanger è¿™äº›åŒæ­¥ç±»ç®€åŒ–äº†ç¼–ç æ“ä½œï¼Œè€Œç”¨ wait() å’Œ notify() å¾ˆéš¾å®ç°å¯¹å¤æ‚çš„æ§åˆ¶æµï¼›å…¶æ¬¡ï¼Œè¿™äº›åŒæ­¥ç±»æ˜¯ç”±æœ€å¥½çš„ä¼ä¸šç¼–å†™å’Œç»´æŠ¤ï¼Œåœ¨åç»­çš„ JDK ä¸­è¿˜ä¼šä¸æ–­ä¼˜åŒ–å’Œå®Œå–„ï¼Œä½¿ç”¨è¿™äº›æ›´é«˜ç­‰çº§çš„åŒæ­¥å·¥å…·ä½ çš„ç¨‹åºå¯ä»¥ä¸è´¹å¹ç°ä¹‹åŠ›è·å¾—ä¼˜åŒ–ã€‚</li><li>å¤šç”¨å¹¶å‘é›†åˆå°‘ç”¨åŒæ­¥é›†åˆï¼Œä¾‹å¦‚åº”è¯¥ä½¿ç”¨ ConcurrentHashMap è€Œä¸æ˜¯ Hashtableã€‚</li><li>ä½¿ç”¨æœ¬åœ°å˜é‡å’Œä¸å¯å˜ç±»æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li><li>ä½¿ç”¨çº¿ç¨‹æ± è€Œä¸æ˜¯ç›´æ¥åˆ›å»º Thread å¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸ºåˆ›å»ºçº¿ç¨‹ä»£ä»·å¾ˆé«˜ï¼Œçº¿ç¨‹æ± å¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨æœ‰é™çš„çº¿ç¨‹æ¥å¯åŠ¨ä»»åŠ¡ã€‚</li><li>ä½¿ç”¨ BlockingQueue å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ã€‚</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="14-çº¿ç¨‹æ± å®ç°åŸç†">14. çº¿ç¨‹æ± å®ç°åŸç†<a href="#14-çº¿ç¨‹æ± å®ç°åŸç†" class="hash-link" aria-label="Direct link to 14. çº¿ç¨‹æ± å®ç°åŸç†" title="Direct link to 14. çº¿ç¨‹æ± å®ç°åŸç†">â€‹</a></h3><blockquote><p>è˜‘è‡è¡—é¢è¯•ï¼Œè®¾è®¡ä¸€ä¸ªçº¿ç¨‹æ± </p></blockquote><p><img loading="lazy" alt="ThrealpoolExecutor_framework" src="/assets/images/ThrealpoolExecutor_framework-e9742548c21bc45f82eef708b8cff961.jpg" width="1304" height="480" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å¹¶å‘é˜Ÿåˆ—">å¹¶å‘é˜Ÿåˆ—<a href="#å¹¶å‘é˜Ÿåˆ—" class="hash-link" aria-label="Direct link to å¹¶å‘é˜Ÿåˆ—" title="Direct link to å¹¶å‘é˜Ÿåˆ—">â€‹</a></h4><p><strong>å…¥é˜Ÿ</strong></p><p>éé˜»å¡é˜Ÿåˆ—ï¼šå½“é˜Ÿåˆ—ä¸­æ»¡äº†æ—¶å€™ï¼Œæ”¾å…¥æ•°æ®ï¼Œæ•°æ®ä¸¢å¤±</p><p>é˜»å¡é˜Ÿåˆ—ï¼šå½“é˜Ÿåˆ—æ»¡äº†çš„æ—¶å€™ï¼Œè¿›è¡Œç­‰å¾…ï¼Œä»€ä¹ˆæ—¶å€™é˜Ÿåˆ—ä¸­æœ‰å‡ºé˜Ÿçš„æ•°æ®ï¼Œé‚£ä¹ˆç¬¬11ä¸ªå†æ”¾è¿›å»</p><p><strong>å‡ºé˜Ÿ</strong></p><p>éé˜»å¡é˜Ÿåˆ—ï¼šå¦‚æœç°åœ¨é˜Ÿåˆ—ä¸­æ²¡æœ‰å…ƒç´ ï¼Œå–å…ƒç´ ï¼Œå¾—åˆ°çš„æ˜¯null</p><p>é˜»å¡é˜Ÿåˆ—ï¼šç­‰å¾…ï¼Œä»€ä¹ˆæ—¶å€™æ”¾è¿›å»ï¼Œå†å–å‡ºæ¥</p><p>çº¿ç¨‹æ± ä½¿ç”¨çš„æ˜¯é˜»å¡é˜Ÿåˆ—</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="çº¿ç¨‹æ± æ¦‚å¿µ">çº¿ç¨‹æ± æ¦‚å¿µ<a href="#çº¿ç¨‹æ± æ¦‚å¿µ" class="hash-link" aria-label="Direct link to çº¿ç¨‹æ± æ¦‚å¿µ" title="Direct link to çº¿ç¨‹æ± æ¦‚å¿µ">â€‹</a></h4><p>çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœè¢«æ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œåˆç†çš„ä½¿ç”¨çº¿ç¨‹æ± å¯¹çº¿ç¨‹è¿›è¡Œç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§ï¼Œæœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p><ol><li>é™ä½èµ„æºæ¶ˆè€—ï¼›</li><li>æé«˜å“åº”é€Ÿåº¦ï¼›</li><li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚</li></ol><p>Java1.5 ä¸­å¼•å…¥çš„ Executor æ¡†æ¶æŠŠä»»åŠ¡çš„æäº¤å’Œæ‰§è¡Œè¿›è¡Œè§£è€¦ï¼Œåªéœ€è¦å®šä¹‰å¥½ä»»åŠ¡ï¼Œç„¶åæäº¤ç»™çº¿ç¨‹æ± ï¼Œè€Œä¸ç”¨å…³å¿ƒè¯¥ä»»åŠ¡æ˜¯å¦‚ä½•æ‰§è¡Œã€è¢«å“ªä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™æ‰§è¡Œã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="executorç±»å›¾">Executorç±»å›¾<a href="#executorç±»å›¾" class="hash-link" aria-label="Direct link to Executorç±»å›¾" title="Direct link to Executorç±»å›¾">â€‹</a></h4><div align="center"><img loading="lazy" src="assets/820628cf179f4952812da4e8ca5de672.png" width="" class="img_ev3q"></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="çº¿ç¨‹æ± å·¥ä½œåŸç†">çº¿ç¨‹æ± å·¥ä½œåŸç†<a href="#çº¿ç¨‹æ± å·¥ä½œåŸç†" class="hash-link" aria-label="Direct link to çº¿ç¨‹æ± å·¥ä½œåŸç†" title="Direct link to çº¿ç¨‹æ± å·¥ä½œåŸç†">â€‹</a></h4><p>çº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå½“æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹æ•°ç­‰äºcorePoolSizeï¼›å¦‚æœå½“å‰çº¿ç¨‹æ•°ä¸º corePoolSizeï¼Œç»§ç»­æäº¤çš„ä»»åŠ¡è¢«ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«æ‰§è¡Œï¼›å¦‚æœé˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œé‚£å°±åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼›ç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è¾¾åˆ° maxPoolSizeï¼Œè¿™æ—¶å†æœ‰ä»»åŠ¡æ¥ï¼Œåªèƒ½æ‰§è¡Œ reject() å¤„ç†è¯¥ä»»åŠ¡ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="åˆå§‹åŒ–çº¿ç¨‹æ± ">åˆå§‹åŒ–çº¿ç¨‹æ± <a href="#åˆå§‹åŒ–çº¿ç¨‹æ± " class="hash-link" aria-label="Direct link to åˆå§‹åŒ–çº¿ç¨‹æ± " title="Direct link to åˆå§‹åŒ–çº¿ç¨‹æ± ">â€‹</a></h4><ul><li><strong>newFixedThreadPool()</strong>
è¯´æ˜ï¼š<strong>åˆå§‹åŒ–ä¸€ä¸ªæŒ‡å®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± </strong>ï¼Œå…¶ä¸­ corePoolSize == maxiPoolSizeï¼Œä½¿ç”¨ LinkedBlockingQuene ä½œä¸ºé˜»å¡é˜Ÿåˆ—
ç‰¹ç‚¹ï¼šå³ä½¿å½“çº¿ç¨‹æ± æ²¡æœ‰å¯æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä¹Ÿä¸ä¼šé‡Šæ”¾çº¿ç¨‹ã€‚</li><li><strong>newCachedThreadPool()</strong>
è¯´æ˜ï¼š<strong>åˆå§‹åŒ–ä¸€ä¸ªå¯ä»¥ç¼“å­˜çº¿ç¨‹çš„çº¿ç¨‹æ± </strong>ï¼Œé»˜è®¤ç¼“å­˜60sï¼Œçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°å¯è¾¾åˆ° Integer.MAX_VALUEï¼Œå³ 2147483647ï¼Œå†…éƒ¨ä½¿ç”¨ SynchronousQueue ä½œä¸ºé˜»å¡é˜Ÿåˆ—ï¼›
ç‰¹ç‚¹ï¼šåœ¨æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œå½“çº¿ç¨‹çš„ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTimeï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹èµ„æºï¼›å½“æäº¤æ–°ä»»åŠ¡æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œä¼šå¯¼è‡´ä¸€å®šçš„ç³»ç»Ÿå¼€é”€ï¼›
å› æ­¤ï¼Œä½¿ç”¨æ—¶è¦æ³¨æ„æ§åˆ¶å¹¶å‘çš„ä»»åŠ¡æ•°ï¼Œé˜²æ­¢å› åˆ›å»ºå¤§é‡çš„çº¿ç¨‹å¯¼è‡´è€Œé™ä½æ€§èƒ½ã€‚</li><li><strong>newSingleThreadExecutor()</strong>
è¯´æ˜ï¼š<strong>åˆå§‹åŒ–åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </strong>ï¼Œå†…éƒ¨ä½¿ç”¨ LinkedBlockingQueue ä½œä¸ºé˜»å¡é˜Ÿåˆ—ã€‚
ç‰¹ç‚¹ï¼šå¦‚æœè¯¥çº¿ç¨‹å¼‚å¸¸ç»“æŸï¼Œä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œä»»åŠ¡ï¼Œå”¯ä¸€çš„çº¿ç¨‹å¯ä»¥ä¿è¯æ‰€æäº¤ä»»åŠ¡çš„é¡ºåºæ‰§è¡Œ</li><li><strong>newScheduledThreadPool()</strong>
ç‰¹ç‚¹ï¼šåˆå§‹åŒ–çš„çº¿ç¨‹æ± å¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´å†…å‘¨æœŸæ€§çš„æ‰§è¡Œæ‰€æäº¤çš„ä»»åŠ¡ï¼Œåœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­å¯ä»¥ä½¿ç”¨è¯¥çº¿ç¨‹æ± å®šæœŸçš„åŒæ­¥æ•°æ®ã€‚</li></ul><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="åˆå§‹åŒ–æ–¹æ³•">åˆå§‹åŒ–æ–¹æ³•<a href="#åˆå§‹åŒ–æ–¹æ³•" class="hash-link" aria-label="Direct link to åˆå§‹åŒ–æ–¹æ³•" title="Direct link to åˆå§‹åŒ–æ–¹æ³•">â€‹</a></h5><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ä½¿ç”¨Executorsé™æ€æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token class-name" style="color:rgb(255, 203, 107)">ExecutorService</span><span class="token plain"> service </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">newSingleThreadExecutor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å¸¸ç”¨æ–¹æ³•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">submit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">shutDown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">shutDownNow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•<a href="#å¸¸ç”¨æ–¹æ³•" class="hash-link" aria-label="Direct link to å¸¸ç”¨æ–¹æ³•" title="Direct link to å¸¸ç”¨æ–¹æ³•">â€‹</a></h4><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="executeä¸submitçš„åŒºåˆ«">executeä¸submitçš„åŒºåˆ«<a href="#executeä¸submitçš„åŒºåˆ«" class="hash-link" aria-label="Direct link to executeä¸submitçš„åŒºåˆ«" title="Direct link to executeä¸submitçš„åŒºåˆ«">â€‹</a></h5><ol><li>æ¥æ”¶çš„å‚æ•°ä¸ä¸€æ ·</li><li>submitæœ‰è¿”å›å€¼ï¼Œè€Œexecuteæ²¡æœ‰</li></ol><p>ç”¨åˆ°è¿”å›å€¼çš„ä¾‹å­ï¼Œæ¯”å¦‚è¯´æˆ‘æœ‰å¾ˆå¤šä¸ªåš validation çš„ taskï¼Œæˆ‘å¸Œæœ›æ‰€æœ‰çš„ task æ‰§è¡Œå®Œï¼Œç„¶åæ¯ä¸ª task å‘Šè¯‰æˆ‘å®ƒçš„æ‰§è¡Œç»“æœï¼Œæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œå¦‚æœæ˜¯å¤±è´¥ï¼ŒåŸå› æ˜¯ä»€ä¹ˆã€‚ç„¶åæˆ‘å°±å¯ä»¥æŠŠæ‰€æœ‰å¤±è´¥çš„åŸå› ç»¼åˆèµ·æ¥å‘ç»™è°ƒç”¨è€…ã€‚</p><ol start="3"><li>submitæ–¹ä¾¿Exceptionå¤„ç†</li></ol><p>å¦‚æœä½ åœ¨ä½ çš„ task é‡Œä¼šæŠ›å‡º checked æˆ–è€… unchecked exceptionï¼Œè€Œä½ åˆå¸Œæœ›å¤–é¢çš„è°ƒç”¨è€…èƒ½å¤Ÿæ„ŸçŸ¥è¿™äº› exception å¹¶åšå‡ºåŠæ—¶çš„å¤„ç†ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨åˆ° submitï¼Œé€šè¿‡æ•è· Future.get æŠ›å‡ºçš„å¼‚å¸¸ã€‚</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="shutdownä¸shutdownnowçš„åŒºåˆ«">shutDownä¸shutDownNowçš„åŒºåˆ«<a href="#shutdownä¸shutdownnowçš„åŒºåˆ«" class="hash-link" aria-label="Direct link to shutDownä¸shutDownNowçš„åŒºåˆ«" title="Direct link to shutDownä¸shutDownNowçš„åŒºåˆ«">â€‹</a></h5><p>å½“çº¿ç¨‹æ± è°ƒç”¨è¯¥æ–¹æ³•æ—¶,çº¿ç¨‹æ± çš„çŠ¶æ€åˆ™ç«‹åˆ»å˜æˆ SHUTDOWN çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œåˆ™ä¸èƒ½å†å¾€çº¿ç¨‹æ± ä¸­æ·»åŠ ä»»ä½•ä»»åŠ¡ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡º RejectedExecutionException å¼‚å¸¸ã€‚ä½†æ˜¯ï¼Œæ­¤æ—¶çº¿ç¨‹æ± ä¸ä¼šç«‹åˆ»é€€å‡ºï¼Œç›´åˆ°æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡éƒ½å·²ç»å¤„ç†å®Œæˆï¼Œæ‰ä¼šé€€å‡ºã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å†…éƒ¨å®ç°">å†…éƒ¨å®ç°<a href="#å†…éƒ¨å®ç°" class="hash-link" aria-label="Direct link to å†…éƒ¨å®ç°" title="Direct link to å†…éƒ¨å®ç°">â€‹</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadPoolExecutor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> corePoolSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ ¸å¿ƒçº¿ç¨‹æ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> maximumPoolSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æœ€å¤§çº¿ç¨‹æ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> keepAliveTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼ˆåœ¨ corePore&lt;*&lt;maxPoolSize æƒ…å†µä¸‹æœ‰ç”¨ï¼‰</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">TimeUnit</span><span class="token plain"> unit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å­˜æ´»æ—¶é—´çš„æ—¶é—´å•ä½</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">BlockingQueue</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token generics class-name" style="color:rgb(255, 203, 107)">Runnable</span><span class="token generics punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> workQueue    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// é˜»å¡é˜Ÿåˆ—ï¼ˆç”¨æ¥ä¿å­˜ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼‰</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ThreadFactory</span><span class="token plain"> threadFactory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// çº¿ç¨‹å·¥å‚ï¼Œä¸»è¦ç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼›</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">RejectedExecutionHandler</span><span class="token plain"> handler </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å½“æ‹’ç»å¤„ç†ä»»åŠ¡æ—¶çš„ç­–ç•¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">corePoolSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> maximumPoolSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> keepAliveTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> unit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> workQueue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token class-name" style="color:rgb(255, 203, 107)">Executors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">defaultThreadFactory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> defaultHandler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å…³äº workQueue å‚æ•°ï¼Œæœ‰å››ç§é˜Ÿåˆ—å¯ä¾›é€‰æ‹©ï¼š</p><ul><li>ArrayBlockingQueueï¼šåŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰ FIFO æ’åºä»»åŠ¡ï¼›</li><li>LinkedBlockingQueneï¼šåŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰ FIFO æ’åºä»»åŠ¡ï¼›</li><li>SynchronousQueneï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äº ArrayBlockingQueneï¼›</li><li>PriorityBlockingQueneï¼šå…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</li></ul><p>å…³äº handler å‚æ•°ï¼Œçº¿ç¨‹æ± çš„é¥±å’Œç­–ç•¥ï¼Œå½“é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”æ²¡æœ‰ç©ºé—²çš„å·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœç»§ç»­æäº¤ä»»åŠ¡ï¼Œå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†è¯¥ä»»åŠ¡ï¼Œçº¿ç¨‹æ± æä¾›äº† 4 ç§ç­–ç•¥ï¼š</p><ul><li>ThreadPoolExecutor.AbortPolicyï¼šä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚</li><li>ThreadPoolExecutor.DiscardPolicyï¼šä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚</li><li>ThreadPoolExecutor.DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰</li><li>ThreadPoolExecutor.CallerRunsPolicyï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡</li></ul><p>å½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯å®ç° RejectedExecutionHandler æ¥å£ï¼Œè‡ªå®šä¹‰é¥±å’Œç­–ç•¥ï¼Œå¦‚è®°å½•æ—¥å¿—æˆ–æŒä¹…åŒ–å­˜å‚¨ä¸èƒ½å¤„ç†çš„ä»»åŠ¡ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="çº¿ç¨‹æ± çš„çŠ¶æ€">çº¿ç¨‹æ± çš„çŠ¶æ€<a href="#çº¿ç¨‹æ± çš„çŠ¶æ€" class="hash-link" aria-label="Direct link to çº¿ç¨‹æ± çš„çŠ¶æ€" title="Direct link to çº¿ç¨‹æ± çš„çŠ¶æ€">â€‹</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">final</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicInteger</span><span class="token plain"> ctl </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AtomicInteger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">ctlOf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">RUNNING</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å…¶ä¸­ AtomicInteger å˜é‡ ctl çš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼šåˆ©ç”¨ä½ 29 ä½è¡¨ç¤ºçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ï¼Œé€šè¿‡é«˜ 3 ä½è¡¨ç¤ºçº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ï¼š</p><ul><li><strong>RUNNING</strong>ï¼š-1 &lt;&lt; COUNT_BITSï¼Œå³é«˜ 3 ä½ä¸º 111ï¼Œè¯¥çŠ¶æ€çš„çº¿ç¨‹æ± ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œå¹¶å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼›</li><li><strong>SHUTDOWN</strong>ï¼š 0 &lt;&lt; COUNT_BITSï¼Œå³é«˜ 3 ä½ä¸º 000ï¼Œè¯¥çŠ¶æ€çš„çº¿ç¨‹æ± ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼›</li><li><strong>STOP</strong> ï¼š 1 &lt;&lt; COUNT_BITSï¼Œå³é«˜ 3 ä½ä¸º 001ï¼Œè¯¥çŠ¶æ€çš„çº¿ç¨‹ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œè€Œä¸”ä¼šä¸­æ–­æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼›</li><li><strong>TIDYING</strong> ï¼š 2 &lt;&lt; COUNT_BITSï¼Œå³é«˜ 3 ä½ä¸º 010ï¼Œè¯¥çŠ¶æ€è¡¨ç¤ºçº¿ç¨‹æ± å¯¹çº¿ç¨‹è¿›è¡Œæ•´ç†ä¼˜åŒ–ï¼›</li><li><strong>TERMINATED</strong>ï¼š 3 &lt;&lt; COUNT_BITSï¼Œå³é«˜ 3 ä½ä¸º 011ï¼Œè¯¥çŠ¶æ€è¡¨ç¤ºçº¿ç¨‹æ± åœæ­¢å·¥ä½œï¼›</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="çº¿ç¨‹æ± å…¶ä»–å¸¸ç”¨æ–¹æ³•">çº¿ç¨‹æ± å…¶ä»–å¸¸ç”¨æ–¹æ³•<a href="#çº¿ç¨‹æ± å…¶ä»–å¸¸ç”¨æ–¹æ³•" class="hash-link" aria-label="Direct link to çº¿ç¨‹æ± å…¶ä»–å¸¸ç”¨æ–¹æ³•" title="Direct link to çº¿ç¨‹æ± å…¶ä»–å¸¸ç”¨æ–¹æ³•">â€‹</a></h4><p>å¦‚æœæ‰§è¡Œäº†çº¿ç¨‹æ± çš„ prestartAllCoreThreads() æ–¹æ³•ï¼Œçº¿ç¨‹æ± ä¼šæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹ã€‚
ThreadPoolExecutor æä¾›äº†åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± å®¹é‡å¤§å°çš„æ–¹æ³•ï¼šsetCorePoolSize() å’Œ setMaximumPoolSize()ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å¦‚ä½•åˆç†è®¾ç½®çº¿ç¨‹æ± çš„å¤§å°">å¦‚ä½•åˆç†è®¾ç½®çº¿ç¨‹æ± çš„å¤§å°<a href="#å¦‚ä½•åˆç†è®¾ç½®çº¿ç¨‹æ± çš„å¤§å°" class="hash-link" aria-label="Direct link to å¦‚ä½•åˆç†è®¾ç½®çº¿ç¨‹æ± çš„å¤§å°" title="Direct link to å¦‚ä½•åˆç†è®¾ç½®çº¿ç¨‹æ± çš„å¤§å°">â€‹</a></h4><p>ä¸€èˆ¬éœ€è¦æ ¹æ®ä»»åŠ¡çš„ç±»å‹æ¥é…ç½®çº¿ç¨‹æ± å¤§å°ï¼š
å¦‚æœæ˜¯ CPU å¯†é›†å‹ä»»åŠ¡ï¼Œå°±éœ€è¦å°½é‡å‹æ¦¨ CPUï¼Œå‚è€ƒå€¼å¯ä»¥è®¾ä¸º NCPU+1
å¦‚æœæ˜¯ IO å¯†é›†å‹ä»»åŠ¡ï¼Œå‚è€ƒå€¼å¯ä»¥è®¾ç½®ä¸º 2*NCPU</p><ul><li>å‚è€ƒèµ„æ–™<ul><li><a href="http://tangxiaolin.com/learn/show?id=402881d2651d1bdf01651de142df0000" target="_blank" rel="noopener noreferrer">Javaçº¿ç¨‹æ± çš„ä½¿ç”¨åŠåŸç†</a></li><li><a href="https://www.jianshu.com/p/87bff5cc8d8c" target="_blank" rel="noopener noreferrer">æ·±å…¥åˆ†æjavaçº¿ç¨‹æ± çš„å®ç°åŸç† - ç®€ä¹¦</a></li><li><a href="https://www.bilibili.com/video/av26354412?p=2" target="_blank" rel="noopener noreferrer">å°šå­¦å ‚çº¿ç¨‹æ± å¹¶å‘é˜Ÿåˆ—ThreadPoolExecutor_CallableåŸç†è§£æå“”å“©å“”å“© (ã‚œ-ã‚œ)ã¤ãƒ­ å¹²æ¯~-bilibili</a></li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ç¬¬äºŒéƒ¨åˆ†é¢è¯•æŒ‡å—">ç¬¬äºŒéƒ¨åˆ†ï¼šé¢è¯•æŒ‡å—<a href="#ç¬¬äºŒéƒ¨åˆ†é¢è¯•æŒ‡å—" class="hash-link" aria-label="Direct link to ç¬¬äºŒéƒ¨åˆ†ï¼šé¢è¯•æŒ‡å—" title="Direct link to ç¬¬äºŒéƒ¨åˆ†ï¼šé¢è¯•æŒ‡å—">â€‹</a></h2><p>åœ¨è¿™é‡Œå°†æ€»ç»“é¢è¯•ä¸­å’Œå¹¶å‘ç¼–ç¨‹ç›¸å…³çš„å¸¸è§çŸ¥è¯†ç‚¹ï¼Œå¦‚åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­å‡ºç°çš„è¿™é‡Œå°†ä¸è¿›è¡Œè¯¦ç»†é˜è¿°ã€‚é¢è¯•æŒ‡å—ä¸­ï¼Œæˆ‘å°†ç”¨æœ€ç®€æ´çš„è¯­è¨€æè¿°ï¼Œæ›´å¤šæ˜¯ä»¥ä¸€ç§å¤§çº²çš„å½¢å¼åˆ—å‡ºé—®ç­”ç‚¹ï¼Œæ ¹æ®è‡ªå·±æŒæ¡çš„æƒ…å†µå›ç­”ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="http://www.importnew.com/12773.html" target="_blank" rel="noopener noreferrer">Javaçº¿ç¨‹é¢è¯•é¢˜ Top 50 - ImportNew</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-volatile-ä¸-synchronized-çš„åŒºåˆ«">1. volatile ä¸ synchronized çš„åŒºåˆ«<a href="#1-volatile-ä¸-synchronized-çš„åŒºåˆ«" class="hash-link" aria-label="Direct link to 1. volatile ä¸ synchronized çš„åŒºåˆ«" title="Direct link to 1. volatile ä¸ synchronized çš„åŒºåˆ«">â€‹</a></h3><p><strong>ï¼ˆ1ï¼‰ä»…é volatileä¸èƒ½ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§ã€‚ï¼ˆåŸå­æ€§ï¼‰</strong></p><ul><li>â‘  volatile è½»é‡çº§ï¼Œåªèƒ½ä¿®é¥°å˜é‡ã€‚synchronizedé‡é‡çº§ï¼Œè¿˜å¯ä¿®é¥°æ–¹æ³•</li><li>â‘¡ volatile åªèƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä¸èƒ½ç”¨æ¥åŒæ­¥ï¼Œå› ä¸ºå¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—® volatile ä¿®é¥°çš„å˜é‡ä¸ä¼šé˜»å¡ã€‚</li></ul><p>synchronized ä¸ä»…ä¿è¯å¯è§æ€§ï¼Œè€Œä¸”è¿˜ä¿è¯åŸå­æ€§ï¼Œå› ä¸ºï¼Œåªæœ‰è·å¾—äº†é”çš„çº¿ç¨‹æ‰èƒ½è¿›å…¥ä¸´ç•ŒåŒºï¼Œä»è€Œä¿è¯ä¸´ç•ŒåŒºä¸­çš„æ‰€æœ‰è¯­å¥éƒ½å…¨éƒ¨æ‰§è¡Œã€‚å¤šä¸ªçº¿ç¨‹äº‰æŠ¢ synchronized é”å¯¹è±¡æ—¶ï¼Œä¼šå‡ºç°é˜»å¡ã€‚</p><p><strong>ï¼ˆ2ï¼‰çº¿ç¨‹å®‰å…¨æ€§</strong></p><p>çº¿ç¨‹å®‰å…¨æ€§åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼Œâ‘ å¯è§æ€§ã€‚â‘¡åŸå­æ€§ã€‚</p><p>ä»ä¸Šé¢è‡ªå¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºï¼šä»…ä»…ä½¿ç”¨ volatile å¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚è€Œ synchronized åˆ™å¯å®ç°çº¿ç¨‹çš„å®‰å…¨æ€§ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªåŠ¨æ€å¤§å°çš„çº¿ç¨‹æ± å¦‚ä½•è®¾è®¡åº”è¯¥æœ‰å“ªäº›æ–¹æ³•çº¿ç¨‹æ± åˆ›å»ºçš„æ–¹å¼">2. ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿå¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªåŠ¨æ€å¤§å°çš„çº¿ç¨‹æ± ï¼Œå¦‚ä½•è®¾è®¡ï¼Œåº”è¯¥æœ‰å“ªäº›æ–¹æ³•ï¼Ÿçº¿ç¨‹æ± åˆ›å»ºçš„æ–¹å¼ï¼Ÿ<a href="#2-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªåŠ¨æ€å¤§å°çš„çº¿ç¨‹æ± å¦‚ä½•è®¾è®¡åº”è¯¥æœ‰å“ªäº›æ–¹æ³•çº¿ç¨‹æ± åˆ›å»ºçš„æ–¹å¼" class="hash-link" aria-label="Direct link to 2. ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿå¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªåŠ¨æ€å¤§å°çš„çº¿ç¨‹æ± ï¼Œå¦‚ä½•è®¾è®¡ï¼Œåº”è¯¥æœ‰å“ªäº›æ–¹æ³•ï¼Ÿçº¿ç¨‹æ± åˆ›å»ºçš„æ–¹å¼ï¼Ÿ" title="Direct link to 2. ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿå¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªåŠ¨æ€å¤§å°çš„çº¿ç¨‹æ± ï¼Œå¦‚ä½•è®¾è®¡ï¼Œåº”è¯¥æœ‰å“ªäº›æ–¹æ³•ï¼Ÿçº¿ç¨‹æ± åˆ›å»ºçš„æ–¹å¼ï¼Ÿ">â€‹</a></h3><ul><li><p>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ±  </p><ul><li>çº¿ç¨‹æ± é¡¾åæ€ä¹‰å°±æ˜¯äº‹å…ˆåˆ›å»ºè‹¥å¹²ä¸ªå¯æ‰§è¡Œçš„çº¿ç¨‹æ”¾å…¥ä¸€ä¸ªæ± ï¼ˆå®¹å™¨ï¼‰ä¸­ï¼Œéœ€è¦çš„æ—¶å€™ä»æ± ä¸­è·å–çº¿ç¨‹ä¸ç”¨è‡ªè¡Œåˆ›å»ºï¼Œä½¿ç”¨å®Œæ¯•ä¸éœ€è¦é”€æ¯çº¿ç¨‹è€Œæ˜¯æ”¾å›æ± ä¸­ï¼Œä»è€Œå‡å°‘åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹å¯¹è±¡çš„å¼€é”€ã€‚ </li></ul></li><li><p>è®¾è®¡ä¸€ä¸ªåŠ¨æ€å¤§å°çš„çº¿ç¨‹æ± ï¼Œå¦‚ä½•è®¾è®¡ï¼Œåº”è¯¥æœ‰å“ªäº›æ–¹æ³• </p><ul><li>ä¸€ä¸ªçº¿ç¨‹æ± åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªåŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼š <ul><li>çº¿ç¨‹ç®¡ç†å™¨ (ThreadPool)ï¼šç”¨äºåˆ›å»ºå¹¶ç®¡ç†çº¿ç¨‹æ± ï¼ŒåŒ…æ‹¬åˆ›å»ºçº¿ç¨‹ï¼Œé”€æ¯çº¿ç¨‹æ± ï¼Œæ·»åŠ æ–°ä»»åŠ¡ï¼› </li><li>å·¥ä½œçº¿ç¨‹ (PoolWorker)ï¼šçº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Œåœ¨æ²¡æœ‰ä»»åŠ¡æ—¶å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¯ä»¥å¾ªç¯çš„æ‰§è¡Œä»»åŠ¡ï¼› </li><li>ä»»åŠ¡æ¥å£ (Task)ï¼šæ¯ä¸ªä»»åŠ¡å¿…é¡»å®ç°çš„æ¥å£ï¼Œä»¥ä¾›å·¥ä½œçº¿ç¨‹è°ƒåº¦ä»»åŠ¡çš„æ‰§è¡Œï¼Œå®ƒä¸»è¦è§„å®šäº†ä»»åŠ¡çš„å…¥å£ï¼Œä»»åŠ¡æ‰§è¡Œå®Œåçš„æ”¶å°¾å·¥ä½œï¼Œä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ç­‰ï¼› </li><li>ä»»åŠ¡é˜Ÿåˆ— (TaskQueue)ï¼šç”¨äºå­˜æ”¾æ²¡æœ‰å¤„ç†çš„ä»»åŠ¡ã€‚æä¾›ä¸€ç§ç¼“å†²æœºåˆ¶ï¼› </li></ul></li><li>æ‰€åŒ…å«çš„æ–¹æ³• <ul><li>private ThreadPool()  åˆ›å»ºçº¿ç¨‹æ±  </li><li>public static ThreadPool getThreadPool()  è·å¾—ä¸€ä¸ªé»˜è®¤çº¿ç¨‹ä¸ªæ•°çš„çº¿ç¨‹æ±   </li><li>public void execute(Runnable task)  æ‰§è¡Œä»»åŠ¡,å…¶å®åªæ˜¯æŠŠä»»åŠ¡åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œä»€ä¹ˆæ—¶å€™æ‰§è¡Œæœ‰çº¿ç¨‹æ± ç®¡ç†å™¨å†³å®š </li><li>public void execute(Runnable[] task)  æ‰¹é‡æ‰§è¡Œä»»åŠ¡,å…¶å®åªæ˜¯æŠŠä»»åŠ¡åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œä»€ä¹ˆæ—¶å€™æ‰§è¡Œæœ‰çº¿ç¨‹æ± ç®¡ç†å™¨å†³å®š </li><li>public void destroy()  é”€æ¯çº¿ç¨‹æ± ,è¯¥æ–¹æ³•ä¿è¯åœ¨æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆçš„æƒ…å†µä¸‹æ‰é”€æ¯æ‰€æœ‰çº¿ç¨‹ï¼Œå¦åˆ™ç­‰å¾…ä»»åŠ¡å®Œæˆæ‰é”€æ¯ </li><li>public int getWorkThreadNumber() è¿”å›å·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°  </li><li>public int getFinishedTasknumber() è¿”å›å·²å®Œæˆä»»åŠ¡çš„ä¸ªæ•°,è¿™é‡Œçš„å·²å®Œæˆæ˜¯åªå‡ºäº†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ä¸ªæ•°ï¼Œå¯èƒ½è¯¥ä»»åŠ¡å¹¶æ²¡æœ‰å®é™…æ‰§è¡Œå®Œæˆ </li><li>public void addThread() åœ¨ä¿è¯çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œï¼Œå¹¶ä¸”è¦æ‰§è¡Œçº¿ç¨‹çš„ä¸ªæ•°å¤§äºæŸä¸€å€¼æ—¶ã€‚å¢åŠ çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„ä¸ªæ•° </li><li>public void reduceThread() åœ¨ä¿è¯çº¿ç¨‹æ± ä¸­æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€ï¼Œå¹¶ä¸”ç©ºé—²çŠ¶æ€çš„çº¿ç¨‹åœ¨å°äºæŸä¸€å€¼æ—¶ï¼Œå‡å°‘çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„ä¸ªæ•°  </li></ul></li></ul></li><li><p>çº¿ç¨‹æ± å››ç§åˆ›å»ºæ–¹å¼</p><p>Java é€šè¿‡ Executors æä¾›å››ç§çº¿ç¨‹æ± ï¼Œåˆ†åˆ«ä¸ºï¼š</p><ul><li>new CachedThreadPool åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹ã€‚</li><li>new FixedThreadPool åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œå¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼Œè¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚</li><li>new ScheduledThreadPool åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚</li><li>new SingleThreadExecutor åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œ">3. ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œ<a href="#3-ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œ" class="hash-link" aria-label="Direct link to 3. ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œ" title="Direct link to 3. ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œ">â€‹</a></h3><div align="center"> <img loading="lazy" src="assets/concurrent_and_parallel.png" width="" class="img_ev3q"></div><br><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å¹¶å‘">å¹¶å‘<a href="#å¹¶å‘" class="hash-link" aria-label="Direct link to å¹¶å‘" title="Direct link to å¹¶å‘">â€‹</a></h4><ul><li>å¹¶å‘æ˜¯æŒ‡ä¸¤ä¸ªä»»åŠ¡éƒ½è¯·æ±‚è¿è¡Œï¼Œè€Œå¤„ç†å™¨åªèƒ½æŒ‰å—ä¸€ä¸ªä»»åŠ¡ï¼Œå°±æŠŠè¿™ä¸¤ä¸ªä»»åŠ¡å®‰æ’è½®æµè¿›è¡Œï¼Œç”±äºæ—¶é—´é—´éš”è¾ƒçŸ­ï¼Œä½¿äººæ„Ÿè§‰ä¸¤ä¸ªä»»åŠ¡éƒ½åœ¨è¿è¡Œã€‚</li><li>å¦‚æœç”¨ä¸€å°ç”µè„‘æˆ‘å…ˆç»™ç”²å‘ä¸ªæ¶ˆæ¯ï¼Œç„¶åç«‹åˆ»å†ç»™ä¹™å‘æ¶ˆæ¯ï¼Œç„¶åå†è·Ÿç”²èŠï¼Œå†è·Ÿä¹™èŠã€‚è¿™å°±å«å¹¶å‘ã€‚</li><li>å¤šä¸ªçº¿ç¨‹æ“ä½œç›¸åŒçš„èµ„æºï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆç†ä½¿ç”¨èµ„æº</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å¹¶è¡Œ">å¹¶è¡Œ<a href="#å¹¶è¡Œ" class="hash-link" aria-label="Direct link to å¹¶è¡Œ" title="Direct link to å¹¶è¡Œ">â€‹</a></h4><ul><li><p>å¹¶è¡Œå°±æ˜¯ä¸¤ä¸ªä»»åŠ¡åŒæ—¶è¿è¡Œï¼Œå°±æ˜¯ç”²ä»»åŠ¡è¿›è¡Œçš„åŒæ—¶ï¼Œä¹™ä»»åŠ¡ä¹Ÿåœ¨è¿›è¡Œã€‚(éœ€è¦å¤šæ ¸CPU)</p></li><li><p>æ¯”å¦‚æˆ‘è·Ÿä¸¤ä¸ªç½‘å‹èŠå¤©ï¼Œå·¦æ‰‹æ“ä½œä¸€ä¸ªç”µè„‘è·Ÿç”²èŠï¼ŒåŒæ—¶å³æ‰‹ç”¨å¦ä¸€å°ç”µè„‘è·Ÿä¹™èŠå¤©ï¼Œè¿™å°±å«å¹¶è¡Œã€‚</p></li><li><p>æœåŠ¡èƒ½åŒæ—¶å¤„ç†å¾ˆå¤šè¯·æ±‚ï¼Œæé«˜ç¨‹åºæ€§èƒ½</p></li></ul><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="https://github.com/forhappy/Cplusplus-Concurrency-In-Practice/blob/master/zh/chapter1-Introduction/1.1%20What%20is%20concurrency.md" target="_blank" rel="noopener noreferrer">Cplusplus-Concurrency-In-Practice/1.1 What is concurrency.md at master Â· forhappy/Cplusplus-Concurrency-In-Practice</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨">4. ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨<a href="#4-ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨" class="hash-link" aria-label="Direct link to 4. ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨" title="Direct link to 4. ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨">â€‹</a></h3><p>å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿è¿è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œæˆ–è€…åœ¨è°ƒç”¨æ–¹è¿›è¡Œä»»ä½•å…¶ä»–çš„åè°ƒæ“ä½œï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å–æ­£ç¡®çš„ç»“æœï¼Œé‚£è¿™ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚â€”â€”æ¥è‡ªã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹</p><ul><li><p>å®šä¹‰ </p><ul><li>æŸä¸ªç±»çš„è¡Œä¸ºä¸å…¶è§„èŒƒä¸€è‡´ã€‚ </li><li>ä¸ç®¡å¤šä¸ªçº¿ç¨‹æ˜¯æ€æ ·çš„æ‰§è¡Œé¡ºåºå’Œä¼˜å…ˆçº§,æˆ–æ˜¯ wait , sleep , join ç­‰æ§åˆ¶æ–¹å¼ï¼Œå¦‚æœä¸€ä¸ªç±»åœ¨å¤šçº¿ç¨‹è®¿é—®ä¸‹è¿è½¬ä¸€åˆ‡æ­£å¸¸ï¼Œå¹¶ä¸”è®¿é—®ç±»ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥å¤„ç†æˆ–è€…åè°ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚  </li></ul></li><li><p>å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿï¼ˆæ›´åŠ è¯¦ç»†çš„è¯·è½¬å‘ç¬¬ä¸€éƒ¨åˆ† <code>11. çº¿ç¨‹å®‰å…¨</code>ï¼‰</p><ul><li>å¯¹å˜é‡ä½¿ç”¨ volitate </li><li>å¯¹ç¨‹åºæ®µè¿›è¡ŒåŠ é” (synchronized , lock) </li></ul></li><li><p>æ³¨æ„ </p><ul><li>éçº¿ç¨‹å®‰å…¨çš„é›†åˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯ä»¥ä½¿ç”¨ï¼Œä½†å¹¶ä¸èƒ½ä½œä¸ºå¤šä¸ªçº¿ç¨‹å…±äº«çš„å±æ€§ï¼Œå¯ä»¥ä½œä¸ºæŸä¸ªçº¿ç¨‹ç‹¬äº«çš„å±æ€§ã€‚ </li><li>ä¾‹å¦‚ Vector æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒArrayList ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœæ¯ä¸€ä¸ªçº¿ç¨‹ä¸­ new ä¸€ä¸ª ArrayListï¼Œè€Œè¿™ä¸ªArrayList åªæ˜¯åœ¨è¿™ä¸€ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨ï¼Œè‚¯å®šæ²¡é—®é¢˜ã€‚ </li></ul></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="éçº¿ç¨‹å®‰å…¨ä¸å®‰å…¨">éçº¿ç¨‹å®‰å…¨!=ä¸å®‰å…¨ï¼Ÿ<a href="#éçº¿ç¨‹å®‰å…¨ä¸å®‰å…¨" class="hash-link" aria-label="Direct link to éçº¿ç¨‹å®‰å…¨!=ä¸å®‰å…¨ï¼Ÿ" title="Direct link to éçº¿ç¨‹å®‰å…¨!=ä¸å®‰å…¨ï¼Ÿ">â€‹</a></h4><p>æœ‰äººåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªä¸æ­£ç¡®çš„è§‚ç‚¹ï¼šæˆ‘çš„ç¨‹åºæ˜¯å¤šçº¿ç¨‹çš„ï¼Œä¸èƒ½ä½¿ç”¨ ArrayList è¦ä½¿ç”¨ Vectorï¼Œè¿™æ ·æ‰å®‰å…¨ã€‚</p><p><strong>éçº¿ç¨‹å®‰å…¨å¹¶ä¸æ˜¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å°±ä¸èƒ½ä½¿ç”¨</strong>ã€‚æ³¨æ„æˆ‘ä¸Šé¢æœ‰è¯´åˆ°ï¼š<strong>å¤šçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡</strong>ã€‚æ³¨æ„æ˜¯<strong>åŒä¸€ä¸ªå¯¹è±¡</strong>ã€‚æ¯”å¦‚æœ€ä¸Šé¢é‚£ä¸ªæ¨¡æ‹Ÿï¼Œå°±æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ new çš„ä¸€ä¸ª ArrayList ç„¶åå¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ª ArrayList å¯¹è±¡ã€‚</p><p>å¦‚æœæ˜¯æ¯ä¸ªçº¿ç¨‹ä¸­ new ä¸€ä¸ª ArrayListï¼Œè€Œè¿™ä¸ª ArrayList åªåœ¨è¿™ä¸€ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯æ²¡é—®é¢˜çš„ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="çº¿ç¨‹å®‰å…¨åä¸‡ä¸ªä¸ºä»€ä¹ˆ">çº¿ç¨‹å®‰å…¨åä¸‡ä¸ªä¸ºä»€ä¹ˆï¼Ÿ<a href="#çº¿ç¨‹å®‰å…¨åä¸‡ä¸ªä¸ºä»€ä¹ˆ" class="hash-link" aria-label="Direct link to çº¿ç¨‹å®‰å…¨åä¸‡ä¸ªä¸ºä»€ä¹ˆï¼Ÿ" title="Direct link to çº¿ç¨‹å®‰å…¨åä¸‡ä¸ªä¸ºä»€ä¹ˆï¼Ÿ">â€‹</a></h4><p><strong>é—®ï¼šå¹³æ—¶é¡¹ç›®ä¸­ä½¿ç”¨é”å’Œ synchronized æ¯”è¾ƒå¤šï¼Œè€Œå¾ˆå°‘ä½¿ç”¨ volatileï¼Œéš¾é“å°±æ²¡æœ‰ä¿è¯å¯è§æ€§ï¼Ÿ</strong>
ç­”ï¼šé”å’Œ synchronized å³å¯ä»¥ä¿è¯åŸå­æ€§ï¼Œä¹Ÿå¯ä»¥ä¿è¯å¯è§æ€§ã€‚éƒ½æ˜¯é€šè¿‡ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç›®æ ‡ä»£ç æ®µæ¥å®ç°çš„ã€‚</p><p><strong>é—®ï¼šé”å’Œ synchronized ä¸ºä½•èƒ½ä¿è¯å¯è§æ€§ï¼Ÿ</strong>
ç­”ï¼šæ ¹æ® <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/package-summary.html#MemoryVisibility" target="_blank" rel="noopener noreferrer">JDK 7çš„Java doc</a> ä¸­å¯¹ <code>concurrent</code> åŒ…çš„è¯´æ˜ï¼Œä¸€ä¸ªçº¿ç¨‹çš„å†™ç»“æœä¿è¯å¯¹å¦å¤–çº¿ç¨‹çš„è¯»æ“ä½œå¯è§ï¼Œåªè¦è¯¥å†™æ“ä½œå¯ä»¥ç”± <code>happen-before</code> åŸåˆ™æ¨æ–­å‡ºåœ¨è¯»æ“ä½œä¹‹å‰å‘ç”Ÿã€‚</p><blockquote><p>The results of a write by one thread are guaranteed to be <strong>visible</strong> to a read by another thread only if the write operation happens-before the read operation. The synchronized and volatile constructs, as well as the Thread.start() and Thread.join() methods, can form happens-before relationships.</p></blockquote><p><strong>é—®ï¼šæ—¢ç„¶é”å’Œ synchronized å³å¯ä¿è¯åŸå­æ€§ä¹Ÿå¯ä¿è¯å¯è§æ€§ï¼Œä¸ºä½•è¿˜éœ€è¦ volatileï¼Ÿ</strong>
ç­”ï¼šsynchronizedå’Œé”éœ€è¦é€šè¿‡æ“ä½œç³»ç»Ÿæ¥ä»²è£è°è·å¾—é”ï¼Œå¼€é”€æ¯”è¾ƒé«˜ï¼Œè€Œ volatile å¼€é”€å°å¾ˆå¤šã€‚å› æ­¤åœ¨åªéœ€è¦ä¿è¯å¯è§æ€§çš„æ¡ä»¶ä¸‹ï¼Œä½¿ç”¨ volatile çš„æ€§èƒ½è¦æ¯”ä½¿ç”¨é”å’Œ synchronized é«˜å¾—å¤šã€‚</p><p><strong>é—®ï¼šæ—¢ç„¶é”å’Œ synchronized å¯ä»¥ä¿è¯åŸå­æ€§ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ AtomicInteger è¿™ç§çš„ç±»æ¥ä¿è¯åŸå­æ“ä½œï¼Ÿ</strong>
ç­”ï¼šé”å’Œ synchronized éœ€è¦é€šè¿‡æ“ä½œç³»ç»Ÿæ¥ä»²è£è°è·å¾—é”ï¼Œå¼€é”€æ¯”è¾ƒé«˜ï¼Œè€Œ AtomicInteger æ˜¯é€šè¿‡CPUçº§çš„CASæ“ä½œæ¥ä¿è¯åŸå­æ€§ï¼Œå¼€é”€æ¯”è¾ƒå°ã€‚æ‰€ä»¥ä½¿ç”¨ AtomicInteger çš„ç›®çš„è¿˜æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ã€‚</p><p><strong>é—®ï¼šè¿˜æœ‰æ²¡æœ‰åˆ«çš„åŠæ³•ä¿è¯çº¿ç¨‹å®‰å…¨</strong>
ç­”ï¼šæœ‰ã€‚å°½å¯èƒ½é¿å…å¼•èµ·éçº¿ç¨‹å®‰å…¨çš„æ¡ä»¶â€”â€”å…±äº«å˜é‡ã€‚å¦‚æœèƒ½ä»è®¾è®¡ä¸Šé¿å…å…±äº«å˜é‡çš„ä½¿ç”¨ï¼Œå³å¯é¿å…éçº¿ç¨‹å®‰å…¨çš„å‘ç”Ÿï¼Œä¹Ÿå°±æ— é¡»é€šè¿‡é”æˆ–è€… synchronized ä»¥åŠ volatile è§£å†³åŸå­æ€§ã€å¯è§æ€§å’Œé¡ºåºæ€§çš„é—®é¢˜ã€‚</p><p><strong>é—®ï¼šsynchronized å³å¯ä¿®é¥°éé™æ€æ–¹å¼ï¼Œä¹Ÿå¯ä¿®é¥°é™æ€æ–¹æ³•ï¼Œè¿˜å¯ä¿®é¥°ä»£ç å—ï¼Œæœ‰ä½•åŒºåˆ«</strong>
ç­”ï¼šsynchronized ä¿®é¥°éé™æ€åŒæ­¥æ–¹æ³•æ—¶ï¼Œé”ä½çš„æ˜¯å½“å‰å®ä¾‹ï¼›synchronized ä¿®é¥°é™æ€åŒæ­¥æ–¹æ³•æ—¶ï¼Œé”ä½çš„æ˜¯è¯¥ç±»çš„ Class å¯¹è±¡ï¼›synchronized ä¿®é¥°é™æ€ä»£ç å—æ—¶ï¼Œé”ä½çš„æ˜¯ synchronized å…³é”®å­—åé¢æ‹¬å·å†…çš„å¯¹è±¡ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="http://www.jasongj.com/java/thread_safe/" target="_blank" rel="noopener noreferrer">Javaè¿›é˜¶ï¼ˆäºŒï¼‰å½“æˆ‘ä»¬è¯´çº¿ç¨‹å®‰å…¨æ—¶ï¼Œåˆ°åº•åœ¨è¯´ä»€ä¹ˆ</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-volatile-å…³é”®å­—çš„å¦‚ä½•ä¿è¯å†…å­˜å¯è§æ€§">5. volatile å…³é”®å­—çš„å¦‚ä½•ä¿è¯å†…å­˜å¯è§æ€§<a href="#5-volatile-å…³é”®å­—çš„å¦‚ä½•ä¿è¯å†…å­˜å¯è§æ€§" class="hash-link" aria-label="Direct link to 5. volatile å…³é”®å­—çš„å¦‚ä½•ä¿è¯å†…å­˜å¯è§æ€§" title="Direct link to 5. volatile å…³é”®å­—çš„å¦‚ä½•ä¿è¯å†…å­˜å¯è§æ€§">â€‹</a></h3><ul><li><p>volatile å…³é”®å­—çš„ä½œç”¨ </p><ul><li>ä¿è¯å†…å­˜çš„å¯è§æ€§ </li><li>é˜²æ­¢æŒ‡ä»¤é‡æ’ </li><li>æ³¨æ„ï¼švolatile å¹¶ä¸ä¿è¯åŸå­æ€§ </li></ul></li><li><p>å†…å­˜å¯è§æ€§ </p><ul><li>volatile ä¿è¯å¯è§æ€§çš„åŸç†æ˜¯åœ¨æ¯æ¬¡è®¿é—®å˜é‡æ—¶éƒ½ä¼šè¿›è¡Œä¸€æ¬¡åˆ·æ–°ï¼Œå› æ­¤æ¯æ¬¡è®¿é—®éƒ½æ˜¯ä¸»å†…å­˜ä¸­æœ€æ–°çš„ç‰ˆæœ¬ã€‚æ‰€ä»¥ volatile å…³é”®å­—çš„ä½œç”¨ä¹‹ä¸€å°±æ˜¯ä¿è¯å˜é‡ä¿®æ”¹çš„å®æ—¶å¯è§æ€§ã€‚ </li></ul></li><li><p>å½“ä¸”ä»…å½“æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶æ—¶ï¼Œæ‰åº”è¯¥ä½¿ç”¨ volatile å˜é‡ </p><ul><li>å¯¹å˜é‡çš„å†™å…¥æ“ä½œä¸ä¾èµ–å˜é‡çš„å½“å‰å€¼ï¼Œæˆ–è€…ä½ èƒ½ç¡®ä¿åªæœ‰å•ä¸ªçº¿ç¨‹æ›´æ–°å˜é‡çš„å€¼ã€‚ </li><li>è¯¥å˜é‡æ²¡æœ‰åŒ…å«åœ¨å…·æœ‰å…¶ä»–å˜é‡çš„ä¸å˜å¼ä¸­ã€‚ </li></ul></li><li><p>volatile ä½¿ç”¨å»ºè®® </p><ul><li>åœ¨ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„çº¿ç¨‹éœ€è¦è®¿é—®çš„æˆå‘˜å˜é‡ä¸Šä½¿ç”¨ volatileã€‚å½“è¦è®¿é—®çš„å˜é‡å·²åœ¨ synchronized ä»£ç å—ä¸­ï¼Œæˆ–è€…ä¸ºå¸¸é‡æ—¶ï¼Œæ²¡å¿…è¦ä½¿ç”¨volatileã€‚ </li><li>ç”±äºä½¿ç”¨ volatile å±è”½æ‰äº† JVM ä¸­å¿…è¦çš„ä»£ç ä¼˜åŒ–ï¼Œæ‰€ä»¥åœ¨æ•ˆç‡ä¸Šæ¯”è¾ƒä½ï¼Œå› æ­¤ä¸€å®šåœ¨å¿…è¦æ—¶æ‰ä½¿ç”¨æ­¤å…³é”®å­—ã€‚ </li></ul></li><li><p>volatile å’Œ synchronizedåŒºåˆ« </p><ul><li>volatile ä¸ä¼šè¿›è¡ŒåŠ é”æ“ä½œï¼š </li></ul><p>ã€€ã€€volatile å˜é‡æ˜¯ä¸€ç§ç¨å¼±çš„åŒæ­¥æœºåˆ¶åœ¨è®¿é—® volatile å˜é‡æ—¶ä¸ä¼šæ‰§è¡ŒåŠ é”æ“ä½œï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šä½¿æ‰§è¡Œçº¿ç¨‹é˜»å¡ï¼Œå› æ­¤ volatile å˜é‡æ˜¯ä¸€ç§æ¯” synchronized å…³é”®å­—æ›´è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚ </p><ul><li>volatile å˜é‡ä½œç”¨ç±»ä¼¼äºåŒæ­¥å˜é‡è¯»å†™æ“ä½œï¼š </li></ul><p>ã€€ã€€ä»å†…å­˜å¯è§æ€§çš„è§’åº¦çœ‹ï¼Œå†™å…¥ volatile å˜é‡ç›¸å½“äºé€€å‡ºåŒæ­¥ä»£ç å—ï¼Œè€Œè¯»å– volatile å˜é‡ç›¸å½“äºè¿›å…¥åŒæ­¥ä»£ç å—ã€‚ </p><ul><li>volatile ä¸å¦‚ synchronizedå®‰å…¨ï¼š </li></ul><p>ã€€ã€€åœ¨ä»£ç ä¸­å¦‚æœè¿‡åº¦ä¾èµ– volatile å˜é‡æ¥æ§åˆ¶çŠ¶æ€çš„å¯è§æ€§ï¼Œé€šå¸¸ä¼šæ¯”ä½¿ç”¨é”çš„ä»£ç æ›´è„†å¼±ï¼Œä¹Ÿæ›´éš¾ä»¥ç†è§£ã€‚ä»…å½“ volatile å˜é‡èƒ½ç®€åŒ–ä»£ç çš„å®ç°ä»¥åŠå¯¹åŒæ­¥ç­–ç•¥çš„éªŒè¯æ—¶ï¼Œæ‰åº”è¯¥ä½¿ç”¨å®ƒã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç”¨åŒæ­¥æœºåˆ¶ä¼šæ›´å®‰å…¨äº›ã€‚ </p><ul><li>volatile æ— æ³•åŒæ—¶ä¿è¯å†…å­˜å¯è§æ€§å’ŒåŸå­æ€§ï¼š </li></ul><p>ã€€ã€€åŠ é”æœºåˆ¶ï¼ˆå³åŒæ­¥æœºåˆ¶ï¼‰æ—¢å¯ä»¥ç¡®ä¿å¯è§æ€§åˆå¯ä»¥ç¡®ä¿åŸå­æ€§ï¼Œè€Œ volatile å˜é‡åªèƒ½ç¡®ä¿å¯è§æ€§ï¼ŒåŸå› æ˜¯å£°æ˜ä¸ºvolatileçš„ç®€å•å˜é‡å¦‚æœå½“å‰å€¼ä¸è¯¥å˜é‡ä»¥å‰çš„å€¼ç›¸å…³ï¼Œé‚£ä¹ˆ volatile å…³é”®å­—ä¸èµ·ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚ä¸‹çš„è¡¨è¾¾å¼éƒ½ä¸æ˜¯åŸå­æ“ä½œï¼šâ€œcount++â€ã€â€œcount = count+1â€ã€‚ </p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-ä»€ä¹ˆæ˜¯çº¿ç¨‹çº¿ç¨‹å’Œè¿›ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹">5. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿçº¿ç¨‹å’Œè¿›ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹<a href="#5-ä»€ä¹ˆæ˜¯çº¿ç¨‹çº¿ç¨‹å’Œè¿›ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹" class="hash-link" aria-label="Direct link to 5. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿçº¿ç¨‹å’Œè¿›ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹" title="Direct link to 5. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿçº¿ç¨‹å’Œè¿›ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹">â€‹</a></h3><p>ï¼ˆ1ï¼‰çº¿ç¨‹å’Œè¿›ç¨‹</p><ul><li>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿ<strong>åˆ†é…èµ„æº</strong>çš„æœ€å°å•ä½ </li><li>çº¿ç¨‹æ˜¯<strong>CPUè°ƒåº¦</strong>çš„æœ€å°å•ä½  </li></ul><p>ï¼ˆ2ï¼‰ä½¿ç”¨çº¿ç¨‹çš„åŸå› </p><ul><li>ä½¿ç”¨å¤šçº¿ç¨‹å¯ä»¥å‡å°‘ç¨‹åºçš„å“åº”æ—¶é—´ï¼›</li><li>ä¸è¿›ç¨‹ç›¸æ¯”ï¼Œçº¿ç¨‹çš„åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€æ›´å°ï¼›</li><li>å¤šæ ¸ç”µè„‘ä¸Šï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ï¼›</li><li>ç®€åŒ–ç¨‹åºçš„ç»“æ„ï¼Œä½¿ç¨‹åºä¾¿äºç†è§£å’Œç»´æŠ¤ï¼›</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-å¤šçº¿ç¨‹å…±ç”¨ä¸€ä¸ªæ•°æ®å˜é‡éœ€è¦æ³¨æ„ä»€ä¹ˆ">6. å¤šçº¿ç¨‹å…±ç”¨ä¸€ä¸ªæ•°æ®å˜é‡éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ<a href="#6-å¤šçº¿ç¨‹å…±ç”¨ä¸€ä¸ªæ•°æ®å˜é‡éœ€è¦æ³¨æ„ä»€ä¹ˆ" class="hash-link" aria-label="Direct link to 6. å¤šçº¿ç¨‹å…±ç”¨ä¸€ä¸ªæ•°æ®å˜é‡éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" title="Direct link to 6. å¤šçº¿ç¨‹å…±ç”¨ä¸€ä¸ªæ•°æ®å˜é‡éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ">â€‹</a></h3><ul><li>å½“æˆ‘ä»¬åœ¨çº¿ç¨‹å¯¹è±¡ï¼ˆRunnableï¼‰ä¸­å®šä¹‰äº†å…¨å±€å˜é‡ï¼Œrunæ–¹æ³•ä¼šä¿®æ”¹è¯¥å˜é‡æ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨è¯¥çº¿ç¨‹å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå…¨å±€å˜é‡çš„å€¼è¢«åŒæ—¶ä¿®æ”¹ï¼Œé€ æˆé”™è¯¯. </li><li>ThreadLocal æ˜¯JDKå¼•å…¥çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒç”¨äºè§£å†³çº¿ç¨‹é—´å…±äº«å˜é‡ï¼Œä½¿ç”¨ ThreadLocal å£°æ˜çš„å˜é‡ï¼Œå³ä½¿åœ¨çº¿ç¨‹ä¸­å±äºå…¨å±€å˜é‡ï¼Œé’ˆå¯¹æ¯ä¸ªçº¿ç¨‹æ¥è®²ï¼Œè¿™ä¸ªå˜é‡ä¹Ÿæ˜¯ç‹¬ç«‹çš„ã€‚ </li><li>volatile å˜é‡æ¯æ¬¡è¢«çº¿ç¨‹è®¿é—®æ—¶ï¼Œéƒ½å¼ºè¿«çº¿ç¨‹ä»ä¸»å†…å­˜ä¸­é‡è¯»è¯¥å˜é‡çš„æœ€æ–°å€¼ï¼Œè€Œå½“è¯¥å˜é‡å‘ç”Ÿä¿®æ”¹å˜åŒ–æ—¶ï¼Œä¹Ÿä¼šå¼ºè¿«çº¿ç¨‹å°†æœ€æ–°çš„å€¼åˆ·æ–°å›ä¸»å†…å­˜ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸åŒçš„çº¿ç¨‹éƒ½èƒ½åŠæ—¶çš„çœ‹åˆ°è¯¥å˜é‡çš„æœ€æ–°å€¼ã€‚ </li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7-å†…å­˜æ³„æ¼ä¸å†…å­˜æº¢å‡º">7. å†…å­˜æ³„æ¼ä¸å†…å­˜æº¢å‡º<a href="#7-å†…å­˜æ³„æ¼ä¸å†…å­˜æº¢å‡º" class="hash-link" aria-label="Direct link to 7. å†…å­˜æ³„æ¼ä¸å†…å­˜æº¢å‡º" title="Direct link to 7. å†…å­˜æ³„æ¼ä¸å†…å­˜æº¢å‡º">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="javaå†…å­˜å›æ”¶æœºåˆ¶">Javaå†…å­˜å›æ”¶æœºåˆ¶<a href="#javaå†…å­˜å›æ”¶æœºåˆ¶" class="hash-link" aria-label="Direct link to Javaå†…å­˜å›æ”¶æœºåˆ¶" title="Direct link to Javaå†…å­˜å›æ”¶æœºåˆ¶">â€‹</a></h4><p>ã€€ã€€ä¸è®ºå“ªç§è¯­è¨€çš„å†…å­˜åˆ†é…æ–¹å¼ï¼Œéƒ½éœ€è¦è¿”å›æ‰€åˆ†é…å†…å­˜çš„çœŸå®åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¿”å›ä¸€ä¸ªæŒ‡é’ˆåˆ°å†…å­˜å—çš„é¦–åœ°å€ã€‚Javaä¸­å¯¹è±¡æ˜¯é‡‡ç”¨ newã€åå°„ã€cloneã€ååºåˆ—åŒ–ç­‰æ–¹æ³•åˆ›å»ºçš„ï¼Œ è¿™äº›å¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯åœ¨å †ï¼ˆHeapï¼‰ä¸­åˆ†é…çš„ï¼Œæ‰€æœ‰å¯¹è±¡çš„å›æ”¶éƒ½æ˜¯ç”±Javaè™šæ‹Ÿæœºé€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶å®Œæˆçš„ã€‚GC ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾å¯¹è±¡ï¼Œä¼šç›‘æ§æ¯ä¸ªå¯¹è±¡çš„è¿è¡ŒçŠ¶å†µï¼Œå¯¹ä»–ä»¬çš„ç”³è¯·ã€å¼•ç”¨ã€è¢«å¼•ç”¨ã€èµ‹å€¼ç­‰çŠ¶å†µè¿›è¡Œç›‘æ§ï¼ŒJava ä¼šä½¿ç”¨æœ‰å‘å›¾çš„æ–¹æ³•è¿›è¡Œç®¡ç†å†…å­˜ï¼Œå®æ—¶ç›‘æ§å¯¹è±¡æ˜¯å¦å¯ä»¥è¾¾åˆ°ï¼Œå¦‚æœä¸å¯åˆ°è¾¾ï¼Œåˆ™å°±å°†å…¶å›æ”¶ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ¶ˆé™¤å¼•ç”¨å¾ªç¯çš„é—®é¢˜ã€‚</p><p>ã€€ã€€åœ¨ Java è¯­è¨€ä¸­ï¼Œåˆ¤æ–­ä¸€ä¸ªå†…å­˜ç©ºé—´æ˜¯å¦ç¬¦åˆåƒåœ¾æ”¶é›†æ ‡å‡†æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯ç»™å¯¹è±¡èµ‹äºˆäº†ç©ºå€¼ nullï¼Œä»¥ä¸‹å†æ²¡æœ‰è°ƒç”¨è¿‡ï¼Œå¦ä¸€ä¸ªæ˜¯ç»™å¯¹è±¡èµ‹äºˆäº†æ–°å€¼ï¼Œè¿™æ ·é‡æ–°åˆ†é…äº†å†…å­˜ç©ºé—´ã€‚ </p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="javaå†…å­˜æ³„éœ²å¼•èµ·åŸå› ">Javaå†…å­˜æ³„éœ²å¼•èµ·åŸå› <a href="#javaå†…å­˜æ³„éœ²å¼•èµ·åŸå› " class="hash-link" aria-label="Direct link to Javaå†…å­˜æ³„éœ²å¼•èµ·åŸå› " title="Direct link to Javaå†…å­˜æ³„éœ²å¼•èµ·åŸå› ">â€‹</a></h4><p>ã€€ã€€é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯å†…å­˜æ³„éœ²ï¼Ÿç»å¸¸å¬äººè°ˆèµ·å†…å­˜æ³„éœ²ï¼Œä½†è¦é—®ä»€ä¹ˆæ˜¯å†…å­˜æ³„éœ²ï¼Œæ²¡å‡ ä¸ªè¯´å¾—æ¸…æ¥šã€‚</p><p>ã€€ã€€<strong>å†…å­˜æ³„éœ²</strong>ï¼šæ˜¯æŒ‡æ— ç”¨å¯¹è±¡ï¼ˆä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼‰æŒç»­å æœ‰å†…å­˜æˆ–æ— ç”¨å¯¹è±¡çš„å†…å­˜å¾—ä¸åˆ°åŠæ—¶é‡Šæ”¾ï¼Œä»è€Œé€ æˆçš„å†…å­˜ç©ºé—´çš„æµªè´¹ç§°ä¸ºå†…å­˜æ³„éœ²ã€‚å†…å­˜æ³„éœ²æœ‰æ—¶ä¸ä¸¥é‡ä¸”ä¸æ˜“å¯Ÿè§‰ï¼Œè¿™æ ·å¼€å‘è€…å°±ä¸çŸ¥é“å­˜åœ¨å†…å­˜æ³„éœ²ï¼Œä½†æœ‰æ—¶ä¹Ÿä¼šå¾ˆä¸¥é‡ï¼Œä¼šæç¤º <code>Out of memory</code>ã€‚</p><p>ã€€ã€€<strong>å†…å­˜æº¢å‡º</strong>ï¼šæŒ‡ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­<strong>æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜</strong>è€Œå¯¼è‡´çš„ä¸€ç§é”™è¯¯ã€‚<strong>å†…å­˜æ³„éœ²æ˜¯å†…å­˜æº¢å‡ºçš„ä¸€ç§è¯±å› </strong>ï¼Œä¸æ˜¯å”¯ä¸€å› ç´ 
ã€€ã€€é‚£ä¹ˆï¼ŒJava å†…å­˜æ³„éœ²æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨å°±å¾ˆå¯èƒ½å‘ç”Ÿå†…å­˜æ³„éœ²ï¼Œå°½ç®¡çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å·²ç»ä¸å†éœ€è¦ï¼Œä½†æ˜¯å› ä¸ºé•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æŒæœ‰å®ƒçš„å¼•ç”¨è€Œå¯¼è‡´ä¸èƒ½è¢«å›æ”¶ï¼Œè¿™å°±æ˜¯ Java ä¸­å†…å­˜æ³„éœ²çš„å‘ç”Ÿåœºæ™¯ã€‚å…·ä½“ä¸»è¦æœ‰å¦‚ä¸‹å‡ å¤§ç±»</p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="é™æ€é›†åˆç±»">é™æ€é›†åˆç±»<a href="#é™æ€é›†åˆç±»" class="hash-link" aria-label="Direct link to é™æ€é›†åˆç±»" title="Direct link to é™æ€é›†åˆç±»">â€‹</a></h5><p>ã€€ã€€é™æ€é›†åˆç±»ï¼Œä½¿ç”¨Setã€Vectorã€HashMapç­‰é›†åˆç±»çš„æ—¶å€™éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚å½“è¿™äº›ç±»è¢«å®šä¹‰æˆé™æ€çš„æ—¶å€™ï¼Œç”±äºä»–ä»¬çš„ç”Ÿå‘½å‘¨æœŸè·Ÿåº”ç”¨ç¨‹åºä¸€æ ·é•¿ï¼Œè¿™æ—¶å€™å°±æœ‰å¯èƒ½å‘ç”Ÿå†…å­˜æ³„æ¼ã€‚ </p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ä¾‹å­ </span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">StaticTest</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Vector</span><span class="token plain"> v </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Vector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">Object</span><span class="token plain"> object </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Object</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">object</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            object </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ã€€ã€€åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¾ªç¯ç”³è¯·objectå¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°Vectorä¸­ï¼Œç„¶åè®¾ç½®object=nullï¼ˆå°±æ˜¯æ¸…é™¤æ ˆä¸­å¼•ç”¨å˜é‡objectï¼‰,ä½†æ˜¯è¿™äº›å¯¹è±¡è¢«vectorå¼•ç”¨ç€ï¼Œå¿…ç„¶ä¸èƒ½è¢«GCå›æ”¶ï¼Œé€ æˆå†…å­˜æ³„éœ²ã€‚å› æ­¤è¦é‡Šæ”¾è¿™äº›å¯¹è±¡ï¼Œè¿˜éœ€è¦å°†å®ƒä»¬ä»vectorä¸­åˆ é™¤ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°†vector=null,æ¸…ç©ºé›†åˆç±»ä¸­çš„å¼•ç”¨ã€‚ </p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ç›‘å¬å™¨">ç›‘å¬å™¨<a href="#ç›‘å¬å™¨" class="hash-link" aria-label="Direct link to ç›‘å¬å™¨" title="Direct link to ç›‘å¬å™¨">â€‹</a></h5><p>ã€€ã€€åœ¨ Java ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å’Œç›‘å¬å™¨æ‰“äº¤é“ï¼Œé€šå¸¸ä¸€ä¸ªåº”ç”¨ä¸­ä¼šç”¨åˆ°å¾ˆå¤šç›‘å¬å™¨ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ä¸€ä¸ªæ§ä»¶ï¼Œè¯¸å¦‚ <code>addXXXListener()</code> ç­‰æ–¹æ³•æ¥å¢åŠ ç›‘å¬å™¨ï¼Œä½†å¾€å¾€åœ¨é‡Šæ”¾çš„æ—¶å€™å´æ²¡æœ‰å»åˆ é™¤è¿™äº›ç›‘å¬å™¨ï¼Œä»è€Œå¢åŠ äº†å†…å­˜æ³„æ¼çš„æœºä¼šã€‚ </p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å„ç§è¿æ¥">å„ç§è¿æ¥<a href="#å„ç§è¿æ¥" class="hash-link" aria-label="Direct link to å„ç§è¿æ¥" title="Direct link to å„ç§è¿æ¥">â€‹</a></h5><p>ã€€ã€€æ¯”å¦‚æ•°æ®åº“è¿æ¥ï¼ˆdataSourse.getConnection()ï¼‰ï¼Œç½‘ç»œè¿æ¥ (socket) å’Œ IO è¿æ¥ï¼Œé™¤éå…¶æ˜¾å¼çš„è°ƒç”¨äº†å…¶close() æ–¹ æ³•å°†å…¶è¿æ¥å…³é—­ï¼Œå¦åˆ™æ˜¯ä¸ä¼šè‡ªåŠ¨è¢« GC å›æ”¶çš„ã€‚å¯¹äº Resultset å’Œ Statement å¯¹è±¡å¯ä»¥ä¸è¿›è¡Œæ˜¾å¼å›æ”¶ï¼Œä½† Connection ä¸€å®šè¦æ˜¾å¼å›æ”¶ï¼Œå› ä¸º Connection åœ¨ä»»ä½•æ—¶å€™éƒ½æ— æ³•è‡ªåŠ¨å›æ”¶ï¼Œè€Œ Connectionä¸€æ—¦å›æ”¶ï¼ŒResultset å’Œ Statement å¯¹è±¡å°±ä¼šç«‹å³ä¸º NULLã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨è¿æ¥æ± ï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†ï¼Œé™¤äº†è¦æ˜¾å¼åœ°å…³é—­è¿æ¥ï¼Œè¿˜å¿…é¡»æ˜¾å¼åœ°å…³é—­ Resultset Statement å¯¹è±¡ï¼ˆå…³é—­å…¶ä¸­ä¸€ä¸ªï¼Œå¦å¤–ä¸€ä¸ªä¹Ÿä¼šå…³é—­ï¼‰ï¼Œå¦åˆ™å°±ä¼šé€ æˆå¤§é‡çš„ Statement å¯¹è±¡æ— æ³•é‡Šæ”¾ï¼Œä»è€Œå¼•èµ·å†…å­˜æ³„æ¼ã€‚è¿™ç§æƒ…å†µä¸‹ä¸€èˆ¬éƒ½ä¼šåœ¨ try é‡Œé¢å»çš„è¿æ¥ï¼Œåœ¨ finally é‡Œé¢é‡Šæ”¾è¿æ¥ã€‚ </p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å†…éƒ¨ç±»å’Œå¤–éƒ¨æ¨¡å—ç­‰çš„å¼•ç”¨">å†…éƒ¨ç±»å’Œå¤–éƒ¨æ¨¡å—ç­‰çš„å¼•ç”¨<a href="#å†…éƒ¨ç±»å’Œå¤–éƒ¨æ¨¡å—ç­‰çš„å¼•ç”¨" class="hash-link" aria-label="Direct link to å†…éƒ¨ç±»å’Œå¤–éƒ¨æ¨¡å—ç­‰çš„å¼•ç”¨" title="Direct link to å†…éƒ¨ç±»å’Œå¤–éƒ¨æ¨¡å—ç­‰çš„å¼•ç”¨">â€‹</a></h5><p>ã€€ã€€å†…éƒ¨ç±»çš„å¼•ç”¨æ˜¯æ¯”è¾ƒå®¹æ˜“é—å¿˜çš„ä¸€ç§ï¼Œè€Œä¸”ä¸€æ—¦æ²¡é‡Šæ”¾å¯èƒ½å¯¼è‡´ä¸€ç³»åˆ—çš„åç»§ç±»å¯¹è±¡æ²¡æœ‰é‡Šæ”¾ã€‚åœ¨è°ƒç”¨å¤–éƒ¨æ¨¡å—çš„æ—¶å€™ï¼Œä¹Ÿåº”è¯¥æ³¨æ„é˜²æ­¢å†…å­˜æ³„æ¼ï¼Œå¦‚æœæ¨¡å—Aè°ƒç”¨äº†å¤–éƒ¨æ¨¡å—Bçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¦‚ï¼š <code>public void register(Object o) </code> è¿™ä¸ªæ–¹æ³•æœ‰å¯èƒ½å°±ä½¿å¾—Aæ¨¡å—æŒæœ‰ä¼ å…¥å¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™æ—¶å€™éœ€è¦æŸ¥çœ‹Bæ¨¡å—æ˜¯å¦æä¾›äº†å‡ºå»å¼•ç”¨çš„æ–¹æ³•ï¼Œè¿™ç§æƒ…å†µå®¹æ˜“å¿½ç•¥ï¼Œè€Œä¸”å‘ç”Ÿå†…å­˜æ³„æ¼çš„è¯ï¼Œè¿˜æ¯”è¾ƒéš¾å¯Ÿè§‰ã€‚ </p><h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å•ä¾‹æ¨¡å¼">å•ä¾‹æ¨¡å¼<a href="#å•ä¾‹æ¨¡å¼" class="hash-link" aria-label="Direct link to å•ä¾‹æ¨¡å¼" title="Direct link to å•ä¾‹æ¨¡å¼">â€‹</a></h5><p>ã€€ã€€å› ä¸ºå•åˆ©å¯¹è±¡åˆå§‹åŒ–åå°†åœ¨ JVM çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å­˜åœ¨ï¼Œå¦‚æœå®ƒæŒæœ‰ä¸€ä¸ªå¤–éƒ¨å¯¹è±¡çš„ï¼ˆç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒçŸ­ï¼‰å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤–éƒ¨å¯¹è±¡å°±ä¸èƒ½è¢«å›æ”¶ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚å¦‚æœè¿™ä¸ªå¤–éƒ¨å¯¹è±¡è¿˜æŒæœ‰å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå†…å­˜æ³„æ¼æ›´ä¸¥é‡ã€‚ </p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8-å¦‚ä½•å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢">8. å¦‚ä½•å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢<a href="#8-å¦‚ä½•å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="hash-link" aria-label="Direct link to 8. å¦‚ä½•å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" title="Direct link to 8. å¦‚ä½•å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢">â€‹</a></h3><p>ä½¿ç”¨å¤šçº¿ç¨‹æ—¶ï¼Œ<strong>ä¸æ˜¯å¤šçº¿ç¨‹èƒ½æå‡ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦</strong>ï¼Œä½¿ç”¨å¤šçº¿ç¨‹æ˜¯ä¸ºäº†<strong>æ›´å¥½åœ°åˆ©ç”¨ CPU èµ„æº</strong>ï¼</p><p>ç¨‹åºåœ¨æ‰§è¡Œæ—¶ï¼Œå¤šçº¿ç¨‹æ˜¯ CPU é€šè¿‡ç»™æ¯ä¸ªçº¿ç¨‹<strong>åˆ†é… CPU æ—¶é—´ç‰‡æ¥å®ç°</strong>çš„ï¼Œæ—¶é—´ç‰‡æ˜¯CPUåˆ†é…ç»™æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´ï¼Œå› æ—¶é—´ç‰‡éå¸¸çŸ­ï¼Œæ‰€ä»¥<strong>CPU é€šè¿‡ä¸åœåœ°åˆ‡æ¢çº¿ç¨‹æ‰§è¡Œ</strong>ã€‚</p><p>çº¿ç¨‹<strong>ä¸æ˜¯è¶Šå¤šå°±è¶Šå¥½</strong>çš„ï¼Œå› ä¸ºçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æœ‰<strong>æ€§èƒ½æŸè€—</strong>çš„ï¼Œåœ¨ä½¿ç”¨å¤šçº¿ç¨‹çš„åŒæ—¶éœ€è¦è€ƒè™‘å¦‚ä½•å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢</p><p>ä¸€èˆ¬æ¥è¯´æœ‰ä»¥ä¸‹å‡ æ¡ç»éªŒ</p><ul><li><strong>æ— é”å¹¶å‘ç¼–ç¨‹</strong>ã€‚å¤šçº¿ç¨‹ç«äº‰æ—¶ï¼Œä¼šå¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰€ä»¥å¤šçº¿ç¨‹å¤„ç†æ•°æ®æ—¶ï¼Œå¯ä»¥ç”¨ä¸€äº›åŠæ³•æ¥é¿å…ä½¿ç”¨é”ï¼Œå¦‚å°†æ•°æ®çš„ ID æŒ‰ç…§Hashå–æ¨¡åˆ†æ®µï¼Œä¸åŒçš„çº¿ç¨‹å¤„ç†ä¸åŒæ®µçš„æ•°æ®</li><li><strong>CASç®—æ³•</strong>ã€‚Java çš„ Atomic åŒ…ä½¿ç”¨ CAS ç®—æ³•æ¥æ›´æ–°æ•°æ®ï¼Œ<strong>è€Œä¸éœ€è¦åŠ é”</strong>ã€‚</li><li><strong>æ§åˆ¶çº¿ç¨‹æ•°é‡</strong>ã€‚é¿å…åˆ›å»ºä¸éœ€è¦çš„çº¿ç¨‹ï¼Œæ¯”å¦‚ä»»åŠ¡å¾ˆå°‘ï¼Œä½†æ˜¯åˆ›å»ºäº†å¾ˆå¤šçº¿ç¨‹æ¥å¤„ç†ï¼Œè¿™æ ·ä¼šé€ æˆå¤§é‡çº¿ç¨‹éƒ½å¤„äºç­‰å¾…çŠ¶æ€</li><li><strong>åç¨‹</strong>ã€‚åœ¨å•çº¿ç¨‹é‡Œå®ç°å¤šä»»åŠ¡çš„è°ƒåº¦ï¼Œå¹¶åœ¨å•çº¿ç¨‹é‡Œç»´æŒå¤šä¸ªä»»åŠ¡é—´çš„åˆ‡æ¢</li><li>åç¨‹å¯ä»¥çœ‹æˆæ˜¯ç”¨æˆ·æ€<strong>è‡ªç®¡ç†çš„â€œçº¿ç¨‹â€</strong>ã€‚<strong>ä¸ä¼šå‚ä¸</strong>CPUæ—¶é—´è°ƒåº¦ï¼Œæ²¡æœ‰å‡è¡¡åˆ†é…åˆ°æ—¶é—´ã€‚<strong>éæŠ¢å å¼</strong>çš„</li></ul><p>è¿˜å¯ä»¥è€ƒè™‘æˆ‘ä»¬çš„åº”ç”¨æ˜¯<strong>IOå¯†é›†å‹çš„è¿˜æ˜¯CPUå¯†é›†å‹</strong>çš„ã€‚</p><ul><li>å¦‚æœæ˜¯IOå¯†é›†å‹çš„è¯ï¼Œçº¿ç¨‹å¯ä»¥å¤šä¸€äº›ã€‚</li><li>å¦‚æœæ˜¯CPUå¯†é›†å‹çš„è¯ï¼Œçº¿ç¨‹ä¸å®œå¤ªå¤šã€‚</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9-çº¿ç¨‹é—´é€šä¿¡å’Œè¿›ç¨‹é—´é€šä¿¡">9. çº¿ç¨‹é—´é€šä¿¡å’Œè¿›ç¨‹é—´é€šä¿¡<a href="#9-çº¿ç¨‹é—´é€šä¿¡å’Œè¿›ç¨‹é—´é€šä¿¡" class="hash-link" aria-label="Direct link to 9. çº¿ç¨‹é—´é€šä¿¡å’Œè¿›ç¨‹é—´é€šä¿¡" title="Direct link to 9. çº¿ç¨‹é—´é€šä¿¡å’Œè¿›ç¨‹é—´é€šä¿¡">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="çº¿ç¨‹é—´é€šä¿¡">çº¿ç¨‹é—´é€šä¿¡<a href="#çº¿ç¨‹é—´é€šä¿¡" class="hash-link" aria-label="Direct link to çº¿ç¨‹é—´é€šä¿¡" title="Direct link to çº¿ç¨‹é—´é€šä¿¡">â€‹</a></h4><ul><li><p><strong>synchronized åŒæ­¥</strong></p><ul><li>è¿™ç§æ–¹å¼ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ â€œå…±äº«å†…å­˜â€ å¼çš„é€šä¿¡ã€‚å¤šä¸ªçº¿ç¨‹éœ€è¦è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡ï¼Œè°æ‹¿åˆ°äº†é”ï¼ˆè·å¾—äº†è®¿é—®æƒé™ï¼‰ï¼Œè°å°±å¯ä»¥æ‰§è¡Œã€‚</li></ul></li><li><p><strong>while è½®è¯¢çš„æ–¹å¼</strong></p><ul><li>åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œçº¿ç¨‹Aä¸æ–­åœ°æ”¹å˜æ¡ä»¶ï¼Œçº¿ç¨‹ ThreadB ä¸åœåœ°é€šè¿‡ while è¯­å¥æ£€æµ‹è¿™ä¸ªæ¡ä»¶<code>(list.size()==5)</code> æ˜¯å¦æˆç«‹ ï¼Œä»è€Œå®ç°äº†çº¿ç¨‹é—´çš„é€šä¿¡ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¼šæµªè´¹ CPU èµ„æºã€‚ä¹‹æ‰€ä»¥è¯´å®ƒæµªè´¹èµ„æºï¼Œæ˜¯å› ä¸º JVM è°ƒåº¦å™¨å°† CPU äº¤ç»™çº¿ç¨‹Bæ‰§è¡Œæ—¶ï¼Œå®ƒæ²¡åšå•¥â€œæœ‰ç”¨â€çš„å·¥ä½œï¼Œåªæ˜¯åœ¨ä¸æ–­åœ°æµ‹è¯•æŸä¸ªæ¡ä»¶æ˜¯å¦æˆç«‹ã€‚å°±ç±»ä¼¼äºç°å®ç”Ÿæ´»ä¸­ï¼ŒæŸä¸ªäººä¸€ç›´çœ‹ç€æ‰‹æœºå±å¹•æ˜¯å¦æœ‰ç”µè¯æ¥äº†ï¼Œè€Œä¸æ˜¯ï¼š åœ¨å¹²åˆ«çš„äº‹æƒ…ï¼Œå½“æœ‰ç”µè¯æ¥æ—¶ï¼Œå“é“ƒé€šçŸ¥TAç”µè¯æ¥äº†ã€‚</li></ul></li><li><p><strong>wait/notify æœºåˆ¶</strong></p><ul><li><p>å½“æ¡ä»¶æœªæ»¡è¶³æ—¶ï¼Œçº¿ç¨‹Aè°ƒç”¨ wait() æ”¾å¼ƒCPUï¼Œå¹¶è¿›å…¥é˜»å¡çŠ¶æ€ã€‚ï¼ˆä¸åƒ while è½®è¯¢é‚£æ ·å ç”¨ CPUï¼‰</p><p>å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹Bè°ƒç”¨ notify() é€šçŸ¥çº¿ç¨‹Aï¼Œæ‰€è°“é€šçŸ¥çº¿ç¨‹Aï¼Œå°±æ˜¯å”¤é†’çº¿ç¨‹Aï¼Œå¹¶è®©å®ƒè¿›å…¥å¯è¿è¡ŒçŠ¶æ€ã€‚</p></li></ul></li><li><p><strong>ç®¡é“é€šä¿¡</strong></p><ul><li>java.io.PipedInputStream å’Œ java.io.PipedOutputStream è¿›è¡Œé€šä¿¡</li></ul></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="è¿›ç¨‹é—´é€šä¿¡">è¿›ç¨‹é—´é€šä¿¡<a href="#è¿›ç¨‹é—´é€šä¿¡" class="hash-link" aria-label="Direct link to è¿›ç¨‹é—´é€šä¿¡" title="Direct link to è¿›ç¨‹é—´é€šä¿¡">â€‹</a></h4><ul><li><strong>ç®¡é“ï¼ˆPipeï¼‰</strong> ï¼šç®¡é“å¯ç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»è¿›ç¨‹é—´çš„é€šä¿¡ï¼Œå…è®¸ä¸€ä¸ªè¿›ç¨‹å’Œå¦ä¸€ä¸ªä¸å®ƒæœ‰å…±åŒç¥–å…ˆçš„è¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚</li><li><strong>å‘½åç®¡é“ï¼ˆnamed pipeï¼‰</strong> ï¼šå‘½åç®¡é“å…‹æœäº†ç®¡é“æ²¡æœ‰åå­—çš„é™åˆ¶ï¼Œå› æ­¤ï¼Œé™¤å…·æœ‰ç®¡é“æ‰€å…·æœ‰çš„åŠŸèƒ½å¤–ï¼Œå®ƒè¿˜å…è®¸æ— äº²ç¼˜å…³ ç³» è¿›ç¨‹é—´çš„é€šä¿¡ã€‚å‘½åç®¡é“åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æœ‰å¯¹åº”çš„æ–‡ä»¶åã€‚å‘½åç®¡é“é€šè¿‡å‘½ä»¤mkfifoæˆ–ç³»ç»Ÿè°ƒç”¨mkfifoæ¥åˆ›å»ºã€‚</li><li><strong>ä¿¡å·ï¼ˆSignalï¼‰</strong> ï¼šä¿¡å·æ˜¯æ¯”è¾ƒå¤æ‚çš„é€šä¿¡æ–¹å¼ï¼Œç”¨äºé€šçŸ¥æ¥å—è¿›ç¨‹æœ‰æŸç§äº‹ä»¶å‘ç”Ÿï¼Œé™¤äº†ç”¨äºè¿›ç¨‹é—´é€šä¿¡å¤–ï¼Œè¿›ç¨‹è¿˜å¯ä»¥å‘é€ ä¿¡å·ç»™è¿›ç¨‹æœ¬èº«ï¼›Linuxé™¤äº†æ”¯æŒUnixæ—©æœŸä¿¡å·è¯­ä¹‰å‡½æ•°sigalå¤–ï¼Œè¿˜æ”¯æŒè¯­ä¹‰ç¬¦åˆPosix.1æ ‡å‡†çš„ä¿¡å·å‡½æ•°sigactionï¼ˆå®é™…ä¸Šï¼Œè¯¥å‡½æ•°æ˜¯åŸºäºBSDçš„ï¼ŒBSDä¸ºäº†å®ç°å¯é ä¿¡å·æœºåˆ¶ï¼Œåˆèƒ½å¤Ÿç»Ÿä¸€å¯¹å¤–æ¥å£ï¼Œç”¨sigactionå‡½æ•°é‡æ–°å®ç°äº†signalå‡½æ•°ï¼‰ã€‚</li><li><strong>æ¶ˆæ¯ï¼ˆMessageï¼‰é˜Ÿåˆ—</strong> ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ¶ˆæ¯çš„é“¾æ¥è¡¨ï¼ŒåŒ…æ‹¬Posixæ¶ˆæ¯é˜Ÿåˆ—system Væ¶ˆæ¯é˜Ÿåˆ—ã€‚æœ‰è¶³å¤Ÿæƒé™çš„è¿›ç¨‹å¯ä»¥å‘é˜Ÿåˆ—ä¸­æ·»åŠ æ¶ˆæ¯ï¼Œè¢«èµ‹äºˆè¯»æƒé™çš„è¿›ç¨‹åˆ™å¯ä»¥è¯»èµ°é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚æ¶ˆæ¯é˜Ÿåˆ—å…‹æœäº†ä¿¡å·æ‰¿è½½ä¿¡æ¯é‡å°‘ï¼Œç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­—èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç¼º</li><li><strong>å…±äº«å†…å­˜</strong> ï¼šä½¿å¾—å¤šä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®åŒä¸€å—å†…å­˜ç©ºé—´ï¼Œæ˜¯æœ€å¿«çš„å¯ç”¨IPCå½¢å¼ã€‚æ˜¯é’ˆå¯¹å…¶ä»–é€šä¿¡æœºåˆ¶è¿è¡Œæ•ˆç‡è¾ƒä½è€Œè®¾è®¡çš„ã€‚å¾€å¾€ä¸å…¶å®ƒé€šä¿¡æœºåˆ¶ï¼Œå¦‚ä¿¡å·é‡ç»“åˆä½¿ç”¨ï¼Œæ¥è¾¾åˆ°è¿›ç¨‹é—´çš„åŒæ­¥åŠäº’æ–¥ã€‚</li><li><strong>å†…å­˜æ˜ å°„ï¼ˆmapped memoryï¼‰</strong> ï¼šå†…å­˜æ˜ å°„å…è®¸ä»»ä½•å¤šä¸ªè¿›ç¨‹é—´é€šä¿¡ï¼Œæ¯ä¸€ä¸ªä½¿ç”¨è¯¥æœºåˆ¶çš„è¿›ç¨‹é€šè¿‡æŠŠä¸€ä¸ªå…±äº«çš„æ–‡ä»¶æ˜ å°„åˆ°è‡ªå·±çš„è¿›ç¨‹åœ°å€ç©ºé—´æ¥å®ç°å®ƒã€‚</li><li><strong>ä¿¡å·é‡ï¼ˆsemaphoreï¼‰</strong> ï¼šä¸»è¦ä½œä¸ºè¿›ç¨‹é—´ä»¥åŠåŒä¸€è¿›ç¨‹ä¸åŒçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æ‰‹æ®µã€‚</li><li><strong>å¥—æ¥å£ï¼ˆSocketï¼‰</strong> ï¼šæ›´ä¸ºä¸€èˆ¬çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œå¯ç”¨äºä¸åŒæœºå™¨ä¹‹é—´çš„è¿›ç¨‹é—´é€šä¿¡ã€‚èµ·åˆæ˜¯ç”±Unixç³»ç»Ÿçš„BSDåˆ†æ”¯å¼€å‘å‡ºæ¥çš„ï¼Œä½†ç°åœ¨ä¸€èˆ¬å¯ä»¥ç§»æ¤åˆ°å…¶å®ƒç±»Unixç³»ç»Ÿä¸Šï¼šlinuxå’ŒSystem Vçš„å˜ç§éƒ½æ”¯æŒå¥—æ¥å­—ã€‚</li></ul><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="https://www.tuhd.top/2017/08/04/2017-08-04-threadandprocess/" target="_blank" rel="noopener noreferrer">Javaçº¿ç¨‹ä¸çº¿ç¨‹ã€è¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´é€šä¿¡æ–¹å¼ | ç†æƒ³æ‘ | å± æ­é•çš„åšå®¢</a></li><li><a href="https://www.cnblogs.com/hapjin/p/5492619.html" target="_blank" rel="noopener noreferrer">JAVAå¤šçº¿ç¨‹ä¹‹çº¿ç¨‹é—´çš„é€šä¿¡æ–¹å¼ - hapjin - åšå®¢å›­</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="10-ä»€ä¹ˆæ˜¯åŒæ­¥å’Œå¼‚æ­¥é˜»å¡å’Œéé˜»å¡">10. ä»€ä¹ˆæ˜¯åŒæ­¥å’Œå¼‚æ­¥ï¼Œé˜»å¡å’Œéé˜»å¡ï¼Ÿ<a href="#10-ä»€ä¹ˆæ˜¯åŒæ­¥å’Œå¼‚æ­¥é˜»å¡å’Œéé˜»å¡" class="hash-link" aria-label="Direct link to 10. ä»€ä¹ˆæ˜¯åŒæ­¥å’Œå¼‚æ­¥ï¼Œé˜»å¡å’Œéé˜»å¡ï¼Ÿ" title="Direct link to 10. ä»€ä¹ˆæ˜¯åŒæ­¥å’Œå¼‚æ­¥ï¼Œé˜»å¡å’Œéé˜»å¡ï¼Ÿ">â€‹</a></h3><blockquote><p>åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯æ¶ˆæ¯é€šä¿¡æœºåˆ¶ (synchronous communication/ asynchronous communication)</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="åŒæ­¥">åŒæ­¥<a href="#åŒæ­¥" class="hash-link" aria-label="Direct link to åŒæ­¥" title="Direct link to åŒæ­¥">â€‹</a></h4><ul><li>åœ¨å‘å‡ºä¸€ä¸ªåŒæ­¥è°ƒç”¨æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨å°±ä¸è¿”å›ã€‚</li><li>ä¾‹å¦‚ï¼šæŒ‰ä¸‹ç”µé¥­é”…çš„ç…®é¥­æŒ‰é’®ï¼Œç„¶åç­‰å¾…é¥­ç…®å¥½ï¼ŒæŠŠé¥­ç››å‡ºæ¥ï¼Œç„¶åå†å»ç‚’èœã€‚</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å¼‚æ­¥">å¼‚æ­¥<a href="#å¼‚æ­¥" class="hash-link" aria-label="Direct link to å¼‚æ­¥" title="Direct link to å¼‚æ­¥">â€‹</a></h4><ul><li>åœ¨å‘å‡ºä¸€ä¸ªå¼‚æ­¥è°ƒç”¨åï¼Œè°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœï¼Œè¯¥è°ƒç”¨å°±è¿”å›äº†ã€‚</li><li>ä¾‹å¦‚ï¼šæŒ‰ä¸‹ç”µé’®é”…çš„ç…®é¥­æŒ‰é’®ï¼Œç›´æ¥å»ç‚’èœæˆ–è€…åšåˆ«çš„äº‹æƒ…ï¼Œå½“ç”µé¥­é”…â€œæ»´æ»´æ»´â€å“çš„æ—¶å€™ï¼Œå†å›å»æŠŠé¥­ç››å‡ºæ¥ã€‚æ˜¾ç„¶ï¼Œå¼‚æ­¥å¼ç¼–ç¨‹è¦æ¯”åŒæ­¥å¼ç¼–ç¨‹é«˜æ•ˆå¾—å¤šã€‚</li></ul><blockquote><p>é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼ˆæ¶ˆæ¯ï¼Œè¿”å›å€¼ï¼‰æ—¶çš„çŠ¶æ€.</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="é˜»å¡">é˜»å¡<a href="#é˜»å¡" class="hash-link" aria-label="Direct link to é˜»å¡" title="Direct link to é˜»å¡">â€‹</a></h4><ul><li>è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚</li><li>ä¾‹å­ï¼šä½ æ‰“ç”µè¯é—®ä¹¦åº—è€æ¿æœ‰æ²¡æœ‰ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿã€‹è¿™æœ¬ä¹¦ï¼Œä½ å¦‚æœæ˜¯é˜»å¡å¼è°ƒç”¨ï¼Œä½ ä¼šä¸€ç›´æŠŠè‡ªå·±â€œæŒ‚èµ·â€ï¼Œç›´åˆ°å¾—åˆ°è¿™æœ¬ä¹¦æœ‰æ²¡æœ‰çš„ç»“æœ </li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="éé˜»å¡">éé˜»å¡<a href="#éé˜»å¡" class="hash-link" aria-label="Direct link to éé˜»å¡" title="Direct link to éé˜»å¡">â€‹</a></h4><ul><li>åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚</li><li>ä¾‹å­ï¼šä½ æ‰“ç”µè¯é—®ä¹¦åº—è€æ¿æœ‰æ²¡æœ‰ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿã€‹è¿™æœ¬ä¹¦ï¼Œä½ ä¸ç®¡è€æ¿æœ‰æ²¡æœ‰å‘Šè¯‰ä½ ï¼Œä½ è‡ªå·±å…ˆä¸€è¾¹å»ç©äº†ï¼Œ å½“ç„¶ä½ ä¹Ÿè¦å¶å°”è¿‡å‡ åˆ†é’Ÿcheckä¸€ä¸‹è€æ¿æœ‰æ²¡æœ‰è¿”å›ç»“æœã€‚ </li></ul><p>å‚è€ƒèµ„æ–™ï¼š</p><ul><li><a href="https://juejin.im/entry/58ae4636b123db0052b1caf8" target="_blank" rel="noopener noreferrer">æ·±å…¥ç†è§£å¹¶å‘ / å¹¶è¡Œï¼Œé˜»å¡ / éé˜»å¡ï¼ŒåŒæ­¥ / å¼‚æ­¥ - åç«¯ - æ˜é‡‘</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11-javaä¸­çš„é”">11. Javaä¸­çš„é”<a href="#11-javaä¸­çš„é”" class="hash-link" aria-label="Direct link to 11. Javaä¸­çš„é”" title="Direct link to 11. Javaä¸­çš„é”">â€‹</a></h3><p>æœ¬å°ç»“å‚è€ƒï¼š<a href="http://wiki.jikexueyuan.com/project/java-concurrent/locks-in-java.html" target="_blank" rel="noopener noreferrer">Java ä¸­çš„é” - Java å¹¶å‘æ€§å’Œå¤šçº¿ç¨‹ - æå®¢å­¦é™¢Wiki</a></p><p>ã€€ã€€é”åƒ synchronized åŒæ­¥å—ä¸€æ ·ï¼Œæ˜¯ä¸€ç§çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼Œä½†æ¯” Java ä¸­çš„ synchronized åŒæ­¥å—æ›´å¤æ‚ã€‚å› ä¸ºé”ï¼ˆä»¥åŠå…¶å®ƒæ›´é«˜çº§çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼‰æ˜¯ç”± synchronized åŒæ­¥å—çš„æ–¹å¼å®ç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜ä¸èƒ½å®Œå…¨æ‘†è„± synchronized å…³é”®å­—ï¼ˆè¯‘è€…æ³¨ï¼šè¿™è¯´çš„æ˜¯ Java 5 ä¹‹å‰çš„æƒ…å†µï¼‰ã€‚</p><p>ã€€ã€€è‡ª Java 5 å¼€å§‹ï¼Œjava.util.concurrent.locks åŒ…ä¸­åŒ…å«äº†ä¸€äº›é”çš„å®ç°ï¼Œå› æ­¤ä½ ä¸ç”¨å»å®ç°è‡ªå·±çš„é”äº†ã€‚ä½†æ˜¯ä½ ä»ç„¶éœ€è¦å»äº†è§£æ€æ ·ä½¿ç”¨è¿™äº›é”ï¼Œä¸”äº†è§£è¿™äº›å®ç°èƒŒåçš„ç†è®ºä¹Ÿæ˜¯å¾ˆæœ‰ç”¨å¤„çš„ã€‚å¯ä»¥å‚è€ƒæˆ‘å¯¹ java.util.concurrent.locks.Lock çš„ä»‹ç»ï¼Œä»¥äº†è§£æ›´å¤šå…³äºé”çš„ä¿¡æ¯ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ä¸€ä¸ªç®€å•çš„é”">ä¸€ä¸ªç®€å•çš„é”<a href="#ä¸€ä¸ªç®€å•çš„é”" class="hash-link" aria-label="Direct link to ä¸€ä¸ªç®€å•çš„é”" title="Direct link to ä¸€ä¸ªç®€å•çš„é”">â€‹</a></h4><p>è®©æˆ‘ä»¬ä» java ä¸­çš„ä¸€ä¸ªåŒæ­¥å—å¼€å§‹ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Counter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> count </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">inc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¯ä»¥çœ‹åˆ°åœ¨ inc()æ–¹æ³•ä¸­æœ‰ä¸€ä¸ª synchronized(this)ä»£ç å—ã€‚è¯¥ä»£ç å—å¯ä»¥ä¿è¯åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œ return ++countã€‚è™½ç„¶åœ¨ synchronized çš„åŒæ­¥å—ä¸­çš„ä»£ç å¯ä»¥æ›´åŠ å¤æ‚ï¼Œä½†æ˜¯++count è¿™ç§ç®€å•çš„æ“ä½œå·²ç»è¶³ä»¥è¡¨è¾¾å‡ºçº¿ç¨‹åŒæ­¥çš„æ„æ€ã€‚</p><p>ä»¥ä¸‹çš„ Counter ç±»ç”¨ Lock ä»£æ›¿ synchronized è¾¾åˆ°äº†åŒæ ·çš„ç›®çš„ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Counter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Lock</span><span class="token plain"> lock </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> count </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">inc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> newCount </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token plain">count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">unlock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> newCount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>lock()æ–¹æ³•ä¼šå¯¹ Lock å®ä¾‹å¯¹è±¡è¿›è¡ŒåŠ é”ï¼Œå› æ­¤æ‰€æœ‰å¯¹è¯¥å¯¹è±¡è°ƒç”¨ lock()æ–¹æ³•çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è¯¥ Lock å¯¹è±¡çš„ unlock()æ–¹æ³•è¢«è°ƒç”¨ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ª Lock ç±»çš„ç®€å•å®ç°ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Counter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> isLocked </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">isLocked</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">wait</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        isLocked </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">unlock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        isLocked </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">notify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ³¨æ„å…¶ä¸­çš„ while(isLocked) å¾ªç¯ï¼Œå®ƒåˆè¢«å«åš â€œ<strong>è‡ªæ—‹é”</strong>â€ã€‚è‡ªæ—‹é”ä»¥åŠ wait() å’Œ notify() æ–¹æ³•åœ¨<a href="http://wiki.jikexueyuan.com/project/java-concurrent/thread-communication.html" target="_blank" rel="noopener noreferrer">çº¿ç¨‹é€šä¿¡</a>è¿™ç¯‡æ–‡ç« ä¸­æœ‰æ›´åŠ è¯¦ç»†çš„ä»‹ç»ã€‚å½“ isLocked ä¸º true æ—¶ï¼Œè°ƒç”¨ lock() çš„çº¿ç¨‹åœ¨ wait() è°ƒç”¨ä¸Šé˜»å¡ç­‰å¾…ã€‚ä¸ºé˜²æ­¢è¯¥çº¿ç¨‹æ²¡æœ‰æ”¶åˆ° notify() è°ƒç”¨ä¹Ÿä» wait() ä¸­è¿”å›ï¼ˆä¹Ÿç§°ä½œ<a href="http://wiki.jikexueyuan.com/project/java-concurrent/race-conditions-and-critical-sections.html" target="_blank" rel="noopener noreferrer">è™šå‡å”¤é†’</a>ï¼‰ï¼Œè¿™ä¸ªçº¿ç¨‹ä¼šé‡æ–°å»æ£€æŸ¥ isLocked æ¡ä»¶ä»¥å†³å®šå½“å‰æ˜¯å¦å¯ä»¥å®‰å…¨åœ°ç»§ç»­æ‰§è¡Œè¿˜æ˜¯éœ€è¦é‡æ–°ä¿æŒç­‰å¾…ï¼Œè€Œä¸æ˜¯è®¤ä¸ºçº¿ç¨‹è¢«å”¤é†’äº†å°±å¯ä»¥å®‰å…¨åœ°ç»§ç»­æ‰§è¡Œäº†ã€‚å¦‚æœ isLocked ä¸º falseï¼Œå½“å‰çº¿ç¨‹ä¼šé€€å‡º while(isLocked) å¾ªç¯ï¼Œå¹¶å°† isLocked è®¾å› trueï¼Œè®©å…¶å®ƒæ­£åœ¨è°ƒç”¨ lock() æ–¹æ³•çš„çº¿ç¨‹èƒ½å¤Ÿåœ¨ Lock å®ä¾‹ä¸ŠåŠ é”ã€‚</p><p>å½“çº¿ç¨‹å®Œæˆäº†<a href="http://wiki.jikexueyuan.com/project/java-concurrent/race-conditions-and-critical-sections.html" target="_blank" rel="noopener noreferrer">ä¸´ç•ŒåŒº</a>ï¼ˆä½äº lock()å’Œ unlock()ä¹‹é—´ï¼‰ä¸­çš„ä»£ç ï¼Œå°±ä¼šè°ƒç”¨ unlock()ã€‚æ‰§è¡Œ unlock()ä¼šé‡æ–°å°† isLocked è®¾ç½®ä¸º falseï¼Œå¹¶ä¸”é€šçŸ¥ï¼ˆå”¤é†’ï¼‰å…¶ä¸­ä¸€ä¸ªï¼ˆè‹¥æœ‰çš„è¯ï¼‰åœ¨ lock()æ–¹æ³•ä¸­è°ƒç”¨äº† wait()å‡½æ•°è€Œå¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="é”çš„å¯é‡å…¥æ€§">é”çš„å¯é‡å…¥æ€§<a href="#é”çš„å¯é‡å…¥æ€§" class="hash-link" aria-label="Direct link to é”çš„å¯é‡å…¥æ€§" title="Direct link to é”çš„å¯é‡å…¥æ€§">â€‹</a></h4><p>Java ä¸­çš„ synchronized åŒæ­¥å—æ˜¯å¯é‡å…¥çš„ã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ª Java çº¿ç¨‹è¿›å…¥äº†ä»£ç ä¸­çš„ synchronized åŒæ­¥å—ï¼Œå¹¶å› æ­¤è·å¾—äº†è¯¥åŒæ­¥å—ä½¿ç”¨çš„åŒæ­¥å¯¹è±¡å¯¹åº”çš„ç®¡ç¨‹ä¸Šçš„é”ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥è¿›å…¥ç”±åŒä¸€ä¸ªç®¡ç¨‹å¯¹è±¡æ‰€åŒæ­¥çš„å¦ä¸€ä¸ª java ä»£ç å—ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Reentrant</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">outer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">inner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">inner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//do something</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ³¨æ„ outer()å’Œ inner()éƒ½è¢«å£°æ˜ä¸º synchronizedï¼Œè¿™åœ¨ Java ä¸­å’Œ synchronized(this) å—ç­‰æ•ˆã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº† outer()ï¼Œåœ¨ outer()é‡Œè°ƒç”¨ inner()å°±æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•ï¼ˆä»£ç å—ï¼‰éƒ½ç”±åŒä¸€ä¸ªç®¡ç¨‹å¯¹è±¡ï¼ˆâ€thisâ€) æ‰€åŒæ­¥ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹å·²ç»æ‹¥æœ‰äº†ä¸€ä¸ªç®¡ç¨‹å¯¹è±¡ä¸Šçš„é”ï¼Œé‚£ä¹ˆå®ƒå°±æœ‰æƒè®¿é—®è¢«è¿™ä¸ªç®¡ç¨‹å¯¹è±¡åŒæ­¥çš„æ‰€æœ‰ä»£ç å—ã€‚è¿™å°±æ˜¯å¯é‡å…¥ã€‚çº¿ç¨‹å¯ä»¥è¿›å…¥ä»»ä½•ä¸€ä¸ªå®ƒå·²ç»æ‹¥æœ‰çš„é”æ‰€åŒæ­¥ç€çš„ä»£ç å—ã€‚</p><p>å‰é¢ç»™å‡ºçš„é”å®ç°ä¸æ˜¯å¯é‡å…¥çš„ã€‚å¦‚æœæˆ‘ä»¬åƒä¸‹é¢è¿™æ ·é‡å†™ Reentrant ç±»ï¼Œå½“çº¿ç¨‹è°ƒç”¨ outer() æ—¶ï¼Œä¼šåœ¨ inner()æ–¹æ³•çš„ lock.lock() å¤„é˜»å¡ä½ã€‚</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Reentrant2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Lock</span><span class="token plain"> lock </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">outer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">inner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">unlock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">inner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//do something</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">unlock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è°ƒç”¨ outer() çš„çº¿ç¨‹é¦–å…ˆä¼šé”ä½ Lock å®ä¾‹ï¼Œç„¶åç»§ç»­è°ƒç”¨ inner()ã€‚inner()æ–¹æ³•ä¸­è¯¥çº¿ç¨‹å°†å†ä¸€æ¬¡å°è¯•é”ä½ Lock å®ä¾‹ï¼Œç»“æœè¯¥åŠ¨ä½œä¼šå¤±è´¥ï¼ˆä¹Ÿå°±æ˜¯è¯´è¯¥çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼‰ï¼Œå› ä¸ºè¿™ä¸ª Lock å®ä¾‹å·²ç»åœ¨ outer()æ–¹æ³•ä¸­è¢«é”ä½äº†ã€‚</p><p>ä¸¤æ¬¡ lock()ä¹‹é—´æ²¡æœ‰è°ƒç”¨ unlock()ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨ lock å°±ä¼šé˜»å¡ï¼Œçœ‹è¿‡ lock() å®ç°åï¼Œä¼šå‘ç°åŸå› å¾ˆæ˜æ˜¾ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> isLocked </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">isLocked</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">wait</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        isLocked </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦è¢«å…è®¸é€€å‡º lock()æ–¹æ³•æ˜¯ç”± while å¾ªç¯ï¼ˆè‡ªæ—‹é”ï¼‰ä¸­çš„æ¡ä»¶å†³å®šçš„ã€‚å½“å‰çš„åˆ¤æ–­æ¡ä»¶æ˜¯åªæœ‰å½“ isLocked ä¸º false æ—¶ lock æ“ä½œæ‰è¢«å…è®¸ï¼Œè€Œæ²¡æœ‰è€ƒè™‘æ˜¯å“ªä¸ªçº¿ç¨‹é”ä½äº†å®ƒã€‚</p><p>ä¸ºäº†è®©è¿™ä¸ª Lock ç±»å…·æœ‰å¯é‡å…¥æ€§ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒåšä¸€ç‚¹å°çš„æ”¹åŠ¨ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">boolean</span><span class="token plain"> isLocked </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain">  lockedBy </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> lockedCount </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">InterruptedException</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token plain"> callingThread </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">currentThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">isLocked </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> lockedBy </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> callingThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">wait</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        isLocked </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lockedCount</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lockedBy </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> callingThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">synchronized</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">unlock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">curentThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lockedBy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            lockedCount</span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lockedCount </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                isLocked </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token function" style="color:rgb(130, 170, 255)">notify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ³¨æ„åˆ°ç°åœ¨çš„ while å¾ªç¯ï¼ˆè‡ªæ—‹é”ï¼‰ä¹Ÿè€ƒè™‘åˆ°äº†å·²é”ä½è¯¥ Lock å®ä¾‹çš„çº¿ç¨‹ã€‚å¦‚æœå½“å‰çš„é”å¯¹è±¡æ²¡æœ‰è¢«åŠ é”(isLocked = false)ï¼Œæˆ–è€…å½“å‰è°ƒç”¨çº¿ç¨‹å·²ç»å¯¹è¯¥ Lock å®ä¾‹åŠ äº†é”ï¼Œé‚£ä¹ˆ while å¾ªç¯å°±ä¸ä¼šè¢«æ‰§è¡Œï¼Œè°ƒç”¨ lock()çš„çº¿ç¨‹å°±å¯ä»¥é€€å‡ºè¯¥æ–¹æ³•ï¼ˆè¯‘è€…æ³¨ï¼šâ€œè¢«å…è®¸é€€å‡ºè¯¥æ–¹æ³•â€åœ¨å½“å‰è¯­ä¹‰ä¸‹å°±æ˜¯æŒ‡ä¸ä¼šè°ƒç”¨ wait()è€Œå¯¼è‡´é˜»å¡ï¼‰ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬éœ€è¦è®°å½•åŒä¸€ä¸ªçº¿ç¨‹é‡å¤å¯¹ä¸€ä¸ªé”å¯¹è±¡åŠ é”çš„æ¬¡æ•°ã€‚å¦åˆ™ï¼Œä¸€æ¬¡ unblock()è°ƒç”¨å°±ä¼šè§£é™¤æ•´ä¸ªé”ï¼Œå³ä½¿å½“å‰é”å·²ç»è¢«åŠ é”è¿‡å¤šæ¬¡ã€‚åœ¨ unlock()è°ƒç”¨æ²¡æœ‰è¾¾åˆ°å¯¹åº” lock()è°ƒç”¨çš„æ¬¡æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›é”è¢«è§£é™¤ã€‚</p><p>ç°åœ¨è¿™ä¸ª Lock ç±»å°±æ˜¯å¯é‡å…¥çš„äº†ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="é”çš„å…¬å¹³æ€§">é”çš„å…¬å¹³æ€§<a href="#é”çš„å…¬å¹³æ€§" class="hash-link" aria-label="Direct link to é”çš„å…¬å¹³æ€§" title="Direct link to é”çš„å…¬å¹³æ€§">â€‹</a></h4><p>Java çš„ synchronized å—å¹¶ä¸ä¿è¯å°è¯•è¿›å…¥å®ƒä»¬çš„çº¿ç¨‹çš„é¡ºåºã€‚å› æ­¤ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹ä¸æ–­ç«äº‰è®¿é—®ç›¸åŒçš„ synchronized åŒæ­¥å—ï¼Œå°±å­˜åœ¨ä¸€ç§é£é™©ï¼Œå…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æ°¸è¿œä¹Ÿå¾—ä¸åˆ°è®¿é—®æƒ â€”â€” ä¹Ÿå°±æ˜¯è¯´è®¿é—®æƒæ€»æ˜¯åˆ†é…ç»™äº†å…¶å®ƒçº¿ç¨‹ã€‚è¿™ç§æƒ…å†µè¢«ç§°ä½œçº¿ç¨‹é¥¥é¥¿ã€‚ä¸ºäº†é¿å…è¿™ç§é—®é¢˜ï¼Œé”éœ€è¦å®ç°å…¬å¹³æ€§ã€‚æœ¬æ–‡æ‰€å±•ç°çš„é”åœ¨å†…éƒ¨æ˜¯ç”¨ synchronized åŒæ­¥å—å®ç°çš„ï¼Œå› æ­¤å®ƒä»¬ä¹Ÿä¸ä¿è¯å…¬å¹³æ€§ã€‚<a href="http://wiki.jikexueyuan.com/project/java-concurrent/starvation-and-fairness.html" target="_blank" rel="noopener noreferrer">é¥¥é¥¿å’Œå…¬å¹³</a>ä¸­æœ‰æ›´å¤šå…³äºè¯¥å†…å®¹çš„è®¨è®ºã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="åœ¨-finally-è¯­å¥ä¸­è°ƒç”¨-unlock">åœ¨ finally è¯­å¥ä¸­è°ƒç”¨ unlock()<a href="#åœ¨-finally-è¯­å¥ä¸­è°ƒç”¨-unlock" class="hash-link" aria-label="Direct link to åœ¨ finally è¯­å¥ä¸­è°ƒç”¨ unlock()" title="Direct link to åœ¨ finally è¯­å¥ä¸­è°ƒç”¨ unlock()">â€‹</a></h4><p>å¦‚æœç”¨ Lock æ¥ä¿æŠ¤ä¸´ç•ŒåŒºï¼Œå¹¶ä¸”ä¸´ç•ŒåŒºæœ‰å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆåœ¨ finally è¯­å¥ä¸­è°ƒç”¨ unlock()å°±æ˜¾å¾—éå¸¸é‡è¦äº†ã€‚è¿™æ ·å¯ä»¥ä¿è¯è¿™ä¸ªé”å¯¹è±¡å¯ä»¥è¢«è§£é”ä»¥ä¾¿å…¶å®ƒçº¿ç¨‹èƒ½ç»§ç»­å¯¹å…¶åŠ é”ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//do critical section code,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//which may throw exception</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">unlock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¿™ä¸ªç®€å•çš„ç»“æ„å¯ä»¥ä¿è¯å½“ä¸´ç•ŒåŒºæŠ›å‡ºå¼‚å¸¸æ—¶ Lock å¯¹è±¡å¯ä»¥è¢«è§£é”ã€‚å¦‚æœä¸æ˜¯åœ¨ finally è¯­å¥ä¸­è°ƒç”¨çš„ unlock()ï¼Œå½“ä¸´ç•ŒåŒºæŠ›å‡ºå¼‚å¸¸æ—¶ï¼ŒLock å¯¹è±¡å°†æ°¸è¿œåœç•™åœ¨è¢«é”ä½çš„çŠ¶æ€ï¼Œè¿™ä¼šå¯¼è‡´å…¶å®ƒæ‰€æœ‰åœ¨è¯¥ Lock å¯¹è±¡ä¸Šè°ƒç”¨ lock()çš„çº¿ç¨‹ä¸€ç›´é˜»å¡ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12-å¹¶å‘åŒ…jucä¸‹é¢éƒ½ç”¨è¿‡ä»€ä¹ˆ">12. å¹¶å‘åŒ…(J.U.C)ä¸‹é¢ï¼Œéƒ½ç”¨è¿‡ä»€ä¹ˆ<a href="#12-å¹¶å‘åŒ…jucä¸‹é¢éƒ½ç”¨è¿‡ä»€ä¹ˆ" class="hash-link" aria-label="Direct link to 12. å¹¶å‘åŒ…(J.U.C)ä¸‹é¢ï¼Œéƒ½ç”¨è¿‡ä»€ä¹ˆ" title="Direct link to 12. å¹¶å‘åŒ…(J.U.C)ä¸‹é¢ï¼Œéƒ½ç”¨è¿‡ä»€ä¹ˆ">â€‹</a></h3><ul><li>concurrentä¸‹é¢çš„åŒ… <ul><li>Executor  ç”¨æ¥åˆ›å»ºçº¿ç¨‹æ± ï¼Œåœ¨å®ç°Callableæ¥å£æ—¶ï¼Œæ·»åŠ çº¿ç¨‹ã€‚ </li><li>FeatureTask æ­¤ FutureTask çš„ get æ–¹æ³•æ‰€è¿”å›çš„ç»“æœç±»å‹ã€‚ </li><li>TimeUnit </li><li>Semaphore  </li><li>LinkedBlockingQueue  </li></ul></li><li>æ‰€ç”¨è¿‡çš„ç±» <ul><li>Executor   </li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13-ä»volatileè¯´åˆ°iåŸå­æ“ä½œçº¿ç¨‹å®‰å…¨é—®é¢˜">13. ä»volatileè¯´åˆ°,i++åŸå­æ“ä½œ,çº¿ç¨‹å®‰å…¨é—®é¢˜<a href="#13-ä»volatileè¯´åˆ°iåŸå­æ“ä½œçº¿ç¨‹å®‰å…¨é—®é¢˜" class="hash-link" aria-label="Direct link to 13. ä»volatileè¯´åˆ°,i++åŸå­æ“ä½œ,çº¿ç¨‹å®‰å…¨é—®é¢˜" title="Direct link to 13. ä»volatileè¯´åˆ°,i++åŸå­æ“ä½œ,çº¿ç¨‹å®‰å…¨é—®é¢˜">â€‹</a></h3><p>ä» volatile è¯´åˆ°ï¼Œi++åŸå­æ“ä½œï¼Œçº¿ç¨‹å®‰å…¨é—®é¢˜ - CSDNåšå®¢
<a href="https://blog.csdn.net/zbw18297786698/article/details/53420780" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/zbw18297786698/article/details/53420780</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™<a href="#å‚è€ƒèµ„æ–™" class="hash-link" aria-label="Direct link to å‚è€ƒèµ„æ–™" title="Direct link to å‚è€ƒèµ„æ–™">â€‹</a></h2><ul><li><p><a href="https://github.com/CyC2018/Interview-Notebook/blob/master/notes/Java%20%E5%B9%B6%E5%8F%91.md" target="_blank" rel="noopener noreferrer">Interview-Notebook/Java å¹¶å‘.md at master Â· CyC2018/Interview-Notebook</a></p></li><li><p><a href="http://wiki.jikexueyuan.com/project/java-concurrency/" target="_blank" rel="noopener noreferrer">Java å¹¶å‘ç¼–ç¨‹-æå®¢å­¦é™¢Wiki</a></p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="æ›´æ–°æ—¥å¿—">æ›´æ–°æ—¥å¿—<a href="#æ›´æ–°æ—¥å¿—" class="hash-link" aria-label="Direct link to æ›´æ–°æ—¥å¿—" title="Direct link to æ›´æ–°æ—¥å¿—">â€‹</a></h2><ul><li>2018/9/2 v3.0</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/frank-lam/frankfeekr-notes/tree/master/docs/02.backend/java/03-Javaå¹¶å‘ç¼–ç¨‹.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/backend/java/Javaé›†åˆæ¡†æ¶"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Java é›†åˆæ¡†æ¶</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/backend/java/Java-IO"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Java IO</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#å‰è¨€" class="table-of-contents__link toc-highlight">å‰è¨€</a></li><li><a href="#ç¬¬ä¸€éƒ¨åˆ†å¹¶å‘ç¼–ç¨‹" class="table-of-contents__link toc-highlight">ç¬¬ä¸€éƒ¨åˆ†ï¼šå¹¶å‘ç¼–ç¨‹</a><ul><li><a href="#1-çº¿ç¨‹çŠ¶æ€è½¬æ¢" class="table-of-contents__link toc-highlight">1. çº¿ç¨‹çŠ¶æ€è½¬æ¢</a><ul><li><a href="#æ–°å»ºnew" class="table-of-contents__link toc-highlight">æ–°å»ºï¼ˆNewï¼‰</a></li><li><a href="#å¯è¿è¡Œrunnable" class="table-of-contents__link toc-highlight">å¯è¿è¡Œï¼ˆRunnableï¼‰</a></li><li><a href="#é˜»å¡blocking" class="table-of-contents__link toc-highlight">é˜»å¡ï¼ˆBlockingï¼‰</a></li><li><a href="#æ— é™æœŸç­‰å¾…waiting" class="table-of-contents__link toc-highlight">æ— é™æœŸç­‰å¾…ï¼ˆWaitingï¼‰</a></li><li><a href="#é™æœŸç­‰å¾…timed-waiting" class="table-of-contents__link toc-highlight">é™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰</a></li><li><a href="#æ­»äº¡terminated" class="table-of-contents__link toc-highlight">æ­»äº¡ï¼ˆTerminatedï¼‰</a></li></ul></li><li><a href="#2-javaå®ç°å¤šçº¿ç¨‹çš„æ–¹å¼åŠä¸‰ç§æ–¹å¼çš„åŒºåˆ«" class="table-of-contents__link toc-highlight">2. Javaå®ç°å¤šçº¿ç¨‹çš„æ–¹å¼åŠä¸‰ç§æ–¹å¼çš„åŒºåˆ«</a><ul><li><a href="#å®ç°-runnable-æ¥å£" class="table-of-contents__link toc-highlight">å®ç° Runnable æ¥å£</a></li><li><a href="#å®ç°-callable-æ¥å£" class="table-of-contents__link toc-highlight">å®ç° Callable æ¥å£</a></li><li><a href="#ç»§æ‰¿-thread-ç±»" class="table-of-contents__link toc-highlight">ç»§æ‰¿ Thread ç±»</a></li><li><a href="#å®ç°æ¥å£-vs-ç»§æ‰¿-thread" class="table-of-contents__link toc-highlight">å®ç°æ¥å£ VS ç»§æ‰¿ Thread</a></li><li><a href="#ä¸‰ç§æ–¹å¼çš„åŒºåˆ«" class="table-of-contents__link toc-highlight">ä¸‰ç§æ–¹å¼çš„åŒºåˆ«</a></li></ul></li><li><a href="#3-åŸºç¡€çº¿ç¨‹æœºåˆ¶" class="table-of-contents__link toc-highlight">3. åŸºç¡€çº¿ç¨‹æœºåˆ¶</a><ul><li><a href="#executor" class="table-of-contents__link toc-highlight">Executor</a></li><li><a href="#daemonå®ˆæŠ¤çº¿ç¨‹" class="table-of-contents__link toc-highlight">Daemonï¼ˆå®ˆæŠ¤çº¿ç¨‹ï¼‰</a></li><li><a href="#sleep" class="table-of-contents__link toc-highlight">sleep()</a></li><li><a href="#yield" class="table-of-contents__link toc-highlight">yield()</a></li><li><a href="#çº¿ç¨‹é˜»å¡" class="table-of-contents__link toc-highlight">çº¿ç¨‹é˜»å¡</a></li></ul></li><li><a href="#4-ä¸­æ–­" class="table-of-contents__link toc-highlight">4. ä¸­æ–­</a><ul><li><a href="#interruptedexception" class="table-of-contents__link toc-highlight">InterruptedException</a></li><li><a href="#interrupted" class="table-of-contents__link toc-highlight">interrupted()</a></li><li><a href="#executor-çš„ä¸­æ–­æ“ä½œ" class="table-of-contents__link toc-highlight">Executor çš„ä¸­æ–­æ“ä½œ</a></li></ul></li><li><a href="#5-äº’æ–¥åŒæ­¥" class="table-of-contents__link toc-highlight">5. äº’æ–¥åŒæ­¥</a><ul><li><a href="#synchronized" class="table-of-contents__link toc-highlight">synchronized</a></li><li><a href="#reentrantlock" class="table-of-contents__link toc-highlight">ReentrantLock</a></li><li><a href="#synchronized-å’Œ-reentrantlock-æ¯”è¾ƒ" class="table-of-contents__link toc-highlight">synchronized å’Œ ReentrantLock æ¯”è¾ƒ</a></li><li><a href="#synchronizedä¸lockçš„åŒºåˆ«ä½¿ç”¨åœºæ™¯çœ‹è¿‡synchronizedçš„æºç æ²¡" class="table-of-contents__link toc-highlight">synchronizedä¸lockçš„åŒºåˆ«ï¼Œä½¿ç”¨åœºæ™¯ã€‚çœ‹è¿‡synchronizedçš„æºç æ²¡ï¼Ÿ</a></li><li><a href="#ä»€ä¹ˆæ˜¯cas" class="table-of-contents__link toc-highlight">ä»€ä¹ˆæ˜¯CAS</a><ul><li><a href="#å…¥é—¨ä¾‹å­" class="table-of-contents__link toc-highlight">å…¥é—¨ä¾‹å­</a></li><li><a href="#compare-and-swap" class="table-of-contents__link toc-highlight">Compare And Swap</a></li></ul></li><li><a href="#ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”" class="table-of-contents__link toc-highlight">ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”</a></li><li><a href="#synchronizedå¯¹è±¡é”å’Œstatic-synchronizedç±»é”åŒºåˆ«" class="table-of-contents__link toc-highlight">Synchronizedï¼ˆå¯¹è±¡é”ï¼‰å’ŒStatic Synchronizedï¼ˆç±»é”ï¼‰åŒºåˆ«</a></li></ul></li><li><a href="#6-çº¿ç¨‹ä¹‹é—´çš„åä½œ" class="table-of-contents__link toc-highlight">6. çº¿ç¨‹ä¹‹é—´çš„åä½œ</a><ul><li><a href="#join" class="table-of-contents__link toc-highlight">join()</a></li><li><a href="#wait-notify-notifyall" class="table-of-contents__link toc-highlight">wait() notify() notifyAll()</a></li><li><a href="#await-signal-signalall" class="table-of-contents__link toc-highlight">await() signal() signalAll()</a></li><li><a href="#sleepå’Œwaitæœ‰ä»€ä¹ˆåŒºåˆ«" class="table-of-contents__link toc-highlight">sleepå’Œwaitæœ‰ä»€ä¹ˆåŒºåˆ«</a></li></ul></li><li><a href="#7-juc---aqs" class="table-of-contents__link toc-highlight">7. J.U.C - AQS</a><ul><li><a href="#countdownlatch" class="table-of-contents__link toc-highlight">CountdownLatch</a></li><li><a href="#cyclicbarrier" class="table-of-contents__link toc-highlight">CyclicBarrier</a></li><li><a href="#semaphore" class="table-of-contents__link toc-highlight">Semaphore</a></li><li><a href="#æ€»ç»“" class="table-of-contents__link toc-highlight">æ€»ç»“</a></li></ul></li><li><a href="#8-juc---å…¶å®ƒç»„ä»¶" class="table-of-contents__link toc-highlight">8. J.U.C - å…¶å®ƒç»„ä»¶</a><ul><li><a href="#futuretask" class="table-of-contents__link toc-highlight">FutureTask</a></li><li><a href="#blockingqueue" class="table-of-contents__link toc-highlight">BlockingQueue</a></li><li><a href="#forkjoin" class="table-of-contents__link toc-highlight">ForkJoin</a></li></ul></li><li><a href="#9-çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹" class="table-of-contents__link toc-highlight">9. çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹</a></li><li><a href="#10-java-å†…å­˜æ¨¡å‹jmm" class="table-of-contents__link toc-highlight">10. Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰</a><ul><li><a href="#ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜" class="table-of-contents__link toc-highlight">ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜</a></li><li><a href="#å†…å­˜é—´äº¤äº’æ“ä½œ" class="table-of-contents__link toc-highlight">å†…å­˜é—´äº¤äº’æ“ä½œ</a></li><li><a href="#å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§" class="table-of-contents__link toc-highlight">å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§</a><ul><li><a href="#1-åŸå­æ€§" class="table-of-contents__link toc-highlight">1. åŸå­æ€§</a></li><li><a href="#2-å¯è§æ€§" class="table-of-contents__link toc-highlight">2. å¯è§æ€§</a></li><li><a href="#3-æœ‰åºæ€§" class="table-of-contents__link toc-highlight">3. æœ‰åºæ€§</a></li></ul></li><li><a href="#æŒ‡ä»¤é‡æ’åº" class="table-of-contents__link toc-highlight">æŒ‡ä»¤é‡æ’åº</a><ul><li><a href="#æ•°æ®ä¾èµ–æ€§" class="table-of-contents__link toc-highlight">æ•°æ®ä¾èµ–æ€§</a></li><li><a href="#as-if-serialè¯­ä¹‰" class="table-of-contents__link toc-highlight">as-if-serialè¯­ä¹‰</a></li><li><a href="#ç¨‹åºé¡ºåºè§„åˆ™" class="table-of-contents__link toc-highlight">ç¨‹åºé¡ºåºè§„åˆ™</a></li><li><a href="#é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“" class="table-of-contents__link toc-highlight">é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“</a></li></ul></li><li><a href="#å…ˆè¡Œå‘ç”ŸåŸåˆ™happens-before" class="table-of-contents__link toc-highlight">å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼ˆhappens-beforeï¼‰</a><ul><li><a href="#1-å•ä¸€çº¿ç¨‹åŸåˆ™" class="table-of-contents__link toc-highlight">1. å•ä¸€çº¿ç¨‹åŸåˆ™</a></li><li><a href="#2-ç®¡ç¨‹é”å®šè§„åˆ™" class="table-of-contents__link toc-highlight">2. ç®¡ç¨‹é”å®šè§„åˆ™</a></li><li><a href="#3-volatile-å˜é‡è§„åˆ™" class="table-of-contents__link toc-highlight">3. volatile å˜é‡è§„åˆ™</a></li><li><a href="#4-çº¿ç¨‹å¯åŠ¨è§„åˆ™" class="table-of-contents__link toc-highlight">4. çº¿ç¨‹å¯åŠ¨è§„åˆ™</a></li><li><a href="#5-çº¿ç¨‹åŠ å…¥è§„åˆ™" class="table-of-contents__link toc-highlight">5. çº¿ç¨‹åŠ å…¥è§„åˆ™</a></li><li><a href="#6-çº¿ç¨‹ä¸­æ–­è§„åˆ™" class="table-of-contents__link toc-highlight">6. çº¿ç¨‹ä¸­æ–­è§„åˆ™</a></li><li><a href="#7-å¯¹è±¡ç»ˆç»“è§„åˆ™" class="table-of-contents__link toc-highlight">7. å¯¹è±¡ç»ˆç»“è§„åˆ™</a></li><li><a href="#8-ä¼ é€’æ€§" class="table-of-contents__link toc-highlight">8. ä¼ é€’æ€§</a></li></ul></li></ul></li><li><a href="#11-çº¿ç¨‹å®‰å…¨" class="table-of-contents__link toc-highlight">11. çº¿ç¨‹å®‰å…¨</a><ul><li><a href="#çº¿ç¨‹å®‰å…¨å®šä¹‰" class="table-of-contents__link toc-highlight">çº¿ç¨‹å®‰å…¨å®šä¹‰</a></li><li><a href="#çº¿ç¨‹å®‰å…¨åˆ†ç±»" class="table-of-contents__link toc-highlight">çº¿ç¨‹å®‰å…¨åˆ†ç±»</a><ul><li><a href="#1-ä¸å¯å˜" class="table-of-contents__link toc-highlight">1. ä¸å¯å˜</a></li><li><a href="#2-ç»å¯¹çº¿ç¨‹å®‰å…¨" class="table-of-contents__link toc-highlight">2. ç»å¯¹çº¿ç¨‹å®‰å…¨</a></li><li><a href="#3-ç›¸å¯¹çº¿ç¨‹å®‰å…¨" class="table-of-contents__link toc-highlight">3. ç›¸å¯¹çº¿ç¨‹å®‰å…¨</a></li><li><a href="#4-çº¿ç¨‹å…¼å®¹" class="table-of-contents__link toc-highlight">4. çº¿ç¨‹å…¼å®¹</a></li><li><a href="#5-çº¿ç¨‹å¯¹ç«‹" class="table-of-contents__link toc-highlight">5. çº¿ç¨‹å¯¹ç«‹</a></li></ul></li><li><a href="#çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•" class="table-of-contents__link toc-highlight">çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•</a><ul><li><a href="#1-é˜»å¡åŒæ­¥äº’æ–¥åŒæ­¥" class="table-of-contents__link toc-highlight">1. é˜»å¡åŒæ­¥ï¼ˆäº’æ–¥åŒæ­¥ï¼‰</a></li><li><a href="#2-éé˜»å¡åŒæ­¥" class="table-of-contents__link toc-highlight">2. éé˜»å¡åŒæ­¥</a></li><li><a href="#3-æ— åŒæ­¥æ–¹æ¡ˆ" class="table-of-contents__link toc-highlight">3. æ— åŒæ­¥æ–¹æ¡ˆ</a><ul><li><a href="#ä¸€å¯é‡å…¥ä»£ç reentrant-code" class="table-of-contents__link toc-highlight">ï¼ˆä¸€ï¼‰å¯é‡å…¥ä»£ç ï¼ˆReentrant Codeï¼‰</a></li><li><a href="#äºŒæ ˆå°é—­" class="table-of-contents__link toc-highlight">ï¼ˆäºŒï¼‰æ ˆå°é—­</a></li><li><a href="#ä¸‰çº¿ç¨‹æœ¬åœ°å­˜å‚¨thread-local-storage" class="table-of-contents__link toc-highlight">ï¼ˆä¸‰ï¼‰çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰</a></li></ul></li></ul></li></ul></li><li><a href="#12-é”ä¼˜åŒ–" class="table-of-contents__link toc-highlight">12. é”ä¼˜åŒ–</a><ul><li><a href="#è‡ªæ—‹é”" class="table-of-contents__link toc-highlight">è‡ªæ—‹é”</a></li><li><a href="#é”æ¶ˆé™¤" class="table-of-contents__link toc-highlight">é”æ¶ˆé™¤</a></li><li><a href="#é”ç²—åŒ–" class="table-of-contents__link toc-highlight">é”ç²—åŒ–</a></li><li><a href="#è½»é‡çº§é”" class="table-of-contents__link toc-highlight">è½»é‡çº§é”</a></li><li><a href="#åå‘é”" class="table-of-contents__link toc-highlight">åå‘é”</a></li></ul></li><li><a href="#13-å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½çš„å®è·µ" class="table-of-contents__link toc-highlight">13. å¤šçº¿ç¨‹å¼€å‘è‰¯å¥½çš„å®è·µ</a></li><li><a href="#14-çº¿ç¨‹æ± å®ç°åŸç†" class="table-of-contents__link toc-highlight">14. çº¿ç¨‹æ± å®ç°åŸç†</a><ul><li><a href="#å¹¶å‘é˜Ÿåˆ—" class="table-of-contents__link toc-highlight">å¹¶å‘é˜Ÿåˆ—</a></li><li><a href="#çº¿ç¨‹æ± æ¦‚å¿µ" class="table-of-contents__link toc-highlight">çº¿ç¨‹æ± æ¦‚å¿µ</a></li><li><a href="#executorç±»å›¾" class="table-of-contents__link toc-highlight">Executorç±»å›¾</a></li><li><a href="#çº¿ç¨‹æ± å·¥ä½œåŸç†" class="table-of-contents__link toc-highlight">çº¿ç¨‹æ± å·¥ä½œåŸç†</a></li><li><a href="#åˆå§‹åŒ–çº¿ç¨‹æ± " class="table-of-contents__link toc-highlight">åˆå§‹åŒ–çº¿ç¨‹æ± </a><ul><li><a href="#åˆå§‹åŒ–æ–¹æ³•" class="table-of-contents__link toc-highlight">åˆå§‹åŒ–æ–¹æ³•</a></li></ul></li><li><a href="#å¸¸ç”¨æ–¹æ³•" class="table-of-contents__link toc-highlight">å¸¸ç”¨æ–¹æ³•</a><ul><li><a href="#executeä¸submitçš„åŒºåˆ«" class="table-of-contents__link toc-highlight">executeä¸submitçš„åŒºåˆ«</a></li><li><a href="#shutdownä¸shutdownnowçš„åŒºåˆ«" class="table-of-contents__link toc-highlight">shutDownä¸shutDownNowçš„åŒºåˆ«</a></li></ul></li><li><a href="#å†…éƒ¨å®ç°" class="table-of-contents__link toc-highlight">å†…éƒ¨å®ç°</a></li><li><a href="#çº¿ç¨‹æ± çš„çŠ¶æ€" class="table-of-contents__link toc-highlight">çº¿ç¨‹æ± çš„çŠ¶æ€</a></li><li><a href="#çº¿ç¨‹æ± å…¶ä»–å¸¸ç”¨æ–¹æ³•" class="table-of-contents__link toc-highlight">çº¿ç¨‹æ± å…¶ä»–å¸¸ç”¨æ–¹æ³•</a></li><li><a href="#å¦‚ä½•åˆç†è®¾ç½®çº¿ç¨‹æ± çš„å¤§å°" class="table-of-contents__link toc-highlight">å¦‚ä½•åˆç†è®¾ç½®çº¿ç¨‹æ± çš„å¤§å°</a></li></ul></li></ul></li><li><a href="#ç¬¬äºŒéƒ¨åˆ†é¢è¯•æŒ‡å—" class="table-of-contents__link toc-highlight">ç¬¬äºŒéƒ¨åˆ†ï¼šé¢è¯•æŒ‡å—</a><ul><li><a href="#1-volatile-ä¸-synchronized-çš„åŒºåˆ«" class="table-of-contents__link toc-highlight">1. volatile ä¸ synchronized çš„åŒºåˆ«</a></li><li><a href="#2-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªåŠ¨æ€å¤§å°çš„çº¿ç¨‹æ± å¦‚ä½•è®¾è®¡åº”è¯¥æœ‰å“ªäº›æ–¹æ³•çº¿ç¨‹æ± åˆ›å»ºçš„æ–¹å¼" class="table-of-contents__link toc-highlight">2. ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿå¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªåŠ¨æ€å¤§å°çš„çº¿ç¨‹æ± ï¼Œå¦‚ä½•è®¾è®¡ï¼Œåº”è¯¥æœ‰å“ªäº›æ–¹æ³•ï¼Ÿçº¿ç¨‹æ± åˆ›å»ºçš„æ–¹å¼ï¼Ÿ</a></li><li><a href="#3-ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œ" class="table-of-contents__link toc-highlight">3. ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œ</a><ul><li><a href="#å¹¶å‘" class="table-of-contents__link toc-highlight">å¹¶å‘</a></li><li><a href="#å¹¶è¡Œ" class="table-of-contents__link toc-highlight">å¹¶è¡Œ</a></li></ul></li><li><a href="#4-ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨" class="table-of-contents__link toc-highlight">4. ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨</a><ul><li><a href="#éçº¿ç¨‹å®‰å…¨ä¸å®‰å…¨" class="table-of-contents__link toc-highlight">éçº¿ç¨‹å®‰å…¨!=ä¸å®‰å…¨ï¼Ÿ</a></li><li><a href="#çº¿ç¨‹å®‰å…¨åä¸‡ä¸ªä¸ºä»€ä¹ˆ" class="table-of-contents__link toc-highlight">çº¿ç¨‹å®‰å…¨åä¸‡ä¸ªä¸ºä»€ä¹ˆï¼Ÿ</a></li></ul></li><li><a href="#5-volatile-å…³é”®å­—çš„å¦‚ä½•ä¿è¯å†…å­˜å¯è§æ€§" class="table-of-contents__link toc-highlight">5. volatile å…³é”®å­—çš„å¦‚ä½•ä¿è¯å†…å­˜å¯è§æ€§</a></li><li><a href="#5-ä»€ä¹ˆæ˜¯çº¿ç¨‹çº¿ç¨‹å’Œè¿›ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹" class="table-of-contents__link toc-highlight">5. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿçº¿ç¨‹å’Œè¿›ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹</a></li><li><a href="#6-å¤šçº¿ç¨‹å…±ç”¨ä¸€ä¸ªæ•°æ®å˜é‡éœ€è¦æ³¨æ„ä»€ä¹ˆ" class="table-of-contents__link toc-highlight">6. å¤šçº¿ç¨‹å…±ç”¨ä¸€ä¸ªæ•°æ®å˜é‡éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</a></li><li><a href="#7-å†…å­˜æ³„æ¼ä¸å†…å­˜æº¢å‡º" class="table-of-contents__link toc-highlight">7. å†…å­˜æ³„æ¼ä¸å†…å­˜æº¢å‡º</a><ul><li><a href="#javaå†…å­˜å›æ”¶æœºåˆ¶" class="table-of-contents__link toc-highlight">Javaå†…å­˜å›æ”¶æœºåˆ¶</a></li><li><a href="#javaå†…å­˜æ³„éœ²å¼•èµ·åŸå› " class="table-of-contents__link toc-highlight">Javaå†…å­˜æ³„éœ²å¼•èµ·åŸå› </a><ul><li><a href="#é™æ€é›†åˆç±»" class="table-of-contents__link toc-highlight">é™æ€é›†åˆç±»</a></li><li><a href="#ç›‘å¬å™¨" class="table-of-contents__link toc-highlight">ç›‘å¬å™¨</a></li><li><a href="#å„ç§è¿æ¥" class="table-of-contents__link toc-highlight">å„ç§è¿æ¥</a></li><li><a href="#å†…éƒ¨ç±»å’Œå¤–éƒ¨æ¨¡å—ç­‰çš„å¼•ç”¨" class="table-of-contents__link toc-highlight">å†…éƒ¨ç±»å’Œå¤–éƒ¨æ¨¡å—ç­‰çš„å¼•ç”¨</a></li><li><a href="#å•ä¾‹æ¨¡å¼" class="table-of-contents__link toc-highlight">å•ä¾‹æ¨¡å¼</a></li></ul></li></ul></li><li><a href="#8-å¦‚ä½•å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="table-of-contents__link toc-highlight">8. å¦‚ä½•å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</a></li><li><a href="#9-çº¿ç¨‹é—´é€šä¿¡å’Œè¿›ç¨‹é—´é€šä¿¡" class="table-of-contents__link toc-highlight">9. çº¿ç¨‹é—´é€šä¿¡å’Œè¿›ç¨‹é—´é€šä¿¡</a><ul><li><a href="#çº¿ç¨‹é—´é€šä¿¡" class="table-of-contents__link toc-highlight">çº¿ç¨‹é—´é€šä¿¡</a></li><li><a href="#è¿›ç¨‹é—´é€šä¿¡" class="table-of-contents__link toc-highlight">è¿›ç¨‹é—´é€šä¿¡</a></li></ul></li><li><a href="#10-ä»€ä¹ˆæ˜¯åŒæ­¥å’Œå¼‚æ­¥é˜»å¡å’Œéé˜»å¡" class="table-of-contents__link toc-highlight">10. ä»€ä¹ˆæ˜¯åŒæ­¥å’Œå¼‚æ­¥ï¼Œé˜»å¡å’Œéé˜»å¡ï¼Ÿ</a><ul><li><a href="#åŒæ­¥" class="table-of-contents__link toc-highlight">åŒæ­¥</a></li><li><a href="#å¼‚æ­¥" class="table-of-contents__link toc-highlight">å¼‚æ­¥</a></li><li><a href="#é˜»å¡" class="table-of-contents__link toc-highlight">é˜»å¡</a></li><li><a href="#éé˜»å¡" class="table-of-contents__link toc-highlight">éé˜»å¡</a></li></ul></li><li><a href="#11-javaä¸­çš„é”" class="table-of-contents__link toc-highlight">11. Javaä¸­çš„é”</a><ul><li><a href="#ä¸€ä¸ªç®€å•çš„é”" class="table-of-contents__link toc-highlight">ä¸€ä¸ªç®€å•çš„é”</a></li><li><a href="#é”çš„å¯é‡å…¥æ€§" class="table-of-contents__link toc-highlight">é”çš„å¯é‡å…¥æ€§</a></li><li><a href="#é”çš„å…¬å¹³æ€§" class="table-of-contents__link toc-highlight">é”çš„å…¬å¹³æ€§</a></li><li><a href="#åœ¨-finally-è¯­å¥ä¸­è°ƒç”¨-unlock" class="table-of-contents__link toc-highlight">åœ¨ finally è¯­å¥ä¸­è°ƒç”¨ unlock()</a></li></ul></li><li><a href="#12-å¹¶å‘åŒ…jucä¸‹é¢éƒ½ç”¨è¿‡ä»€ä¹ˆ" class="table-of-contents__link toc-highlight">12. å¹¶å‘åŒ…(J.U.C)ä¸‹é¢ï¼Œéƒ½ç”¨è¿‡ä»€ä¹ˆ</a></li><li><a href="#13-ä»volatileè¯´åˆ°iåŸå­æ“ä½œçº¿ç¨‹å®‰å…¨é—®é¢˜" class="table-of-contents__link toc-highlight">13. ä»volatileè¯´åˆ°,i++åŸå­æ“ä½œ,çº¿ç¨‹å®‰å…¨é—®é¢˜</a></li></ul></li><li><a href="#å‚è€ƒèµ„æ–™" class="table-of-contents__link toc-highlight">å‚è€ƒèµ„æ–™</a></li><li><a href="#æ›´æ–°æ—¥å¿—" class="table-of-contents__link toc-highlight">æ›´æ–°æ—¥å¿—</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 æŠ€æœ¯å°åŒ  Â· çŸ¥è¯†ç¬”è®°</div></div></div></footer></div>
<script src="/assets/js/runtime~main.038b63a9.js"></script>
<script src="/assets/js/main.e83d61b7.js"></script>
</body>
</html>