"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3730],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return s}});var a=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var o=a.createContext({}),p=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(o.Provider,{value:n},e.children)},k={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,o=e.parentName,c=u(e,["components","mdxType","originalType","parentName"]),d=p(t),s=l,m=d["".concat(o,".").concat(s)]||d[s]||k[s]||r;return t?a.createElement(m,i(i({ref:n},c),{},{components:t})):a.createElement(m,i({ref:n},c))}));function s(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,i=new Array(r);i[0]=d;var u={};for(var o in n)hasOwnProperty.call(n,o)&&(u[o]=n[o]);u.originalType=e,u.mdxType="string"==typeof e?e:l,i[1]=u;for(var p=2;p<r;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},8020:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return o},default:function(){return s},frontMatter:function(){return u},metadata:function(){return p},toc:function(){return k}});var a=t(7462),l=t(3366),r=(t(7294),t(3905)),i=["components"],u={},o="Java \u5e76\u53d1\u7f16\u7a0b",p={unversionedId:"backend/java/Java\u5e76\u53d1\u7f16\u7a0b",id:"backend/java/Java\u5e76\u53d1\u7f16\u7a0b",title:"Java \u5e76\u53d1\u7f16\u7a0b",description:"\u524d\u8a00",source:"@site/docs/02.backend/java/03-Java\u5e76\u53d1\u7f16\u7a0b.md",sourceDirName:"02.backend/java",slug:"/backend/java/Java\u5e76\u53d1\u7f16\u7a0b",permalink:"/docs/backend/java/Java\u5e76\u53d1\u7f16\u7a0b",editUrl:"https://github.com/frank-lam/frankfeekr-notes/tree/master/docs/02.backend/java/03-Java\u5e76\u53d1\u7f16\u7a0b.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"backend_java",previous:{title:"Java \u96c6\u5408\u6846\u67b6",permalink:"/docs/backend/java/Java\u96c6\u5408\u6846\u67b6"},next:{title:"Java IO",permalink:"/docs/backend/java/Java-IO"}},c={},k=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u7b2c\u4e00\u90e8\u5206\uff1a\u5e76\u53d1\u7f16\u7a0b",id:"\u7b2c\u4e00\u90e8\u5206\u5e76\u53d1\u7f16\u7a0b",level:2},{value:"1. \u7ebf\u7a0b\u72b6\u6001\u8f6c\u6362",id:"1-\u7ebf\u7a0b\u72b6\u6001\u8f6c\u6362",level:3},{value:"\u65b0\u5efa\uff08New\uff09",id:"\u65b0\u5efanew",level:4},{value:"\u53ef\u8fd0\u884c\uff08Runnable\uff09",id:"\u53ef\u8fd0\u884crunnable",level:4},{value:"\u963b\u585e\uff08Blocking\uff09",id:"\u963b\u585eblocking",level:4},{value:"\u65e0\u9650\u671f\u7b49\u5f85\uff08Waiting\uff09",id:"\u65e0\u9650\u671f\u7b49\u5f85waiting",level:4},{value:"\u9650\u671f\u7b49\u5f85\uff08Timed Waiting\uff09",id:"\u9650\u671f\u7b49\u5f85timed-waiting",level:4},{value:"\u6b7b\u4ea1\uff08Terminated\uff09",id:"\u6b7b\u4ea1terminated",level:4},{value:"2. Java\u5b9e\u73b0\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u53ca\u4e09\u79cd\u65b9\u5f0f\u7684\u533a\u522b",id:"2-java\u5b9e\u73b0\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u53ca\u4e09\u79cd\u65b9\u5f0f\u7684\u533a\u522b",level:3},{value:"\u5b9e\u73b0 Runnable \u63a5\u53e3",id:"\u5b9e\u73b0-runnable-\u63a5\u53e3",level:4},{value:"\u5b9e\u73b0 Callable \u63a5\u53e3",id:"\u5b9e\u73b0-callable-\u63a5\u53e3",level:4},{value:"\u7ee7\u627f Thread \u7c7b",id:"\u7ee7\u627f-thread-\u7c7b",level:4},{value:"\u5b9e\u73b0\u63a5\u53e3 VS \u7ee7\u627f Thread",id:"\u5b9e\u73b0\u63a5\u53e3-vs-\u7ee7\u627f-thread",level:4},{value:"\u4e09\u79cd\u65b9\u5f0f\u7684\u533a\u522b",id:"\u4e09\u79cd\u65b9\u5f0f\u7684\u533a\u522b",level:4},{value:"3. \u57fa\u7840\u7ebf\u7a0b\u673a\u5236",id:"3-\u57fa\u7840\u7ebf\u7a0b\u673a\u5236",level:3},{value:"Executor",id:"executor",level:4},{value:"Daemon\uff08\u5b88\u62a4\u7ebf\u7a0b\uff09",id:"daemon\u5b88\u62a4\u7ebf\u7a0b",level:4},{value:"sleep()",id:"sleep",level:4},{value:"yield()",id:"yield",level:4},{value:"\u7ebf\u7a0b\u963b\u585e",id:"\u7ebf\u7a0b\u963b\u585e",level:4},{value:"4. \u4e2d\u65ad",id:"4-\u4e2d\u65ad",level:3},{value:"InterruptedException",id:"interruptedexception",level:4},{value:"interrupted()",id:"interrupted",level:4},{value:"Executor \u7684\u4e2d\u65ad\u64cd\u4f5c",id:"executor-\u7684\u4e2d\u65ad\u64cd\u4f5c",level:4},{value:"5. \u4e92\u65a5\u540c\u6b65",id:"5-\u4e92\u65a5\u540c\u6b65",level:3},{value:"synchronized",id:"synchronized",level:4},{value:"ReentrantLock",id:"reentrantlock",level:4},{value:"synchronized \u548c ReentrantLock \u6bd4\u8f83",id:"synchronized-\u548c-reentrantlock-\u6bd4\u8f83",level:4},{value:"synchronized\u4e0elock\u7684\u533a\u522b\uff0c\u4f7f\u7528\u573a\u666f\u3002\u770b\u8fc7synchronized\u7684\u6e90\u7801\u6ca1\uff1f",id:"synchronized\u4e0elock\u7684\u533a\u522b\u4f7f\u7528\u573a\u666f\u770b\u8fc7synchronized\u7684\u6e90\u7801\u6ca1",level:4},{value:"\u4ec0\u4e48\u662fCAS",id:"\u4ec0\u4e48\u662fcas",level:4},{value:"\u5165\u95e8\u4f8b\u5b50",id:"\u5165\u95e8\u4f8b\u5b50",level:5},{value:"Compare And Swap",id:"compare-and-swap",level:5},{value:"\u4ec0\u4e48\u662f\u4e50\u89c2\u9501\u548c\u60b2\u89c2\u9501",id:"\u4ec0\u4e48\u662f\u4e50\u89c2\u9501\u548c\u60b2\u89c2\u9501",level:4},{value:"Synchronized\uff08\u5bf9\u8c61\u9501\uff09\u548cStatic Synchronized\uff08\u7c7b\u9501\uff09\u533a\u522b",id:"synchronized\u5bf9\u8c61\u9501\u548cstatic-synchronized\u7c7b\u9501\u533a\u522b",level:4},{value:"6. \u7ebf\u7a0b\u4e4b\u95f4\u7684\u534f\u4f5c",id:"6-\u7ebf\u7a0b\u4e4b\u95f4\u7684\u534f\u4f5c",level:3},{value:"join()",id:"join",level:4},{value:"wait() notify() notifyAll()",id:"wait-notify-notifyall",level:4},{value:"await() signal() signalAll()",id:"await-signal-signalall",level:4},{value:"sleep\u548cwait\u6709\u4ec0\u4e48\u533a\u522b",id:"sleep\u548cwait\u6709\u4ec0\u4e48\u533a\u522b",level:4},{value:"7. J.U.C - AQS",id:"7-juc---aqs",level:3},{value:"CountdownLatch",id:"countdownlatch",level:4},{value:"CyclicBarrier",id:"cyclicbarrier",level:4},{value:"Semaphore",id:"semaphore",level:4},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:4},{value:"8. J.U.C - \u5176\u5b83\u7ec4\u4ef6",id:"8-juc---\u5176\u5b83\u7ec4\u4ef6",level:3},{value:"FutureTask",id:"futuretask",level:4},{value:"BlockingQueue",id:"blockingqueue",level:4},{value:"ForkJoin",id:"forkjoin",level:4},{value:"9. \u7ebf\u7a0b\u4e0d\u5b89\u5168\u793a\u4f8b",id:"9-\u7ebf\u7a0b\u4e0d\u5b89\u5168\u793a\u4f8b",level:3},{value:"10. Java \u5185\u5b58\u6a21\u578b\uff08JMM\uff09",id:"10-java-\u5185\u5b58\u6a21\u578bjmm",level:3},{value:"\u4e3b\u5185\u5b58\u4e0e\u5de5\u4f5c\u5185\u5b58",id:"\u4e3b\u5185\u5b58\u4e0e\u5de5\u4f5c\u5185\u5b58",level:4},{value:"\u5185\u5b58\u95f4\u4ea4\u4e92\u64cd\u4f5c",id:"\u5185\u5b58\u95f4\u4ea4\u4e92\u64cd\u4f5c",level:4},{value:"\u5185\u5b58\u6a21\u578b\u4e09\u5927\u7279\u6027",id:"\u5185\u5b58\u6a21\u578b\u4e09\u5927\u7279\u6027",level:4},{value:"1. \u539f\u5b50\u6027",id:"1-\u539f\u5b50\u6027",level:5},{value:"2. \u53ef\u89c1\u6027",id:"2-\u53ef\u89c1\u6027",level:5},{value:"3. \u6709\u5e8f\u6027",id:"3-\u6709\u5e8f\u6027",level:5},{value:"\u6307\u4ee4\u91cd\u6392\u5e8f",id:"\u6307\u4ee4\u91cd\u6392\u5e8f",level:4},{value:"\u6570\u636e\u4f9d\u8d56\u6027",id:"\u6570\u636e\u4f9d\u8d56\u6027",level:5},{value:"as-if-serial\u8bed\u4e49",id:"as-if-serial\u8bed\u4e49",level:5},{value:"\u7a0b\u5e8f\u987a\u5e8f\u89c4\u5219",id:"\u7a0b\u5e8f\u987a\u5e8f\u89c4\u5219",level:5},{value:"\u91cd\u6392\u5e8f\u5bf9\u591a\u7ebf\u7a0b\u7684\u5f71\u54cd",id:"\u91cd\u6392\u5e8f\u5bf9\u591a\u7ebf\u7a0b\u7684\u5f71\u54cd",level:5},{value:"\u5148\u884c\u53d1\u751f\u539f\u5219\uff08happens-before\uff09",id:"\u5148\u884c\u53d1\u751f\u539f\u5219happens-before",level:4},{value:"1. \u5355\u4e00\u7ebf\u7a0b\u539f\u5219",id:"1-\u5355\u4e00\u7ebf\u7a0b\u539f\u5219",level:5},{value:"2. \u7ba1\u7a0b\u9501\u5b9a\u89c4\u5219",id:"2-\u7ba1\u7a0b\u9501\u5b9a\u89c4\u5219",level:5},{value:"3. volatile \u53d8\u91cf\u89c4\u5219",id:"3-volatile-\u53d8\u91cf\u89c4\u5219",level:5},{value:"4. \u7ebf\u7a0b\u542f\u52a8\u89c4\u5219",id:"4-\u7ebf\u7a0b\u542f\u52a8\u89c4\u5219",level:5},{value:"5. \u7ebf\u7a0b\u52a0\u5165\u89c4\u5219",id:"5-\u7ebf\u7a0b\u52a0\u5165\u89c4\u5219",level:5},{value:"6. \u7ebf\u7a0b\u4e2d\u65ad\u89c4\u5219",id:"6-\u7ebf\u7a0b\u4e2d\u65ad\u89c4\u5219",level:5},{value:"7. \u5bf9\u8c61\u7ec8\u7ed3\u89c4\u5219",id:"7-\u5bf9\u8c61\u7ec8\u7ed3\u89c4\u5219",level:5},{value:"8. \u4f20\u9012\u6027",id:"8-\u4f20\u9012\u6027",level:5},{value:"11. \u7ebf\u7a0b\u5b89\u5168",id:"11-\u7ebf\u7a0b\u5b89\u5168",level:3},{value:"\u7ebf\u7a0b\u5b89\u5168\u5b9a\u4e49",id:"\u7ebf\u7a0b\u5b89\u5168\u5b9a\u4e49",level:4},{value:"\u7ebf\u7a0b\u5b89\u5168\u5206\u7c7b",id:"\u7ebf\u7a0b\u5b89\u5168\u5206\u7c7b",level:4},{value:"1. \u4e0d\u53ef\u53d8",id:"1-\u4e0d\u53ef\u53d8",level:5},{value:"2. \u7edd\u5bf9\u7ebf\u7a0b\u5b89\u5168",id:"2-\u7edd\u5bf9\u7ebf\u7a0b\u5b89\u5168",level:5},{value:"3. \u76f8\u5bf9\u7ebf\u7a0b\u5b89\u5168",id:"3-\u76f8\u5bf9\u7ebf\u7a0b\u5b89\u5168",level:5},{value:"4. \u7ebf\u7a0b\u517c\u5bb9",id:"4-\u7ebf\u7a0b\u517c\u5bb9",level:5},{value:"5. \u7ebf\u7a0b\u5bf9\u7acb",id:"5-\u7ebf\u7a0b\u5bf9\u7acb",level:5},{value:"\u7ebf\u7a0b\u5b89\u5168\u7684\u5b9e\u73b0\u65b9\u6cd5",id:"\u7ebf\u7a0b\u5b89\u5168\u7684\u5b9e\u73b0\u65b9\u6cd5",level:4},{value:"1. \u963b\u585e\u540c\u6b65\uff08\u4e92\u65a5\u540c\u6b65\uff09",id:"1-\u963b\u585e\u540c\u6b65\u4e92\u65a5\u540c\u6b65",level:5},{value:"2. \u975e\u963b\u585e\u540c\u6b65",id:"2-\u975e\u963b\u585e\u540c\u6b65",level:5},{value:"3. \u65e0\u540c\u6b65\u65b9\u6848",id:"3-\u65e0\u540c\u6b65\u65b9\u6848",level:5},{value:"\uff08\u4e00\uff09\u53ef\u91cd\u5165\u4ee3\u7801\uff08Reentrant Code\uff09",id:"\u4e00\u53ef\u91cd\u5165\u4ee3\u7801reentrant-code",level:6},{value:"\uff08\u4e8c\uff09\u6808\u5c01\u95ed",id:"\u4e8c\u6808\u5c01\u95ed",level:6},{value:"\uff08\u4e09\uff09\u7ebf\u7a0b\u672c\u5730\u5b58\u50a8\uff08Thread Local Storage\uff09",id:"\u4e09\u7ebf\u7a0b\u672c\u5730\u5b58\u50a8thread-local-storage",level:6},{value:"12. \u9501\u4f18\u5316",id:"12-\u9501\u4f18\u5316",level:3},{value:"\u81ea\u65cb\u9501",id:"\u81ea\u65cb\u9501",level:4},{value:"\u9501\u6d88\u9664",id:"\u9501\u6d88\u9664",level:4},{value:"\u9501\u7c97\u5316",id:"\u9501\u7c97\u5316",level:4},{value:"\u8f7b\u91cf\u7ea7\u9501",id:"\u8f7b\u91cf\u7ea7\u9501",level:4},{value:"\u504f\u5411\u9501",id:"\u504f\u5411\u9501",level:4},{value:"13. \u591a\u7ebf\u7a0b\u5f00\u53d1\u826f\u597d\u7684\u5b9e\u8df5",id:"13-\u591a\u7ebf\u7a0b\u5f00\u53d1\u826f\u597d\u7684\u5b9e\u8df5",level:3},{value:"14. \u7ebf\u7a0b\u6c60\u5b9e\u73b0\u539f\u7406",id:"14-\u7ebf\u7a0b\u6c60\u5b9e\u73b0\u539f\u7406",level:3},{value:"\u5e76\u53d1\u961f\u5217",id:"\u5e76\u53d1\u961f\u5217",level:4},{value:"\u7ebf\u7a0b\u6c60\u6982\u5ff5",id:"\u7ebf\u7a0b\u6c60\u6982\u5ff5",level:4},{value:"Executor\u7c7b\u56fe",id:"executor\u7c7b\u56fe",level:4},{value:"\u7ebf\u7a0b\u6c60\u5de5\u4f5c\u539f\u7406",id:"\u7ebf\u7a0b\u6c60\u5de5\u4f5c\u539f\u7406",level:4},{value:"\u521d\u59cb\u5316\u7ebf\u7a0b\u6c60",id:"\u521d\u59cb\u5316\u7ebf\u7a0b\u6c60",level:4},{value:"\u521d\u59cb\u5316\u65b9\u6cd5",id:"\u521d\u59cb\u5316\u65b9\u6cd5",level:5},{value:"\u5e38\u7528\u65b9\u6cd5",id:"\u5e38\u7528\u65b9\u6cd5",level:4},{value:"execute\u4e0esubmit\u7684\u533a\u522b",id:"execute\u4e0esubmit\u7684\u533a\u522b",level:5},{value:"shutDown\u4e0eshutDownNow\u7684\u533a\u522b",id:"shutdown\u4e0eshutdownnow\u7684\u533a\u522b",level:5},{value:"\u5185\u90e8\u5b9e\u73b0",id:"\u5185\u90e8\u5b9e\u73b0",level:4},{value:"\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001",id:"\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001",level:4},{value:"\u7ebf\u7a0b\u6c60\u5176\u4ed6\u5e38\u7528\u65b9\u6cd5",id:"\u7ebf\u7a0b\u6c60\u5176\u4ed6\u5e38\u7528\u65b9\u6cd5",level:4},{value:"\u5982\u4f55\u5408\u7406\u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u7684\u5927\u5c0f",id:"\u5982\u4f55\u5408\u7406\u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u7684\u5927\u5c0f",level:4},{value:"\u7b2c\u4e8c\u90e8\u5206\uff1a\u9762\u8bd5\u6307\u5357",id:"\u7b2c\u4e8c\u90e8\u5206\u9762\u8bd5\u6307\u5357",level:2},{value:"1. volatile \u4e0e synchronized \u7684\u533a\u522b",id:"1-volatile-\u4e0e-synchronized-\u7684\u533a\u522b",level:3},{value:"2. \u4ec0\u4e48\u662f\u7ebf\u7a0b\u6c60\uff1f\u5982\u679c\u8ba9\u4f60\u8bbe\u8ba1\u4e00\u4e2a\u52a8\u6001\u5927\u5c0f\u7684\u7ebf\u7a0b\u6c60\uff0c\u5982\u4f55\u8bbe\u8ba1\uff0c\u5e94\u8be5\u6709\u54ea\u4e9b\u65b9\u6cd5\uff1f\u7ebf\u7a0b\u6c60\u521b\u5efa\u7684\u65b9\u5f0f\uff1f",id:"2-\u4ec0\u4e48\u662f\u7ebf\u7a0b\u6c60\u5982\u679c\u8ba9\u4f60\u8bbe\u8ba1\u4e00\u4e2a\u52a8\u6001\u5927\u5c0f\u7684\u7ebf\u7a0b\u6c60\u5982\u4f55\u8bbe\u8ba1\u5e94\u8be5\u6709\u54ea\u4e9b\u65b9\u6cd5\u7ebf\u7a0b\u6c60\u521b\u5efa\u7684\u65b9\u5f0f",level:3},{value:"3. \u4ec0\u4e48\u662f\u5e76\u53d1\u548c\u5e76\u884c",id:"3-\u4ec0\u4e48\u662f\u5e76\u53d1\u548c\u5e76\u884c",level:3},{value:"\u5e76\u53d1",id:"\u5e76\u53d1",level:4},{value:"\u5e76\u884c",id:"\u5e76\u884c",level:4},{value:"4. \u4ec0\u4e48\u662f\u7ebf\u7a0b\u5b89\u5168",id:"4-\u4ec0\u4e48\u662f\u7ebf\u7a0b\u5b89\u5168",level:3},{value:"\u975e\u7ebf\u7a0b\u5b89\u5168!=\u4e0d\u5b89\u5168\uff1f",id:"\u975e\u7ebf\u7a0b\u5b89\u5168\u4e0d\u5b89\u5168",level:4},{value:"\u7ebf\u7a0b\u5b89\u5168\u5341\u4e07\u4e2a\u4e3a\u4ec0\u4e48\uff1f",id:"\u7ebf\u7a0b\u5b89\u5168\u5341\u4e07\u4e2a\u4e3a\u4ec0\u4e48",level:4},{value:"5. volatile \u5173\u952e\u5b57\u7684\u5982\u4f55\u4fdd\u8bc1\u5185\u5b58\u53ef\u89c1\u6027",id:"5-volatile-\u5173\u952e\u5b57\u7684\u5982\u4f55\u4fdd\u8bc1\u5185\u5b58\u53ef\u89c1\u6027",level:3},{value:"5. \u4ec0\u4e48\u662f\u7ebf\u7a0b\uff1f\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u6709\u4ec0\u4e48\u533a\u522b\uff1f\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u591a\u7ebf\u7a0b",id:"5-\u4ec0\u4e48\u662f\u7ebf\u7a0b\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u6709\u4ec0\u4e48\u533a\u522b\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u591a\u7ebf\u7a0b",level:3},{value:"6. \u591a\u7ebf\u7a0b\u5171\u7528\u4e00\u4e2a\u6570\u636e\u53d8\u91cf\u9700\u8981\u6ce8\u610f\u4ec0\u4e48\uff1f",id:"6-\u591a\u7ebf\u7a0b\u5171\u7528\u4e00\u4e2a\u6570\u636e\u53d8\u91cf\u9700\u8981\u6ce8\u610f\u4ec0\u4e48",level:3},{value:"7. \u5185\u5b58\u6cc4\u6f0f\u4e0e\u5185\u5b58\u6ea2\u51fa",id:"7-\u5185\u5b58\u6cc4\u6f0f\u4e0e\u5185\u5b58\u6ea2\u51fa",level:3},{value:"Java\u5185\u5b58\u56de\u6536\u673a\u5236",id:"java\u5185\u5b58\u56de\u6536\u673a\u5236",level:4},{value:"Java\u5185\u5b58\u6cc4\u9732\u5f15\u8d77\u539f\u56e0",id:"java\u5185\u5b58\u6cc4\u9732\u5f15\u8d77\u539f\u56e0",level:4},{value:"\u9759\u6001\u96c6\u5408\u7c7b",id:"\u9759\u6001\u96c6\u5408\u7c7b",level:5},{value:"\u76d1\u542c\u5668",id:"\u76d1\u542c\u5668",level:5},{value:"\u5404\u79cd\u8fde\u63a5",id:"\u5404\u79cd\u8fde\u63a5",level:5},{value:"\u5185\u90e8\u7c7b\u548c\u5916\u90e8\u6a21\u5757\u7b49\u7684\u5f15\u7528",id:"\u5185\u90e8\u7c7b\u548c\u5916\u90e8\u6a21\u5757\u7b49\u7684\u5f15\u7528",level:5},{value:"\u5355\u4f8b\u6a21\u5f0f",id:"\u5355\u4f8b\u6a21\u5f0f",level:5},{value:"8. \u5982\u4f55\u51cf\u5c11\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362",id:"8-\u5982\u4f55\u51cf\u5c11\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362",level:3},{value:"9. \u7ebf\u7a0b\u95f4\u901a\u4fe1\u548c\u8fdb\u7a0b\u95f4\u901a\u4fe1",id:"9-\u7ebf\u7a0b\u95f4\u901a\u4fe1\u548c\u8fdb\u7a0b\u95f4\u901a\u4fe1",level:3},{value:"\u7ebf\u7a0b\u95f4\u901a\u4fe1",id:"\u7ebf\u7a0b\u95f4\u901a\u4fe1",level:4},{value:"\u8fdb\u7a0b\u95f4\u901a\u4fe1",id:"\u8fdb\u7a0b\u95f4\u901a\u4fe1",level:4},{value:"10. \u4ec0\u4e48\u662f\u540c\u6b65\u548c\u5f02\u6b65\uff0c\u963b\u585e\u548c\u975e\u963b\u585e\uff1f",id:"10-\u4ec0\u4e48\u662f\u540c\u6b65\u548c\u5f02\u6b65\u963b\u585e\u548c\u975e\u963b\u585e",level:3},{value:"\u540c\u6b65",id:"\u540c\u6b65",level:4},{value:"\u5f02\u6b65",id:"\u5f02\u6b65",level:4},{value:"\u963b\u585e",id:"\u963b\u585e",level:4},{value:"\u975e\u963b\u585e",id:"\u975e\u963b\u585e",level:4},{value:"11. Java\u4e2d\u7684\u9501",id:"11-java\u4e2d\u7684\u9501",level:3},{value:"\u4e00\u4e2a\u7b80\u5355\u7684\u9501",id:"\u4e00\u4e2a\u7b80\u5355\u7684\u9501",level:4},{value:"\u9501\u7684\u53ef\u91cd\u5165\u6027",id:"\u9501\u7684\u53ef\u91cd\u5165\u6027",level:4},{value:"\u9501\u7684\u516c\u5e73\u6027",id:"\u9501\u7684\u516c\u5e73\u6027",level:4},{value:"\u5728 finally \u8bed\u53e5\u4e2d\u8c03\u7528 unlock()",id:"\u5728-finally-\u8bed\u53e5\u4e2d\u8c03\u7528-unlock",level:4},{value:"12. \u5e76\u53d1\u5305(J.U.C)\u4e0b\u9762\uff0c\u90fd\u7528\u8fc7\u4ec0\u4e48",id:"12-\u5e76\u53d1\u5305juc\u4e0b\u9762\u90fd\u7528\u8fc7\u4ec0\u4e48",level:3},{value:"13. \u4ecevolatile\u8bf4\u5230,i++\u539f\u5b50\u64cd\u4f5c,\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898",id:"13-\u4ecevolatile\u8bf4\u5230i\u539f\u5b50\u64cd\u4f5c\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898",level:3},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2},{value:"\u66f4\u65b0\u65e5\u5fd7",id:"\u66f4\u65b0\u65e5\u5fd7",level:2}],d={toc:k};function s(e){var n=e.components,u=(0,l.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},d,u,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"java-\u5e76\u53d1\u7f16\u7a0b"},"Java \u5e76\u53d1\u7f16\u7a0b"),(0,r.kt)("h2",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,r.kt)("p",null,"\u5728\u672c\u6587\u5c06\u603b\u7ed3\u591a\u7ebf\u7a0b\u5e76\u53d1\u7f16\u7a0b\u4e2d\u7684\u5e38\u89c1\u9762\u8bd5\u9898\uff0c\u4e3b\u8981\u6838\u5fc3\u7ebf\u7a0b\u751f\u547d\u5468\u671f\u3001\u7ebf\u7a0b\u901a\u4fe1\u3001\u5e76\u53d1\u5305\u90e8\u5206\u3002\u4e3b\u8981\u5206\u6210 \u201c\u5e76\u53d1\u7f16\u7a0b\u201d \u548c \u201c\u9762\u8bd5\u6307\u5357\u201d \u4e24 \u90e8\u5206\uff0c\u5728\u9762\u8bd5\u6307\u5357\u4e2d\u5c06\u8ba8\u8bba\u5e76\u53d1\u76f8\u5173\u9762\u7ecf\u3002"),(0,r.kt)("h2",{id:"\u7b2c\u4e00\u90e8\u5206\u5e76\u53d1\u7f16\u7a0b"},"\u7b2c\u4e00\u90e8\u5206\uff1a\u5e76\u53d1\u7f16\u7a0b"),(0,r.kt)("h3",{id:"1-\u7ebf\u7a0b\u72b6\u6001\u8f6c\u6362"},"1. \u7ebf\u7a0b\u72b6\u6001\u8f6c\u6362"),(0,r.kt)("div",{align:"center"}," ",(0,r.kt)("img",{src:"assets/ace830df-9919-48ca-91b5-60b193f593d2.png",width:""})),(0,r.kt)("p",null,"\u8fd9\u91cc\u7b14\u8005\u4e5f\u7ed8\u5236\u4e86\u4e00\u5f20\u4e2d\u6587\u7248\u7684\u56fe\uff0c",(0,r.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/frank-lam/2019_campus_apply/master/notes/JavaArchitecture/assets/1536767960941.png"},"\u70b9\u51fb\u67e5\u770b")),(0,r.kt)("h4",{id:"\u65b0\u5efanew"},"\u65b0\u5efa\uff08New\uff09"),(0,r.kt)("p",null,"\u521b\u5efa\u540e\u5c1a\u672a\u542f\u52a8\u3002"),(0,r.kt)("h4",{id:"\u53ef\u8fd0\u884crunnable"},"\u53ef\u8fd0\u884c\uff08Runnable\uff09"),(0,r.kt)("p",null,"\u53ef\u80fd\u6b63\u5728\u8fd0\u884c\uff0c\u4e5f\u53ef\u80fd\u6b63\u5728\u7b49\u5f85 CPU \u65f6\u95f4\u7247\u3002"),(0,r.kt)("p",null,"\u5305\u542b\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7ebf\u7a0b\u72b6\u6001\u4e2d\u7684 \u8fd0\u884c\uff08Running \uff09 \u548c \u5c31\u7eea\uff08Ready\uff09\u3002"),(0,r.kt)("h4",{id:"\u963b\u585eblocking"},"\u963b\u585e\uff08Blocking\uff09"),(0,r.kt)("p",null,"\u8fd9\u4e2a\u72b6\u6001\u4e0b\uff0c\u662f\u5728\u591a\u4e2a\u7ebf\u7a0b\u6709\u540c\u6b65\u64cd\u4f5c\u7684\u573a\u666f\uff0c\u6bd4\u5982\u6b63\u5728\u7b49\u5f85\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684 synchronized \u5757\u7684\u6267\u884c\u91ca\u653e\uff0c\u6216\u8005\u53ef\u91cd\u5165\u7684 synchronized \u5757\u91cc\u522b\u4eba\u8c03\u7528 wait() \u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u7ebf\u7a0b\u5728\u7b49\u5f85\u8fdb\u5165\u4e34\u754c\u533a\u3002 "),(0,r.kt)("p",null,"\u963b\u585e\u53ef\u4ee5\u5206\u4e3a\uff1a\u7b49\u5f85\u963b\u585e\uff0c\u540c\u6b65\u963b\u585e\uff0c\u5176\u4ed6\u963b\u585e"),(0,r.kt)("h4",{id:"\u65e0\u9650\u671f\u7b49\u5f85waiting"},"\u65e0\u9650\u671f\u7b49\u5f85\uff08Waiting\uff09"),(0,r.kt)("p",null,"\u7b49\u5f85\u5176\u5b83\u7ebf\u7a0b\u663e\u5f0f\u5730\u5524\u9192\uff0c\u5426\u5219\u4e0d\u4f1a\u88ab\u5206\u914d CPU \u65f6\u95f4\u7247\u3002"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u8fdb\u5165\u65b9\u6cd5"),(0,r.kt)("th",{parentName:"tr",align:null},"\u9000\u51fa\u65b9\u6cd5"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u6ca1\u6709\u8bbe\u7f6e Timeout \u53c2\u6570\u7684 Object.wait() \u65b9\u6cd5"),(0,r.kt)("td",{parentName:"tr",align:null},"Object.notify() / Object.notifyAll()")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u6ca1\u6709\u8bbe\u7f6e Timeout \u53c2\u6570\u7684 Thread.join() \u65b9\u6cd5"),(0,r.kt)("td",{parentName:"tr",align:null},"\u88ab\u8c03\u7528\u7684\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"LockSupport.park() \u65b9\u6cd5"),(0,r.kt)("td",{parentName:"tr",align:null},"-")))),(0,r.kt)("h4",{id:"\u9650\u671f\u7b49\u5f85timed-waiting"},"\u9650\u671f\u7b49\u5f85\uff08Timed Waiting\uff09"),(0,r.kt)("p",null,"\u65e0\u9700\u7b49\u5f85\u5176\u5b83\u7ebf\u7a0b\u663e\u5f0f\u5730\u5524\u9192\uff0c\u5728\u4e00\u5b9a\u65f6\u95f4\u4e4b\u540e\u4f1a\u88ab\u7cfb\u7edf\u81ea\u52a8\u5524\u9192\u3002"),(0,r.kt)("p",null,"\u8c03\u7528 Thread.sleep() \u65b9\u6cd5\u4f7f\u7ebf\u7a0b\u8fdb\u5165\u9650\u671f\u7b49\u5f85\u72b6\u6001\u65f6\uff0c\u5e38\u5e38\u7528 \u201c",(0,r.kt)("strong",{parentName:"p"},"\u4f7f\u4e00\u4e2a\u7ebf\u7a0b\u7761\u7720"),"\u201d \u8fdb\u884c\u63cf\u8ff0\u3002"),(0,r.kt)("p",null,"\u8c03\u7528 Object.wait() \u65b9\u6cd5\u4f7f\u7ebf\u7a0b\u8fdb\u5165\u9650\u671f\u7b49\u5f85\u6216\u8005\u65e0\u9650\u671f\u7b49\u5f85\u65f6\uff0c\u5e38\u5e38\u7528 \u201c",(0,r.kt)("strong",{parentName:"p"},"\u6302\u8d77\u4e00\u4e2a\u7ebf\u7a0b"),"\u201d \u8fdb\u884c\u63cf\u8ff0\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u7761\u7720\u548c\u6302\u8d77"),"\u662f\u7528\u6765\u63cf\u8ff0",(0,r.kt)("strong",{parentName:"p"},"\u884c\u4e3a"),"\uff0c\u800c",(0,r.kt)("strong",{parentName:"p"},"\u963b\u585e"),"\u548c\u7b49\u5f85\u7528\u6765\u63cf\u8ff0",(0,r.kt)("strong",{parentName:"p"},"\u72b6\u6001"),"\u3002"),(0,r.kt)("p",null,"\u963b\u585e\u548c\u7b49\u5f85\u7684\u533a\u522b\u5728\u4e8e\uff0c\u963b\u585e\u662f\u88ab\u52a8\u7684\uff0c\u5b83\u662f\u5728\u7b49\u5f85\u83b7\u53d6\u4e00\u4e2a\u6392\u5b83\u9501\u3002\u800c\u7b49\u5f85\u662f\u4e3b\u52a8\u7684\uff0c\u901a\u8fc7\u8c03\u7528 Thread.sleep() \u548c Object.wait() \u7b49\u65b9\u6cd5\u8fdb\u5165\u3002"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u8fdb\u5165\u65b9\u6cd5"),(0,r.kt)("th",{parentName:"tr",align:null},"\u9000\u51fa\u65b9\u6cd5"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Thread.sleep() \u65b9\u6cd5"),(0,r.kt)("td",{parentName:"tr",align:null},"\u65f6\u95f4\u7ed3\u675f")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u8bbe\u7f6e\u4e86 Timeout \u53c2\u6570\u7684 Object.wait() \u65b9\u6cd5"),(0,r.kt)("td",{parentName:"tr",align:null},"\u65f6\u95f4\u7ed3\u675f / Object.notify() / Object.notifyAll()")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u8bbe\u7f6e\u4e86 Timeout \u53c2\u6570\u7684 Thread.join() \u65b9\u6cd5"),(0,r.kt)("td",{parentName:"tr",align:null},"\u65f6\u95f4\u7ed3\u675f / \u88ab\u8c03\u7528\u7684\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"LockSupport.parkNanos() \u65b9\u6cd5"),(0,r.kt)("td",{parentName:"tr",align:null},"-")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"LockSupport.parkUntil() \u65b9\u6cd5"),(0,r.kt)("td",{parentName:"tr",align:null},"-")))),(0,r.kt)("h4",{id:"\u6b7b\u4ea1terminated"},"\u6b7b\u4ea1\uff08Terminated\uff09"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\u56e0\u4e3a run \u65b9\u6cd5\u6b63\u5e38\u9000\u51fa\u800c\u81ea\u7136\u6b7b\u4ea1"),(0,r.kt)("li",{parentName:"ul"},"\u56e0\u4e3a\u4e00\u4e2a\u6ca1\u6709\u6355\u83b7\u7684\u5f02\u5e38\u7ec8\u6b62\u4e86 run \u65b9\u6cd5\u800c\u610f\u5916\u6b7b\u4ea1")),(0,r.kt)("h3",{id:"2-java\u5b9e\u73b0\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u53ca\u4e09\u79cd\u65b9\u5f0f\u7684\u533a\u522b"},"2. Java\u5b9e\u73b0\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u53ca\u4e09\u79cd\u65b9\u5f0f\u7684\u533a\u522b"),(0,r.kt)("p",null,"\u6709\u4e09\u79cd\u4f7f\u7528\u7ebf\u7a0b\u7684\u65b9\u6cd5\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5b9e\u73b0 Runnable \u63a5\u53e3\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u5b9e\u73b0 Callable \u63a5\u53e3\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u7ee7\u627f Thread \u7c7b\u3002")),(0,r.kt)("p",null,"\u5b9e\u73b0 Runnable \u548c Callable \u63a5\u53e3\u7684\u7c7b\u53ea\u80fd\u5f53\u505a\u4e00\u4e2a\u53ef\u4ee5\u5728\u7ebf\u7a0b\u4e2d\u8fd0\u884c\u7684\u4efb\u52a1\uff0c\u4e0d\u662f\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u7ebf\u7a0b\uff0c\u56e0\u6b64\u6700\u540e\u8fd8\u9700\u8981\u901a\u8fc7 Thread \u6765\u8c03\u7528\u3002\u53ef\u4ee5\u8bf4\u4efb\u52a1\u662f\u901a\u8fc7\u7ebf\u7a0b\u9a71\u52a8\u4ece\u800c\u6267\u884c\u7684\u3002"),(0,r.kt)("h4",{id:"\u5b9e\u73b0-runnable-\u63a5\u53e3"},"\u5b9e\u73b0 Runnable \u63a5\u53e3"),(0,r.kt)("p",null,"\u9700\u8981\u5b9e\u73b0 run() \u65b9\u6cd5\u3002"),(0,r.kt)("p",null,"\u901a\u8fc7 Thread \u8c03\u7528 start() \u65b9\u6cd5\u6765\u542f\u52a8\u7ebf\u7a0b\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class MyRunnable implements Runnable {\n    public void run() {\n        // ...\n    }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    MyRunnable instance = new MyRunnable();\n    Thread thread = new Thread(instance);\n    thread.start();\n}\n")),(0,r.kt)("h4",{id:"\u5b9e\u73b0-callable-\u63a5\u53e3"},"\u5b9e\u73b0 Callable \u63a5\u53e3"),(0,r.kt)("p",null,"\u4e0e Runnable \u76f8\u6bd4\uff0cCallable \u53ef\u4ee5\u6709\u8fd4\u56de\u503c\uff0c\u8fd4\u56de\u503c\u901a\u8fc7 FutureTask \u8fdb\u884c\u5c01\u88c5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class MyCallable implements Callable<Integer> {\n    public Integer call() {\n        return 123;\n    }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) throws ExecutionException, InterruptedException {\n    MyCallable mc = new MyCallable();\n    FutureTask<Integer> ft = new FutureTask<>(mc);\n    Thread thread = new Thread(ft);\n    thread.start();\n    System.out.println(ft.get());\n}\n")),(0,r.kt)("h4",{id:"\u7ee7\u627f-thread-\u7c7b"},"\u7ee7\u627f Thread \u7c7b"),(0,r.kt)("p",null,"\u540c\u6837\u4e5f\u662f\u9700\u8981\u5b9e\u73b0 run() \u65b9\u6cd5\uff0c\u56e0\u4e3a Thread \u7c7b\u4e5f\u5b9e\u73b0\u4e86 Runable \u63a5\u53e3\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class MyThread extends Thread {\n    public void run() {\n        // ...\n    }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    MyThread mt = new MyThread();\n    mt.start();\n}\n")),(0,r.kt)("h4",{id:"\u5b9e\u73b0\u63a5\u53e3-vs-\u7ee7\u627f-thread"},"\u5b9e\u73b0\u63a5\u53e3 VS \u7ee7\u627f Thread"),(0,r.kt)("p",null,"\u5b9e\u73b0\u63a5\u53e3\u4f1a\u66f4\u597d\u4e00\u4e9b\uff0c\u56e0\u4e3a\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Java \u4e0d\u652f\u6301\u591a\u91cd\u7ee7\u627f\uff0c\u56e0\u6b64\u7ee7\u627f\u4e86 Thread \u7c7b\u5c31\u65e0\u6cd5\u7ee7\u627f\u5176\u5b83\u7c7b\uff0c\u4f46\u662f\u53ef\u4ee5\u5b9e\u73b0\u591a\u4e2a\u63a5\u53e3\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u7c7b\u53ef\u80fd\u53ea\u8981\u6c42\u53ef\u6267\u884c\u5c31\u884c\uff0c\u7ee7\u627f\u6574\u4e2a Thread \u7c7b\u5f00\u9500\u8fc7\u5927\u3002")),(0,r.kt)("h4",{id:"\u4e09\u79cd\u65b9\u5f0f\u7684\u533a\u522b"},"\u4e09\u79cd\u65b9\u5f0f\u7684\u533a\u522b"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5b9e\u73b0 Runnable \u63a5\u53e3\u53ef\u4ee5\u907f\u514d Java \u5355\u7ee7\u627f\u7279\u6027\u800c\u5e26\u6765\u7684\u5c40\u9650\uff1b\u589e\u5f3a\u7a0b\u5e8f\u7684\u5065\u58ee\u6027\uff0c\u4ee3\u7801\u80fd\u591f\u88ab\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\uff0c\u4ee3\u7801\u4e0e\u6570\u636e\u662f\u72ec\u7acb\u7684\uff1b\u9002\u5408\u591a\u4e2a\u76f8\u540c\u7a0b\u5e8f\u4ee3\u7801\u7684\u7ebf\u7a0b\u533a\u5904\u7406\u540c\u4e00\u8d44\u6e90\u7684\u60c5\u51b5\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\u7ee7\u627f Thread \u7c7b\u548c\u5b9e\u73b0 Runnable \u65b9\u6cd5\u542f\u52a8\u7ebf\u7a0b\u90fd\u662f\u4f7f\u7528 start() \u65b9\u6cd5\uff0c\u7136\u540e JVM \u865a\u62df\u673a\u5c06\u6b64\u7ebf\u7a0b\u653e\u5230\u5c31\u7eea\u961f\u5217\u4e2d\uff0c\u5982\u679c\u6709\u5904\u7406\u673a\u53ef\u7528\uff0c\u5219\u6267\u884c run() \u65b9\u6cd5\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\u5b9e\u73b0 Callable \u63a5\u53e3\u8981\u5b9e\u73b0 call() \u65b9\u6cd5\uff0c\u5e76\u4e14\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\u540e\u4f1a\u6709\u8fd4\u56de\u503c\u3002\u5176\u4ed6\u7684\u4e24\u79cd\u90fd\u662f\u91cd\u5199 run() \u65b9\u6cd5\uff0c\u6ca1\u6709\u8fd4\u56de\u503c\u3002 ")),(0,r.kt)("h3",{id:"3-\u57fa\u7840\u7ebf\u7a0b\u673a\u5236"},"3. \u57fa\u7840\u7ebf\u7a0b\u673a\u5236"),(0,r.kt)("h4",{id:"executor"},"Executor"),(0,r.kt)("p",null,"Executor \u7ba1\u7406\u591a\u4e2a\u5f02\u6b65\u4efb\u52a1\u7684\u6267\u884c\uff0c\u800c\u65e0\u9700\u7a0b\u5e8f\u5458\u663e\u5f0f\u5730\u7ba1\u7406\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\u3002\u8fd9\u91cc\u7684\u5f02\u6b65\u662f\u6307\u591a\u4e2a\u4efb\u52a1\u7684\u6267\u884c\u4e92\u4e0d\u5e72\u6270\uff0c\u4e0d\u9700\u8981\u8fdb\u884c\u540c\u6b65\u64cd\u4f5c\u3002"),(0,r.kt)("p",null,"\u4e3b\u8981\u6709\u4e09\u79cd Executor\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CachedThreadPool\uff1a\u4e00\u4e2a\u4efb\u52a1\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff1b"),(0,r.kt)("li",{parentName:"ul"},"FixedThreadPool\uff1a\u6240\u6709\u4efb\u52a1\u53ea\u80fd\u4f7f\u7528\u56fa\u5b9a\u5927\u5c0f\u7684\u7ebf\u7a0b\uff1b"),(0,r.kt)("li",{parentName:"ul"},"SingleThreadExecutor\uff1a\u76f8\u5f53\u4e8e\u5927\u5c0f\u4e3a 1 \u7684 FixedThreadPool\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    for (int i = 0; i < 5; i++) {\n        executorService.execute(new MyRunnable());\n    }\n    executorService.shutdown();\n}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u4e3a\u4ec0\u4e48\u5f15\u5165Executor\u7ebf\u7a0b\u6c60\u6846\u67b6\uff1f")),(0,r.kt)("p",null,"new Thread() \u7684\u7f3a\u70b9"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6bcf\u6b21 new Thread() \u8017\u8d39\u6027\u80fd "),(0,r.kt)("li",{parentName:"ul"},"\u8c03\u7528 new Thread() \u521b\u5efa\u7684\u7ebf\u7a0b\u7f3a\u4e4f\u7ba1\u7406\uff0c\u88ab\u79f0\u4e3a\u91ce\u7ebf\u7a0b\uff0c\u800c\u4e14\u53ef\u4ee5\u65e0\u9650\u5236\u521b\u5efa\uff0c\u4e4b\u95f4\u76f8\u4e92\u7ade\u4e89\uff0c\u4f1a\u5bfc\u81f4\u8fc7\u591a\u5360\u7528\u7cfb\u7edf\u8d44\u6e90\u5bfc\u81f4\u7cfb\u7edf\u762b\u75ea\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u5229\u4e8e\u6269\u5c55\uff0c\u6bd4\u5982\u5982\u5b9a\u65f6\u6267\u884c\u3001\u5b9a\u671f\u6267\u884c\u3001\u7ebf\u7a0b\u4e2d\u65ad")),(0,r.kt)("p",null,"\u91c7\u7528\u7ebf\u7a0b\u6c60\u7684\u4f18\u70b9"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u91cd\u7528\u5b58\u5728\u7684\u7ebf\u7a0b\uff0c\u51cf\u5c11\u5bf9\u8c61\u521b\u5efa\u3001\u6d88\u4ea1\u7684\u5f00\u9500\uff0c\u6027\u80fd\u4f73 "),(0,r.kt)("li",{parentName:"ul"},"\u53ef\u6709\u6548\u63a7\u5236\u6700\u5927\u5e76\u53d1\u7ebf\u7a0b\u6570\uff0c\u63d0\u9ad8\u7cfb\u7edf\u8d44\u6e90\u7684\u4f7f\u7528\u7387\uff0c\u540c\u65f6\u907f\u514d\u8fc7\u591a\u8d44\u6e90\u7ade\u4e89\uff0c\u907f\u514d\u5835\u585e "),(0,r.kt)("li",{parentName:"ul"},"\u63d0\u4f9b\u5b9a\u65f6\u6267\u884c\u3001\u5b9a\u671f\u6267\u884c\u3001\u5355\u7ebf\u7a0b\u3001\u5e76\u53d1\u6570\u63a7\u5236\u7b49\u529f\u80fd")),(0,r.kt)("h4",{id:"daemon\u5b88\u62a4\u7ebf\u7a0b"},"Daemon\uff08\u5b88\u62a4\u7ebf\u7a0b\uff09"),(0,r.kt)("p",null,"Java \u4e2d\u6709\u4e24\u7c7b\u7ebf\u7a0b\uff1aUser Thread (\u7528\u6237\u7ebf\u7a0b)\u3001Daemon Thread (\u5b88\u62a4\u7ebf\u7a0b)"),(0,r.kt)("p",null,"\u7528\u6237\u7ebf\u7a0b\u5373\u8fd0\u884c\u5728\u524d\u53f0\u7684\u7ebf\u7a0b\uff0c\u800c\u5b88\u62a4\u7ebf\u7a0b\u662f\u8fd0\u884c\u5728\u540e\u53f0\u7684\u7ebf\u7a0b\u3002 \u5b88\u62a4\u7ebf\u7a0b\u4f5c\u7528\u662f\u4e3a\u5176\u4ed6\u524d\u53f0\u7ebf\u7a0b\u7684\u8fd0\u884c\u63d0\u4f9b\u4fbf\u5229\u670d\u52a1\uff0c\u800c\u4e14\u4ec5\u5728\u666e\u901a\u3001\u975e\u5b88\u62a4\u7ebf\u7a0b\u4ecd\u7136\u8fd0\u884c\u65f6\u624d\u9700\u8981\uff0c\u6bd4\u5982\u5783\u573e\u56de\u6536\u7ebf\u7a0b\u5c31\u662f\u4e00\u4e2a\u5b88\u62a4\u7ebf\u7a0b\u3002\u5f53 JVM \u68c0\u6d4b\u4ec5\u5269\u4e00\u4e2a\u5b88\u62a4\u7ebf\u7a0b\uff0c\u800c\u7528\u6237\u7ebf\u7a0b\u90fd\u5df2\u7ecf\u9000\u51fa\u8fd0\u884c\u65f6\uff0cJVM \u5c31\u4f1a\u9000\u51fa\uff0c\u56e0\u4e3a\u6ca1\u6709\u5982\u679c\u6ca1\u6709\u4e86\u88ab\u5b88\u62a4\u8fd9\uff0c\u4e5f\u5c31\u6ca1\u6709\u7ee7\u7eed\u8fd0\u884c\u7a0b\u5e8f\u7684\u5fc5\u8981\u4e86\u3002\u5982\u679c\u6709\u975e\u5b88\u62a4\u7ebf\u7a0b\u4ecd\u7136\u5b58\u6d3b\uff0cJVM \u5c31\u4e0d\u4f1a\u9000\u51fa\u3002"),(0,r.kt)("p",null,"\u5b88\u62a4\u7ebf\u7a0b\u5e76\u975e\u53ea\u6709\u865a\u62df\u673a\u5185\u90e8\u63d0\u4f9b\uff0c\u7528\u6237\u5728\u7f16\u5199\u7a0b\u5e8f\u65f6\u4e5f\u53ef\u4ee5\u81ea\u5df1\u8bbe\u7f6e\u5b88\u62a4\u7ebf\u7a0b\u3002\u7528\u6237\u53ef\u4ee5\u7528 Thread \u7684 setDaemon(true) \u65b9\u6cd5\u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u4e3a\u5b88\u62a4\u7ebf\u7a0b\u3002"),(0,r.kt)("p",null,"\u867d\u7136\u5b88\u62a4\u7ebf\u7a0b\u53ef\u80fd\u975e\u5e38\u6709\u7528\uff0c\u4f46\u5fc5\u987b\u5c0f\u5fc3\u786e\u4fdd\u5176\u4ed6\u6240\u6709\u975e\u5b88\u62a4\u7ebf\u7a0b\u6d88\u4ea1\u65f6\uff0c\u4e0d\u4f1a\u7531\u4e8e\u5b83\u7684\u7ec8\u6b62\u800c\u4ea7\u751f\u4efb\u4f55\u5371\u5bb3\u3002\u56e0\u4e3a\u4f60\u4e0d\u53ef\u80fd\u77e5\u9053\u5728\u6240\u6709\u7684\u7528\u6237\u7ebf\u7a0b\u9000\u51fa\u8fd0\u884c\u524d\uff0c\u5b88\u62a4\u7ebf\u7a0b\u662f\u5426\u5df2\u7ecf\u5b8c\u6210\u4e86\u9884\u671f\u7684\u670d\u52a1\u4efb\u52a1\u3002\u4e00\u65e6\u6240\u6709\u7684\u7528\u6237\u7ebf\u7a0b\u9000\u51fa\u4e86\uff0c\u865a\u62df\u673a\u4e5f\u5c31\u9000\u51fa\u8fd0\u884c\u4e86\u3002 \u56e0\u6b64\uff0c\u4e0d\u8981\u5728\u5b88\u62a4\u7ebf\u7a0b\u4e2d\u6267\u884c\u4e1a\u52a1\u903b\u8f91\u64cd\u4f5c\uff08\u6bd4\u5982\u5bf9\u6570\u636e\u7684\u8bfb\u5199\u7b49\uff09\u3002"),(0,r.kt)("p",null," ",(0,r.kt)("strong",{parentName:"p"},"\u53e6\u5916\u6709\u51e0\u70b9\u9700\u8981\u6ce8\u610f\uff1a")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"setDaemon(true) \u5fc5\u987b\u5728\u8c03\u7528\u7ebf\u7a0b\u7684 start() \u65b9\u6cd5\u4e4b\u524d\u8bbe\u7f6e\uff0c\u5426\u5219\u4f1a\u8dd1\u51fa IllegalThreadStateException \u5f02\u5e38\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5728\u5b88\u62a4\u7ebf\u7a0b\u4e2d\u4ea7\u751f\u7684\u65b0\u7ebf\u7a0b\u4e5f\u662f\u5b88\u62a4\u7ebf\u7a0b\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u8981\u8ba4\u4e3a\u6240\u6709\u7684\u5e94\u7528\u90fd\u53ef\u4ee5\u5206\u914d\u7ed9\u5b88\u62a4\u7ebf\u7a0b\u6765\u8fdb\u884c\u670d\u52a1\uff0c\u6bd4\u5982\u8bfb\u5199\u64cd\u4f5c\u6216\u8005\u8ba1\u7b97\u903b\u8f91\u3002")),(0,r.kt)("p",null,"\u5b88\u62a4\u7ebf\u7a0b\u662f\u7a0b\u5e8f\u8fd0\u884c\u65f6\u5728\u540e\u53f0\u63d0\u4f9b\u670d\u52a1\u7684\u7ebf\u7a0b\uff0c\u4e0d\u5c5e\u4e8e\u7a0b\u5e8f\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u90e8\u5206\u3002"),(0,r.kt)("p",null,"\u5f53\u6240\u6709\u975e\u5b88\u62a4\u7ebf\u7a0b\u7ed3\u675f\u65f6\uff0c\u7a0b\u5e8f\u4e5f\u5c31\u7ec8\u6b62\uff0c\u540c\u65f6\u4f1a\u6740\u6b7b\u6240\u6709\u5b88\u62a4\u7ebf\u7a0b\u3002"),(0,r.kt)("p",null,"main() \u5c5e\u4e8e\u975e\u5b88\u62a4\u7ebf\u7a0b\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528 setDaemon() \u65b9\u6cd5\u5c06\u4e00\u4e2a\u7ebf\u7a0b\u8bbe\u7f6e\u4e3a\u5b88\u62a4\u7ebf\u7a0b\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    Thread thread = new Thread(new MyRunnable());\n    thread.setDaemon(true);\n}\n")),(0,r.kt)("h4",{id:"sleep"},"sleep()"),(0,r.kt)("p",null,"Thread.sleep(millisec) \u65b9\u6cd5\u4f1a\u4f11\u7720\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u7ebf\u7a0b\uff0cmillisec \u5355\u4f4d\u4e3a\u6beb\u79d2\u3002"),(0,r.kt)("p",null,"sleep() \u53ef\u80fd\u4f1a\u629b\u51fa InterruptedException\uff0c\u56e0\u4e3a\u5f02\u5e38\u4e0d\u80fd\u8de8\u7ebf\u7a0b\u4f20\u64ad\u56de main() \u4e2d\uff0c\u56e0\u6b64\u5fc5\u987b\u5728\u672c\u5730\u8fdb\u884c\u5904\u7406\u3002\u7ebf\u7a0b\u4e2d\u629b\u51fa\u7684\u5176\u5b83\u5f02\u5e38\u4e5f\u540c\u6837\u9700\u8981\u5728\u672c\u5730\u8fdb\u884c\u5904\u7406\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public void run() {\n    try {\n        Thread.sleep(3000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}\n")),(0,r.kt)("h4",{id:"yield"},"yield()"),(0,r.kt)("p",null,"\u5bf9\u9759\u6001\u65b9\u6cd5 Thread.yield() \u7684\u8c03\u7528\u58f0\u660e\u4e86",(0,r.kt)("strong",{parentName:"p"},"\u5f53\u524d\u7ebf\u7a0b\u5df2\u7ecf\u5b8c\u6210\u4e86\u751f\u547d\u5468\u671f\u4e2d\u6700\u91cd\u8981\u7684\u90e8\u5206"),"\uff0c\u53ef\u4ee5\u5207\u6362\u7ed9\u5176\u5b83\u7ebf\u7a0b\u6765\u6267\u884c\u3002\u8be5\u65b9\u6cd5\u53ea\u662f\u5bf9\u7ebf\u7a0b\u8c03\u5ea6\u5668\u7684\u4e00\u4e2a\u5efa\u8bae\uff0c\u800c\u4e14\u4e5f\u53ea\u662f\u5efa\u8bae\u5177\u6709\u76f8\u540c\u4f18\u5148\u7ea7\u7684\u5176\u5b83\u7ebf\u7a0b\u53ef\u4ee5\u8fd0\u884c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public void run() {\n    Thread.yield();\n}\n")),(0,r.kt)("h4",{id:"\u7ebf\u7a0b\u963b\u585e"},"\u7ebf\u7a0b\u963b\u585e"),(0,r.kt)("p",null,"\u7ebf\u7a0b\u53ef\u4ee5\u963b\u585e\u4e8e\u56db\u79cd\u72b6\u6001\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f53\u7ebf\u7a0b\u6267\u884c Thread.sleep() \u65f6\uff0c\u5b83\u4e00\u76f4\u963b\u585e\u5230\u6307\u5b9a\u7684\u6beb\u79d2\u65f6\u95f4\u4e4b\u540e\uff0c\u6216\u8005\u963b\u585e\u88ab\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u6253\u65ad\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u5f53\u7ebf\u7a0b\u78b0\u5230\u4e00\u6761 wait() \u8bed\u53e5\u65f6\uff0c\u5b83\u4f1a\u4e00\u76f4\u963b\u585e\u5230\u63a5\u5230\u901a\u77e5 notify()\u3001\u88ab\u4e2d\u65ad\u6216\u7ecf\u8fc7\u4e86\u6307\u5b9a\u6beb\u79d2\u65f6\u95f4\u4e3a\u6b62\uff08\u82e5\u5236\u5b9a\u4e86\u8d85\u65f6\u503c\u7684\u8bdd\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\u963b\u585e\u4e0e\u4e0d\u540c I/O \u7684\u65b9\u5f0f\u6709\u591a\u79cd\u3002\u5e38\u89c1\u7684\u4e00\u79cd\u65b9\u5f0f\u662f InputStream \u7684 read() \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u4e00\u76f4\u963b\u585e\u5230\u4ece\u6d41\u4e2d\u8bfb\u53d6\u4e00\u4e2a\u5b57\u8282\u7684\u6570\u636e\u4e3a\u6b62\uff0c\u5b83\u53ef\u4ee5\u65e0\u9650\u963b\u585e\uff0c\u56e0\u6b64\u4e0d\u80fd\u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\u4e5f\u53ef\u4ee5\u963b\u585e\u7b49\u5f85\u83b7\u53d6\u67d0\u4e2a\u5bf9\u8c61\u9501\u7684\u6392\u4ed6\u6027\u8bbf\u95ee\u6743\u9650\uff08\u5373\u7b49\u5f85\u83b7\u5f97 synchronized \u8bed\u53e5\u5fc5\u987b\u7684\u9501\u65f6\u963b\u585e\uff09\u3002")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u6ce8\u610f\uff0c\u5e76\u975e\u6240\u6709\u7684\u963b\u585e\u72b6\u6001\u90fd\u662f\u53ef\u4e2d\u65ad\u7684\uff0c\u4ee5\u4e0a\u963b\u585e\u72b6\u6001\u7684\u524d\u4e24\u79cd\u53ef\u4ee5\u88ab\u4e2d\u65ad\uff0c\u540e\u4e24\u79cd\u4e0d\u4f1a\u5bf9\u4e2d\u65ad\u505a\u51fa\u53cd\u5e94")),(0,r.kt)("h3",{id:"4-\u4e2d\u65ad"},"4. \u4e2d\u65ad"),(0,r.kt)("p",null,"\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\u4e4b\u540e\u4f1a\u81ea\u52a8\u7ed3\u675f\uff0c\u5982\u679c\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u5f02\u5e38\u4e5f\u4f1a\u63d0\u524d\u7ed3\u675f\u3002"),(0,r.kt)("h4",{id:"interruptedexception"},"InterruptedException"),(0,r.kt)("p",null,"\u901a\u8fc7\u8c03\u7528\u4e00\u4e2a\u7ebf\u7a0b\u7684 interrupt() \u6765\u4e2d\u65ad\u8be5\u7ebf\u7a0b\uff0c\u5982\u679c\u8be5\u7ebf\u7a0b\u5904\u4e8e",(0,r.kt)("strong",{parentName:"p"},"\u963b\u585e\u3001\u9650\u671f\u7b49\u5f85\u6216\u8005\u65e0\u9650\u671f\u7b49\u5f85"),"\u72b6\u6001\uff0c\u90a3\u4e48\u5c31\u4f1a\u629b\u51fa InterruptedException\uff0c\u4ece\u800c\u63d0\u524d\u7ed3\u675f\u8be5\u7ebf\u7a0b\u3002\u4f46\u662f\u4e0d\u80fd\u4e2d\u65ad I/O \u963b\u585e\u548c synchronized \u9501\u963b\u585e\u3002"),(0,r.kt)("p",null,"\u5bf9\u4e8e\u4ee5\u4e0b\u4ee3\u7801\uff0c\u5728 main() \u4e2d\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u4e4b\u540e\u518d\u4e2d\u65ad\u5b83\uff0c\u7531\u4e8e\u7ebf\u7a0b\u4e2d\u8c03\u7528\u4e86 Thread.sleep() \u65b9\u6cd5\uff0c\u56e0\u6b64\u4f1a\u629b\u51fa\u4e00\u4e2a InterruptedException\uff0c\u4ece\u800c\u63d0\u524d\u7ed3\u675f\u7ebf\u7a0b\uff0c\u4e0d\u6267\u884c\u4e4b\u540e\u7684\u8bed\u53e5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class InterruptExample {\n\n    private static class MyThread1 extends Thread {\n        @Override\n        public void run() {\n            try {\n                Thread.sleep(2000);\n                System.out.println("Thread run");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public static void main(String[] args) throws InterruptedException {\n    Thread thread1 = new MyThread1();\n    thread1.start();\n    thread1.interrupt();\n    System.out.println("Main run");\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"Main run\njava.lang.InterruptedException: sleep interrupted\n    at java.lang.Thread.sleep(Native Method)\n    at InterruptExample.lambda$main$0(InterruptExample.java:5)\n    at InterruptExample$$Lambda$1/713338599.run(Unknown Source)\n    at java.lang.Thread.run(Thread.java:745)\n")),(0,r.kt)("h4",{id:"interrupted"},"interrupted()"),(0,r.kt)("p",null,"\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u7684 run() \u65b9\u6cd5\u6267\u884c\u4e00\u4e2a\u65e0\u9650\u5faa\u73af\uff0c\u5e76\u4e14\u6ca1\u6709\u6267\u884c sleep() \u7b49\u4f1a\u629b\u51fa InterruptedException \u7684\u64cd\u4f5c\uff0c\u90a3\u4e48\u8c03\u7528\u7ebf\u7a0b\u7684 interrupt() \u65b9\u6cd5\u5c31\u65e0\u6cd5\u4f7f\u7ebf\u7a0b\u63d0\u524d\u7ed3\u675f\u3002"),(0,r.kt)("p",null,"\u4f46\u662f\u8c03\u7528 interrupt() \u65b9\u6cd5\u4f1a\u8bbe\u7f6e\u7ebf\u7a0b\u7684\u4e2d\u65ad\u6807\u8bb0\uff0c\u6b64\u65f6\u8c03\u7528 interrupted() \u65b9\u6cd5\u4f1a\u8fd4\u56de true\u3002\u56e0\u6b64\u53ef\u4ee5\u5728\u5faa\u73af\u4f53\u4e2d\u4f7f\u7528 interrupted() \u65b9\u6cd5\u6765\u5224\u65ad\u7ebf\u7a0b\u662f\u5426\u5904\u4e8e\u4e2d\u65ad\u72b6\u6001\uff0c\u4ece\u800c\u63d0\u524d\u7ed3\u675f\u7ebf\u7a0b\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class InterruptExample {\n\n    private static class MyThread2 extends Thread {\n        @Override\n        public void run() {\n            while (!interrupted()) {\n                // ..\n            }\n            System.out.println("Thread end");\n        }\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"public static void main(String[] args) throws InterruptedException {\n    Thread thread2 = new MyThread2();\n    thread2.start();\n    thread2.interrupt();\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Thread end\n")),(0,r.kt)("h4",{id:"executor-\u7684\u4e2d\u65ad\u64cd\u4f5c"},"Executor \u7684\u4e2d\u65ad\u64cd\u4f5c"),(0,r.kt)("p",null,"\u8c03\u7528 Executor \u7684 shutdown() \u65b9\u6cd5\u4f1a\u7b49\u5f85\u7ebf\u7a0b\u90fd\u6267\u884c\u5b8c\u6bd5\u4e4b\u540e\u518d\u5173\u95ed\uff0c\u4f46\u662f\u5982\u679c\u8c03\u7528\u7684\u662f shutdownNow() \u65b9\u6cd5\uff0c\u5219\u76f8\u5f53\u4e8e\u8c03\u7528\u6bcf\u4e2a\u7ebf\u7a0b\u7684 interrupt() \u65b9\u6cd5\u3002"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u4f7f\u7528 Lambda \u521b\u5efa\u7ebf\u7a0b\uff0c\u76f8\u5f53\u4e8e\u521b\u5efa\u4e86\u4e00\u4e2a\u533f\u540d\u5185\u90e8\u7ebf\u7a0b\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public static void main(String[] args) {\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> {\n        try {\n            Thread.sleep(2000);\n            System.out.println("Thread run");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    });\n    executorService.shutdownNow();\n    System.out.println("Main run");\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"Main run\njava.lang.InterruptedException: sleep interrupted\n    at java.lang.Thread.sleep(Native Method)\n    at ExecutorInterruptExample.lambda$main$0(ExecutorInterruptExample.java:9)\n    at ExecutorInterruptExample$$Lambda$1/1160460865.run(Unknown Source)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n")),(0,r.kt)("p",null,"\u5982\u679c\u53ea\u60f3\u4e2d\u65ad Executor \u4e2d\u7684\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 submit() \u65b9\u6cd5\u6765\u63d0\u4ea4\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2a Future<?> \u5bf9\u8c61\uff0c\u901a\u8fc7\u8c03\u7528\u8be5\u5bf9\u8c61\u7684 cancel(true) \u65b9\u6cd5\u5c31\u53ef\u4ee5\u4e2d\u65ad\u7ebf\u7a0b\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"Future<?> future = executorService.submit(() -> {\n    // ..\n});\nfuture.cancel(true);\n")),(0,r.kt)("h3",{id:"5-\u4e92\u65a5\u540c\u6b65"},"5. \u4e92\u65a5\u540c\u6b65"),(0,r.kt)("p",null,"Java \u63d0\u4f9b\u4e86\u4e24\u79cd\u9501\u673a\u5236\u6765\u63a7\u5236\u591a\u4e2a\u7ebf\u7a0b\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u4e92\u65a5\u8bbf\u95ee\uff0c\u7b2c\u4e00\u4e2a\u662f JVM \u5b9e\u73b0\u7684 synchronized\uff0c\u800c\u53e6\u4e00\u4e2a\u662f JDK \u5b9e\u73b0\u7684 ReentrantLock\u3002"),(0,r.kt)("h4",{id:"synchronized"},"synchronized"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1. \u540c\u6b65\u4e00\u4e2a\u4ee3\u7801\u5757")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public void func() {\n    synchronized (this) {\n        // ...\n    }\n}\n")),(0,r.kt)("p",null,"\u5b83\u53ea\u4f5c\u7528\u4e8e\u540c\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5982\u679c\u8c03\u7528\u4e24\u4e2a\u5bf9\u8c61\u4e0a\u7684\u540c\u6b65\u4ee3\u7801\u5757\uff0c\u5c31\u4e0d\u4f1a\u8fdb\u884c\u540c\u6b65\u3002"),(0,r.kt)("p",null,"\u5bf9\u4e8e\u4ee5\u4e0b\u4ee3\u7801\uff0c\u4f7f\u7528 ExecutorService \u6267\u884c\u4e86\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u7531\u4e8e\u8c03\u7528\u7684\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\u7684\u540c\u6b65\u4ee3\u7801\u5757\uff0c\u56e0\u6b64\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u4f1a\u8fdb\u884c\u540c\u6b65\uff0c\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u540c\u6b65\u8bed\u53e5\u5757\u65f6\uff0c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u5c31\u5fc5\u987b\u7b49\u5f85\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class SynchronizedExample {\n    public void func1() {\n        synchronized (this) {\n            for (int i = 0; i < 10; i++) {\n                System.out.print(i + " ");\n            }\n        }\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    SynchronizedExample e1 = new SynchronizedExample();\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> e1.func1());\n    executorService.execute(() -> e1.func1());\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\n")),(0,r.kt)("p",null,"\u5bf9\u4e8e\u4ee5\u4e0b\u4ee3\u7801\uff0c\u4e24\u4e2a\u7ebf\u7a0b\u8c03\u7528\u4e86\u4e0d\u540c\u5bf9\u8c61\u7684\u540c\u6b65\u4ee3\u7801\u5757\uff0c\u56e0\u6b64\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u5c31\u4e0d\u9700\u8981\u540c\u6b65\u3002\u4ece\u8f93\u51fa\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\uff0c\u4e24\u4e2a\u7ebf\u7a0b\u4ea4\u53c9\u6267\u884c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    SynchronizedExample e1 = new SynchronizedExample();\n    SynchronizedExample e2 = new SynchronizedExample();\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> e1.func1());\n    executorService.execute(() -> e2.func1());\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"0 0 1 1 2 2 3 3 4 4 5 5 6 6 7 7 8 8 9 9\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2. \u540c\u6b65\u4e00\u4e2a\u65b9\u6cd5")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public synchronized void func () {\n    // ...\n}\n")),(0,r.kt)("p",null,"\u5b83\u548c\u540c\u6b65\u4ee3\u7801\u5757\u4e00\u6837\uff0c\u4f5c\u7528\u4e8e\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3. \u540c\u6b65\u4e00\u4e2a\u7c7b")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public void func() {\n    synchronized (SynchronizedExample.class) {\n        // ...\n    }\n}\n")),(0,r.kt)("p",null,"\u4f5c\u7528\u4e8e\u6574\u4e2a\u7c7b\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e24\u4e2a\u7ebf\u7a0b\u8c03\u7528\u540c\u4e00\u4e2a\u7c7b\u7684\u4e0d\u540c\u5bf9\u8c61\u4e0a\u7684\u8fd9\u79cd\u540c\u6b65\u8bed\u53e5\uff0c\u4e5f\u4f1a\u8fdb\u884c\u540c\u6b65\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class SynchronizedExample {\n    public void func2() {\n        synchronized (SynchronizedExample.class) {\n            for (int i = 0; i < 10; i++) {\n                System.out.print(i + " ");\n            }\n        }\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    SynchronizedExample e1 = new SynchronizedExample();\n    SynchronizedExample e2 = new SynchronizedExample();\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> e1.func2());\n    executorService.execute(() -> e2.func2());\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"4. \u540c\u6b65\u4e00\u4e2a\u9759\u6001\u65b9\u6cd5")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u975e\u9759\u6001\u540c\u6b65\u51fd\u6570\u7684\u9501\u662f\uff1athis"),(0,r.kt)("li",{parentName:"ul"},"\u9759\u6001\u7684\u540c\u6b65\u51fd\u6570\u7684\u9501\u662f\uff1a\u5b57\u8282\u7801\u5bf9\u8c61")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public synchronized static void fun() {\n    // ...\n}\n")),(0,r.kt)("p",null,"\u4f5c\u7528\u4e8e\u6574\u4e2a\u7c7b\u3002"),(0,r.kt)("h4",{id:"reentrantlock"},"ReentrantLock"),(0,r.kt)("p",null,"\u91cd\u5165\u9501\uff08ReentrantLock\uff09\u662f\u4e00\u79cd\u9012\u5f52\u65e0\u963b\u585e\u7684\u540c\u6b65\u673a\u5236\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class LockExample {\n    private Lock lock = new ReentrantLock();\n\n    public void func() {\n        lock.lock();\n        try {\n            for (int i = 0; i < 10; i++) {\n                System.out.print(i + " ");\n            }\n        } finally {\n            lock.unlock(); // \u786e\u4fdd\u91ca\u653e\u9501\uff0c\u4ece\u800c\u907f\u514d\u53d1\u751f\u6b7b\u9501\u3002\n        }\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    LockExample lockExample = new LockExample();\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> lockExample.func());\n    executorService.execute(() -> lockExample.func());\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9\n")),(0,r.kt)("p",null,"ReentrantLock \u662f java.util.concurrent\uff08J.U.C\uff09\u5305\u4e2d\u7684\u9501\uff0c\u76f8\u6bd4\u4e8e synchronized\uff0c\u5b83\u591a\u4e86\u4ee5\u4e0b\u9ad8\u7ea7\u529f\u80fd\uff1a"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1. \u7b49\u5f85\u53ef\u4e2d\u65ad")),(0,r.kt)("p",null,"\u5f53\u6301\u6709\u9501\u7684\u7ebf\u7a0b\u957f\u671f\u4e0d\u91ca\u653e\u9501\u7684\u65f6\u5019\uff0c\u6b63\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b\u53ef\u4ee5\u9009\u62e9\u653e\u5f03\u7b49\u5f85\uff0c\u6539\u4e3a\u5904\u7406\u5176\u4ed6\u4e8b\u60c5\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2. \u53ef\u5b9e\u73b0\u516c\u5e73\u9501")),(0,r.kt)("p",null,"\u516c\u5e73\u9501\u662f\u6307\u591a\u4e2a\u7ebf\u7a0b\u5728\u7b49\u5f85\u540c\u4e00\u4e2a\u9501\u65f6\uff0c\u5fc5\u987b\u6309\u7167\u7533\u8bf7\u9501\u7684\u65f6\u95f4\u987a\u5e8f\u6765\u4f9d\u6b21\u83b7\u5f97\u9501\u3002"),(0,r.kt)("p",null,"synchronized \u4e2d\u7684\u9501\u662f\u975e\u516c\u5e73\u7684\uff0cReentrantLock \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e5f\u662f\u975e\u516c\u5e73\u7684\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u5e26\u5e03\u5c14\u503c\u7684\u6784\u9020\u51fd\u6570\u8981\u6c42\u4f7f\u7528\u516c\u5e73\u9501\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3. \u9501\u7ed1\u5b9a\u591a\u4e2a\u6761\u4ef6")),(0,r.kt)("p",null,"\u4e00\u4e2a ReentrantLock \u5bf9\u8c61\u53ef\u4ee5\u540c\u65f6\u7ed1\u5b9a\u591a\u4e2a Condition \u5bf9\u8c61\u3002"),(0,r.kt)("h4",{id:"synchronized-\u548c-reentrantlock-\u6bd4\u8f83"},"synchronized \u548c ReentrantLock \u6bd4\u8f83"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1. \u9501\u7684\u5b9e\u73b0")),(0,r.kt)("p",null,"synchronized \u662f JVM \u5b9e\u73b0\u7684\uff0c\u800c ReentrantLock \u662f JDK \u5b9e\u73b0\u7684\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2. \u6027\u80fd")),(0,r.kt)("p",null,"\u65b0\u7248\u672c Java \u5bf9 synchronized \u8fdb\u884c\u4e86\u5f88\u591a\u4f18\u5316\uff0c\u4f8b\u5982\u81ea\u65cb\u9501\u7b49\u3002\u76ee\u524d\u6765\u770b\u5b83\u548c ReentrantLock \u7684\u6027\u80fd\u57fa\u672c\u6301\u5e73\u4e86\uff0c\u56e0\u6b64\u6027\u80fd\u56e0\u7d20\u4e0d\u518d\u662f\u9009\u62e9 ReentrantLock \u7684\u7406\u7531\u3002synchronized \u6709\u66f4\u5927\u7684\u6027\u80fd\u4f18\u5316\u7a7a\u95f4\uff0c\u5e94\u8be5\u4f18\u5148\u8003\u8651 synchronized\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3. \u529f\u80fd")),(0,r.kt)("p",null,"ReentrantLock \u591a\u4e86\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"4. \u4f7f\u7528\u9009\u62e9")),(0,r.kt)("p",null,"\u9664\u975e\u9700\u8981\u4f7f\u7528 ReentrantLock \u7684\u9ad8\u7ea7\u529f\u80fd\uff0c\u5426\u5219\u4f18\u5148\u4f7f\u7528 synchronized\u3002\u8fd9\u662f\u56e0\u4e3a synchronized \u662f JVM \u5b9e\u73b0\u7684\u4e00\u79cd\u9501\u673a\u5236\uff0cJVM \u539f\u751f\u5730\u652f\u6301\u5b83\uff0c\u800c ReentrantLock \u4e0d\u662f\u6240\u6709\u7684 JDK \u7248\u672c\u90fd\u652f\u6301\u3002\u5e76\u4e14\u4f7f\u7528 synchronized \u4e0d\u7528\u62c5\u5fc3\u6ca1\u6709\u91ca\u653e\u9501\u800c\u5bfc\u81f4\u6b7b\u9501\u95ee\u9898\uff0c\u56e0\u4e3a JVM \u4f1a\u786e\u4fdd\u9501\u7684\u91ca\u653e\u3002"),(0,r.kt)("h4",{id:"synchronized\u4e0elock\u7684\u533a\u522b\u4f7f\u7528\u573a\u666f\u770b\u8fc7synchronized\u7684\u6e90\u7801\u6ca1"},"synchronized\u4e0elock\u7684\u533a\u522b\uff0c\u4f7f\u7528\u573a\u666f\u3002\u770b\u8fc7synchronized\u7684\u6e90\u7801\u6ca1\uff1f"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\uff08\u7528\u6cd5\uff09synchronized\uff08\u9690\u5f0f\u9501\uff09\uff1a\u5728\u9700\u8981\u540c\u6b65\u7684\u5bf9\u8c61\u4e2d\u52a0\u5165\u6b64\u63a7\u5236\uff0csynchronized \u53ef\u4ee5\u52a0\u5728\u65b9\u6cd5\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u52a0\u5728\u7279\u5b9a\u4ee3\u7801\u5757\u4e2d\uff0c\u62ec\u53f7\u4e2d\u8868\u793a\u9700\u8981\u9501\u7684\u5bf9\u8c61\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\uff08\u7528\u6cd5\uff09lock\uff08\u663e\u793a\u9501\uff09\uff1a\u9700\u8981\u663e\u793a\u6307\u5b9a\u8d77\u59cb\u4f4d\u7f6e\u548c\u7ec8\u6b62\u4f4d\u7f6e\u3002\u4e00\u822c\u4f7f\u7528 ReentrantLock \u7c7b\u505a\u4e3a\u9501\uff0c\u591a\u4e2a\u7ebf\u7a0b\u4e2d\u5fc5\u987b\u8981\u4f7f\u7528\u4e00\u4e2a ReentrantLock \u7c7b\u505a\u4e3a\u5bf9\u8c61\u624d\u80fd\u4fdd\u8bc1\u9501\u7684\u751f\u6548\u3002\u4e14\u5728\u52a0\u9501\u548c\u89e3\u9501\u5904\u9700\u8981\u901a\u8fc7 lock() \u548c unlock() \u663e\u793a\u6307\u51fa\u3002\u6240\u4ee5\u4e00\u822c\u4f1a\u5728 finally \u5757\u4e2d\u5199 unlock() \u4ee5\u9632\u6b7b\u9501\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\uff08\u6027\u80fd\uff09synchronized \u662f\u6258\u7ba1\u7ed9 JVM \u6267\u884c\u7684\uff0c\u800c lock \u662f Java \u5199\u7684\u63a7\u5236\u9501\u7684\u4ee3\u7801\u3002\u5728 Java1.5 \u4e2d\uff0csynchronize \u662f\u6027\u80fd\u4f4e\u6548\u7684\u3002\u56e0\u4e3a\u8fd9\u662f\u4e00\u4e2a\u91cd\u91cf\u7ea7\u64cd\u4f5c\uff0c\u9700\u8981\u8c03\u7528\u64cd\u4f5c\u63a5\u53e3\uff0c\u5bfc\u81f4\u6709\u53ef\u80fd\u52a0\u9501\u6d88\u8017\u7684\u7cfb\u7edf\u65f6\u95f4\u6bd4\u52a0\u9501\u4ee5\u5916\u7684\u64cd\u4f5c\u8fd8\u591a\u3002\u76f8\u6bd4\u4e4b\u4e0b\u4f7f\u7528 Java \u63d0\u4f9b\u7684 Lock \u5bf9\u8c61\uff0c\u6027\u80fd\u66f4\u9ad8\u4e00\u4e9b\u3002\u4f46\u662f\u5230\u4e86 Java1.6 \uff0c\u53d1\u751f\u4e86\u53d8\u5316\u3002synchronize \u5728\u8bed\u4e49\u4e0a\u5f88\u6e05\u6670\uff0c\u53ef\u4ee5\u8fdb\u884c\u5f88\u591a\u4f18\u5316\uff0c\u6709",(0,r.kt)("u",null,"\u9002\u5e94\u81ea\u65cb\uff0c\u9501\u6d88\u9664\uff0c\u9501\u7c97\u5316\uff0c\u8f7b\u91cf\u7ea7\u9501\uff0c\u504f\u5411\u9501"),"\u7b49\u7b49\u3002\u5bfc\u81f4 \u5728 Java1.6 \u4e0a synchronize \u7684\u6027\u80fd\u5e76\u4e0d\u6bd4 Lock \u5dee\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\uff08\u673a\u5236\uff09",(0,r.kt)("strong",{parentName:"li"},"synchronized \u539f\u59cb\u91c7\u7528\u7684\u662f CPU \u60b2\u89c2\u9501\u673a\u5236\uff0c\u5373\u7ebf\u7a0b\u83b7\u5f97\u7684\u662f\u72ec\u5360\u9501\u3002Lock \u4e5f\u5c5e\u4e8e\u60b2\u89c2\u9501"),"\u3002\u72ec\u5360\u9501\u610f\u5473\u7740\u5176\u4ed6\u7ebf\u7a0b\u53ea\u80fd\u4f9d\u9760\u963b\u585e\u6765\u7b49\u5f85\u7ebf\u7a0b\u91ca\u653e\u9501\u3002\u76f8\u5bf9\u800c\u8a00\u4e50\u89c2\u9501\u6bcf\u6b21\u4e0d\u52a0\u9501\uff0c\u800c\u662f\u5047\u8bbe\u6ca1\u6709\u51b2\u7a81\u800c\u53bb\u5b8c\u6210\u67d0\u9879\u64cd\u4f5c\uff0c\u5982\u679c\u56e0\u4e3a\u51b2\u7a81\u5931\u8d25\u5c31\u91cd\u8bd5\uff0c\u76f4\u5230\u6210\u529f\u4e3a\u6b62\u3002\u4e50\u89c2\u9501\u5b9e\u73b0\u7684\u673a\u5236\u5c31\u662f CAS \u64cd\u4f5c\uff08Compare and Swap\uff09\u3002 ")),(0,r.kt)("h4",{id:"\u4ec0\u4e48\u662fcas"},"\u4ec0\u4e48\u662fCAS"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u8611\u83c7\u8857\u9762\u8bd5\uff0c\u8fd9\u91cc\u7b80\u5355\u8bba\u8ff0\u4e00\u4e0b")),(0,r.kt)("h5",{id:"\u5165\u95e8\u4f8b\u5b50"},"\u5165\u95e8\u4f8b\u5b50"),(0,r.kt)("p",null,"\u5728 Java \u5e76\u53d1\u5305\u4e2d\u6709\u8fd9\u6837\u4e00\u4e2a\u5305\uff0cjava.util.concurrent.atomic\uff0c\u8be5\u5305\u662f\u5bf9 Java \u90e8\u5206\u6570\u636e\u7c7b\u578b\u7684\u539f\u5b50\u5c01\u88c5\uff0c\u5728\u539f\u6709\u6570\u636e\u7c7b\u578b\u7684\u57fa\u7840\u4e0a\uff0c\u63d0\u4f9b\u4e86\u539f\u5b50\u6027\u7684\u64cd\u4f5c\u65b9\u6cd5\uff0c\u4fdd\u8bc1\u4e86\u7ebf\u7a0b\u5b89\u5168\u3002\u4e0b\u9762\u4ee5 AtomicInteger \u4e3a\u4f8b\uff0c\u6765\u770b\u4e00\u4e0b\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public final int incrementAndGet() {\n    for (;;) {\n        int current = get();\n        int next = current + 1;\n        if (compareAndSet(current, next))\n            return next;\n    }\n}\n\npublic final int decrementAndGet() {\n    for (;;) {\n        int current = get();\n        int next = current - 1;\n        if (compareAndSet(current, next))\n            return next;\n    }\n}\n")),(0,r.kt)("p",null,"\u4ee5\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u4e3a\u4f8b\uff0cincrementAndGet \u65b9\u6cd5\u76f8\u5f53\u4e8e\u539f\u5b50\u6027\u7684 ++i\uff0cdecrementAndGet \u65b9\u6cd5\u76f8\u5f53\u4e8e\u539f\u5b50\u6027\u7684 --i\uff0c\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u4e2d\u90fd\u6ca1\u6709\u4f7f\u7528\u963b\u585e\u5f0f\u7684\u65b9\u5f0f\u6765\u4fdd\u8bc1\u539f\u5b50\u6027\uff08\u5982 Synchronized \uff09\uff0c\u90a3\u5b83\u4eec\u662f\u5982\u4f55\u4fdd\u8bc1\u539f\u5b50\u6027\u7684\u5462\uff0c\u4e0b\u9762\u5f15\u51fa CAS\u3002"),(0,r.kt)("h5",{id:"compare-and-swap"},"Compare And Swap"),(0,r.kt)("p",null,"CAS \u6307\u7684\u662f\u73b0\u4ee3 CPU \u5e7f\u6cdb\u652f\u6301\u7684\u4e00\u79cd\u5bf9\u5185\u5b58\u4e2d\u7684\u5171\u4eab\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u7684\u4e00\u79cd\u7279\u6b8a\u6307\u4ee4\u3002\u8fd9\u4e2a\u6307\u4ee4\u4f1a\u5bf9\u5185\u5b58\u4e2d\u7684\u5171\u4eab\u6570\u636e\u505a\u539f\u5b50\u7684\u8bfb\u5199\u64cd\u4f5c\u3002"),(0,r.kt)("p",null,"\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e2a\u6307\u4ee4\u7684\u64cd\u4f5c\u8fc7\u7a0b\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u9996\u5148\uff0cCPU \u4f1a\u5c06\u5185\u5b58\u4e2d\u5c06\u8981\u88ab\u66f4\u6539\u7684\u6570\u636e\u4e0e\u671f\u671b\u7684\u503c\u505a\u6bd4\u8f83\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7136\u540e\uff0c\u5f53\u8fd9\u4e24\u4e2a\u503c\u76f8\u7b49\u65f6\uff0cCPU \u624d\u4f1a\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u503c\u66ff\u6362\u4e3a\u65b0\u7684\u503c\u3002\u5426\u5219\u4fbf\u4e0d\u505a\u64cd\u4f5c\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u6700\u540e\uff0cCPU \u4f1a\u5c06\u65e7\u7684\u6570\u503c\u8fd4\u56de\u3002")),(0,r.kt)("p",null,"\u8fd9\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\u662f\u539f\u5b50\u7684\u3002\u5b83\u4eec\u867d\u7136\u770b\u4f3c\u590d\u6742\uff0c\u4f46\u5374\u662f Java 5 \u5e76\u53d1\u673a\u5236\u4f18\u4e8e\u539f\u6709\u9501\u673a\u5236\u7684\u6839\u672c\u3002\u7b80\u5355\u6765\u8bf4\uff0cCAS \u7684\u542b\u4e49\u662f\uff1a\u6211\u8ba4\u4e3a\u539f\u6709\u7684\u503c\u5e94\u8be5\u662f\u4ec0\u4e48\uff0c\u5982\u679c\u662f\uff0c\u5219\u5c06\u539f\u6709\u7684\u503c\u66f4\u65b0\u4e3a\u65b0\u503c\uff0c\u5426\u5219\u4e0d\u505a\u4fee\u6539\uff0c\u5e76\u544a\u8bc9\u6211\u539f\u6765\u7684\u503c\u662f\u591a\u5c11\u3002\n\u200b       \u7b80\u5355\u7684\u6765\u8bf4\uff0cCAS \u6709 3 \u4e2a\u64cd\u4f5c\u6570\uff0c\u5185\u5b58\u503c V\uff0c\u65e7\u7684\u9884\u671f\u503c A\uff0c\u8981\u4fee\u6539\u7684\u65b0\u503c B\u3002\u5f53\u4e14\u4ec5\u5f53\u9884\u671f\u503c A \u548c\u5185\u5b58\u503c V \u76f8\u540c\u65f6\uff0c\u5c06\u5185\u5b58\u503c V \u4fee\u6539\u4e3a B\uff0c\u5426\u5219\u8fd4\u56de V\u3002\u8fd9\u662f\u4e00\u79cd\u4e50\u89c2\u9501\u7684\u601d\u8def\uff0c\u5b83\u76f8\u4fe1\u5728\u5b83\u4fee\u6539\u4e4b\u524d\uff0c\u6ca1\u6709\u5176\u5b83\u7ebf\u7a0b\u53bb\u4fee\u6539\u5b83\uff1b\u800c Synchronized \u662f\u4e00\u79cd\u60b2\u89c2\u9501\uff0c\u5b83\u8ba4\u4e3a\u5728\u5b83\u4fee\u6539\u4e4b\u524d\uff0c\u4e00\u5b9a\u4f1a\u6709\u5176\u5b83\u7ebf\u7a0b\u53bb\u4fee\u6539\u5b83\uff0c\u60b2\u89c2\u9501\u6548\u7387\u5f88\u4f4e\u3002"),(0,r.kt)("h4",{id:"\u4ec0\u4e48\u662f\u4e50\u89c2\u9501\u548c\u60b2\u89c2\u9501"},"\u4ec0\u4e48\u662f\u4e50\u89c2\u9501\u548c\u60b2\u89c2\u9501"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e3a\u4ec0\u4e48\u9700\u8981\u9501\uff08\u5e76\u53d1\u63a7\u5236\uff09",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5728\u591a\u7528\u6237\u73af\u5883\u4e2d\uff0c\u5728\u540c\u4e00\u65f6\u95f4\u53ef\u80fd\u4f1a\u6709\u591a\u4e2a\u7528\u6237\u66f4\u65b0\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u8fd9\u4f1a\u4ea7\u751f\u51b2\u7a81\u3002\u8fd9\u5c31\u662f\u8457\u540d\u7684\u5e76\u53d1\u6027\u95ee\u9898\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5178\u578b\u7684\u51b2\u7a81\u6709\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4e22\u5931\u66f4\u65b0\uff1a\u4e00\u4e2a\u4e8b\u52a1\u7684\u66f4\u65b0\u8986\u76d6\u4e86\u5176\u5b83\u4e8b\u52a1\u7684\u66f4\u65b0\u7ed3\u679c\uff0c\u5c31\u662f\u6240\u8c13\u7684\u66f4\u65b0\u4e22\u5931\u3002\u4f8b\u5982\uff1a\u7528\u6237 A \u628a\u503c\u4ece 6 \u6539\u4e3a 2\uff0c\u7528\u6237 B \u628a\u503c\u4ece 2 \u6539\u4e3a 6\uff0c\u5219\u7528\u6237 A \u4e22\u5931\u4e86\u4ed6\u7684\u66f4\u65b0\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u810f\u8bfb\uff1a\u5f53\u4e00\u4e2a\u4e8b\u52a1\u8bfb\u53d6\u5176\u5b83\u5b8c\u6210\u4e00\u534a\u4e8b\u52a1\u7684\u8bb0\u5f55\u65f6\uff0c\u5c31\u4f1a\u53d1\u751f\u810f\u8bfb\u53d6\u3002\u4f8b\u5982\uff1a\u7528\u6237 A,B \u770b\u5230\u7684\u503c\u90fd\u662f6\uff0c\u7528\u6237 B \u628a\u503c\u6539\u4e3a 2\uff0c\u7528\u6237 A \u8bfb\u5230\u7684\u503c\u4ecd\u4e3a 6\u3002"))),(0,r.kt)("li",{parentName:"ul"},"\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u5e76\u53d1\u5e26\u6765\u7684\u95ee\u9898\u3002 \u6211\u4eec\u9700\u8981\u5f15\u5165\u5e76\u53d1\u63a7\u5236\u673a\u5236\u3002"))),(0,r.kt)("li",{parentName:"ul"},"\u5e76\u53d1\u63a7\u5236\u673a\u5236",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u60b2\u89c2\u9501\uff1a\u5047\u5b9a\u4f1a\u53d1\u751f\u5e76\u53d1\u51b2\u7a81"),"\uff0c\u72ec\u5360\u9501\uff0c\u5c4f\u853d\u4e00\u5207\u53ef\u80fd\u8fdd\u53cd\u6570\u636e\u5b8c\u6574\u6027\u7684\u64cd\u4f5c\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u4e50\u89c2\u9501\uff1a\u5047\u8bbe\u4e0d\u4f1a\u53d1\u751f\u5e76\u53d1\u51b2\u7a81"),"\uff0c\u53ea\u5728\u63d0\u4ea4\u64cd\u4f5c\u65f6\u68c0\u67e5\u662f\u5426\u8fdd\u53cd\u6570\u636e\u5b8c\u6574\u6027\u3002\u4e50\u89c2\u9501\u4e0d\u80fd\u89e3\u51b3\u810f\u8bfb\u7684\u95ee\u9898\u3002")))),(0,r.kt)("p",null,"\u53c2\u8003\u8d44\u6599\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.cnblogs.com/0201zcr/p/4782283.html"},"\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501\u2014\u2014\u89e3\u51b3\u5e76\u53d1\u95ee\u9898 - WhyWin - \u535a\u5ba2\u56ed"))),(0,r.kt)("h4",{id:"synchronized\u5bf9\u8c61\u9501\u548cstatic-synchronized\u7c7b\u9501\u533a\u522b"},"Synchronized\uff08\u5bf9\u8c61\u9501\uff09\u548cStatic Synchronized\uff08\u7c7b\u9501\uff09\u533a\u522b"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4e00\u4e2a\u662f\u5b9e\u4f8b\u9501\uff08\u9501\u5728\u67d0\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u8c61\u4e0a\uff0c\u5982\u679c\u8be5\u7c7b\u662f\u5355\u4f8b\uff0c\u90a3\u4e48\u8be5\u9501\u4e5f\u5177\u6709\u5168\u5c40\u9501\u7684\u6982\u5ff5\uff09\uff0c\u4e00\u4e2a\u662f\u5168\u5c40\u9501\uff08\u8be5\u9501\u9488\u5bf9\u7684\u662f\u7c7b\uff0c\u65e0\u8bba\u5b9e\u4f8b\u591a\u5c11\u4e2a\u5bf9\u8c61\uff0c\u90a3\u4e48\u7ebf\u7a0b\u90fd\u5171\u4eab\u8be5\u9501\uff09\u3002"),(0,r.kt)("p",{parentName:"li"},"\u5b9e\u4f8b\u9501\u5bf9\u5e94\u7684\u5c31\u662f synchronized\u5173 \u952e\u5b57\uff0c\u800c\u7c7b\u9501\uff08\u5168\u5c40\u9501\uff09\u5bf9\u5e94\u7684\u5c31\u662f static synchronized\uff08\u6216\u8005\u662f\u9501\u5728\u8be5\u7c7b\u7684 class \u6216\u8005 classloader \u5bf9\u8c61\u4e0a\uff09\u3002"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * static synchronized \u548csynchronized\u7684\u533a\u522b\uff01\n * \u5173\u952e\u662f\u533a\u522b\u7b2c\u56db\u79cd\u60c5\u51b5\uff01\n */\npublic class StaticSynchronized {\n\n    /**\n     * synchronized\u65b9\u6cd5\n     */\n    public synchronized void isSynA(){\n        System.out.println("isSynA");\n    }\n    public synchronized void isSynB(){\n        System.out.println("isSynB");\n    }\n\n    /**\n     * static synchronized\u65b9\u6cd5\n     */\n    public static synchronized void cSynA(){\n        System.out.println("cSynA");\n    }\n    public static synchronized void cSynB(){\n        System.out.println("cSynB");\n    }\n\n    public static void main(String[] args) {\n        StaticSynchronized x = new StaticSynchronized();\n        StaticSynchronized y = new StaticSynchronized();\n        /**\n         *  x.isSynA()\u4e0ex.isSynB(); \u4e0d\u80fd\u540c\u65f6\u8bbf\u95ee(\u540c\u4e00\u4e2a\u5bf9\u8c61\u8bbf\u95eesynchronized\u65b9\u6cd5)\n         *  x.isSynA()\u4e0ey.isSynB(); \u80fd\u540c\u65f6\u8bbf\u95ee(\u4e0d\u540c\u5bf9\u8c61\u8bbf\u95eesynchronized\u65b9\u6cd5)\n         *  x.cSynA()\u4e0ey.cSynB(); \u4e0d\u80fd\u540c\u65f6\u8bbf\u95ee(\u4e0d\u540c\u5bf9\u8c61\u4e5f\u4e0d\u80fd\u8bbf\u95eestatic synchronized\u65b9\u6cd5)\n         *  x.isSynA()\u4e0ey.cSynA(); \u80fd\u540c\u65f6\u8bbf\u95ee(static synchronized\u65b9\u6cd5\u5360\u7528\u7684\u662f\u7c7b\u9501\uff0c\n         *                        \u800c\u8bbf\u95eesynchronized\u65b9\u6cd5\u5360\u7528\u7684\u662f\u5bf9\u8c61\u9501\uff0c\u4e0d\u5b58\u5728\u4e92\u65a5\u73b0\u8c61)\n         */\n    }\n}\n')),(0,r.kt)("h3",{id:"6-\u7ebf\u7a0b\u4e4b\u95f4\u7684\u534f\u4f5c"},"6. \u7ebf\u7a0b\u4e4b\u95f4\u7684\u534f\u4f5c"),(0,r.kt)("p",null,"\u5f53\u591a\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u4e00\u8d77\u5de5\u4f5c\u53bb\u89e3\u51b3\u67d0\u4e2a\u95ee\u9898\u65f6\uff0c\u5982\u679c\u67d0\u4e9b\u90e8\u5206\u5fc5\u987b\u5728\u5176\u5b83\u90e8\u5206\u4e4b\u524d\u5b8c\u6210\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5bf9\u7ebf\u7a0b\u8fdb\u884c\u534f\u8c03\u3002"),(0,r.kt)("h4",{id:"join"},"join()"),(0,r.kt)("p",null,"\u5728\u7ebf\u7a0b\u4e2d\u8c03\u7528\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684 join() \u65b9\u6cd5\uff0c\u4f1a\u5c06\u5f53\u524d\u7ebf\u7a0b\u6302\u8d77\uff0c\u800c\u4e0d\u662f\u5fd9\u7b49\u5f85\uff0c\u76f4\u5230\u76ee\u6807\u7ebf\u7a0b\u7ed3\u675f\u3002"),(0,r.kt)("p",null,"\u5bf9\u4e8e\u4ee5\u4e0b\u4ee3\u7801\uff0c\u867d\u7136 b \u7ebf\u7a0b\u5148\u542f\u52a8\uff0c\u4f46\u662f\u56e0\u4e3a\u5728 b \u7ebf\u7a0b\u4e2d\u8c03\u7528\u4e86 a \u7ebf\u7a0b\u7684 join() \u65b9\u6cd5\uff0cb \u7ebf\u7a0b\u4f1a\u7b49\u5f85 a \u7ebf\u7a0b\u7ed3\u675f\u624d\u7ee7\u7eed\u6267\u884c\uff0c\u56e0\u6b64\u6700\u540e\u80fd\u591f\u4fdd\u8bc1 a \u7ebf\u7a0b\u7684\u8f93\u51fa\u5148\u4e8e b \u7ebf\u7a0b\u7684\u8f93\u51fa\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class JoinExample {\n    private class A extends Thread {\n        @Override\n        public void run() {\n            System.out.println("A");\n        }\n    }\n\n    private class B extends Thread {\n        private A a;\n        B(A a) {\n            this.a = a;\n        }\n\n        @Override\n        public void run() {\n            try {\n                a.join();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println("B");\n        }\n    }\n\n    public void test() {\n        A a = new A();\n        B b = new B(a);\n        b.start();\n        a.start();\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    JoinExample example = new JoinExample();\n    example.test();\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"A\nB\n")),(0,r.kt)("h4",{id:"wait-notify-notifyall"},"wait() notify() notifyAll()"),(0,r.kt)("p",null,"\u8c03\u7528 wait() \u4f7f\u5f97\u7ebf\u7a0b\u7b49\u5f85\u67d0\u4e2a\u6761\u4ef6\u6ee1\u8db3\uff0c\u7ebf\u7a0b\u5728\u7b49\u5f85\u65f6\u4f1a\u88ab\u6302\u8d77\uff0c\u5f53\u5176\u4ed6\u7ebf\u7a0b\u7684\u8fd0\u884c\u4f7f\u5f97\u8fd9\u4e2a\u6761\u4ef6\u6ee1\u8db3\u65f6\uff0c\u5176\u5b83\u7ebf\u7a0b\u4f1a\u8c03\u7528 notify()\uff08\u968f\u673a\u53eb\u9192\u4e00\u4e2a\uff09 \u6216\u8005 notifyAll() \uff08\u53eb\u9192\u6240\u6709 wait \u7ebf\u7a0b\uff0c\u4e89\u593a\u65f6\u95f4\u7247\u7684\u7ebf\u7a0b\u53ea\u6709\u4e00\u4e2a\uff09\u6765\u5524\u9192\u6302\u8d77\u7684\u7ebf\u7a0b\u3002"),(0,r.kt)("p",null,"\u5b83\u4eec\u90fd\u5c5e\u4e8e Object \u7684\u4e00\u90e8\u5206\uff0c\u800c\u4e0d\u5c5e\u4e8e Thread\u3002"),(0,r.kt)("p",null,"\u53ea\u80fd\u7528\u5728",(0,r.kt)("strong",{parentName:"p"},"\u540c\u6b65\u65b9\u6cd5"),"\u6216\u8005",(0,r.kt)("strong",{parentName:"p"},"\u540c\u6b65\u63a7\u5236\u5757"),"\u4e2d\u4f7f\u7528\uff01\u5426\u5219\u4f1a\u5728\u8fd0\u884c\u65f6\u629b\u51fa IllegalMonitorStateExeception\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528 wait() \u6302\u8d77\u671f\u95f4\uff0c\u7ebf\u7a0b\u4f1a\u91ca\u653e\u9501\u3002\u8fd9\u662f\u56e0\u4e3a\uff0c\u5982\u679c\u6ca1\u6709\u91ca\u653e\u9501\uff0c\u90a3\u4e48\u5176\u5b83\u7ebf\u7a0b\u5c31\u65e0\u6cd5\u8fdb\u5165\u5bf9\u8c61\u7684\u540c\u6b65\u65b9\u6cd5\u6216\u8005\u540c\u6b65\u63a7\u5236\u5757\u4e2d\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u6267\u884c notify() \u6216\u8005 notifyAll() \u6765\u5524\u9192\u6302\u8d77\u7684\u7ebf\u7a0b\uff0c\u9020\u6210\u6b7b\u9501\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class WaitNotifyExample {\n    public synchronized void before() {\n        System.out.println("before");\n        notifyAll();\n    }\n\n    public synchronized void after() {\n        try {\n            wait();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println("after");\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    WaitNotifyExample example = new WaitNotifyExample();\n    executorService.execute(() -> example.after());\n    executorService.execute(() -> example.before());\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"before\nafter\n")),(0,r.kt)("h4",{id:"await-signal-signalall"},"await() signal() signalAll()"),(0,r.kt)("p",null,"java.util.concurrent \u7c7b\u5e93\u4e2d\u63d0\u4f9b\u4e86 Condition \u7c7b\u6765\u5b9e\u73b0\u7ebf\u7a0b\u4e4b\u95f4\u7684\u534f\u8c03\uff0c\u53ef\u4ee5\u5728 Condition \u4e0a\u8c03\u7528 await() \u65b9\u6cd5\u4f7f\u7ebf\u7a0b\u7b49\u5f85\uff0c\u5176\u5b83\u7ebf\u7a0b\u8c03\u7528 signal() \u6216 signalAll() \u65b9\u6cd5\u5524\u9192\u7b49\u5f85\u7684\u7ebf\u7a0b\u3002\u76f8\u6bd4\u4e8e wait() \u8fd9\u79cd\u7b49\u5f85\u65b9\u5f0f\uff0cawait() \u53ef\u4ee5\u6307\u5b9a\u7b49\u5f85\u7684\u6761\u4ef6\uff0c\u56e0\u6b64\u66f4\u52a0\u7075\u6d3b\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528 Lock \u6765\u83b7\u53d6\u4e00\u4e2a Condition \u5bf9\u8c61\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class AwaitSignalExample {\n    private Lock lock = new ReentrantLock();\n    private Condition condition = lock.newCondition();\n\n    public void before() {\n        lock.lock();\n        try {\n            System.out.println("before");\n            condition.signalAll();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public void after() {\n        lock.lock();\n        try {\n            condition.await();\n            System.out.println("after");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    AwaitSignalExample example = new AwaitSignalExample();\n    executorService.execute(() -> example.after());\n    executorService.execute(() -> example.before());\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"before\nafter\n")),(0,r.kt)("h4",{id:"sleep\u548cwait\u6709\u4ec0\u4e48\u533a\u522b"},"sleep\u548cwait\u6709\u4ec0\u4e48\u533a\u522b"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"sleep \u548c wait",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"wait() \u662f Object \u7684\u65b9\u6cd5\uff0c\u800c sleep() \u662f Thread \u7684\u9759\u6001\u65b9\u6cd5\uff1b"),(0,r.kt)("li",{parentName:"ul"},"wait() \u4f1a\u91ca\u653e\u9501\uff0csleep() \u4e0d\u4f1a\u3002"))),(0,r.kt)("li",{parentName:"ul"},"\u6709\u4ec0\u4e48\u533a\u522b",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"sleep() \u65b9\u6cd5\uff08\u4f11\u7720\uff09\u662f\u7ebf\u7a0b\u7c7b\uff08Thread\uff09\u7684\u9759\u6001\u65b9\u6cd5\uff0c\u8c03\u7528\u6b64\u65b9\u6cd5\u4f1a\u8ba9\u5f53\u524d\u7ebf\u7a0b\u6682\u505c\u6267\u884c\u6307\u5b9a\u7684\u65f6\u95f4\uff0c\u5c06\u6267\u884c\u673a\u4f1a\uff08CPU\uff09\u8ba9\u7ed9\u5176\u4ed6\u7ebf\u7a0b\uff0c\u4f46\u662f\u5bf9\u8c61\u7684\u9501\u4f9d\u7136\u4fdd\u6301\uff0c\u56e0\u6b64\u4f11\u7720\u65f6\u95f4\u7ed3\u675f\u540e\u4f1a\u81ea\u52a8\u6062\u590d\uff08\u7ebf\u7a0b\u56de\u5230\u5c31\u7eea\u72b6\u6001\uff09\u3002 "),(0,r.kt)("li",{parentName:"ul"},"wait() \u662f Object \u7c7b\u7684\u65b9\u6cd5\uff0c\u8c03\u7528\u5bf9\u8c61\u7684 wait() \u65b9\u6cd5\u5bfc\u81f4\u5f53\u524d\u7ebf\u7a0b\u653e\u5f03\u5bf9\u8c61\u7684\u9501\uff08\u7ebf\u7a0b\u6682\u505c\u6267\u884c\uff09\uff0c\u8fdb\u5165\u5bf9\u8c61\u7684\u7b49\u5f85\u6c60\uff08wait pool\uff09\uff0c\u53ea\u6709\u8c03\u7528\u5bf9\u8c61\u7684 notify() \u65b9\u6cd5\uff08\u6216 notifyAll() \u65b9\u6cd5\uff09\u65f6\u624d\u80fd\u5524\u9192\u7b49\u5f85\u6c60\u4e2d\u7684\u7ebf\u7a0b\u8fdb\u5165\u7b49\u9501\u6c60\uff08lock pool\uff09\uff0c\u5982\u679c\u7ebf\u7a0b\u91cd\u65b0\u83b7\u5f97\u5bf9\u8c61\u7684\u9501\u5c31\u53ef\u4ee5\u8fdb\u5165\u5c31\u7eea\u72b6\u6001\u3002 ")))),(0,r.kt)("h3",{id:"7-juc---aqs"},"7. J.U.C - AQS"),(0,r.kt)("p",null,"AQS \u662f  AbstractQueuedSynchronizer \u7684\u7b80\u79f0\uff0cjava.util.concurrent\uff08J.U.C\uff09\u5927\u5927\u63d0\u9ad8\u4e86\u5e76\u53d1\u6027\u80fd\uff0cAQS (AbstractQueuedSynchronizer) \u88ab\u8ba4\u4e3a\u662f J.U.C \u7684\u6838\u5fc3\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u57fa\u4e8e FIFO \u961f\u5217\uff0c\u8fd9\u4e2a\u961f\u5217\u53ef\u4ee5\u7528\u6765\u6784\u5efa\u9501\u6216\u8005\u5176\u4ed6\u76f8\u5173\u7684\u540c\u6b65\u88c5\u7f6e\u7684\u57fa\u7840\u6846\u67b6\u3002\u4e0b\u56fe\u662f AQS \u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\uff1a"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/616953-20160403170136176-573839888.png",width:"600"})),(0,r.kt)("p",null,"\u5b83\u5e95\u5c42\u4f7f\u7528\u7684\u662f\u53cc\u5411\u5217\u8868\uff0c\u662f\u961f\u5217\u7684\u4e00\u79cd\u5b9e\u73b0 , \u56e0\u6b64\u4e5f\u53ef\u4ee5\u5c06\u5b83\u5f53\u6210\u4e00\u79cd\u961f\u5217\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Sync queue \u662f\u540c\u6b65\u5217\u8868\uff0c\u5b83\u662f\u53cc\u5411\u5217\u8868 , \u5305\u62ec head\uff0ctail \u8282\u70b9\u3002\u5176\u4e2d head \u8282\u70b9\u4e3b\u8981\u7528\u6765\u540e\u7eed\u7684\u8c03\u5ea6 ;"),(0,r.kt)("li",{parentName:"ul"},"Condition queue \u662f\u5355\u5411\u94fe\u8868 , \u4e0d\u662f\u5fc5\u987b\u7684 , \u53ea\u6709\u5f53\u7a0b\u5e8f\u4e2d\u9700\u8981 Condition \u7684\u65f6\u5019\uff0c\u624d\u4f1a\u5b58\u5728\u8fd9\u4e2a\u5355\u5411\u94fe\u8868 , \u5e76\u4e14\u53ef\u80fd\u4f1a\u6709\u591a\u4e2a Condition queue\u3002")),(0,r.kt)("p",null,"\u7b80\u5355\u7684\u6765\u8bf4\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"AQS\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u53ef\u4ee5\u7ed9\u6211\u4eec\u5b9e\u73b0\u9501\u7684",(0,r.kt)("strong",{parentName:"p"},"\u6846\u67b6"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5185\u90e8\u5b9e\u73b0\u7684\u5173\u952e\u662f\uff1a",(0,r.kt)("strong",{parentName:"p"},"\u5148\u8fdb\u5148\u51fa\u7684\u961f\u5217\u3001state \u72b6\u6001"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5b9a\u4e49\u4e86\u5185\u90e8\u7c7b ConditionObject")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u62e5\u6709\u4e24\u79cd\u7ebf\u7a0b\u6a21\u5f0f")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u72ec\u5360\u6a21\u5f0f"),(0,r.kt)("li",{parentName:"ul"},"\u5171\u4eab\u6a21\u5f0f"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5728 LOCK \u5305\u4e2d\u7684\u76f8\u5173\u9501\uff08\u5e38\u7528\u7684\u6709 ReentrantLock\u3001 ReadWriteLock \uff09\u90fd\u662f\u57fa\u4e8e AQS \u6765\u6784\u5efa")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4e00\u822c\u6211\u4eec\u53eb AQS \u4e3a\u540c\u6b65\u5668\u3002"))),(0,r.kt)("h4",{id:"countdownlatch"},"CountdownLatch"),(0,r.kt)("p",null,"CountDownLatch \u7c7b\u4f4d\u4e8e java.util.concurrent \u5305\u4e0b\uff0c\u5229\u7528\u5b83\u53ef\u4ee5\u5b9e\u73b0\u7c7b\u4f3c\u8ba1\u6570\u5668\u7684\u529f\u80fd\u3002\u6bd4\u5982\u6709\u4e00\u4e2a\u4efb\u52a1 A\uff0c\u5b83\u8981\u7b49\u5f85\u5176\u4ed6 4 \u4e2a\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\u4e4b\u540e\u624d\u80fd\u6267\u884c\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u5229\u7528 CountDownLatch \u6765\u5b9e\u73b0\u8fd9\u79cd\u529f\u80fd\u4e86\u3002"),(0,r.kt)("p",null,"\u7ef4\u62a4\u4e86\u4e00\u4e2a\u8ba1\u6570\u5668 cnt\uff0c\u6bcf\u6b21\u8c03\u7528 countDown() \u65b9\u6cd5\u4f1a\u8ba9\u8ba1\u6570\u5668\u7684\u503c\u51cf 1\uff0c\u51cf\u5230 0 \u7684\u65f6\u5019\uff0c\u90a3\u4e9b\u56e0\u4e3a\u8c03\u7528 await() \u65b9\u6cd5\u800c\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b\u5c31\u4f1a\u88ab\u5524\u9192\u3002"),(0,r.kt)("div",{align:"center"}," ",(0,r.kt)("img",{src:"assets/CountdownLatch.png",width:""})),(0,r.kt)("p",null,"CountDownLatch \u7c7b\u53ea\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6784\u9020\u5668\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public CountDownLatch(int count) {  };  // \u53c2\u6570count\u4e3a\u8ba1\u6570\u503c\n")),(0,r.kt)("p",null,"\u7136\u540e\u4e0b\u9762\u8fd9 3 \u4e2a\u65b9\u6cd5\u662f CountDownLatch \u7c7b\u4e2d\u6700\u91cd\u8981\u7684\u65b9\u6cd5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"//\u8c03\u7528await()\u65b9\u6cd5\u7684\u7ebf\u7a0b\u4f1a\u88ab\u6302\u8d77\uff0c\u5b83\u4f1a\u7b49\u5f85\u76f4\u5230count\u503c\u4e3a0\u624d\u7ee7\u7eed\u6267\u884c\npublic void await() throws InterruptedException { };\n//\u548cawait()\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u7b49\u5f85\u4e00\u5b9a\u7684\u65f6\u95f4\u540ecount\u503c\u8fd8\u6ca1\u53d8\u4e3a0\u7684\u8bdd\u5c31\u4f1a\u7ee7\u7eed\u6267\u884c\npublic boolean await(long timeout, TimeUnit unit) throws InterruptedException { };\n//\u5c06count\u503c\u51cf1\npublic void countDown() { };\n")),(0,r.kt)("p",null,"\u4e0b\u9762\u770b\u4e00\u4e2a\u4f8b\u5b50\u5927\u5bb6\u5c31\u6e05\u695a CountDownLatch \u7684\u7528\u6cd5\u4e86\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class Test {\n    public static void main(String[] args) {\n        final CountDownLatch latch = new CountDownLatch(2);\n        new Thread() {\n            public void run() {\n                try {\n                    System.out.println("\u5b50\u7ebf\u7a0b" + Thread.currentThread().getName() + "\u6b63\u5728\u6267\u884c");\n                    Thread.sleep(3000);\n                    System.out.println("\u5b50\u7ebf\u7a0b" + Thread.currentThread().getName() + "\u6267\u884c\u5b8c\u6bd5");\n                    latch.countDown();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n\n            ;\n        }.start();\n        new Thread() {\n            public void run() {\n                try {\n                    System.out.println("\u5b50\u7ebf\u7a0b" + Thread.currentThread().getName() + "\u6b63\u5728\u6267\u884c");\n                    Thread.sleep(3000);\n                    System.out.println("\u5b50\u7ebf\u7a0b" + Thread.currentThread().getName() + "\u6267\u884c\u5b8c\u6bd5");\n                    latch.countDown();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n\n            ;\n        }.start();\n        try {\n            System.out.println("\u7b49\u5f852\u4e2a\u5b50\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5...");\n            latch.await();\n            System.out.println("2\u4e2a\u5b50\u7ebf\u7a0b\u5df2\u7ecf\u6267\u884c\u5b8c\u6bd5");\n            System.out.println("\u7ee7\u7eed\u6267\u884c\u4e3b\u7ebf\u7a0b");\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n')),(0,r.kt)("p",null,"\u6267\u884c\u7ed3\u679c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u7ebf\u7a0bThread-0\u6b63\u5728\u6267\u884c\n\u7ebf\u7a0bThread-1\u6b63\u5728\u6267\u884c\n\u7b49\u5f852\u4e2a\u5b50\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5...\n\u7ebf\u7a0bThread-0\u6267\u884c\u5b8c\u6bd5\n\u7ebf\u7a0bThread-1\u6267\u884c\u5b8c\u6bd5\n2\u4e2a\u5b50\u7ebf\u7a0b\u5df2\u7ecf\u6267\u884c\u5b8c\u6bd5\n\u7ee7\u7eed\u6267\u884c\u4e3b\u7ebf\u7a0b\n")),(0,r.kt)("h4",{id:"cyclicbarrier"},"CyclicBarrier"),(0,r.kt)("p",null,"\u7528\u6765\u63a7\u5236\u591a\u4e2a\u7ebf\u7a0b\u4e92\u76f8\u7b49\u5f85\uff0c\u53ea\u6709\u5f53\u591a\u4e2a\u7ebf\u7a0b\u90fd\u5230\u8fbe\u65f6\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u624d\u4f1a\u7ee7\u7eed\u6267\u884c\u3002"),(0,r.kt)("p",null,"\u548c CountdownLatch \u76f8\u4f3c\uff0c\u90fd\u662f\u901a\u8fc7\u7ef4\u62a4\u8ba1\u6570\u5668\u6765\u5b9e\u73b0\u7684\u3002\u4f46\u662f\u5b83\u7684\u8ba1\u6570\u5668\u662f\u9012\u589e\u7684\uff0c\u6bcf\u6b21\u6267\u884c await() \u65b9\u6cd5\u4e4b\u540e\uff0c\u8ba1\u6570\u5668\u4f1a\u52a0 1\uff0c\u76f4\u5230\u8ba1\u6570\u5668\u7684\u503c\u548c\u8bbe\u7f6e\u7684\u503c\u76f8\u7b49\uff0c\u7b49\u5f85\u7684\u6240\u6709\u7ebf\u7a0b\u624d\u4f1a\u7ee7\u7eed\u6267\u884c\u3002\u548c CountdownLatch \u7684\u53e6\u4e00\u4e2a\u533a\u522b\u662f\uff0cCyclicBarrier \u7684\u8ba1\u6570\u5668\u53ef\u4ee5\u5faa\u73af\u4f7f\u7528\uff0c\u6240\u4ee5\u5b83\u624d\u53eb\u505a\u5faa\u73af\u5c4f\u969c\u3002"),(0,r.kt)("p",null,"\u4e0b\u56fe\u5e94\u8be5\u4ece\u4e0b\u5f80\u4e0a\u770b\u624d\u6b63\u786e\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/CyclicBarrier.png",width:""})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class CyclicBarrierExample {\n    public static void main(String[] args) throws InterruptedException {\n        final int totalThread = 10;\n        CyclicBarrier cyclicBarrier = new CyclicBarrier(totalThread);\n        ExecutorService executorService = Executors.newCachedThreadPool();\n        for (int i = 0; i < totalThread; i++) {\n            executorService.execute(() -> {\n                System.out.print("before..");\n                try {\n                    cyclicBarrier.await();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                } catch (BrokenBarrierException e) {\n                    e.printStackTrace();\n                }\n                System.out.print("after..");\n            });\n        }\n        executorService.shutdown();\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"before..before..before..before..before..before..before..before..before..before..after..after..after..after..after..after..after..after..after..after..\n")),(0,r.kt)("h4",{id:"semaphore"},"Semaphore"),(0,r.kt)("p",null,"Semaphore \u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4fe1\u53f7\u91cf\uff0c\u53ef\u4ee5\u63a7\u5236\u5bf9\u4e92\u65a5\u8d44\u6e90\u7684\u8bbf\u95ee\u7ebf\u7a0b\u6570\u3002Semaphore \u53ef\u4ee5\u63a7\u540c\u65f6\u8bbf\u95ee\u7684\u7ebf\u7a0b\u4e2a\u6570\uff0c\u901a\u8fc7 acquire() \u83b7\u53d6\u4e00\u4e2a\u8bb8\u53ef\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u7b49\u5f85\uff0c\u800c release() \u91ca\u653e\u4e00\u4e2a\u8bb8\u53ef\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/Semaphore.png",width:""})),(0,r.kt)("br",null),(0,r.kt)("p",null,"Semaphore \u7c7b\u4f4d\u4e8e java.util.concurrent \u5305\u4e0b\uff0c\u5b83\u63d0\u4f9b\u4e862\u4e2a\u6784\u9020\u5668\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public Semaphore(int permits) {          \n    //\u53c2\u6570permits\u8868\u793a\u8bb8\u53ef\u6570\u76ee\uff0c\u5373\u540c\u65f6\u53ef\u4ee5\u5141\u8bb8\u591a\u5c11\u7ebf\u7a0b\u8fdb\u884c\u8bbf\u95ee\n    sync = new NonfairSync(permits);\n}\n\npublic Semaphore(int permits, boolean fair) {    \n    //\u8fd9\u4e2a\u591a\u4e86\u4e00\u4e2a\u53c2\u6570fair\u8868\u793a\u662f\u5426\u662f\u516c\u5e73\u7684\uff0c\u5373\u7b49\u5f85\u65f6\u95f4\u8d8a\u4e45\u7684\u8d8a\u5148\u83b7\u53d6\u8bb8\u53ef    \n    sync = (fair) ? new FairSync(permits) : new NonfairSync(permits);\n}\n")),(0,r.kt)("p",null,"\u4e0b\u9762\u8bf4\u4e00\u4e0b Semaphore \u7c7b\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u51e0\u4e2a\u65b9\u6cd5\uff0c\u9996\u5148\u662f acquire()\u3001release() \u65b9\u6cd5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"//\u83b7\u53d6\u4e00\u4e2a\u8bb8\u53ef\npublic void acquire() throws InterruptedException {  }\n//\u83b7\u53d6permits\u4e2a\u8bb8\u53ef\npublic void acquire(int permits) throws InterruptedException { }\n//\u91ca\u653e\u4e00\u4e2a\u8bb8\u53ef\npublic void release() { }\n//\u91ca\u653epermits\u4e2a\u8bb8\u53ef\npublic void release(int permits) { }\n")),(0,r.kt)("p",null,"\u3000\u3000acquire() \u7528\u6765\u83b7\u53d6\u4e00\u4e2a\u8bb8\u53ef\uff0c\u82e5\u65e0\u8bb8\u53ef\u80fd\u591f\u83b7\u5f97\uff0c\u5219\u4f1a\u4e00\u76f4\u7b49\u5f85\uff0c\u76f4\u5230\u83b7\u5f97\u8bb8\u53ef\u3002"),(0,r.kt)("p",null,"\u3000\u3000release() \u7528\u6765\u91ca\u653e\u8bb8\u53ef\u3002\u6ce8\u610f\uff0c\u5728\u91ca\u653e\u8bb8\u53ef\u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u83b7\u83b7\u5f97\u8bb8\u53ef\u3002"),(0,r.kt)("p",null,"\u8fd9 4 \u4e2a\u65b9\u6cd5\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u5982\u679c\u60f3\u7acb\u5373\u5f97\u5230\u6267\u884c\u7ed3\u679c\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u51e0\u4e2a\u65b9\u6cd5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"//\u5c1d\u8bd5\u83b7\u53d6\u4e00\u4e2a\u8bb8\u53ef\uff0c\u82e5\u83b7\u53d6\u6210\u529f\uff0c\u5219\u7acb\u5373\u8fd4\u56detrue\uff0c\u82e5\u83b7\u53d6\u5931\u8d25\uff0c\u5219\u7acb\u5373\u8fd4\u56defalse\npublic boolean tryAcquire() { };    \n//\u5c1d\u8bd5\u83b7\u53d6\u4e00\u4e2a\u8bb8\u53ef\uff0c\u82e5\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u5185\u83b7\u53d6\u6210\u529f\uff0c\u5219\u7acb\u5373\u8fd4\u56detrue\uff0c\u5426\u5219\u5219\u7acb\u5373\u8fd4\u56defalse\npublic boolean tryAcquire(long timeout, TimeUnit unit) throws InterruptedException { }; \n//\u5c1d\u8bd5\u83b7\u53d6permits\u4e2a\u8bb8\u53ef\uff0c\u82e5\u83b7\u53d6\u6210\u529f\uff0c\u5219\u7acb\u5373\u8fd4\u56detrue\uff0c\u82e5\u83b7\u53d6\u5931\u8d25\uff0c\u5219\u7acb\u5373\u8fd4\u56defalse\npublic boolean tryAcquire(int permits) { }; \n//\u5c1d\u8bd5\u83b7\u53d6permits\u4e2a\u8bb8\u53ef\uff0c\u82e5\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u5185\u83b7\u53d6\u6210\u529f\uff0c\u5219\u7acb\u5373\u8fd4\u56detrue\uff0c\u5426\u5219\u5219\u7acb\u5373\u8fd4\u56defalse\npublic boolean tryAcquire(int permits, long timeout, TimeUnit unit) throws InterruptedException { }; \n")),(0,r.kt)("p",null,"\u3000\u3000\u53e6\u5916\u8fd8\u53ef\u4ee5\u901a\u8fc7 availablePermits() \u65b9\u6cd5\u5f97\u5230\u53ef\u7528\u7684\u8bb8\u53ef\u6570\u76ee\u3002"),(0,r.kt)("p",null,"\u3000\u3000\u4e0b\u9762\u901a\u8fc7\u4e00\u4e2a\u4f8b\u5b50\u6765\u770b\u4e00\u4e0b Semaphore \u7684\u5177\u4f53\u4f7f\u7528\uff1a"),(0,r.kt)("p",null,"\u3000\u3000\u5047\u82e5\u4e00\u4e2a\u5de5\u5382\u6709 5 \u53f0\u673a\u5668\uff0c\u4f46\u662f\u6709 8 \u4e2a\u5de5\u4eba\uff0c\u4e00\u53f0\u673a\u5668\u540c\u65f6\u53ea\u80fd\u88ab\u4e00\u4e2a\u5de5\u4eba\u4f7f\u7528\uff0c\u53ea\u6709\u4f7f\u7528\u5b8c\u4e86\uff0c\u5176\u4ed6\u5de5\u4eba\u624d\u80fd\u7ee7\u7eed\u4f7f\u7528\u3002\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 Semaphore \u6765\u5b9e\u73b0\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class Test {\n    public static void main(String[] args) {\n        int N = 8;            //\u5de5\u4eba\u6570        \n        Semaphore semaphore = new Semaphore(5); //\u673a\u5668\u6570\u76ee       \n        for (int i = 0; i < N; i++) new Worker(i, semaphore).start();\n    }\n\n    static class Worker extends Thread {\n        private int num;\n        private Semaphore semaphore;\n\n        public Worker(int num, Semaphore semaphore) {\n            this.num = num;\n            this.semaphore = semaphore;\n        }\n        \n        @Override\n        public void run() {\n            try {\n                semaphore.acquire();\n                System.out.println("\u5de5\u4eba" + this.num + "\u5360\u7528\u4e00\u4e2a\u673a\u5668\u5728\u751f\u4ea7...");\n                Thread.sleep(2000);\n                System.out.println("\u5de5\u4eba" + this.num + "\u91ca\u653e\u51fa\u673a\u5668");\n                semaphore.release();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n')),(0,r.kt)("p",null,"\u6267\u884c\u7ed3\u679c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u5de5\u4eba0\u5360\u7528\u4e00\u4e2a\u673a\u5668\u5728\u751f\u4ea7...\n\u5de5\u4eba1\u5360\u7528\u4e00\u4e2a\u673a\u5668\u5728\u751f\u4ea7...\n\u5de5\u4eba2\u5360\u7528\u4e00\u4e2a\u673a\u5668\u5728\u751f\u4ea7...\n\u5de5\u4eba4\u5360\u7528\u4e00\u4e2a\u673a\u5668\u5728\u751f\u4ea7...\n\u5de5\u4eba5\u5360\u7528\u4e00\u4e2a\u673a\u5668\u5728\u751f\u4ea7...\n\u5de5\u4eba0\u91ca\u653e\u51fa\u673a\u5668\n\u5de5\u4eba2\u91ca\u653e\u51fa\u673a\u5668\n\u5de5\u4eba3\u5360\u7528\u4e00\u4e2a\u673a\u5668\u5728\u751f\u4ea7...\n\u5de5\u4eba7\u5360\u7528\u4e00\u4e2a\u673a\u5668\u5728\u751f\u4ea7...\n\u5de5\u4eba4\u91ca\u653e\u51fa\u673a\u5668\n\u5de5\u4eba5\u91ca\u653e\u51fa\u673a\u5668\n\u5de5\u4eba1\u91ca\u653e\u51fa\u673a\u5668\n\u5de5\u4eba6\u5360\u7528\u4e00\u4e2a\u673a\u5668\u5728\u751f\u4ea7...\n\u5de5\u4eba3\u91ca\u653e\u51fa\u673a\u5668\n\u5de5\u4eba7\u91ca\u653e\u51fa\u673a\u5668\n\u5de5\u4eba6\u91ca\u653e\u51fa\u673a\u5668\n")),(0,r.kt)("h4",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,r.kt)("p",null,"\u4e0b\u9762\u5bf9\u4e0a\u9762\u8bf4\u7684\u4e09\u4e2a\u8f85\u52a9\u7c7b\u8fdb\u884c\u4e00\u4e2a\u603b\u7ed3\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CountDownLatch \u548c CyclicBarrier \u90fd\u80fd\u591f\u5b9e\u73b0\u7ebf\u7a0b\u4e4b\u95f4\u7684\u7b49\u5f85\uff0c\u53ea\u4e0d\u8fc7\u5b83\u4eec\u4fa7\u91cd\u70b9\u4e0d\u540c\uff1a",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"CountDownLatch \u4e00\u822c\u7528\u4e8e\u67d0\u4e2a\u7ebf\u7a0bA\u7b49\u5f85\u82e5\u5e72\u4e2a\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u5b8c\u4efb\u52a1\u4e4b\u540e\uff0c\u5b83\u624d\u6267\u884c\uff1b"),(0,r.kt)("li",{parentName:"ul"},"CyclicBarrier \u4e00\u822c\u7528\u4e8e\u4e00\u7ec4\u7ebf\u7a0b\u4e92\u76f8\u7b49\u5f85\u81f3\u67d0\u4e2a\u72b6\u6001\uff0c\u7136\u540e\u8fd9\u4e00\u7ec4\u7ebf\u7a0b\u518d\u540c\u65f6\u6267\u884c\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u53e6\u5916\uff0cCountDownLatch \u662f\u4e0d\u80fd\u591f\u91cd\u7528\u7684\uff0c\u800c CyclicBarrier \u662f\u53ef\u4ee5\u91cd\u7528\u7684\u3002"))),(0,r.kt)("li",{parentName:"ul"},"Semaphore \u5176\u5b9e\u548c\u9501\u6709\u70b9\u7c7b\u4f3c\uff0c\u5b83\u4e00\u822c\u7528\u4e8e\u63a7\u5236\u5bf9\u67d0\u7ec4\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u3002")),(0,r.kt)("h3",{id:"8-juc---\u5176\u5b83\u7ec4\u4ef6"},"8. J.U.C - \u5176\u5b83\u7ec4\u4ef6"),(0,r.kt)("h4",{id:"futuretask"},"FutureTask"),(0,r.kt)("p",null,"\u5728\u4ecb\u7ecd Callable \u65f6\u6211\u4eec\u77e5\u9053\u5b83\u53ef\u4ee5\u6709\u8fd4\u56de\u503c\uff0c\u8fd4\u56de\u503c\u901a\u8fc7 Future \u8fdb\u884c\u5c01\u88c5\u3002FutureTask \u5b9e\u73b0\u4e86 RunnableFuture \u63a5\u53e3\uff0c\u8be5\u63a5\u53e3\u7ee7\u627f\u81ea Runnable \u548c Future \u63a5\u53e3\uff0c\u8fd9\u4f7f\u5f97 FutureTask \u65e2\u53ef\u4ee5\u5f53\u505a\u4e00\u4e2a\u4efb\u52a1\u6267\u884c\uff0c\u4e5f\u53ef\u4ee5\u6709\u8fd4\u56de\u503c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class FutureTask<V> implements RunnableFuture<V>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public interface RunnableFuture<V> extends Runnable, Future<V>\n")),(0,r.kt)("p",null,"FutureTask \u53ef\u7528\u4e8e\u5f02\u6b65\u83b7\u53d6\u6267\u884c\u7ed3\u679c\u6216\u53d6\u6d88\u6267\u884c\u4efb\u52a1\u7684\u573a\u666f\u3002\u5f53\u4e00\u4e2a\u8ba1\u7b97\u4efb\u52a1\u9700\u8981\u6267\u884c\u5f88\u957f\u65f6\u95f4\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7528 FutureTask \u6765\u5c01\u88c5\u8fd9\u4e2a\u4efb\u52a1\uff0c\u4e3b\u7ebf\u7a0b\u5728\u5b8c\u6210\u81ea\u5df1\u7684\u4efb\u52a1\u4e4b\u540e\u518d\u53bb\u83b7\u53d6\u7ed3\u679c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class FutureTaskExample {\n    public static void main(String[] args) throws ExecutionException, InterruptedException {\n        FutureTask<Integer> futureTask = new FutureTask<Integer>(new Callable<Integer>() {\n            @Override\n            public Integer call() throws Exception {\n                int result = 0;\n                for (int i = 0; i < 100; i++) {\n                    Thread.sleep(10);\n                    result += i;\n                }\n                return result;\n            }\n        });\n\n        Thread computeThread = new Thread(futureTask);\n        computeThread.start();\n\n        Thread otherThread = new Thread(() -> {\n            System.out.println("other task is running...");\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        });\n        otherThread.start();\n        System.out.println(futureTask.get());\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"other task is running...\n4950\n")),(0,r.kt)("h4",{id:"blockingqueue"},"BlockingQueue"),(0,r.kt)("p",null,"java.util.concurrent.BlockingQueue \u63a5\u53e3\u6709\u4ee5\u4e0b\u963b\u585e\u961f\u5217\u7684\u5b9e\u73b0\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"FIFO \u961f\u5217")," \uff1aLinkedBlockingQueue\u3001ArrayBlockingQueue\uff08\u56fa\u5b9a\u957f\u5ea6\uff09"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u4f18\u5148\u7ea7\u961f\u5217")," \uff1aPriorityBlockingQueue")),(0,r.kt)("p",null,"\u63d0\u4f9b\u4e86\u963b\u585e\u7684 take() \u548c put() \u65b9\u6cd5\uff1a\u5982\u679c\u961f\u5217\u4e3a\u7a7a take() \u5c06\u963b\u585e\uff0c\u76f4\u5230\u961f\u5217\u4e2d\u6709\u5185\u5bb9\uff1b\u5982\u679c\u961f\u5217\u4e3a\u6ee1 put() \u5c06\u963b\u585e\uff0c\u76f4\u5230\u961f\u5217\u6709\u7a7a\u95f2\u4f4d\u7f6e\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u4f7f\u7528 BlockingQueue \u5b9e\u73b0\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u95ee\u9898")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class ProducerConsumer {\n\n    private static BlockingQueue<String> queue = new ArrayBlockingQueue<>(5);\n\n    private static class Producer extends Thread {\n        @Override\n        public void run() {\n            try {\n                queue.put("product");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.print("produce..");\n        }\n    }\n\n    private static class Consumer extends Thread {\n\n        @Override\n        public void run() {\n            try {\n                String product = queue.take();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.print("consume..");\n        }\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    for (int i = 0; i < 2; i++) {\n        Producer producer = new Producer();\n        producer.start();\n    }\n    for (int i = 0; i < 5; i++) {\n        Consumer consumer = new Consumer();\n        consumer.start();\n    }\n    for (int i = 0; i < 3; i++) {\n        Producer producer = new Producer();\n        producer.start();\n    }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"produce..produce..consume..consume..produce..consume..produce..consume..produce..consume..\n")),(0,r.kt)("h4",{id:"forkjoin"},"ForkJoin"),(0,r.kt)("p",null,"\u4e3b\u8981\u7528\u4e8e\u5e76\u884c\u8ba1\u7b97\u4e2d\uff0c\u548c MapReduce \u539f\u7406\u7c7b\u4f3c\uff0c\u90fd\u662f\u628a\u5927\u7684\u8ba1\u7b97\u4efb\u52a1\u62c6\u5206\u6210\u591a\u4e2a\u5c0f\u4efb\u52a1\u5e76\u884c\u8ba1\u7b97\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class ForkJoinExample extends RecursiveTask<Integer> {\n    private final int threshold = 5;\n    private int first;\n    private int last;\n\n    public ForkJoinExample(int first, int last) {\n        this.first = first;\n        this.last = last;\n    }\n\n    @Override\n    protected Integer compute() {\n        int result = 0;\n        if (last - first <= threshold) {\n            // \u4efb\u52a1\u8db3\u591f\u5c0f\u5219\u76f4\u63a5\u8ba1\u7b97\n            for (int i = first; i <= last; i++) {\n                result += i;\n            }\n        } else {\n            // \u62c6\u5206\u6210\u5c0f\u4efb\u52a1\n            int middle = first + (last - first) / 2;\n            ForkJoinExample leftTask = new ForkJoinExample(first, middle);\n            ForkJoinExample rightTask = new ForkJoinExample(middle + 1, last);\n            leftTask.fork();\n            rightTask.fork();\n            result = leftTask.join() + rightTask.join();\n        }\n        return result;\n    }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"public static void main(String[] args) throws ExecutionException, InterruptedException {\n    ForkJoinExample example = new ForkJoinExample(1, 10000);\n    ForkJoinPool forkJoinPool = new ForkJoinPool();\n    Future result = forkJoinPool.submit(example);\n    System.out.println(result.get());\n}\n")),(0,r.kt)("p",null,"ForkJoin \u4f7f\u7528 ForkJoinPool \u6765\u542f\u52a8\uff0c\u5b83\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u7ebf\u7a0b\u6c60\uff0c\u7ebf\u7a0b\u6570\u91cf\u53d6\u51b3\u4e8e CPU \u6838\u6570\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class ForkJoinPool extends AbstractExecutorService\n")),(0,r.kt)("p",null,"ForkJoinPool \u5b9e\u73b0\u4e86\u5de5\u4f5c\u7a83\u53d6\u7b97\u6cd5\u6765\u63d0\u9ad8 CPU \u7684\u5229\u7528\u7387\u3002\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u7ef4\u62a4\u4e86\u4e00\u4e2a\u53cc\u7aef\u961f\u5217\uff0c\u7528\u6765\u5b58\u50a8\u9700\u8981\u6267\u884c\u7684\u4efb\u52a1\u3002\u5de5\u4f5c\u7a83\u53d6\u7b97\u6cd5\u5141\u8bb8\u7a7a\u95f2\u7684\u7ebf\u7a0b\u4ece\u5176\u5b83\u7ebf\u7a0b\u7684\u53cc\u7aef\u961f\u5217\u4e2d\u7a83\u53d6\u4e00\u4e2a\u4efb\u52a1\u6765\u6267\u884c\u3002\u7a83\u53d6\u7684\u4efb\u52a1\u5fc5\u987b\u662f\u6700\u665a\u7684\u4efb\u52a1\uff0c\u907f\u514d\u548c\u961f\u5217\u6240\u5c5e\u7ebf\u7a0b\u53d1\u751f\u7ade\u4e89\u3002\u4f8b\u5982\u4e0b\u56fe\u4e2d\uff0cThread2 \u4ece Thread1 \u7684\u961f\u5217\u4e2d\u62ff\u51fa\u6700\u665a\u7684 Task1 \u4efb\u52a1\uff0cThread1 \u4f1a\u62ff\u51fa Task2 \u6765\u6267\u884c\uff0c\u8fd9\u6837\u5c31\u907f\u514d\u53d1\u751f\u7ade\u4e89\u3002\u4f46\u662f\u5982\u679c\u961f\u5217\u4e2d\u53ea\u6709\u4e00\u4e2a\u4efb\u52a1\u65f6\u8fd8\u662f\u4f1a\u53d1\u751f\u7ade\u4e89\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/fork-and-join.jpg",width:"600"})),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"9-\u7ebf\u7a0b\u4e0d\u5b89\u5168\u793a\u4f8b"},"9. \u7ebf\u7a0b\u4e0d\u5b89\u5168\u793a\u4f8b"),(0,r.kt)("p",null,"\u5982\u679c\u591a\u4e2a\u7ebf\u7a0b\u5bf9\u540c\u4e00\u4e2a\u5171\u4eab\u6570\u636e\u8fdb\u884c\u8bbf\u95ee\u800c\u4e0d\u91c7\u53d6\u540c\u6b65\u64cd\u4f5c\u7684\u8bdd\uff0c\u90a3\u4e48\u64cd\u4f5c\u7684\u7ed3\u679c\u662f\u4e0d\u4e00\u81f4\u7684\u3002"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u4ee3\u7801\u6f14\u793a\u4e86 1000 \u4e2a\u7ebf\u7a0b\u540c\u65f6\u5bf9 cnt \u6267\u884c\u81ea\u589e\u64cd\u4f5c\uff0c\u64cd\u4f5c\u7ed3\u675f\u4e4b\u540e\u5b83\u7684\u503c\u4e3a 997 \u800c\u4e0d\u662f 1000\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class ThreadUnsafeExample {\n    private int cnt = 0;\n    public void add() {\n        cnt++;\n    }\n    public int get() {\n        return cnt;\n    }\n}\n\npublic static void main(String[] args) throws InterruptedException {\n    final int threadSize = 1000;\n    ThreadUnsafeExample example = new ThreadUnsafeExample();\n    final CountDownLatch countDownLatch = new CountDownLatch(threadSize);\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    for (int i = 0; i < threadSize; i++) {\n        executorService.execute(() -> {\n            example.add();\n            countDownLatch.countDown();\n        });\n    }\n    countDownLatch.await();\n    executorService.shutdown();\n    System.out.println(example.get());\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"997\n")),(0,r.kt)("h3",{id:"10-java-\u5185\u5b58\u6a21\u578bjmm"},"10. Java \u5185\u5b58\u6a21\u578b\uff08JMM\uff09"),(0,r.kt)("p",null,"Java \u5185\u5b58\u6a21\u578b\u8bd5\u56fe\u5c4f\u853d\u5404\u79cd\u786c\u4ef6\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u8bbf\u95ee\u5dee\u5f02\uff0c\u4ee5\u5b9e\u73b0\u8ba9 Java \u7a0b\u5e8f\u5728\u5404\u79cd\u5e73\u53f0\u4e0b\u90fd\u80fd\u8fbe\u5230\u4e00\u81f4\u7684\u5185\u5b58\u8bbf\u95ee\u6548\u679c\u3002"),(0,r.kt)("h4",{id:"\u4e3b\u5185\u5b58\u4e0e\u5de5\u4f5c\u5185\u5b58"},"\u4e3b\u5185\u5b58\u4e0e\u5de5\u4f5c\u5185\u5b58"),(0,r.kt)("p",null,"\u5904\u7406\u5668\u4e0a\u7684\u5bc4\u5b58\u5668\u7684\u8bfb\u5199\u7684\u901f\u5ea6\u6bd4\u5185\u5b58\u5feb\u51e0\u4e2a\u6570\u91cf\u7ea7\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u79cd\u901f\u5ea6\u77db\u76fe\uff0c\u5728\u5b83\u4eec\u4e4b\u95f4\u52a0\u5165\u4e86\u9ad8\u901f\u7f13\u5b58\u3002"),(0,r.kt)("p",null,"\u52a0\u5165\u9ad8\u901f\u7f13\u5b58\u5e26\u6765\u4e86\u4e00\u4e2a\u65b0\u7684\u95ee\u9898\uff1a\u7f13\u5b58\u4e00\u81f4\u6027\u3002\u5982\u679c\u591a\u4e2a\u7f13\u5b58\u5171\u4eab\u540c\u4e00\u5757\u4e3b\u5185\u5b58\u533a\u57df\uff0c\u90a3\u4e48\u591a\u4e2a\u7f13\u5b58\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u4e0d\u4e00\u81f4\uff0c\u9700\u8981\u4e00\u4e9b\u534f\u8bae\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002"),(0,r.kt)("div",{align:"center"}," ",(0,r.kt)("img",{src:"assets/1195582-20180508173147029-1341787720.png",width:"700"})),(0,r.kt)("p",null,"\u6240\u6709\u7684\u53d8\u91cf\u90fd\u5b58\u50a8\u5728",(0,r.kt)("strong",{parentName:"p"},"\u4e3b\u5185\u5b58"),"\u4e2d\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u8fd8\u6709\u81ea\u5df1\u7684",(0,r.kt)("strong",{parentName:"p"},"\u5de5\u4f5c\u5185\u5b58"),"\uff0c\u5de5\u4f5c\u5185\u5b58\u5b58\u50a8\u5728\u9ad8\u901f\u7f13\u5b58\u6216\u8005\u5bc4\u5b58\u5668\u4e2d\uff0c\u4fdd\u5b58\u4e86\u8be5\u7ebf\u7a0b\u4f7f\u7528\u7684\u53d8\u91cf\u7684\u4e3b\u5185\u5b58\u526f\u672c\u62f7\u8d1d\u3002"),(0,r.kt)("p",null,"\u7ebf\u7a0b\u53ea\u80fd\u76f4\u63a5\u64cd\u4f5c\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u4e0d\u540c\u7ebf\u7a0b\u4e4b\u95f4\u7684\u53d8\u91cf\u503c\u4f20\u9012\u9700\u8981\u901a\u8fc7\u4e3b\u5185\u5b58\u6765\u5b8c\u6210\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Java\u5185\u5b58\u6a21\u578b\u548c\u786c\u4ef6\u5173\u7cfb\u56fe")),(0,r.kt)("div",{align:"center"}," ",(0,r.kt)("img",{src:"assets/v2-4015322359279c5568263aeb7f41c36d.jpg",width:"600"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Java\u5185\u5b58\u6a21\u578b\u62bd\u8c61\u7ed3\u6784\u56fe")),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/1135283-20170403195814660-1521573510.png",width:"400"})),(0,r.kt)("h4",{id:"\u5185\u5b58\u95f4\u4ea4\u4e92\u64cd\u4f5c"},"\u5185\u5b58\u95f4\u4ea4\u4e92\u64cd\u4f5c"),(0,r.kt)("p",null,"Java \u5185\u5b58\u6a21\u578b\u5b9a\u4e49\u4e86 8 \u4e2a\u64cd\u4f5c\u6765\u5b8c\u6210\u4e3b\u5185\u5b58\u548c\u5de5\u4f5c\u5185\u5b58\u7684\u4ea4\u4e92\u64cd\u4f5c\u3002"),(0,r.kt)("div",{align:"center"}," ",(0,r.kt)("img",{src:"assets/536c6dfd-305a-4b95-b12c-28ca5e8aa043.png",width:"650"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"read\uff1a\u628a\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4ece\u4e3b\u5185\u5b58\u4f20\u8f93\u5230\u5de5\u4f5c\u5185\u5b58\u4e2d"),(0,r.kt)("li",{parentName:"ul"},"load\uff1a\u5728 read \u4e4b\u540e\u6267\u884c\uff0c\u628a read \u5f97\u5230\u7684\u503c\u653e\u5165\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf\u526f\u672c\u4e2d"),(0,r.kt)("li",{parentName:"ul"},"use\uff1a\u628a\u5de5\u4f5c\u5185\u5b58\u4e2d\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4f20\u9012\u7ed9\u6267\u884c\u5f15\u64ce"),(0,r.kt)("li",{parentName:"ul"},"assign\uff1a\u628a\u4e00\u4e2a\u4ece\u6267\u884c\u5f15\u64ce\u63a5\u6536\u5230\u7684\u503c\u8d4b\u7ed9\u5de5\u4f5c\u5185\u5b58\u7684\u53d8\u91cf"),(0,r.kt)("li",{parentName:"ul"},"store\uff1a\u628a\u5de5\u4f5c\u5185\u5b58\u7684\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u4f20\u9001\u5230\u4e3b\u5185\u5b58\u4e2d"),(0,r.kt)("li",{parentName:"ul"},"write\uff1a\u5728 store \u4e4b\u540e\u6267\u884c\uff0c\u628a store \u5f97\u5230\u7684\u503c\u653e\u5165\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\u4e2d"),(0,r.kt)("li",{parentName:"ul"},"lock\uff1a\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u7684\u53d8\u91cf\uff0c\u628a\u4e00\u4e2a\u53d8\u91cf\u6807\u8bc6\u4e3a\u4e00\u6761\u7ebf\u7a0b\u72ec\u5360\u72b6\u6001"),(0,r.kt)("li",{parentName:"ul"},"unlock\uff1a\u4f5c\u7528\u4e8e\u4e3b\u5185\u5b58\u53d8\u91cf\uff0c\u628a\u4e00\u4e2a\u5904\u4e8e\u9501\u5b9a\u72b6\u6001\u7684\u53d8\u91cf\u91ca\u653e\u51fa\u6765\uff0c\u91ca\u653e\u540e\u7684\u53d8\u91cf\u624d\u53ef\u4ee5\u88ab\u5176\u4ed6\u7ebf\u7a0b\u9501\u5b9a")),(0,r.kt)("p",null,"\u5982\u679c\u8981\u628a\u4e00\u4e2a\u53d8\u91cf\u4ece\u4e3b\u5185\u5b58\u4e2d\u590d\u5236\u5230\u5de5\u4f5c\u5185\u5b58\uff0c\u5c31\u9700\u8981\u6309\u987a\u5bfb\u5730\u6267\u884c read \u548c load \u64cd\u4f5c\uff0c\u5982\u679c\u628a\u53d8\u91cf\u4ece\u5de5\u4f5c\u5185\u5b58\u4e2d\u540c\u6b65\u56de\u4e3b\u5185\u5b58\u4e2d\uff0c\u5c31\u8981\u6309\u987a\u5e8f\u5730\u6267\u884c store \u548c write \u64cd\u4f5c\u3002Java\u5185\u5b58\u6a21\u578b\u53ea\u8981\u6c42\u4e0a\u8ff0\u64cd\u4f5c\u5fc5\u987b\u6309\u987a\u5e8f\u6267\u884c\uff0c\u800c\u6ca1\u6709\u4fdd\u8bc1\u5fc5\u987b\u662f\u8fde\u7eed\u6267\u884c\u3002\u4e5f\u5c31\u662f read \u548c load \u4e4b\u95f4\uff0cstore \u548c write \u4e4b\u95f4\u662f\u53ef\u4ee5\u63d2\u5165\u5176\u4ed6\u6307\u4ee4\u7684\uff0c\u5982\u5bf9\u4e3b\u5185\u5b58\u4e2d\u7684\u53d8\u91cfa\u3001b\u8fdb\u884c\u8bbf\u95ee\u65f6\uff0c\u53ef\u80fd\u7684\u987a\u5e8f\u662fread a\uff0cread b\uff0cload b\uff0c load a\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Java\u5185\u5b58\u6a21\u578b\u8fd8\u89c4\u5b9a\u4e86\u5728\u6267\u884c\u4e0a\u8ff08\u79cd\u57fa\u672c\u64cd\u4f5c\u65f6\uff0c\u5fc5\u987b\u6ee1\u8db3\u5982\u4e0b\u89c4\u5219\uff1a")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u5141\u8bb8 read \u548c load\u3001store \u548c write \u64cd\u4f5c\u4e4b\u4e00\u5355\u72ec\u51fa\u73b0"),(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u4e22\u5f03\u5b83\u7684\u6700\u8fd1 assign \u7684\u64cd\u4f5c\uff0c\u5373\u53d8\u91cf\u5728\u5de5\u4f5c\u5185\u5b58\u4e2d\u6539\u53d8\u4e86\u4e4b\u540e\u5fc5\u987b\u540c\u6b65\u5230\u4e3b\u5185\u5b58\u4e2d"),(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u65e0\u539f\u56e0\u5730\uff08\u6ca1\u6709\u53d1\u751f\u8fc7\u4efb\u4f55assign\u64cd\u4f5c\uff09\u628a\u6570\u636e\u4ece\u5de5\u4f5c\u5185\u5b58\u540c\u6b65\u56de\u4e3b\u5185\u5b58\u4e2d"),(0,r.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u65b0\u7684\u53d8\u91cf\u53ea\u80fd\u5728\u4e3b\u5185\u5b58\u4e2d\u8bde\u751f\uff0c\u4e0d\u5141\u8bb8\u5728\u5de5\u4f5c\u5185\u5b58\u4e2d\u76f4\u63a5\u4f7f\u7528\u4e00\u4e2a\u672a\u88ab\u521d\u59cb\u5316\uff08load \u6216 assign\uff09\u7684\u53d8\u91cf\u3002\u5373\u5c31\u662f\u5bf9\u4e00\u4e2a\u53d8\u91cf\u5b9e\u65bd use \u548c store \u64cd\u4f5c\u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u6267\u884c\u8fc7\u4e86 assign \u548c load \u64cd\u4f5c\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u53d8\u91cf\u5728\u540c\u4e00\u65f6\u523b\u53ea\u5141\u8bb8\u4e00\u6761\u7ebf\u7a0b\u5bf9\u5176\u8fdb\u884clock\u64cd\u4f5c\uff0clock \u548c unlock\u5fc5\u987b\u6210\u5bf9\u51fa\u73b0"),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u5bf9\u4e00\u4e2a\u53d8\u91cf\u6267\u884c lock \u64cd\u4f5c\uff0c\u5c06\u4f1a\u6e05\u7a7a\u5de5\u4f5c\u5185\u5b58\u4e2d\u6b64\u53d8\u91cf\u7684\u503c\uff0c\u5728\u6267\u884c\u5f15\u64ce\u4f7f\u7528\u8fd9\u4e2a\u53d8\u91cf\u524d\u9700\u8981\u91cd\u65b0\u6267\u884c load \u6216 assign \u64cd\u4f5c\u521d\u59cb\u5316\u53d8\u91cf\u7684\u503c"),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u4e00\u4e2a\u53d8\u91cf\u4e8b\u5148\u6ca1\u6709\u88ab lock \u64cd\u4f5c\u9501\u5b9a\uff0c\u5219\u4e0d\u5141\u8bb8\u5bf9\u5b83\u6267\u884c unlock \u64cd\u4f5c\uff1b\u4e5f\u4e0d\u5141\u8bb8\u53bb unlock \u4e00\u4e2a\u88ab\u5176\u4ed6\u7ebf\u7a0b\u9501\u5b9a\u7684\u53d8\u91cf\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5bf9\u4e00\u4e2a\u53d8\u91cf\u6267\u884c unlock \u64cd\u4f5c\u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u628a\u6b64\u53d8\u91cf\u540c\u6b65\u5230\u4e3b\u5185\u5b58\u4e2d\uff08\u6267\u884c store \u548c write \u64cd\u4f5c\uff09\u3002")),(0,r.kt)("p",null,"\u53c2\u8003\u8d44\u6599\uff1a"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/yzwall/p/6661528.html"},"volatile\u5173\u952e\u5b57\u4e0eJava\u5185\u5b58\u6a21\u578b(JMM) - yzwall - \u535a\u5ba2\u56ed")),(0,r.kt)("h4",{id:"\u5185\u5b58\u6a21\u578b\u4e09\u5927\u7279\u6027"},"\u5185\u5b58\u6a21\u578b\u4e09\u5927\u7279\u6027"),(0,r.kt)("h5",{id:"1-\u539f\u5b50\u6027"},"1. \u539f\u5b50\u6027"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6982\u5ff5",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4e8b\u7269\u6709\u539f\u5b50\u6027\uff0c\u8fd9\u4e2a\u6982\u5ff5\u5927\u6982\u90fd\u6e05\u695a\uff0c\u5373\u4e00\u4e2a\u64cd\u4f5c\u6216\u591a\u4e2a\u64cd\u4f5c\u8981\u4e48\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u4e0d\u88ab\u4efb\u4f55\u56e0\u7d20\u6253\u65ad\uff0c\u8981\u4e48\u4e0d\u6267\u884c\u3002"))),(0,r.kt)("li",{parentName:"ul"},"\u5982\u4f55\u5b9e\u73b0\u539f\u5b50\u6027\uff1f",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u540c\u6b65\u4ee3\u7801\u5757 synchronized \u6216\u8005 local \u9501\u6765\u786e\u4fdd\u539f\u5b50\u6027")))),(0,r.kt)("p",null,"Java \u5185\u5b58\u6a21\u578b\u4fdd\u8bc1\u4e86 read\u3001load\u3001use\u3001assign\u3001store\u3001write\u3001lock \u548c unlock \u64cd\u4f5c\u5177\u6709\u539f\u5b50\u6027\uff0c\u4f8b\u5982\u5bf9\u4e00\u4e2a int \u7c7b\u578b\u7684\u53d8\u91cf\u6267\u884c assign \u8d4b\u503c\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u5c31\u662f\u539f\u5b50\u6027\u7684\u3002\u4f46\u662f Java \u5185\u5b58\u6a21\u578b\u5141\u8bb8\u865a\u62df\u673a\u5c06\u6ca1\u6709\u88ab volatile \u4fee\u9970\u7684 64 \u4f4d\u6570\u636e\uff08long\uff0cdouble\uff09\u7684\u8bfb\u5199\u64cd\u4f5c\u5212\u5206\u4e3a\u4e24\u6b21 32 \u4f4d\u7684\u64cd\u4f5c\u6765\u8fdb\u884c\uff0c\u5373 load\u3001store\u3001read \u548c write \u64cd\u4f5c\u53ef\u4ee5\u4e0d\u5177\u5907\u539f\u5b50\u6027\u3002"),(0,r.kt)("p",null,"\u6709\u4e00\u4e2a\u9519\u8bef\u8ba4\u8bc6\u5c31\u662f\uff0cint \u7b49\u539f\u5b50\u6027\u7684\u53d8\u91cf\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u4e0d\u4f1a\u51fa\u73b0\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\u3002\u524d\u9762\u7684\u7ebf\u7a0b\u4e0d\u5b89\u5168\u793a\u4f8b\u4ee3\u7801\u4e2d\uff0ccnt \u53d8\u91cf\u5c5e\u4e8e int \u7c7b\u578b\u53d8\u91cf\uff0c1000 \u4e2a\u7ebf\u7a0b\u5bf9\u5b83\u8fdb\u884c\u81ea\u589e\u64cd\u4f5c\u4e4b\u540e\uff0c\u5f97\u5230\u7684\u503c\u4e3a 997 \u800c\u4e0d\u662f 1000\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u65b9\u4fbf\u8ba8\u8bba\uff0c\u5c06\u5185\u5b58\u95f4\u7684\u4ea4\u4e92\u64cd\u4f5c\u7b80\u5316\u4e3a 3 \u4e2a\uff1aload\u3001assign\u3001store\u3002"),(0,r.kt)("p",null,"\u4e0b\u56fe\u6f14\u793a\u4e86\u4e24\u4e2a\u7ebf\u7a0b\u540c\u65f6\u5bf9 cnt \u53d8\u91cf\u8fdb\u884c\u64cd\u4f5c\uff0cload\u3001assign\u3001store \u8fd9\u4e00\u7cfb\u5217\u64cd\u4f5c\u6574\u4f53\u4e0a\u770b\u4e0d\u5177\u5907\u539f\u5b50\u6027\uff0c\u90a3\u4e48\u5728 T1 \u4fee\u6539 cnt \u5e76\u4e14\u8fd8\u6ca1\u6709\u5c06\u4fee\u6539\u540e\u7684\u503c\u5199\u5165\u4e3b\u5185\u5b58\uff0cT2 \u4f9d\u7136\u53ef\u4ee5\u8bfb\u5165\u8be5\u53d8\u91cf\u7684\u503c\u3002\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u867d\u7136\u6267\u884c\u4e86\u4e24\u6b21\u81ea\u589e\u8fd0\u7b97\uff0c\u4f46\u662f\u4e3b\u5185\u5b58\u4e2d cnt \u7684\u503c\u6700\u540e\u4e3a 1 \u800c\u4e0d\u662f 2\u3002\u56e0\u6b64\u5bf9 int \u7c7b\u578b\u8bfb\u5199\u64cd\u4f5c\u6ee1\u8db3\u539f\u5b50\u6027\u53ea\u662f\u8bf4\u660e load\u3001assign\u3001store \u8fd9\u4e9b\u5355\u4e2a\u64cd\u4f5c\u5177\u5907\u539f\u5b50\u6027\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/ef8eab00-1d5e-4d99-a7c2-d6d68ea7fe92-1534148019548.png",width:"400"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"AtomicInteger \u80fd\u4fdd\u8bc1\u591a\u4e2a\u7ebf\u7a0b\u4fee\u6539\u7684\u539f\u5b50\u6027\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/952afa9a-458b-44ce-bba9-463e60162945-1534148027104.png",width:"400"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"\u4f7f\u7528 AtomicInteger \u91cd\u5199\u4e4b\u524d\u7ebf\u7a0b\u4e0d\u5b89\u5168\u7684\u4ee3\u7801\u4e4b\u540e\u5f97\u5230\u4ee5\u4e0b\u7ebf\u7a0b\u5b89\u5168\u5b9e\u73b0\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class AtomicExample {\n    private AtomicInteger cnt = new AtomicInteger();\n\n    public void add() {\n        cnt.incrementAndGet();\n    }\n\n    public int get() {\n        return cnt.get();\n    }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) throws InterruptedException {\n    final int threadSize = 1000;\n    AtomicExample example = new AtomicExample(); // \u53ea\u4fee\u6539\u8fd9\u6761\u8bed\u53e5\n    final CountDownLatch countDownLatch = new CountDownLatch(threadSize);\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    for (int i = 0; i < threadSize; i++) {\n        executorService.execute(() -> {\n            example.add();\n            countDownLatch.countDown();\n        });\n    }\n    countDownLatch.await();\n    executorService.shutdown();\n    System.out.println(example.get());\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"1000\n")),(0,r.kt)("p",null,"\u9664\u4e86\u4f7f\u7528\u539f\u5b50\u7c7b\u4e4b\u5916\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 synchronized \u4e92\u65a5\u9501\u6765\u4fdd\u8bc1\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002\u5b83\u5bf9\u5e94\u7684\u5185\u5b58\u95f4\u4ea4\u4e92\u64cd\u4f5c\u4e3a\uff1alock \u548c unlock\uff0c\u5728\u865a\u62df\u673a\u5b9e\u73b0\u4e0a\u5bf9\u5e94\u7684\u5b57\u8282\u7801\u6307\u4ee4\u4e3a monitorenter \u548c monitorexit\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class AtomicSynchronizedExample {\n    private int cnt = 0;\n\n    public synchronized void add() {\n        cnt++;\n    }\n\n    public synchronized int get() {\n        return cnt;\n    }\n}\npublic static void main(String[] args) throws InterruptedException {\n    final int threadSize = 1000;\n    AtomicSynchronizedExample example = new AtomicSynchronizedExample();\n    final CountDownLatch countDownLatch = new CountDownLatch(threadSize);\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    for (int i = 0; i < threadSize; i++) {\n        executorService.execute(() -> {\n            example.add();\n            countDownLatch.countDown();\n        });\n    }\n    countDownLatch.await();\n    executorService.shutdown();\n    System.out.println(example.get());\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"1000\n")),(0,r.kt)("h5",{id:"2-\u53ef\u89c1\u6027"},"2. \u53ef\u89c1\u6027"),(0,r.kt)("p",null,"\u53ef\u89c1\u6027\u6307\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u4e86\u5171\u4eab\u53d8\u91cf\u7684\u503c\uff0c\u5176\u5b83\u7ebf\u7a0b\u80fd\u591f\u7acb\u5373\u5f97\u77e5\u8fd9\u4e2a\u4fee\u6539\u3002Java \u5185\u5b58\u6a21\u578b\u662f\u901a\u8fc7\u5728\u53d8\u91cf\u4fee\u6539\u540e\u5c06\u65b0\u503c\u540c\u6b65\u56de\u4e3b\u5185\u5b58\uff0c\u5728\u53d8\u91cf\u8bfb\u53d6\u524d\u4ece\u4e3b\u5185\u5b58\u5237\u65b0\u53d8\u91cf\u503c\u6765\u5b9e\u73b0\u53ef\u89c1\u6027\u7684\u3002"),(0,r.kt)("p",null,"\u4e3b\u8981\u6709\u6709\u4e09\u79cd\u5b9e\u73b0\u53ef\u89c1\u6027\u7684\u65b9\u5f0f\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"volatile"),(0,r.kt)("li",{parentName:"ul"},"synchronized\uff0c\u5bf9\u4e00\u4e2a\u53d8\u91cf\u6267\u884c unlock \u64cd\u4f5c\u4e4b\u524d\uff0c\u5fc5\u987b\u628a\u53d8\u91cf\u503c\u540c\u6b65\u56de\u4e3b\u5185\u5b58\u3002"),(0,r.kt)("li",{parentName:"ul"},"final\uff0c\u88ab final \u5173\u952e\u5b57\u4fee\u9970\u7684\u5b57\u6bb5\u5728\u6784\u9020\u5668\u4e2d\u4e00\u65e6\u521d\u59cb\u5316\u5b8c\u6210\uff0c\u5e76\u4e14\u6ca1\u6709\u53d1\u751f this \u9003\u9038\uff08\u5176\u5b83\u7ebf\u7a0b\u901a\u8fc7 this \u5f15\u7528\u8bbf\u95ee\u5230\u521d\u59cb\u5316\u4e86\u4e00\u534a\u7684\u5bf9\u8c61\uff09\uff0c\u90a3\u4e48\u5176\u5b83\u7ebf\u7a0b\u5c31\u80fd\u770b\u89c1 final \u5b57\u6bb5\u7684\u503c\u3002")),(0,r.kt)("p",null,"\u5bf9\u524d\u9762\u7684\u7ebf\u7a0b\u4e0d\u5b89\u5168\u793a\u4f8b\u4e2d\u7684 cnt \u53d8\u91cf\u4f7f\u7528 volatile \u4fee\u9970\uff0c\u4e0d\u80fd\u89e3\u51b3\u7ebf\u7a0b\u4e0d\u5b89\u5168\u95ee\u9898\uff0c\u56e0\u4e3a volatile \u5e76\u4e0d\u80fd\u4fdd\u8bc1\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002"),(0,r.kt)("h5",{id:"3-\u6709\u5e8f\u6027"},"3. \u6709\u5e8f\u6027"),(0,r.kt)("p",null,"\u6709\u5e8f\u6027\u662f\u6307\uff1a\u5728\u672c\u7ebf\u7a0b\u5185\u89c2\u5bdf\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u6709\u5e8f\u7684\u3002\u5728\u4e00\u4e2a\u7ebf\u7a0b\u89c2\u5bdf\u53e6\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u65e0\u5e8f\u7684\uff0c\u65e0\u5e8f\u662f\u56e0\u4e3a\u53d1\u751f\u4e86\u6307\u4ee4\u91cd\u6392\u5e8f\u3002"),(0,r.kt)("p",null,"\u5728 Java \u5185\u5b58\u6a21\u578b\u4e2d\uff0c\u5141\u8bb8\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u5bf9\u6307\u4ee4\u8fdb\u884c\u91cd\u6392\u5e8f\uff0c\u91cd\u6392\u5e8f\u8fc7\u7a0b\u4e0d\u4f1a\u5f71\u54cd\u5230\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u6267\u884c\uff0c\u5374\u4f1a\u5f71\u54cd\u5230\u591a\u7ebf\u7a0b\u5e76\u53d1\u6267\u884c\u7684\u6b63\u786e\u6027\u3002"),(0,r.kt)("p",null,"volatile \u5173\u952e\u5b57\u901a\u8fc7\u6dfb\u52a0\u5185\u5b58\u5c4f\u969c\u7684\u65b9\u5f0f\u6765\u7981\u6b62\u6307\u4ee4\u91cd\u6392\uff0c\u5373\u91cd\u6392\u5e8f\u65f6\u4e0d\u80fd\u628a\u540e\u9762\u7684\u6307\u4ee4\u653e\u5230\u5185\u5b58\u5c4f\u969c\u4e4b\u524d\u3002"),(0,r.kt)("p",null,"\u4e5f\u53ef\u4ee5\u901a\u8fc7 synchronized \u6765\u4fdd\u8bc1\u6709\u5e8f\u6027\uff0c\u5b83\u4fdd\u8bc1\u6bcf\u4e2a\u65f6\u523b\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u540c\u6b65\u4ee3\u7801\uff0c\u76f8\u5f53\u4e8e\u662f\u8ba9\u7ebf\u7a0b\u987a\u5e8f\u6267\u884c\u540c\u6b65\u4ee3\u7801\u3002"),(0,r.kt)("h4",{id:"\u6307\u4ee4\u91cd\u6392\u5e8f"},"\u6307\u4ee4\u91cd\u6392\u5e8f"),(0,r.kt)("p",null,"\u5728\u6267\u884c\u7a0b\u5e8f\u65f6\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u5e38\u5e38\u4f1a\u5bf9\u6307\u4ee4\u505a\u91cd\u6392\u5e8f\u3002"),(0,r.kt)("p",null,"\u6307\u4ee4\u91cd\u6392\u5e8f\u5305\u62ec\uff1a",(0,r.kt)("strong",{parentName:"p"},"\u7f16\u8bd1\u5668\u91cd\u6392\u5e8f"),"\u548c",(0,r.kt)("strong",{parentName:"p"},"\u5904\u7406\u5668\u91cd\u6392\u5e8f")),(0,r.kt)("p",null,"\u91cd\u6392\u5e8f\u5206\u4e09\u79cd\u7c7b\u578b\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u7f16\u8bd1\u5668\u4f18\u5316\u7684\u91cd\u6392\u5e8f"),"\u3002\u7f16\u8bd1\u5668\u5728\u4e0d\u6539\u53d8\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u8bed\u4e49\u7684\u524d\u63d0\u4e0b\uff0c\u53ef\u4ee5\u91cd\u65b0\u5b89\u6392\u8bed\u53e5\u7684\u6267\u884c\u987a\u5e8f\u3002"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u6307\u4ee4\u7ea7\u5e76\u884c\u7684\u91cd\u6392\u5e8f"),"\u3002\u73b0\u4ee3\u5904\u7406\u5668\u91c7\u7528\u4e86\u6307\u4ee4\u7ea7\u5e76\u884c\u6280\u672f\uff08Instruction-Level Parallelism\uff0c ILP\uff09\u6765\u5c06\u591a\u6761\u6307\u4ee4\u91cd\u53e0\u6267\u884c\u3002\u5982\u679c\u4e0d\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u6027\uff0c\u5904\u7406\u5668\u53ef\u4ee5\u6539\u53d8\u8bed\u53e5\u5bf9\u5e94\u673a\u5668\u6307\u4ee4\u7684\u6267\u884c\u987a\u5e8f\u3002"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u5185\u5b58\u7cfb\u7edf\u7684\u91cd\u6392\u5e8f"),"\u3002\u7531\u4e8e\u5904\u7406\u5668\u4f7f\u7528\u7f13\u5b58\u548c\u8bfb/\u5199\u7f13\u51b2\u533a\uff0c\u8fd9\u4f7f\u5f97\u52a0\u8f7d\u548c\u5b58\u50a8\u64cd\u4f5c\u770b\u4e0a\u53bb\u53ef\u80fd\u662f\u5728\u4e71\u5e8f\u6267\u884c\u3002")),(0,r.kt)("p",null,"\u4ece Java \u6e90\u4ee3\u7801\u5230\u6700\u7ec8\u5b9e\u9645\u6267\u884c\u7684\u6307\u4ee4\u5e8f\u5217\uff0c\u4f1a\u5206\u522b\u7ecf\u5386\u4e0b\u9762\u4e09\u79cd\u91cd\u6392\u5e8f\uff1a"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/33-1534150864535.png",width:""})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u4e0a\u8ff0\u7684 1 \u5c5e\u4e8e\u7f16\u8bd1\u5668\u91cd\u6392\u5e8f\uff0c2 \u548c 3 \u5c5e\u4e8e\u5904\u7406\u5668\u91cd\u6392\u5e8f"),"\u3002\u8fd9\u4e9b\u91cd\u6392\u5e8f\u90fd\u53ef\u80fd\u4f1a\u5bfc\u81f4\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u51fa\u73b0\u5185\u5b58\u53ef\u89c1\u6027\u95ee\u9898\u3002\u5bf9\u4e8e\u7f16\u8bd1\u5668\uff0cJMM \u7684\u7f16\u8bd1\u5668\u91cd\u6392\u5e8f\u89c4\u5219\u4f1a\u7981\u6b62\u7279\u5b9a\u7c7b\u578b\u7684\u7f16\u8bd1\u5668\u91cd\u6392\u5e8f\uff08\u4e0d\u662f\u6240\u6709\u7684\u7f16\u8bd1\u5668\u91cd\u6392\u5e8f\u90fd\u8981\u7981\u6b62\uff09\u3002\u5bf9\u4e8e\u5904\u7406\u5668\u91cd\u6392\u5e8f\uff0cJMM \u7684\u5904\u7406\u5668\u91cd\u6392\u5e8f\u89c4\u5219\u4f1a\u8981\u6c42 Java \u7f16\u8bd1\u5668\u5728\u751f\u6210\u6307\u4ee4\u5e8f\u5217\u65f6\uff0c\u63d2\u5165\u7279\u5b9a\u7c7b\u578b\u7684\u5185\u5b58\u5c4f\u969c\uff08memory barriers\uff0cintel \u79f0\u4e4b\u4e3a memory fence\uff09\u6307\u4ee4\uff0c\u901a\u8fc7\u5185\u5b58\u5c4f\u969c\u6307\u4ee4\u6765\u7981\u6b62\u7279\u5b9a\u7c7b\u578b\u7684\u5904\u7406\u5668\u91cd\u6392\u5e8f\uff08\u4e0d\u662f\u6240\u6709\u7684\u5904\u7406\u5668\u91cd\u6392\u5e8f\u90fd\u8981\u7981\u6b62\uff09\u3002"),(0,r.kt)("p",null,"JMM \u5c5e\u4e8e\u8bed\u8a00\u7ea7\u7684\u5185\u5b58\u6a21\u578b\uff0c\u5b83\u786e\u4fdd\u5728\u4e0d\u540c\u7684\u7f16\u8bd1\u5668\u548c\u4e0d\u540c\u7684\u5904\u7406\u5668\u5e73\u53f0\u4e4b\u4e0a\uff0c\u901a\u8fc7\u7981\u6b62\u7279\u5b9a\u7c7b\u578b\u7684\u7f16\u8bd1\u5668\u91cd\u6392\u5e8f\u548c\u5904\u7406\u5668\u91cd\u6392\u5e8f\uff0c\u4e3a\u7a0b\u5e8f\u5458\u63d0\u4f9b\u4e00\u81f4\u7684\u5185\u5b58\u53ef\u89c1\u6027\u4fdd\u8bc1\u3002"),(0,r.kt)("h5",{id:"\u6570\u636e\u4f9d\u8d56\u6027"},"\u6570\u636e\u4f9d\u8d56\u6027"),(0,r.kt)("p",null,"\u5982\u679c\u4e24\u4e2a\u64cd\u4f5c\u8bbf\u95ee\u540c\u4e00\u4e2a\u53d8\u91cf\uff0c\u4e14\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u4e2d\u6709\u4e00\u4e2a\u4e3a\u5199\u64cd\u4f5c\uff0c\u6b64\u65f6\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u4e4b\u95f4\u5c31\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u6027\u3002\u6570\u636e\u4f9d\u8d56\u5206\u4e0b\u5217\u4e09\u79cd\u7c7b\u578b\uff1a"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u4ee3\u7801\u793a\u4f8b"),(0,r.kt)("th",{parentName:"tr",align:null},"\u8bf4\u660e"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u5199\u540e\u8bfb"),(0,r.kt)("td",{parentName:"tr",align:null},"a = 1;b = a;"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5199\u4e00\u4e2a\u53d8\u91cf\u4e4b\u540e\uff0c\u518d\u8bfb\u8fd9\u4e2a\u4f4d\u7f6e\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u5199\u540e\u5199"),(0,r.kt)("td",{parentName:"tr",align:null},"a = 1;a = 2;"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5199\u4e00\u4e2a\u53d8\u91cf\u4e4b\u540e\uff0c\u518d\u5199\u8fd9\u4e2a\u53d8\u91cf\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u8bfb\u540e\u5199"),(0,r.kt)("td",{parentName:"tr",align:null},"a = b;b = 1;"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8bfb\u4e00\u4e2a\u53d8\u91cf\u4e4b\u540e\uff0c\u518d\u5199\u8fd9\u4e2a\u53d8\u91cf\u3002")))),(0,r.kt)("p",null,"\u4e0a\u9762\u4e09\u79cd\u60c5\u51b5\uff0c\u53ea\u8981\u91cd\u6392\u5e8f\u4e24\u4e2a\u64cd\u4f5c\u7684\u6267\u884c\u987a\u5e8f\uff0c\u7a0b\u5e8f\u7684\u6267\u884c\u7ed3\u679c\u5c06\u4f1a\u88ab\u6539\u53d8\u3002"),(0,r.kt)("p",null,"\u524d\u9762\u63d0\u5230\u8fc7\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u53ef\u80fd\u4f1a\u5bf9\u64cd\u4f5c\u505a\u91cd\u6392\u5e8f\u3002\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u5728\u91cd\u6392\u5e8f\u65f6\uff0c\u4f1a\u9075\u5b88\u6570\u636e\u4f9d\u8d56\u6027\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u4e0d\u4f1a\u6539\u53d8\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\u7684\u4e24\u4e2a\u64cd\u4f5c\u7684\u6267\u884c\u987a\u5e8f\u3002"),(0,r.kt)("p",null,"\u6ce8\u610f\uff0c\u8fd9\u91cc\u6240\u8bf4\u7684\u6570\u636e\u4f9d\u8d56\u6027\u4ec5\u9488\u5bf9\u5355\u4e2a\u5904\u7406\u5668\u4e2d\u6267\u884c\u7684\u6307\u4ee4\u5e8f\u5217\u548c\u5355\u4e2a\u7ebf\u7a0b\u4e2d\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u4e0d\u540c\u5904\u7406\u5668\u4e4b\u95f4\u548c\u4e0d\u540c\u7ebf\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u4f9d\u8d56\u6027\u4e0d\u88ab\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u8003\u8651\u3002"),(0,r.kt)("h5",{id:"as-if-serial\u8bed\u4e49"},"as-if-serial\u8bed\u4e49"),(0,r.kt)("p",null,"as-if-serial \u8bed\u4e49\u7684\u610f\u601d\u6307\uff1a\u4e0d\u7ba1\u600e\u4e48\u91cd\u6392\u5e8f\uff08\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u4e3a\u4e86\u63d0\u9ad8\u5e76\u884c\u5ea6\uff09\uff0c\uff08\u5355\u7ebf\u7a0b\uff09\u7a0b\u5e8f\u7684\u6267\u884c\u7ed3\u679c\u4e0d\u80fd\u88ab\u6539\u53d8\u3002\u7f16\u8bd1\u5668\uff0cruntime \u548c \u5904\u7406\u5668 \u90fd\u5fc5\u987b\u9075\u5b88 as-if-serial \u8bed\u4e49\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u9075\u5b88 as-if-serial \u8bed\u4e49\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u4e0d\u4f1a\u5bf9\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\u7684\u64cd\u4f5c\u505a\u91cd\u6392\u5e8f\uff0c\u56e0\u4e3a\u8fd9\u79cd\u91cd\u6392\u5e8f\u4f1a\u6539\u53d8\u6267\u884c\u7ed3\u679c\u3002\u4f46\u662f\uff0c\u5982\u679c\u64cd\u4f5c\u4e4b\u95f4\u4e0d\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u53ef\u80fd\u88ab\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u91cd\u6392\u5e8f\u3002\u4e3a\u4e86\u5177\u4f53\u8bf4\u660e\uff0c\u8bf7\u770b\u4e0b\u9762\u8ba1\u7b97\u5706\u9762\u79ef\u7684\u4ee3\u7801\u793a\u4f8b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"double pi  = 3.14;    //A\ndouble r   = 1.0;     //B\ndouble area = pi * r * r; //C\n")),(0,r.kt)("p",null,"\u4e0a\u9762\u4e09\u4e2a\u64cd\u4f5c\u7684\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/11.png",width:""})),(0,r.kt)("p",null,"\u5982\u4e0a\u56fe\u6240\u793a\uff0cA \u548c C \u4e4b\u95f4\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\uff0c\u540c\u65f6 B \u548c C \u4e4b\u95f4\u4e5f\u5b58\u5728\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\u3002\u56e0\u6b64\u5728\u6700\u7ec8\u6267\u884c\u7684\u6307\u4ee4\u5e8f\u5217\u4e2d\uff0cC \u4e0d\u80fd\u88ab\u91cd\u6392\u5e8f\u5230 A \u548c B \u7684\u524d\u9762\uff08C \u6392\u5230 A \u548c B \u7684\u524d\u9762\uff0c\u7a0b\u5e8f\u7684\u7ed3\u679c\u5c06\u4f1a\u88ab\u6539\u53d8\uff09\u3002\u4f46 A \u548c B \u4e4b\u95f4\u6ca1\u6709\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u53ef\u4ee5\u91cd\u6392\u5e8f A \u548c B \u4e4b\u95f4\u7684\u6267\u884c\u987a\u5e8f\u3002\u4e0b\u56fe\u662f\u8be5\u7a0b\u5e8f\u7684\u4e24\u79cd\u6267\u884c\u987a\u5e8f\uff1a"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/22.png",width:""})),(0,r.kt)("p",null,"as-if-serial \u8bed\u4e49\u628a\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u4fdd\u62a4\u4e86\u8d77\u6765\uff0c\u9075\u5b88 as-if-serial \u8bed\u4e49\u7684\u7f16\u8bd1\u5668\uff0cruntime \u548c\u5904\u7406\u5668\u5171\u540c\u4e3a\u7f16\u5199\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u7a0b\u5e8f\u5458\u521b\u5efa\u4e86\u4e00\u4e2a\u5e7b\u89c9\uff1a\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u662f\u6309\u7a0b\u5e8f\u7684\u987a\u5e8f\u6765\u6267\u884c\u7684\u3002as-if-serial \u8bed\u4e49\u4f7f\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u5458\u65e0\u9700\u62c5\u5fc3\u91cd\u6392\u5e8f\u4f1a\u5e72\u6270\u4ed6\u4eec\uff0c\u4e5f\u65e0\u9700\u62c5\u5fc3\u5185\u5b58\u53ef\u89c1\u6027\u95ee\u9898\u3002"),(0,r.kt)("h5",{id:"\u7a0b\u5e8f\u987a\u5e8f\u89c4\u5219"},"\u7a0b\u5e8f\u987a\u5e8f\u89c4\u5219"),(0,r.kt)("p",null,"\u6839\u636e happens- before \u7684\u7a0b\u5e8f\u987a\u5e8f\u89c4\u5219\uff0c\u4e0a\u9762\u8ba1\u7b97\u5706\u7684\u9762\u79ef\u7684\u793a\u4f8b\u4ee3\u7801\u5b58\u5728\u4e09\u4e2a happens- before \u5173\u7cfb\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"A happens- before B\uff1b"),(0,r.kt)("li",{parentName:"ol"},"B happens- before C\uff1b"),(0,r.kt)("li",{parentName:"ol"},"A happens- before C\uff1b")),(0,r.kt)("p",null,"\u8fd9\u91cc\u7684\u7b2c 3 \u4e2a happens- before \u5173\u7cfb\uff0c\u662f\u6839\u636e happens- before \u7684\u4f20\u9012\u6027\u63a8\u5bfc\u51fa\u6765\u7684\u3002"),(0,r.kt)("p",null,"\u8fd9\u91cc A happens- before B\uff0c\u4f46\u5b9e\u9645\u6267\u884c\u65f6 B \u5374\u53ef\u4ee5\u6392\u5728 A \u4e4b\u524d\u6267\u884c\uff08\u770b\u4e0a\u9762\u7684\u91cd\u6392\u5e8f\u540e\u7684\u6267\u884c\u987a\u5e8f\uff09\u3002\u5982\u679cA happens- before B\uff0cJMM \u5e76\u4e0d\u8981\u6c42 A \u4e00\u5b9a\u8981\u5728 B \u4e4b\u524d\u6267\u884c\u3002JMM \u4ec5\u4ec5\u8981\u6c42\u524d\u4e00\u4e2a\u64cd\u4f5c\uff08\u6267\u884c\u7684\u7ed3\u679c\uff09\u5bf9\u540e\u4e00\u4e2a\u64cd\u4f5c\u53ef\u89c1\uff0c\u4e14\u524d\u4e00\u4e2a\u64cd\u4f5c\u6309\u987a\u5e8f\u6392\u5728\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\u4e4b\u524d\u3002\u8fd9\u91cc\u64cd\u4f5c A \u7684\u6267\u884c\u7ed3\u679c\u4e0d\u9700\u8981\u5bf9\u64cd\u4f5c B \u53ef\u89c1\uff1b\u800c\u4e14\u91cd\u6392\u5e8f\u64cd\u4f5c A \u548c\u64cd\u4f5c B \u540e\u7684\u6267\u884c\u7ed3\u679c\uff0c\u4e0e\u64cd\u4f5c A \u548c\u64cd\u4f5c B \u6309 happens- before \u987a\u5e8f\u6267\u884c\u7684\u7ed3\u679c\u4e00\u81f4\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c JMM \u4f1a\u8ba4\u4e3a\u8fd9\u79cd\u91cd\u6392\u5e8f\u5e76\u4e0d\u975e\u6cd5\uff08not illegal\uff09\uff0cJMM \u5141\u8bb8\u8fd9\u79cd\u91cd\u6392\u5e8f\u3002"),(0,r.kt)("p",null,"\u5728\u8ba1\u7b97\u673a\u4e2d\uff0c\u8f6f\u4ef6\u6280\u672f\u548c\u786c\u4ef6\u6280\u672f\u6709\u4e00\u4e2a\u5171\u540c\u7684\u76ee\u6807\uff1a\u5728\u4e0d\u6539\u53d8\u7a0b\u5e8f\u6267\u884c\u7ed3\u679c\u7684\u524d\u63d0\u4e0b\uff0c\u5c3d\u53ef\u80fd\u7684\u5f00\u53d1\u5e76\u884c\u5ea6\u3002\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u9075\u4ece\u8fd9\u4e00\u76ee\u6807\uff0c\u4ece happens- before \u7684\u5b9a\u4e49\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0cJMM \u540c\u6837\u9075\u4ece\u8fd9\u4e00\u76ee\u6807\u3002"),(0,r.kt)("h5",{id:"\u91cd\u6392\u5e8f\u5bf9\u591a\u7ebf\u7a0b\u7684\u5f71\u54cd"},"\u91cd\u6392\u5e8f\u5bf9\u591a\u7ebf\u7a0b\u7684\u5f71\u54cd"),(0,r.kt)("p",null,"\u73b0\u5728\u8ba9\u6211\u4eec\u6765\u770b\u770b\uff0c\u91cd\u6392\u5e8f\u662f\u5426\u4f1a\u6539\u53d8\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u6267\u884c\u7ed3\u679c\u3002\u8bf7\u770b\u4e0b\u9762\u7684\u793a\u4f8b\u4ee3\u7801\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"class ReorderExample {\n    int a = 0;\n    boolean flag = false;\n\n    public void writer() {\n        a = 1;                   // 1\n        flag = true;             // 2\n    }\n\n    Public void reader() {\n        if (flag) {                // 3\n            int i =  a * a;        // 4\n            \u2026\u2026\n        }\n    }\n}\n")),(0,r.kt)("p",null,"flag \u53d8\u91cf\u662f\u4e2a\u6807\u8bb0\uff0c\u7528\u6765\u6807\u8bc6\u53d8\u91cf a \u662f\u5426\u5df2\u88ab\u5199\u5165\u3002\u8fd9\u91cc\u5047\u8bbe\u6709\u4e24\u4e2a\u7ebf\u7a0b A \u548c B\uff0cA\u9996\u5148\u6267\u884c writer() \u65b9\u6cd5\uff0c\u968f\u540e B \u7ebf\u7a0b\u63a5\u7740\u6267\u884c reader() \u65b9\u6cd5\u3002\u7ebf\u7a0b B \u5728\u6267\u884c\u64cd\u4f5c 4 \u65f6\uff0c\u80fd\u5426\u770b\u5230\u7ebf\u7a0b A \u5728\u64cd\u4f5c 1 \u5bf9\u5171\u4eab\u53d8\u91cf a \u7684\u5199\u5165\uff1f"),(0,r.kt)("p",null,"\u7b54\u6848\u662f\uff1a\u4e0d\u4e00\u5b9a\u80fd\u770b\u5230\u3002"),(0,r.kt)("p",null,"\u7531\u4e8e\u64cd\u4f5c 1 \u548c\u64cd\u4f5c 2 \u6ca1\u6709\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u53ef\u4ee5\u5bf9\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u91cd\u6392\u5e8f\uff1b\u540c\u6837\uff0c\u64cd\u4f5c 3 \u548c\u64cd\u4f5c 4 \u6ca1\u6709\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u4e5f\u53ef\u4ee5\u5bf9\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u91cd\u6392\u5e8f\u3002\u8ba9\u6211\u4eec\u5148\u6765\u770b\u770b\uff0c\u5f53\u64cd\u4f5c 1 \u548c\u64cd\u4f5c 2 \u91cd\u6392\u5e8f\u65f6\uff0c\u53ef\u80fd\u4f1a\u4ea7\u751f\u4ec0\u4e48\u6548\u679c\uff1f\u8bf7\u770b\u4e0b\u9762\u7684\u7a0b\u5e8f\u6267\u884c\u65f6\u5e8f\u56fe\uff1a"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/33.png",width:""})),(0,r.kt)("p",null,"\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u64cd\u4f5c 1 \u548c\u64cd\u4f5c 2 \u505a\u4e86\u91cd\u6392\u5e8f\u3002\u7a0b\u5e8f\u6267\u884c\u65f6\uff0c\u7ebf\u7a0b A \u9996\u5148\u5199\u6807\u8bb0\u53d8\u91cf flag\uff0c\u968f\u540e\u7ebf\u7a0b B \u8bfb\u8fd9\u4e2a\u53d8\u91cf\u3002\u7531\u4e8e\u6761\u4ef6\u5224\u65ad\u4e3a\u771f\uff0c\u7ebf\u7a0b B \u5c06\u8bfb\u53d6\u53d8\u91cf a\u3002\u6b64\u65f6\uff0c\u53d8\u91cf a \u8fd8\u6839\u672c\u6ca1\u6709\u88ab\u7ebf\u7a0b A \u5199\u5165\uff0c\u5728\u8fd9\u91cc\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u8bed\u4e49\u88ab\u91cd\u6392\u5e8f\u7834\u574f\u4e86\uff01"),(0,r.kt)("p",null,"\u203b\u6ce8\uff1a\u672c\u6587\u7edf\u4e00\u7528\u7ea2\u8272\u7684\u865a\u7bad\u7ebf\u8868\u793a\u9519\u8bef\u7684\u8bfb\u64cd\u4f5c\uff0c\u7528\u7eff\u8272\u7684\u865a\u7bad\u7ebf\u8868\u793a\u6b63\u786e\u7684\u8bfb\u64cd\u4f5c\u3002"),(0,r.kt)("p",null,"\u4e0b\u9762\u518d\u8ba9\u6211\u4eec\u770b\u770b\uff0c\u5f53\u64cd\u4f5c 3 \u548c\u64cd\u4f5c 4 \u91cd\u6392\u5e8f\u65f6\u4f1a\u4ea7\u751f\u4ec0\u4e48\u6548\u679c\uff08\u501f\u52a9\u8fd9\u4e2a\u91cd\u6392\u5e8f\uff0c\u53ef\u4ee5\u987a\u4fbf\u8bf4\u660e\u63a7\u5236\u4f9d\u8d56\u6027\uff09\u3002\u4e0b\u9762\u662f\u64cd\u4f5c 3 \u548c\u64cd\u4f5c 4 \u91cd\u6392\u5e8f\u540e\uff0c\u7a0b\u5e8f\u7684\u6267\u884c\u65f6\u5e8f\u56fe\uff1a"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/44.png",width:""})),(0,r.kt)("p",null,"\u5728\u7a0b\u5e8f\u4e2d\uff0c\u64cd\u4f5c 3 \u548c\u64cd\u4f5c 4 \u5b58\u5728\u63a7\u5236\u4f9d\u8d56\u5173\u7cfb\u3002\u5f53\u4ee3\u7801\u4e2d\u5b58\u5728\u63a7\u5236\u4f9d\u8d56\u6027\u65f6\uff0c\u4f1a\u5f71\u54cd\u6307\u4ee4\u5e8f\u5217\u6267\u884c\u7684\u5e76\u884c\u5ea6\u3002\u4e3a\u6b64\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u4f1a\u91c7\u7528\u731c\u6d4b\uff08Speculation\uff09\u6267\u884c\u6765\u514b\u670d\u63a7\u5236\u76f8\u5173\u6027\u5bf9\u5e76\u884c\u5ea6\u7684\u5f71\u54cd\u3002\u4ee5\u5904\u7406\u5668\u7684\u731c\u6d4b\u6267\u884c\u4e3a\u4f8b\uff0c\u6267\u884c\u7ebf\u7a0b B \u7684\u5904\u7406\u5668\u53ef\u4ee5\u63d0\u524d\u8bfb\u53d6\u5e76\u8ba1\u7b97 a*a\uff0c\u7136\u540e\u628a\u8ba1\u7b97\u7ed3\u679c\u4e34\u65f6\u4fdd\u5b58\u5230\u4e00\u4e2a\u540d\u4e3a\u91cd\u6392\u5e8f\u7f13\u51b2\uff08reorder buffer ROB\uff09\u7684\u786c\u4ef6\u7f13\u5b58\u4e2d\u3002\u5f53\u63a5\u4e0b\u6765\u64cd\u4f5c3\u7684\u6761\u4ef6\u5224\u65ad\u4e3a\u771f\u65f6\uff0c\u5c31\u628a\u8be5\u8ba1\u7b97\u7ed3\u679c\u5199\u5165\u53d8\u91cf i \u4e2d\u3002"),(0,r.kt)("p",null,"\u4ece\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c\u731c\u6d4b\u6267\u884c\u5b9e\u8d28\u4e0a\u5bf9\u64cd\u4f5c 3 \u548c 4 \u505a\u4e86\u91cd\u6392\u5e8f\u3002\u91cd\u6392\u5e8f\u5728\u8fd9\u91cc\u7834\u574f\u4e86\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u8bed\u4e49\uff01"),(0,r.kt)("p",null,"\u5728\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u4e2d\uff0c\u5bf9\u5b58\u5728\u63a7\u5236\u4f9d\u8d56\u7684\u64cd\u4f5c\u91cd\u6392\u5e8f\uff0c\u4e0d\u4f1a\u6539\u53d8\u6267\u884c\u7ed3\u679c\uff08\u8fd9\u4e5f\u662f as-if-serial \u8bed\u4e49\u5141\u8bb8\u5bf9\u5b58\u5728\u63a7\u5236\u4f9d\u8d56\u7684\u64cd\u4f5c\u505a\u91cd\u6392\u5e8f\u7684\u539f\u56e0\uff09\uff1b\u4f46\u5728\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u4e2d\uff0c\u5bf9\u5b58\u5728\u63a7\u5236\u4f9d\u8d56\u7684\u64cd\u4f5c\u91cd\u6392\u5e8f\uff0c\u53ef\u80fd\u4f1a\u6539\u53d8\u7a0b\u5e8f\u7684\u6267\u884c\u7ed3\u679c\u3002"),(0,r.kt)("p",null,"\u53c2\u8003\u8d44\u6599\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"http://www.infoq.com/cn/articles/java-memory-model-1"},"\u6df1\u5165\u7406\u89e3Java\u5185\u5b58\u6a21\u578b\uff08\u4e00\uff09\u2014\u2014\u57fa\u7840"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"http://www.infoq.com/cn/articles/java-memory-model-2"},"\u6df1\u5165\u7406\u89e3Java\u5185\u5b58\u6a21\u578b\uff08\u4e8c\uff09\u2014\u2014\u91cd\u6392\u5e8f")))),(0,r.kt)("h4",{id:"\u5148\u884c\u53d1\u751f\u539f\u5219happens-before"},"\u5148\u884c\u53d1\u751f\u539f\u5219\uff08happens-before\uff09"),(0,r.kt)("p",null,"Happens-before \u662f\u7528\u6765\u6307\u5b9a\u4e24\u4e2a\u64cd\u4f5c\u4e4b\u95f4\u7684\u6267\u884c\u987a\u5e8f\u3002\u63d0\u4f9b\u8de8\u7ebf\u7a0b\u7684\u5185\u5b58\u53ef\u89c1\u6027\u3002"),(0,r.kt)("p",null,"\u5728 Java \u5185\u5b58\u6a21\u578b\u4e2d\uff0c\u5982\u679c\u4e00\u4e2a\u64cd\u4f5c\u6267\u884c\u7684\u7ed3\u679c\u9700\u8981\u5bf9\u53e6\u4e00\u4e2a\u64cd\u4f5c\u53ef\u89c1\uff0c\u90a3\u4e48\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u4e4b\u95f4\u5fc5\u7136\u5b58\u5728 happens-before \u5173\u7cfb\u3002"),(0,r.kt)("p",null,"\u4e0a\u9762\u63d0\u5230\u4e86\u53ef\u4ee5\u7528 volatile \u548c synchronized \u6765\u4fdd\u8bc1\u6709\u5e8f\u6027\u3002\u9664\u6b64\u4e4b\u5916\uff0cJVM \u8fd8\u89c4\u5b9a\u4e86\u5148\u884c\u53d1\u751f\u539f\u5219\uff0c\u8ba9\u4e00\u4e2a\u64cd\u4f5c\u65e0\u9700\u63a7\u5236\u5c31\u80fd\u5148\u4e8e\u53e6\u4e00\u4e2a\u64cd\u4f5c\u5b8c\u6210\u3002"),(0,r.kt)("p",null,"\u4e3b\u8981\u6709\u4ee5\u4e0b\u8fd9\u4e9b\u539f\u5219\uff1a"),(0,r.kt)("h5",{id:"1-\u5355\u4e00\u7ebf\u7a0b\u539f\u5219"},"1. \u5355\u4e00\u7ebf\u7a0b\u539f\u5219"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Single Thread rule")),(0,r.kt)("p",null,"\u5728\u4e00\u4e2a\u7ebf\u7a0b\u5185\uff0c\u5728\u7a0b\u5e8f\u524d\u9762\u7684\u64cd\u4f5c\u5148\u884c\u53d1\u751f\u4e8e\u540e\u9762\u7684\u64cd\u4f5c\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/single-thread-rule-1534148720379.png",width:""})),(0,r.kt)("h5",{id:"2-\u7ba1\u7a0b\u9501\u5b9a\u89c4\u5219"},"2. \u7ba1\u7a0b\u9501\u5b9a\u89c4\u5219"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Monitor Lock Rule")),(0,r.kt)("p",null,"\u5bf9\u4e00\u4e2a\u9501\u7684\u89e3\u9501\uff08unlock \uff09\uff0c\u603b\u662f happens-before \u4e8e\u968f\u540e\u5bf9\u8fd9\u4e2a\u9501\u7684\u52a0\u9501\uff08lock\uff09"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/monitor-lock-rule-1534148737603.png",width:""})),(0,r.kt)("h5",{id:"3-volatile-\u53d8\u91cf\u89c4\u5219"},"3. volatile \u53d8\u91cf\u89c4\u5219"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Volatile Variable Rule")),(0,r.kt)("p",null,"\u5bf9\u4e00\u4e2a volatile \u53d8\u91cf\u7684\u5199\u64cd\u4f5c\u5148\u884c\u53d1\u751f\u4e8e\u540e\u9762\u5bf9\u8fd9\u4e2a\u53d8\u91cf\u7684\u8bfb\u64cd\u4f5c\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/volatile-variable-rule-1534148747964.png",width:"600"})),(0,r.kt)("h5",{id:"4-\u7ebf\u7a0b\u542f\u52a8\u89c4\u5219"},"4. \u7ebf\u7a0b\u542f\u52a8\u89c4\u5219"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Thread Start Rule")),(0,r.kt)("p",null,"Thread \u5bf9\u8c61\u7684 start() \u65b9\u6cd5\u8c03\u7528\u5148\u884c\u53d1\u751f\u4e8e\u6b64\u7ebf\u7a0b\u7684\u6bcf\u4e00\u4e2a\u52a8\u4f5c\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/thread-start-rule-1534148760654.png",width:"600"})),(0,r.kt)("h5",{id:"5-\u7ebf\u7a0b\u52a0\u5165\u89c4\u5219"},"5. \u7ebf\u7a0b\u52a0\u5165\u89c4\u5219"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Thread Join Rule")),(0,r.kt)("p",null,"Thread \u5bf9\u8c61\u7684\u7ed3\u675f\u5148\u884c\u53d1\u751f\u4e8e join() \u65b9\u6cd5\u8fd4\u56de\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/thread-join-rule-1534148774041.png",width:""})),(0,r.kt)("h5",{id:"6-\u7ebf\u7a0b\u4e2d\u65ad\u89c4\u5219"},"6. \u7ebf\u7a0b\u4e2d\u65ad\u89c4\u5219"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Thread Interruption Rule")),(0,r.kt)("p",null,"\u5bf9\u7ebf\u7a0b interrupt() \u65b9\u6cd5\u7684\u8c03\u7528\u5148\u884c\u53d1\u751f\u4e8e\u88ab\u4e2d\u65ad\u7ebf\u7a0b\u7684\u4ee3\u7801\u68c0\u6d4b\u5230\u4e2d\u65ad\u4e8b\u4ef6\u7684\u53d1\u751f\uff0c\u53ef\u4ee5\u901a\u8fc7 interrupted() \u65b9\u6cd5\u68c0\u6d4b\u5230\u662f\u5426\u6709\u4e2d\u65ad\u53d1\u751f\u3002"),(0,r.kt)("h5",{id:"7-\u5bf9\u8c61\u7ec8\u7ed3\u89c4\u5219"},"7. \u5bf9\u8c61\u7ec8\u7ed3\u89c4\u5219"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Finalizer Rule")),(0,r.kt)("p",null,"\u4e00\u4e2a\u5bf9\u8c61\u7684\u521d\u59cb\u5316\u5b8c\u6210\uff08\u6784\u9020\u51fd\u6570\u6267\u884c\u7ed3\u675f\uff09\u5148\u884c\u53d1\u751f\u4e8e\u5b83\u7684 finalize() \u65b9\u6cd5\u7684\u5f00\u59cb\u3002"),(0,r.kt)("h5",{id:"8-\u4f20\u9012\u6027"},"8. \u4f20\u9012\u6027"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Transitivity")),(0,r.kt)("p",null,"\u5982\u679c\u64cd\u4f5c A \u5148\u884c\u53d1\u751f\u4e8e\u64cd\u4f5c B\uff0c\u64cd\u4f5c B \u5148\u884c\u53d1\u751f\u4e8e\u64cd\u4f5c C\uff0c\u90a3\u4e48\u64cd\u4f5c A \u5148\u884c\u53d1\u751f\u4e8e\u64cd\u4f5c C\u3002"),(0,r.kt)("h3",{id:"11-\u7ebf\u7a0b\u5b89\u5168"},"11. \u7ebf\u7a0b\u5b89\u5168"),(0,r.kt)("h4",{id:"\u7ebf\u7a0b\u5b89\u5168\u5b9a\u4e49"},"\u7ebf\u7a0b\u5b89\u5168\u5b9a\u4e49"),(0,r.kt)("p",null,"\u4e00\u4e2a\u7c7b\u5728\u53ef\u4ee5\u88ab\u591a\u4e2a\u7ebf\u7a0b\u5b89\u5168\u8c03\u7528\u65f6\u5c31\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002"),(0,r.kt)("h4",{id:"\u7ebf\u7a0b\u5b89\u5168\u5206\u7c7b"},"\u7ebf\u7a0b\u5b89\u5168\u5206\u7c7b"),(0,r.kt)("p",null,"\u7ebf\u7a0b\u5b89\u5168\u4e0d\u662f\u4e00\u4e2a\u975e\u771f\u5373\u5047\u7684\u547d\u9898\uff0c\u53ef\u4ee5\u5c06\u5171\u4eab\u6570\u636e\u6309\u7167\u5b89\u5168\u7a0b\u5ea6\u7684\u5f3a\u5f31\u987a\u5e8f\u5206\u6210\u4ee5\u4e0b\u4e94\u7c7b\uff1a\u4e0d\u53ef\u53d8\u3001\u7edd\u5bf9\u7ebf\u7a0b\u5b89\u5168\u3001\u76f8\u5bf9\u7ebf\u7a0b\u5b89\u5168\u3001\u7ebf\u7a0b\u517c\u5bb9\u548c\u7ebf\u7a0b\u5bf9\u7acb\u3002"),(0,r.kt)("h5",{id:"1-\u4e0d\u53ef\u53d8"},"1. \u4e0d\u53ef\u53d8"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u53ef\u53d8\uff08Immutable\uff09\u7684\u5bf9\u8c61\u4e00\u5b9a\u662f\u7ebf\u7a0b\u5b89\u5168\u7684"),"\uff0c\u65e0\u8bba\u662f\u5bf9\u8c61\u7684\u65b9\u6cd5\u5b9e\u73b0\u8fd8\u662f\u65b9\u6cd5\u7684\u8c03\u7528\u8005\uff0c\u90fd\u4e0d\u9700\u8981\u518d\u91c7\u53d6\u4efb\u4f55\u7684\u7ebf\u7a0b\u5b89\u5168\u4fdd\u969c\u63aa\u65bd\uff0c\u53ea\u8981\u4e00\u4e2a\u4e0d\u53ef\u53d8\u7684\u5bf9\u8c61\u88ab\u6b63\u786e\u5730\u6784\u5efa\u51fa\u6765\uff0c\u90a3\u5176\u5916\u90e8\u7684\u53ef\u89c1\u72b6\u6001\u6c38\u8fdc\u4e5f\u4e0d\u4f1a\u6539\u53d8\uff0c\u6c38\u8fdc\u4e5f\u4e0d\u4f1a\u770b\u5230\u5b83\u5728\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u4e2d\u5904\u4e8e\u4e0d\u4e00\u81f4\u7684\u72b6\u6001\u3002"),(0,r.kt)("p",null,"\u4e0d\u53ef\u53d8\u7684\u7c7b\u578b\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"final \u5173\u952e\u5b57\u4fee\u9970\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff1b"),(0,r.kt)("li",{parentName:"ul"},"String"),(0,r.kt)("li",{parentName:"ul"},"\u679a\u4e3e\u7c7b\u578b"),(0,r.kt)("li",{parentName:"ul"},"Number \u90e8\u5206\u5b50\u7c7b\uff0c\u5982 Long \u548c Double \u7b49\u6570\u503c\u5305\u88c5\u7c7b\u578b\uff0cBigInteger \u548c BigDecimal \u7b49\u5927\u6570\u636e\u7c7b\u578b\u3002\u4f46\u540c\u4e3a Number \u7684\u5b50\u7c7b\u578b\u7684\u539f\u5b50\u7c7b AtomicInteger \u548c AtomicLong \u5219\u5e76\u975e\u4e0d\u53ef\u53d8\u7684\u3002")),(0,r.kt)("p",null,"\u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\uff0c\u53ef\u4ee5\u4f7f\u7528 Collections.unmodifiableXXX() \u65b9\u6cd5\u6765\u83b7\u53d6\u4e00\u4e2a\u4e0d\u53ef\u53d8\u7684\u96c6\u5408\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class ImmutableExample {\n    public static void main(String[] args) {\n        Map<String, Integer> map = new HashMap<>();\n        Map<String, Integer> unmodifiableMap = Collections.unmodifiableMap(map);\n        unmodifiableMap.put("a", 1);\n    }\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Exception in thread "main" java.lang.UnsupportedOperationException\n    at java.util.Collections$UnmodifiableMap.put(Collections.java:1457)\n    at ImmutableExample.main(ImmutableExample.java:9)\n')),(0,r.kt)("p",null,"Collections.unmodifiableXXX() \u5148\u5bf9\u539f\u59cb\u7684\u96c6\u5408\u8fdb\u884c\u62f7\u8d1d\uff0c\u9700\u8981\u5bf9\u96c6\u5408\u8fdb\u884c\u4fee\u6539\u7684\u65b9\u6cd5\u90fd\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public V put(K key, V value) {\n    throw new UnsupportedOperationException();\n}\n")),(0,r.kt)("p",null,"\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\uff0c\u5e94\u5f53\u5c3d\u91cf\u4f7f\u5bf9\u8c61\u6210\u4e3a\u4e0d\u53ef\u53d8\uff0c\u6765\u6ee1\u8db3\u7ebf\u7a0b\u5b89\u5168\u3002"),(0,r.kt)("h5",{id:"2-\u7edd\u5bf9\u7ebf\u7a0b\u5b89\u5168"},"2. \u7edd\u5bf9\u7ebf\u7a0b\u5b89\u5168"),(0,r.kt)("p",null,"\u4e0d\u7ba1\u8fd0\u884c\u65f6\u73af\u5883\u5982\u4f55\uff0c\u8c03\u7528\u8005\u90fd\u4e0d\u9700\u8981\u4efb\u4f55\u989d\u5916\u7684\u540c\u6b65\u63aa\u65bd\u3002"),(0,r.kt)("h5",{id:"3-\u76f8\u5bf9\u7ebf\u7a0b\u5b89\u5168"},"3. \u76f8\u5bf9\u7ebf\u7a0b\u5b89\u5168"),(0,r.kt)("p",null,"\u76f8\u5bf9\u7684\u7ebf\u7a0b\u5b89\u5168\u9700\u8981\u4fdd\u8bc1\u5bf9\u8fd9\u4e2a\u5bf9\u8c61\u5355\u72ec\u7684\u64cd\u4f5c\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u5728\u8c03\u7528\u7684\u65f6\u5019\u4e0d\u9700\u8981\u505a\u989d\u5916\u7684\u4fdd\u969c\u63aa\u65bd\uff0c\u4f46\u662f\u5bf9\u4e8e\u4e00\u4e9b\u7279\u5b9a\u987a\u5e8f\u7684\u8fde\u7eed\u8c03\u7528\uff0c\u5c31\u53ef\u80fd\u9700\u8981\u5728\u8c03\u7528\u7aef\u4f7f\u7528\u989d\u5916\u7684\u540c\u6b65\u624b\u6bb5\u6765\u4fdd\u8bc1\u8c03\u7528\u7684\u6b63\u786e\u6027\u3002"),(0,r.kt)("p",null,"\u5728 Java \u8bed\u8a00\u4e2d\uff0c\u5927\u90e8\u5206\u7684\u7ebf\u7a0b\u5b89\u5168\u7c7b\u90fd\u5c5e\u4e8e\u8fd9\u79cd\u7c7b\u578b\uff0c\u4f8b\u5982 Vector\u3001HashTable\u3001Collections \u7684 synchronizedCollection() \u65b9\u6cd5\u5305\u88c5\u7684\u96c6\u5408\u7b49\u3002"),(0,r.kt)("p",null,"\u5bf9\u4e8e\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u5982\u679c\u5220\u9664\u5143\u7d20\u7684\u7ebf\u7a0b\u5220\u9664\u4e86\u4e00\u4e2a\u5143\u7d20\uff0c\u800c\u83b7\u53d6\u5143\u7d20\u7684\u7ebf\u7a0b\u8bd5\u56fe\u8bbf\u95ee\u4e00\u4e2a\u5df2\u7ecf\u88ab\u5220\u9664\u7684\u5143\u7d20\uff0c\u90a3\u4e48\u5c31\u4f1a\u629b\u51fa ArrayIndexOutOfBoundsException\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class VectorUnsafeExample {\n    private static Vector<Integer> vector = new Vector<>();\n\n    public static void main(String[] args) {\n        while (true) {\n            for (int i = 0; i < 100; i++) {\n                vector.add(i);\n            }\n            ExecutorService executorService = Executors.newCachedThreadPool();\n            executorService.execute(() -> {\n                for (int i = 0; i < vector.size(); i++) {\n                    vector.remove(i);\n                }\n            });\n            executorService.execute(() -> {\n                for (int i = 0; i < vector.size(); i++) {\n                    vector.get(i);\n                }\n            });\n            executorService.shutdown();\n        }\n    }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Exception in thread "Thread-159738" java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 3\n    at java.util.Vector.remove(Vector.java:831)\n    at VectorUnsafeExample.lambda$main$0(VectorUnsafeExample.java:14)\n    at VectorUnsafeExample$$Lambda$1/713338599.run(Unknown Source)\n    at java.lang.Thread.run(Thread.java:745)\n')),(0,r.kt)("p",null,"\u5982\u679c\u8981\u4fdd\u8bc1\u4e0a\u9762\u7684\u4ee3\u7801\u80fd\u6b63\u786e\u6267\u884c\u4e0b\u53bb\uff0c\u5c31\u9700\u8981\u5bf9\u5220\u9664\u5143\u7d20\u548c\u83b7\u53d6\u5143\u7d20\u7684\u4ee3\u7801\u8fdb\u884c\u540c\u6b65\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"executorService.execute(() -> {\n    synchronized (vector) {\n        for (int i = 0; i < vector.size(); i++) {\n            vector.remove(i);\n        }\n    }\n});\nexecutorService.execute(() -> {\n    synchronized (vector) {\n        for (int i = 0; i < vector.size(); i++) {\n            vector.get(i);\n        }\n    }\n});\n")),(0,r.kt)("h5",{id:"4-\u7ebf\u7a0b\u517c\u5bb9"},"4. \u7ebf\u7a0b\u517c\u5bb9"),(0,r.kt)("p",null,"\u7ebf\u7a0b\u517c\u5bb9\u662f\u6307\u5bf9\u8c61\u672c\u8eab\u5e76\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u5728\u8c03\u7528\u7aef\u6b63\u786e\u5730\u4f7f\u7528\u540c\u6b65\u624b\u6bb5\u6765\u4fdd\u8bc1\u5bf9\u8c61\u5728\u5e76\u53d1\u73af\u5883\u4e2d\u53ef\u4ee5\u5b89\u5168\u5730\u4f7f\u7528\uff0c\u6211\u4eec\u5e73\u5e38\u8bf4\u4e00\u4e2a\u7c7b\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u7edd\u5927\u591a\u6570\u65f6\u5019\u6307\u7684\u662f\u8fd9\u4e00\u79cd\u60c5\u51b5\u3002Java API \u4e2d\u5927\u90e8\u5206\u7684\u7c7b\u90fd\u662f\u5c5e\u4e8e\u7ebf\u7a0b\u517c\u5bb9\u7684\uff0c\u5982\u4e0e\u524d\u9762\u7684 Vector \u548c HashTable \u76f8\u5bf9\u5e94\u7684\u96c6\u5408\u7c7b ArrayList \u548c HashMap \u7b49\u3002"),(0,r.kt)("h5",{id:"5-\u7ebf\u7a0b\u5bf9\u7acb"},"5. \u7ebf\u7a0b\u5bf9\u7acb"),(0,r.kt)("p",null,"\u7ebf\u7a0b\u5bf9\u7acb\u662f\u6307\u65e0\u8bba\u8c03\u7528\u7aef\u662f\u5426\u91c7\u53d6\u4e86\u540c\u6b65\u63aa\u65bd\uff0c\u90fd\u65e0\u6cd5\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u5e76\u53d1\u4f7f\u7528\u7684\u4ee3\u7801\u3002\u7531\u4e8e Java \u8bed\u8a00\u5929\u751f\u5c31\u5177\u5907\u591a\u7ebf\u7a0b\u7279\u6027\uff0c\u7ebf\u7a0b\u5bf9\u7acb\u8fd9\u79cd\u6392\u65a5\u591a\u7ebf\u7a0b\u7684\u4ee3\u7801\u662f\u5f88\u5c11\u51fa\u73b0\u7684\uff0c\u800c\u4e14\u901a\u5e38\u90fd\u662f\u6709\u5bb3\u7684\uff0c\u5e94\u5f53\u5c3d\u91cf\u907f\u514d\u3002"),(0,r.kt)("h4",{id:"\u7ebf\u7a0b\u5b89\u5168\u7684\u5b9e\u73b0\u65b9\u6cd5"},"\u7ebf\u7a0b\u5b89\u5168\u7684\u5b9e\u73b0\u65b9\u6cd5"),(0,r.kt)("h5",{id:"1-\u963b\u585e\u540c\u6b65\u4e92\u65a5\u540c\u6b65"},"1. \u963b\u585e\u540c\u6b65\uff08\u4e92\u65a5\u540c\u6b65\uff09"),(0,r.kt)("p",null,"synchronized \u548c ReentrantLock\u3002"),(0,r.kt)("p",null,"\u4e92\u65a5\u540c\u6b65\u6700\u4e3b\u8981\u7684\u95ee\u9898\u5c31\u662f\u8fdb\u884c\u7ebf\u7a0b\u963b\u585e\u548c\u5524\u9192\u6240\u5e26\u6765\u7684\u6027\u80fd\u95ee\u9898\uff0c\u56e0\u6b64\u8fd9\u79cd\u540c\u6b65\u4e5f\u79f0\u4e3a\u963b\u585e\u540c\u6b65\u3002"),(0,r.kt)("p",null,"\u4e92\u65a5\u540c\u6b65\u5c5e\u4e8e\u4e00\u79cd",(0,r.kt)("strong",{parentName:"p"},"\u60b2\u89c2\u7684\u5e76\u53d1\u7b56\u7565"),"\uff0c\u603b\u662f\u8ba4\u4e3a\u53ea\u8981\u4e0d\u53bb\u505a\u6b63\u786e\u7684\u540c\u6b65\u63aa\u65bd\uff0c\u90a3\u5c31\u80af\u5b9a\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\u65e0\u8bba\u5171\u4eab\u6570\u636e\u662f\u5426\u771f\u7684\u4f1a\u51fa\u73b0\u7ade\u4e89\uff0c\u5b83\u90fd\u8981\u8fdb\u884c\u52a0\u9501\uff08\u8fd9\u91cc\u8ba8\u8bba\u7684\u662f\u6982\u5ff5\u6a21\u578b\uff0c\u5b9e\u9645\u4e0a\u865a\u62df\u673a\u4f1a\u4f18\u5316\u6389\u5f88\u5927\u4e00\u90e8\u5206\u4e0d\u5fc5\u8981\u7684\u52a0\u9501\uff09\u3001\u7528\u6237\u6001\u6838\u5fc3\u6001\u8f6c\u6362\u3001\u7ef4\u62a4\u9501\u8ba1\u6570\u5668\u548c\u68c0\u67e5\u662f\u5426\u6709\u88ab\u963b\u585e\u7684\u7ebf\u7a0b\u9700\u8981\u5524\u9192\u7b49\u64cd\u4f5c\u3002"),(0,r.kt)("h5",{id:"2-\u975e\u963b\u585e\u540c\u6b65"},"2. \u975e\u963b\u585e\u540c\u6b65"),(0,r.kt)("p",null,"\u968f\u7740\u786c\u4ef6\u6307\u4ee4\u96c6\u7684\u53d1\u5c55\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u57fa\u4e8e\u51b2\u7a81\u68c0\u6d4b\u7684",(0,r.kt)("strong",{parentName:"p"},"\u4e50\u89c2\u5e76\u53d1\u7b56\u7565"),"\uff1a\u5148\u8fdb\u884c\u64cd\u4f5c\uff0c\u5982\u679c\u6ca1\u6709\u5176\u5b83\u7ebf\u7a0b\u4e89\u7528\u5171\u4eab\u6570\u636e\uff0c\u90a3\u64cd\u4f5c\u5c31\u6210\u529f\u4e86\uff0c\u5426\u5219\u91c7\u53d6\u8865\u507f\u63aa\u65bd\uff08\u4e0d\u65ad\u5730\u91cd\u8bd5\uff0c\u76f4\u5230\u6210\u529f\u4e3a\u6b62\uff09\u3002\u8fd9\u79cd\u4e50\u89c2\u7684\u5e76\u53d1\u7b56\u7565\u7684\u8bb8\u591a\u5b9e\u73b0\u90fd\u4e0d\u9700\u8981\u628a\u7ebf\u7a0b\u6302\u8d77\uff0c\u56e0\u6b64\u8fd9\u79cd\u540c\u6b65\u64cd\u4f5c\u79f0\u4e3a\u975e\u963b\u585e\u540c\u6b65\u3002"),(0,r.kt)("p",null,"\u4e50\u89c2\u9501\u9700\u8981\u64cd\u4f5c\u548c\u51b2\u7a81\u68c0\u6d4b\u8fd9\u4e24\u4e2a\u6b65\u9aa4\u5177\u5907\u539f\u5b50\u6027\uff0c\u8fd9\u91cc\u5c31\u4e0d\u80fd\u518d\u4f7f\u7528\u4e92\u65a5\u540c\u6b65\u6765\u4fdd\u8bc1\u4e86\uff0c\u53ea\u80fd\u9760\u786c\u4ef6\u6765\u5b8c\u6210\u3002"),(0,r.kt)("p",null,"\u786c\u4ef6\u652f\u6301\u7684\u539f\u5b50\u6027\u64cd\u4f5c\u6700\u5178\u578b\u7684\u662f\uff1a",(0,r.kt)("strong",{parentName:"p"},"\u6bd4\u8f83\u5e76\u4ea4\u6362"),"\uff08Compare-and-Swap\uff0cCAS\uff09\u3002CAS \u6307\u4ee4\u9700\u8981\u6709 3 \u4e2a\u64cd\u4f5c\u6570\uff0c\u5206\u522b\u662f",(0,r.kt)("strong",{parentName:"p"},"\u5185\u5b58\u5730\u5740 V\u3001\u65e7\u7684\u9884\u671f\u503c A \u548c\u65b0\u503c B"),"\u3002\u5f53\u6267\u884c\u64cd\u4f5c\u65f6\uff0c\u53ea\u6709\u5f53 V \u7684\u503c\u7b49\u4e8e A\uff0c\u624d\u5c06 V \u7684\u503c\u66f4\u65b0\u4e3a B\u3002"),(0,r.kt)("p",null,"J.U.C \u5305\u91cc\u9762\u7684\u6574\u6570\u539f\u5b50\u7c7b AtomicInteger\uff0c\u5176\u4e2d\u7684 compareAndSet() \u548c getAndIncrement() \u7b49\u65b9\u6cd5\u90fd\u4f7f\u7528\u4e86 Unsafe \u7c7b\u7684 CAS \u64cd\u4f5c\u3002"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u4ee3\u7801\u4f7f\u7528\u4e86 AtomicInteger \u6267\u884c\u4e86\u81ea\u589e\u7684\u64cd\u4f5c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"private AtomicInteger cnt = new AtomicInteger();\n\npublic void add() {\n    cnt.incrementAndGet();\n}\n")),(0,r.kt)("p",null,"\u4ee5\u4e0b\u4ee3\u7801\u662f incrementAndGet() \u7684\u6e90\u7801\uff0c\u5b83\u8c03\u7528\u4e86 unsafe \u7684 getAndAddInt() \u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public final int incrementAndGet() {\n    return unsafe.getAndAddInt(this, valueOffset, 1) + 1;\n}\n")),(0,r.kt)("p",null,"\u4ee5\u4e0b\u4ee3\u7801\u662f getAndAddInt() \u6e90\u7801\uff0cvar1 \u6307\u793a\u5bf9\u8c61\u5185\u5b58\u5730\u5740\uff0cvar2 \u6307\u793a\u8be5\u5b57\u6bb5\u76f8\u5bf9\u5bf9\u8c61\u5185\u5b58\u5730\u5740\u7684\u504f\u79fb\uff0cvar4 \u6307\u793a\u64cd\u4f5c\u9700\u8981\u52a0\u7684\u6570\u503c\uff0c\u8fd9\u91cc\u4e3a 1\u3002\u901a\u8fc7 getIntVolatile(var1, var2) \u5f97\u5230\u65e7\u7684\u9884\u671f\u503c\uff0c\u901a\u8fc7\u8c03\u7528 compareAndSwapInt() \u6765\u8fdb\u884c CAS \u6bd4\u8f83\uff0c\u5982\u679c\u8be5\u5b57\u6bb5\u5185\u5b58\u5730\u5740\u4e2d\u7684\u503c ==var5\uff0c\u90a3\u4e48\u5c31\u66f4\u65b0\u5185\u5b58\u5730\u5740\u4e3a var1+var2 \u7684\u53d8\u91cf\u4e3a var5+var4\u3002"),(0,r.kt)("p",null,"\u53ef\u4ee5\u770b\u5230 getAndAddInt() \u5728\u4e00\u4e2a\u5faa\u73af\u4e2d\u8fdb\u884c\uff0c\u53d1\u751f\u51b2\u7a81\u7684\u505a\u6cd5\u662f\u4e0d\u65ad\u7684\u8fdb\u884c\u91cd\u8bd5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public final int getAndAddInt(Object var1, long var2, int var4) {\n    int var5;\n    do {\n        var5 = this.getIntVolatile(var1, var2);\n    } while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4));\n\n    return var5;\n}\n")),(0,r.kt)("p",null,"ABA \uff1a\u5982\u679c\u4e00\u4e2a\u53d8\u91cf\u521d\u6b21\u8bfb\u53d6\u7684\u65f6\u5019\u662f A \u503c\uff0c\u5b83\u7684\u503c\u88ab\u6539\u6210\u4e86 B\uff0c\u540e\u6765\u53c8\u88ab\u6539\u56de\u4e3a A\uff0c\u90a3 CAS \u64cd\u4f5c\u5c31\u4f1a\u8bef\u8ba4\u4e3a\u5b83\u4ece\u6765\u6ca1\u6709\u88ab\u6539\u53d8\u8fc7\u3002"),(0,r.kt)("p",null,"J.U.C \u5305\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5e26\u6709\u6807\u8bb0\u7684\u539f\u5b50\u5f15\u7528\u7c7b AtomicStampedReference \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7\u63a7\u5236\u53d8\u91cf\u503c\u7684\u7248\u672c\u6765\u4fdd\u8bc1 CAS \u7684\u6b63\u786e\u6027\u3002\u5927\u90e8\u5206\u60c5\u51b5\u4e0b ABA \u95ee\u9898\u4e0d\u4f1a\u5f71\u54cd\u7a0b\u5e8f\u5e76\u53d1\u7684\u6b63\u786e\u6027\uff0c\u5982\u679c\u9700\u8981\u89e3\u51b3 ABA \u95ee\u9898\uff0c\u6539\u7528\u4f20\u7edf\u7684\u4e92\u65a5\u540c\u6b65\u53ef\u80fd\u4f1a\u6bd4\u539f\u5b50\u7c7b\u66f4\u9ad8\u6548\u3002"),(0,r.kt)("h5",{id:"3-\u65e0\u540c\u6b65\u65b9\u6848"},"3. \u65e0\u540c\u6b65\u65b9\u6848"),(0,r.kt)("p",null,"\u8981\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff0c\u5e76\u4e0d\u662f\u4e00\u5b9a\u5c31\u8981\u8fdb\u884c\u540c\u6b65\uff0c\u4e24\u8005\u6ca1\u6709\u56e0\u679c\u5173\u7cfb\u3002\u540c\u6b65\u53ea\u662f\u4fdd\u8bc1\u5171\u4eab\u6570\u636e\u4e89\u7528\u65f6\u7684\u6b63\u786e\u6027\u7684\u624b\u6bb5\uff0c\u5982\u679c\u4e00\u4e2a\u65b9\u6cd5\u672c\u6765\u5c31\u4e0d\u6d89\u53ca\u5171\u4eab\u6570\u636e\uff0c\u90a3\u5b83\u81ea\u7136\u5c31\u65e0\u987b\u4efb\u4f55\u540c\u6b65\u63aa\u65bd\u53bb\u4fdd\u8bc1\u6b63\u786e\u6027\uff0c\u56e0\u6b64\u4f1a\u6709\u4e00\u4e9b\u4ee3\u7801\u5929\u751f\u5c31\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002"),(0,r.kt)("h6",{id:"\u4e00\u53ef\u91cd\u5165\u4ee3\u7801reentrant-code"},"\uff08\u4e00\uff09\u53ef\u91cd\u5165\u4ee3\u7801\uff08Reentrant Code\uff09"),(0,r.kt)("p",null,"\u8fd9\u79cd\u4ee3\u7801\u4e5f\u53eb\u505a\u7eaf\u4ee3\u7801\uff08Pure Code\uff09\uff0c\u53ef\u4ee5\u5728\u4ee3\u7801\u6267\u884c\u7684\u4efb\u4f55\u65f6\u523b\u4e2d\u65ad\u5b83\uff0c\u8f6c\u800c\u53bb\u6267\u884c\u53e6\u5916\u4e00\u6bb5\u4ee3\u7801\uff08\u5305\u62ec\u9012\u5f52\u8c03\u7528\u5b83\u672c\u8eab\uff09\uff0c\u800c\u5728\u63a7\u5236\u6743\u8fd4\u56de\u540e\uff0c\u539f\u6765\u7684\u7a0b\u5e8f\u4e0d\u4f1a\u51fa\u73b0\u4efb\u4f55\u9519\u8bef\u3002"),(0,r.kt)("p",null,"\u53ef\u91cd\u5165\u4ee3\u7801\u6709\u4e00\u4e9b\u5171\u540c\u7684\u7279\u5f81\uff0c\u4f8b\u5982\u4e0d\u4f9d\u8d56\u5b58\u50a8\u5728\u5806\u4e0a\u7684\u6570\u636e\u548c\u516c\u7528\u7684\u7cfb\u7edf\u8d44\u6e90\u3001\u7528\u5230\u7684\u72b6\u6001\u91cf\u90fd\u7531\u53c2\u6570\u4e2d\u4f20\u5165\u3001\u4e0d\u8c03\u7528\u975e\u53ef\u91cd\u5165\u7684\u65b9\u6cd5\u7b49\u3002"),(0,r.kt)("h6",{id:"\u4e8c\u6808\u5c01\u95ed"},"\uff08\u4e8c\uff09\u6808\u5c01\u95ed"),(0,r.kt)("p",null,"\u591a\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u4e2a\u65b9\u6cd5\u7684\u5c40\u90e8\u53d8\u91cf\u65f6\uff0c\u4e0d\u4f1a\u51fa\u73b0\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\uff0c\u56e0\u4e3a\u5c40\u90e8\u53d8\u91cf\u5b58\u50a8\u5728\u6808\u4e2d\uff0c\u5c5e\u4e8e\u7ebf\u7a0b\u79c1\u6709\u7684\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"import java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\npublic class StackClosedExample {\n    public void add100() {\n        int cnt = 0;\n        for (int i = 0; i < 100; i++) {\n            cnt++;\n        }\n        System.out.println(cnt);\n    }\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static void main(String[] args) {\n    StackClosedExample example = new StackClosedExample();\n    ExecutorService executorService = Executors.newCachedThreadPool();\n    executorService.execute(() -> example.add100());\n    executorService.execute(() -> example.add100());\n    executorService.shutdown();\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"100\n100\n")),(0,r.kt)("h6",{id:"\u4e09\u7ebf\u7a0b\u672c\u5730\u5b58\u50a8thread-local-storage"},"\uff08\u4e09\uff09\u7ebf\u7a0b\u672c\u5730\u5b58\u50a8\uff08Thread Local Storage\uff09"),(0,r.kt)("p",null,"\u5982\u679c\u4e00\u6bb5\u4ee3\u7801\u4e2d\u6240\u9700\u8981\u7684\u6570\u636e\u5fc5\u987b\u4e0e\u5176\u4ed6\u4ee3\u7801\u5171\u4eab\uff0c\u90a3\u5c31\u770b\u770b\u8fd9\u4e9b\u5171\u4eab\u6570\u636e\u7684\u4ee3\u7801\u662f\u5426\u80fd\u4fdd\u8bc1\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u6267\u884c\u3002\u5982\u679c\u80fd\u4fdd\u8bc1\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u5171\u4eab\u6570\u636e\u7684\u53ef\u89c1\u8303\u56f4\u9650\u5236\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u4e4b\u5185\uff0c\u8fd9\u6837\uff0c\u65e0\u987b\u540c\u6b65\u4e5f\u80fd\u4fdd\u8bc1\u7ebf\u7a0b\u4e4b\u95f4\u4e0d\u51fa\u73b0\u6570\u636e\u4e89\u7528\u7684\u95ee\u9898\u3002"),(0,r.kt)("p",null,"\u7b26\u5408\u8fd9\u79cd\u7279\u70b9\u7684\u5e94\u7528\u5e76\u4e0d\u5c11\u89c1\uff0c\u5927\u90e8\u5206\u4f7f\u7528\u6d88\u8d39\u961f\u5217\u7684\u67b6\u6784\u6a21\u5f0f\uff08\u5982\u201c\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u201d\u6a21\u5f0f\uff09\u90fd\u4f1a\u5c06\u4ea7\u54c1\u7684\u6d88\u8d39\u8fc7\u7a0b\u5c3d\u91cf\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u6d88\u8d39\u5b8c\uff0c\u5176\u4e2d\u6700\u91cd\u8981\u7684\u4e00\u4e2a\u5e94\u7528\u5b9e\u4f8b\u5c31\u662f\u7ecf\u5178 Web \u4ea4\u4e92\u6a21\u578b\u4e2d\u7684 \u201c",(0,r.kt)("strong",{parentName:"p"},"\u4e00\u4e2a\u8bf7\u6c42\u5bf9\u5e94\u4e00\u4e2a\u670d\u52a1\u5668\u7ebf\u7a0b"),"\u201d\uff08Thread-per-Request\uff09\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u8fd9\u79cd\u5904\u7406\u65b9\u5f0f\u7684\u5e7f\u6cdb\u5e94\u7528\u4f7f\u5f97\u5f88\u591a Web \u670d\u52a1\u7aef\u5e94\u7528\u90fd\u53ef\u4ee5\u4f7f\u7528\u7ebf\u7a0b\u672c\u5730\u5b58\u50a8\u6765\u89e3\u51b3\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\u3002"),(0,r.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528 java.lang.ThreadLocal \u7c7b\u6765\u5b9e\u73b0\u7ebf\u7a0b\u672c\u5730\u5b58\u50a8\u529f\u80fd\u3002"),(0,r.kt)("p",null,"\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u4f8b\u9898\uff0c\u8bf7\u53c2\u8003\u6574\u7406\uff1a"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.nowcoder.com/questionTerminal/b82e4a85a66e4dc488a5ab49094976e9?orderByHotValue=0&pos=73&mutiTagIds=171"},"\u5173\u4e8eThreadLocal\u7c7b\u4ee5\u4e0b\u8bf4\u6cd5\u6b63\u786e\u7684\u662f?",(0,r.kt)("em",{parentName:"a"},"\u8fc5\u96f7\u7b14\u8bd5\u9898"),"\u725b\u5ba2\u7f51")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u793a\u4f8b\u7528\u6cd5")),(0,r.kt)("p",null,"\u5148\u901a\u8fc7\u4e0b\u9762\u8fd9\u4e2a\u5b9e\u4f8b\u6765\u7406\u89e3 ThreadLocal \u7684\u7528\u6cd5\u3002\u5148\u58f0\u660e\u4e00\u4e2a ThreadLocal \u5bf9\u8c61\uff0c\u5b58\u50a8\u5e03\u5c14\u7c7b\u578b\u7684\u6570\u503c\u3002\u7136\u540e\u5206\u522b\u5728main\u7ebf\u7a0b\u3001Thread1\u3001Thread2\u4e2d\u4e3a ThreadLocal \u5bf9\u8c61\u8bbe\u7f6e\u4e0d\u540c\u7684\u6570\u503c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class ThreadLocalDemo {\n    public static void main(String[] args) {\n\n        // \u58f0\u660e ThreadLocal\u5bf9\u8c61\n        ThreadLocal<Boolean> mThreadLocal = new ThreadLocal<Boolean>();\n\n        // \u5728\u4e3b\u7ebf\u7a0b\u3001\u5b50\u7ebf\u7a0b1\u3001\u5b50\u7ebf\u7a0b2\u4e2d\u53bb\u8bbe\u7f6e\u8bbf\u95ee\u5b83\u7684\u503c\n        mThreadLocal.set(true);\n\n        System.out.println("Main " + mThreadLocal.get());\n\n        new Thread("Thread#1"){\n            @Override\n            public void run() {\n                mThreadLocal.set(false);\n                System.out.println("Thread#1 " + mThreadLocal.get());\n            }\n        }.start();\n\n        new Thread("Thread#2"){\n            @Override\n            public void run() {\n                System.out.println("Thread#2 " + mThreadLocal.get());\n            }\n        }.start();\n    }\n}\n')),(0,r.kt)("p",null,"\u6253\u5370\u7684\u7ed3\u679c\u8f93\u51fa\u5982\u4e0b\u6240\u793a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"MainThread true\nThread#1 false\nThread#2 null\n")),(0,r.kt)("p",null,"\u53ef\u4ee5\u770b\u89c1\uff0c\u5728\u4e0d\u540c\u7ebf\u7a0b\u5bf9\u540c\u4e00\u4e2a ThreadLocal\u5bf9\u8c61\u8bbe\u7f6e\u6570\u503c\uff0c\u5728\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e2d\u53d6\u51fa\u6765\u7684\u503c\u4e0d\u4e00\u6837\u3002\u63a5\u4e0b\u6765\u5c31\u5206\u6790\u4e00\u4e0b\u6e90\u7801\uff0c\u770b\u770b\u5176\u5185\u90e8\u7ed3\u6784\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u7ed3\u6784\u6982\u89c8")),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/006dXScfgy1fj7s01fjqpj30ng0jbabn.jpg",width:"500"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"\u6e05\u6670\u7684\u770b\u5230\u4e00\u4e2a\u7ebf\u7a0b Thread \u4e2d\u5b58\u5728\u4e00\u4e2a ThreadLocalMap\uff0cThreadLocalMap \u4e2d\u7684 key \u5bf9\u5e94 ThreadLocal\uff0c\u5728\u6b64\u5904\u53ef\u89c1 Map \u53ef\u4ee5\u5b58\u50a8\u591a\u4e2a key \u5373 (ThreadLocal)\u3002\u53e6\u5916 Value \u5c31\u5bf9\u5e94\u7740\u5728 ThreadLocal \u4e2d\u5b58\u50a8\u7684 Value\u3002"),(0,r.kt)("p",null,"\u56e0\u6b64\u603b\u7ed3\u51fa\uff1a\u6bcf\u4e2a Thread \u4e2d\u90fd\u5177\u5907\u4e00\u4e2a ThreadLocalMap\uff0c\u800c ThreadLocalMap \u53ef\u4ee5\u5b58\u50a8\u4ee5 ThreadLocal \u4e3akey\u7684\u952e\u503c\u5bf9\u3002\u8fd9\u91cc\u89e3\u91ca\u4e86\u4e3a\u4ec0\u4e48\u6bcf\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u4e2a ThreadLocal\uff0c\u5f97\u5230\u7684\u786e\u662f\u4e0d\u540c\u7684\u6570\u503c\u3002\u5982\u679c\u6b64\u5904\u4f60\u89c9\u5f97\u6709\u70b9\u7a81\u5140\uff0c\u63a5\u4e0b\u6765\u770b\u6e90\u7801\u5206\u6790\uff01"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6e90\u7801\u5206\u6790")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1. ThreadLocal#set")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public void set(T value) {\n    // \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u5bf9\u8c61\n    Thread t = Thread.currentThread();\n    // \u6839\u636e\u5f53\u524d\u7ebf\u7a0b\u7684\u5bf9\u8c61\u83b7\u53d6\u5176\u5185\u90e8Map\n    ThreadLocalMap map = getMap(t);\n    \n    // \u6ce8\u91ca1\n    if (map != null)\n        map.set(this, value);\n    else\n        createMap(t, value);\n}\n")),(0,r.kt)("p",null,"\u5982\u4e0a\u6240\u793a\uff0c\u5927\u90e8\u5206\u89e3\u91ca\u5df2\u7ecf\u5728\u4ee3\u7801\u4e2d\u505a\u51fa\uff0c\u6ce8\u610f",(0,r.kt)("inlineCode",{parentName:"p"},"\u6ce8\u91ca1"),"\u5904\uff0c\u5f97\u5230 map \u5bf9\u8c61\u4e4b\u540e\uff0c\u7528\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"this")," \u4f5c\u4e3a  key\uff0cthis \u5728\u8fd9\u91cc\u4ee3\u8868\u7684\u662f\u5f53\u524d\u7ebf\u7a0b\u7684 ThreadLocal \u5bf9\u8c61\u3002 \u53e6\u5916\u5c31\u662f\u7b2c\u4e8c\u53e5\u6839\u636e getMap \u83b7\u53d6\u4e00\u4e2a ThreadLocalMap\uff0c\u5176\u4e2dgetMap \u4e2d\u4f20\u5165\u4e86\u53c2\u6570 t (\u5f53\u524d\u7ebf\u7a0b\u5bf9\u8c61)\uff0c\u8fd9\u6837\u5c31\u80fd\u591f\u83b7\u53d6\u6bcf\u4e2a\u7ebf\u7a0b\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"ThreadLocal")," \u4e86\u3002 "),(0,r.kt)("p",null,"\u7ee7\u7eed\u8ddf\u8fdb\u5230 ThreadLocalMap \u4e2d\u67e5\u770b set \u65b9\u6cd5\uff1a"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2. ThreadLocalMap")),(0,r.kt)("p",null,"ThreadLocalMap \u662f ThreadLocal \u7684\u4e00\u4e2a\u5185\u90e8\u7c7b\uff0c\u5728\u5206\u6790\u5176 set \u65b9\u6cd5\u4e4b\u524d\uff0c\u67e5\u770b\u4e00\u4e0b\u5176\u7c7b\u7ed3\u6784\u548c\u6210\u5458\u53d8\u91cf\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"}," static class ThreadLocalMap {\n     // Entry\u7c7b\u7ee7\u627f\u4e86WeakReference<ThreadLocal<?>>\n     // \u5373\u6bcf\u4e2aEntry\u5bf9\u8c61\u90fd\u6709\u4e00\u4e2aThreadLocal\u7684\u5f31\u5f15\u7528\uff08\u4f5c\u4e3akey\uff09\uff0c\u8fd9\u662f\u4e3a\u4e86\u9632\u6b62\u5185\u5b58\u6cc4\u9732\u3002\n     // \u4e00\u65e6\u7ebf\u7a0b\u7ed3\u675f\uff0ckey\u53d8\u4e3a\u4e00\u4e2a\u4e0d\u53ef\u8fbe\u7684\u5bf9\u8c61\uff0c\u8fd9\u4e2aEntry\u5c31\u53ef\u4ee5\u88abGC\u4e86\u3002\n     static class Entry extends WeakReference<ThreadLocal<?>> {\n         /** The value associated with this ThreadLocal. */\n         Object value;\n         Entry(ThreadLocal<?> k, Object v) {\n             super(k);\n             value = v;\n         }\n     }\n     // ThreadLocalMap \u7684\u521d\u59cb\u5bb9\u91cf\uff0c\u5fc5\u987b\u4e3a2\u7684\u500d\u6570\n     private static final int INITIAL_CAPACITY = 16;\n\n     // resized\u65f6\u5019\u9700\u8981\u7684table\n     private Entry[] table;\n\n     // table\u4e2d\u7684entry\u4e2a\u6570\n     private int size = 0;\n\n     // \u6269\u5bb9\u6570\u503c\n     private int threshold; // Default to 0\n }\n")),(0,r.kt)("p",null,"\u4e00\u8d77\u770b\u4e00\u4e0b\u5176\u5e38\u7528\u7684\u6784\u9020\u51fd\u6570\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"ThreadLocalMap(ThreadLocal<?> firstKey, Object firstValue) {\n    table = new Entry[INITIAL_CAPACITY];\n    int i = firstKey.threadLocalHashCode & (INITIAL_CAPACITY - 1);\n    table[i] = new Entry(firstKey, firstValue);\n    size = 1;\n    setThreshold(INITIAL_CAPACITY);\n}\n")),(0,r.kt)("p",null,"\u6784\u9020\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5c31\u662f\u672c ThreadLocal \u5b9e\u4f8b (this)\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f\u8981\u4fdd\u5b58\u7684\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u3002\u6784\u9020\u51fd\u6570\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u957f\u5ea6\u4e3a16\u7684 Entry \u6570\u7ec4\uff0c\u7136\u540e\u8ba1\u7b97\u51fa firstKey \u5bf9\u5e94\u7684\u54c8\u5e0c\u503c\uff0c\u7136\u540e\u5b58\u50a8\u5230 table \u4e2d\uff0c\u5e76\u8bbe\u7f6e size \u548c threshold\u3002"),(0,r.kt)("p",null,"\u6ce8\u610f\u4e00\u4e2a\u7ec6\u8282\uff0c\u8ba1\u7b97 hash \u7684\u65f6\u5019\u91cc\u9762\u91c7\u7528\u4e86 hashCode & (size - 1) \u7684\u7b97\u6cd5\uff0c\u8fd9\u76f8\u5f53\u4e8e\u53d6\u6a21\u8fd0\u7b97 hashCode % size \u7684\u4e00\u4e2a\u66f4\u9ad8\u6548\u7684\u5b9e\u73b0\uff08\u548cHashMap\u4e2d\u7684\u601d\u8def\u76f8\u540c\uff09\u3002\u6b63\u662f\u56e0\u4e3a\u8fd9\u79cd\u7b97\u6cd5\uff0c\u6211\u4eec\u8981\u6c42 size\u5fc5\u987b\u662f 2 \u7684\u6307\u6570\uff0c\u56e0\u4e3a\u8fd9\u53ef\u4ee5\u4f7f\u5f97 hash \u53d1\u751f\u51b2\u7a81\u7684\u6b21\u6570\u51cf\u5c0f\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3. ThreadLocalMap#set")),(0,r.kt)("p",null,"ThreadLocal \u4e2d put \u51fd\u6570\u6700\u7ec8\u8c03\u7528\u4e86 ThreadLocalMap \u4e2d\u7684 set \u51fd\u6570\uff0c\u8ddf\u8fdb\u53bb\u770b\u4e00\u770b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"private void set(ThreadLocal<?> key, Object value) {\n    Entry[] tab = table;\n    int len = tab.length;\n    int i = key.threadLocalHashCode & (len-1);\n\n    for (Entry e = tab[i];\n         e != null;\n         // \u51b2\u7a81\u4e86\n         e = tab[i = nextIndex(i, len)]) {\n        ThreadLocal<?> k = e.get();\n\n        if (k == key) {\n            e.value = value;\n            return;\n        }\n\n        if (k == null) {\n            replaceStaleEntry(key, value, i);\n            return;\n        }\n    }\n\n    tab[i] = new Entry(key, value);\n    int sz = ++size;\n    if (!cleanSomeSlots(i, sz) && sz >= threshold)\n        rehash();\n}\n")),(0,r.kt)("p",null,"\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u5982\u679c Entry \u5728\u5b58\u653e\u8fc7\u7a0b\u4e2d\u51b2\u7a81\u4e86\uff0c\u8c03\u7528 nextIndex \u6765\u5904\u7406\uff0c\u5982\u4e0b\u6240\u793a\u3002\u662f\u5426\u8fd8\u8bb0\u5f97 hashmap \u4e2d\u5bf9\u5f85\u51b2\u7a81\u7684\u5904\u7406\uff1f\u8fd9\u91cc\u597d\u50cf\u662f\u53e6\u4e00\u79cd\u5957\u8def\uff1a\u53ea\u8981 i \u7684\u6570\u503c\u5c0f\u4e8e len\uff0c\u5c31\u52a01\u53d6\u503c\uff0c\u5b98\u65b9\u672f\u8bed\u79f0\u4e3a\uff1a\u7ebf\u6027\u63a2\u6d4b\u6cd5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"}," private static int nextIndex(int i, int len) {\n     return ((i + 1 < len) ? i + 1 : 0);\n }\n")),(0,r.kt)("p",null,"\u4ee5\u4e0a\u6b65\u9aa4ok\u4e86\u4e4b\u540e\uff0c\u518d\u6b21\u5173\u6ce8\u4e00\u4e0b\u6e90\u7801\u4e2d\u7684 cleanSomeSlots\uff0c\u8be5\u51fd\u6570\u4e3b\u8981\u7684\u4f5c\u7528\u5c31\u662f\u6e05\u7406\u65e0\u7528\u7684 entry\uff0c\u907f\u514d\u51fa\u73b0\u5185\u5b58\u6cc4\u9732\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"private boolean cleanSomeSlots(int i, int n) {\n    boolean removed = false;\n    Entry[] tab = table;\n    int len = tab.length;\n    do {\n        i = nextIndex(i, len);\n        Entry e = tab[i];\n        if (e != null && e.get() == null) {\n            n = len;\n            removed = true;\n            i = expungeStaleEntry(i);\n        }\n    } while ( (n >>>= 1) != 0);\n    return removed;\n}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"4. ThreadLocal#get")),(0,r.kt)("p",null,"\u770b\u5b8c\u4e86 set \u51fd\u6570\uff0c\u80af\u5b9a\u662f\u8981\u5173\u6ce8 get \u7684\uff0c\u6e90\u7801\u5982\u4e0b\u6240\u793a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public T get() {\n    // \u83b7\u53d6Thread\u5bf9\u8c61t\n    Thread t = Thread.currentThread();\n    // \u83b7\u53d6t\u4e2d\u7684map\n    ThreadLocalMap map = getMap(t);\n    if (map != null) {\n        ThreadLocalMap.Entry e = map.getEntry(this);\n        if (e != null) {\n            @SuppressWarnings("unchecked")\n            T result = (T)e.value;\n            return result;\n        }\n    }\n    // \u5982\u679ct\u4e2d\u7684map\u4e3a\u7a7a\n    return setInitialValue();\n}\n')),(0,r.kt)("p",null,"\u5982\u679c map \u4e3a null\uff0c\u5c31\u8fd4\u56de setInitialValue() \u8fd9\u4e2a\u65b9\u6cd5\uff0c\u8ddf\u8fdb\u8fd9\u4e2a\u65b9\u6cd5\u770b\u4e00\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"}," private T setInitialValue() {\n     T value = initialValue();\n     Thread t = Thread.currentThread();\n     ThreadLocalMap map = getMap(t);\n     if (map != null)\n         map.set(this, value);\n     else\n         createMap(t, value);\n     return value;\n }\n")),(0,r.kt)("p",null,"\u6700\u540e\u8fd4\u56de\u7684\u662f value\uff0c\u800c value \u6765\u81ea ",(0,r.kt)("inlineCode",{parentName:"p"},"initialValue() "),"\uff0c\u8fdb\u5165\u8fd9\u4e2a\u6e90\u7801\u4e2d\u67e5\u770b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"protected T initialValue() {\n    return null;\n}\n")),(0,r.kt)("p",null,"\u539f\u6765\u5982\u6b64\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e ThreadLocal \u7684\u6570\u503c\uff0c\u9ed8\u8ba4\u5c31\u662f null\uff0c\u6765\u81ea\u4e8e\u6b64\u3002"),(0,r.kt)("p",null,"ThreadLocal \u4ece\u7406\u8bba\u4e0a\u8bb2\u5e76\u4e0d\u662f\u7528\u6765\u89e3\u51b3\u591a\u7ebf\u7a0b\u5e76\u53d1\u95ee\u9898\u7684\uff0c\u56e0\u4e3a\u6839\u672c\u4e0d\u5b58\u5728\u591a\u7ebf\u7a0b\u7ade\u4e89\u3002\u5728\u4e00\u4e9b\u573a\u666f (\u5c24\u5176\u662f\u4f7f\u7528\u7ebf\u7a0b\u6c60) \u4e0b\uff0c\u7531\u4e8e ThreadLocal.ThreadLocalMap \u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5bfc\u81f4 ThreadLocal \u6709\u5185\u5b58\u6cc4\u6f0f\u7684\u60c5\u51b5\uff0c\u5c3d\u53ef\u80fd\u5728\u6bcf\u6b21\u4f7f\u7528 ThreadLocal \u540e\u624b\u52a8\u8c03\u7528 remove()\uff0c\u4ee5\u907f\u514d\u51fa\u73b0 ThreadLocal \u7ecf\u5178\u7684\u5185\u5b58\u6cc4\u6f0f\u751a\u81f3\u662f\u9020\u6210\u81ea\u8eab\u4e1a\u52a1\u6df7\u4e71\u7684\u98ce\u9669\u3002"),(0,r.kt)("p",null,"\u53c2\u8003\u8d44\u6599\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://allenwu.itscoder.com/threadlocal-source"},"\u6df1\u5165\u7406\u89e3 Java \u4e4b ThreadLocal \u5de5\u4f5c\u539f\u7406"))),(0,r.kt)("h3",{id:"12-\u9501\u4f18\u5316"},"12. \u9501\u4f18\u5316"),(0,r.kt)("p",null,"\u8fd9\u91cc\u7684\u9501\u4f18\u5316\u4e3b\u8981\u662f\u6307\u865a\u62df\u673a\u5bf9 synchronized \u7684\u4f18\u5316\u3002"),(0,r.kt)("h4",{id:"\u81ea\u65cb\u9501"},"\u81ea\u65cb\u9501"),(0,r.kt)("p",null,"\u4e92\u65a5\u540c\u6b65\u7684\u8fdb\u5165\u963b\u585e\u72b6\u6001\u7684\u5f00\u9500\u90fd\u5f88\u5927\uff0c\u5e94\u8be5\u5c3d\u91cf\u907f\u514d\u3002\u5728\u8bb8\u591a\u5e94\u7528\u4e2d\uff0c\u5171\u4eab\u6570\u636e\u7684\u9501\u5b9a\u72b6\u6001\u53ea\u4f1a\u6301\u7eed\u5f88\u77ed\u7684\u4e00\u6bb5\u65f6\u95f4\u3002\u81ea\u65cb\u9501\u7684\u601d\u60f3\u662f\u8ba9\u4e00\u4e2a\u7ebf\u7a0b\u5728\u8bf7\u6c42\u4e00\u4e2a\u5171\u4eab\u6570\u636e\u7684\u9501\u65f6\u6267\u884c\u5fd9\u5faa\u73af\uff08\u81ea\u65cb\uff09\u4e00\u6bb5\u65f6\u95f4\uff0c\u5982\u679c\u5728\u8fd9\u6bb5\u65f6\u95f4\u5185\u80fd\u83b7\u5f97\u9501\uff0c\u5c31\u53ef\u4ee5\u907f\u514d\u8fdb\u5165\u963b\u585e\u72b6\u6001\u3002"),(0,r.kt)("p",null,"\u81ea\u65cb\u9501\u867d\u7136\u80fd\u907f\u514d\u8fdb\u5165\u963b\u585e\u72b6\u6001\u4ece\u800c\u51cf\u5c11\u5f00\u9500\uff0c\u4f46\u662f\u5b83\u9700\u8981\u8fdb\u884c\u5fd9\u5faa\u73af\u64cd\u4f5c\u5360\u7528 CPU \u65f6\u95f4\uff0c\u5b83\u53ea\u9002\u7528\u4e8e\u5171\u4eab\u6570\u636e\u7684\u9501\u5b9a\u72b6\u6001\u5f88\u77ed\u7684\u573a\u666f\u3002"),(0,r.kt)("p",null,"\u5728 JDK 1.6 \u4e2d\u5f15\u5165\u4e86\u81ea\u9002\u5e94\u7684\u81ea\u65cb\u9501\u3002\u81ea\u9002\u5e94\u610f\u5473\u7740\u81ea\u65cb\u7684\u6b21\u6570\u4e0d\u518d\u56fa\u5b9a\u4e86\uff0c\u800c\u662f\u7531\u524d\u4e00\u6b21\u5728\u540c\u4e00\u4e2a\u9501\u4e0a\u7684\u81ea\u65cb\u6b21\u6570\u53ca\u9501\u7684\u62e5\u6709\u8005\u7684\u72b6\u6001\u6765\u51b3\u5b9a\u3002"),(0,r.kt)("h4",{id:"\u9501\u6d88\u9664"},"\u9501\u6d88\u9664"),(0,r.kt)("p",null,"\u9501\u6d88\u9664\u662f\u6307\u5bf9\u4e8e\u88ab\u68c0\u6d4b\u51fa\u4e0d\u53ef\u80fd\u5b58\u5728\u7ade\u4e89\u7684\u5171\u4eab\u6570\u636e\u7684\u9501\u8fdb\u884c\u6d88\u9664\u3002"),(0,r.kt)("p",null,"\u9501\u6d88\u9664\u4e3b\u8981\u662f\u901a\u8fc7",(0,r.kt)("strong",{parentName:"p"},"\u9003\u9038\u5206\u6790"),"\u6765\u652f\u6301\uff0c\u5982\u679c\u5806\u4e0a\u7684\u5171\u4eab\u6570\u636e\u4e0d\u53ef\u80fd\u9003\u9038\u51fa\u53bb\u88ab\u5176\u5b83\u7ebf\u7a0b\u8bbf\u95ee\u5230\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u628a\u5b83\u4eec\u5f53\u6210\u79c1\u6709\u6570\u636e\u5bf9\u5f85\uff0c\u4e5f\u5c31\u53ef\u4ee5\u5c06\u5b83\u4eec\u7684\u9501\u8fdb\u884c\u6d88\u9664\u3002"),(0,r.kt)("p",null,"\u5bf9\u4e8e\u4e00\u4e9b\u770b\u8d77\u6765\u6ca1\u6709\u52a0\u9501\u7684\u4ee3\u7801\uff0c\u5176\u5b9e\u9690\u5f0f\u7684\u52a0\u4e86\u5f88\u591a\u9501\u3002\u4f8b\u5982\u4e0b\u9762\u7684\u5b57\u7b26\u4e32\u62fc\u63a5\u4ee3\u7801\u5c31\u9690\u5f0f\u52a0\u4e86\u9501\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static String concatString(String s1, String s2, String s3) {\n    return s1 + s2 + s3;\n}\n")),(0,r.kt)("p",null,"String \u662f\u4e00\u4e2a\u4e0d\u53ef\u53d8\u7684\u7c7b\uff0c\u7f16\u8bd1\u5668\u4f1a\u5bf9 String \u7684\u62fc\u63a5\u81ea\u52a8\u4f18\u5316\u3002\u5728 JDK 1.5 \u4e4b\u524d\uff0c\u4f1a\u8f6c\u5316\u4e3a StringBuffer \u5bf9\u8c61\u7684\u8fde\u7eed append() \u64cd\u4f5c\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public static String concatString(String s1, String s2, String s3) {\n    StringBuffer sb = new StringBuffer();\n    sb.append(s1);\n    sb.append(s2);\n    sb.append(s3);\n    return sb.toString();\n}\n")),(0,r.kt)("p",null,"\u6bcf\u4e2a append() \u65b9\u6cd5\u4e2d\u90fd\u6709\u4e00\u4e2a\u540c\u6b65\u5757\u3002\u865a\u62df\u673a\u89c2\u5bdf\u53d8\u91cf sb\uff0c\u5f88\u5feb\u5c31\u4f1a\u53d1\u73b0\u5b83\u7684\u52a8\u6001\u4f5c\u7528\u57df\u88ab\u9650\u5236\u5728 concatString() \u65b9\u6cd5\u5185\u90e8\u3002\u4e5f\u5c31\u662f\u8bf4\uff0csb \u7684\u6240\u6709\u5f15\u7528\u6c38\u8fdc\u4e0d\u4f1a\u201c\u9003\u9038\u201d\u5230 concatString() \u65b9\u6cd5\u4e4b\u5916\uff0c\u5176\u4ed6\u7ebf\u7a0b\u65e0\u6cd5\u8bbf\u95ee\u5230\u5b83\uff0c\u56e0\u6b64\u53ef\u4ee5\u8fdb\u884c\u6d88\u9664\u3002"),(0,r.kt)("h4",{id:"\u9501\u7c97\u5316"},"\u9501\u7c97\u5316"),(0,r.kt)("p",null,"\u5982\u679c\u4e00\u7cfb\u5217\u7684\u8fde\u7eed\u64cd\u4f5c\u90fd\u5bf9\u540c\u4e00\u4e2a\u5bf9\u8c61\u53cd\u590d\u52a0\u9501\u548c\u89e3\u9501\uff0c\u9891\u7e41\u7684\u52a0\u9501\u64cd\u4f5c\u5c31\u4f1a\u5bfc\u81f4\u6027\u80fd\u635f\u8017\u3002"),(0,r.kt)("p",null,"\u4e0a\u4e00\u8282\u7684\u793a\u4f8b\u4ee3\u7801\u4e2d\u8fde\u7eed\u7684 append() \u65b9\u6cd5\u5c31\u5c5e\u4e8e\u8fd9\u7c7b\u60c5\u51b5\u3002\u5982\u679c\u865a\u62df\u673a\u63a2\u6d4b\u5230\u7531\u8fd9\u6837\u7684\u4e00\u4e32\u96f6\u788e\u7684\u64cd\u4f5c\u90fd\u5bf9\u540c\u4e00\u4e2a\u5bf9\u8c61\u52a0\u9501\uff0c\u5c06\u4f1a\u628a\u52a0\u9501\u7684\u8303\u56f4\u6269\u5c55\uff08\u7c97\u5316\uff09\u5230\u6574\u4e2a\u64cd\u4f5c\u5e8f\u5217\u7684\u5916\u90e8\u3002\u5bf9\u4e8e\u4e0a\u4e00\u8282\u7684\u793a\u4f8b\u4ee3\u7801\u5c31\u662f\u6269\u5c55\u5230\u7b2c\u4e00\u4e2a append() \u64cd\u4f5c\u4e4b\u524d\u76f4\u81f3\u6700\u540e\u4e00\u4e2a append() \u64cd\u4f5c\u4e4b\u540e\uff0c\u8fd9\u6837\u53ea\u9700\u8981\u52a0\u9501\u4e00\u6b21\u5c31\u53ef\u4ee5\u4e86\u3002"),(0,r.kt)("h4",{id:"\u8f7b\u91cf\u7ea7\u9501"},"\u8f7b\u91cf\u7ea7\u9501"),(0,r.kt)("p",null,"JDK 1.6 \u5f15\u5165\u4e86\u504f\u5411\u9501\u548c\u8f7b\u91cf\u7ea7\u9501\uff0c\u4ece\u800c\u8ba9\u9501\u62e5\u6709\u4e86\u56db\u4e2a\u72b6\u6001\uff1a\u65e0\u9501\u72b6\u6001\uff08unlocked\uff09\u3001\u504f\u5411\u9501\u72b6\u6001\uff08biasble\uff09\u3001\u8f7b\u91cf\u7ea7\u9501\u72b6\u6001\uff08lightweight locked\uff09\u548c\u91cd\u91cf\u7ea7\u9501\u72b6\u6001\uff08inflated\uff09\u3002"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u662f HotSpot \u865a\u62df\u673a\u5bf9\u8c61\u5934\u7684\u5185\u5b58\u5e03\u5c40\uff0c\u8fd9\u4e9b\u6570\u636e\u88ab\u79f0\u4e3a mark word\u3002\u5176\u4e2d tag bits \u5bf9\u5e94\u4e86\u4e94\u4e2a\u72b6\u6001\uff0c\u8fd9\u4e9b\u72b6\u6001\u5728\u53f3\u4fa7\u7684 state \u8868\u683c\u4e2d\u7ed9\u51fa\uff0c\u5e94\u8be5\u6ce8\u610f\u7684\u662f state \u8868\u683c\u4e0d\u662f\u5b58\u50a8\u5728\u5bf9\u8c61\u5934\u4e2d\u7684\u3002\u9664\u4e86 marked for gc \u72b6\u6001\uff0c\u5176\u5b83\u56db\u4e2a\u72b6\u6001\u5df2\u7ecf\u5728\u524d\u9762\u4ecb\u7ecd\u8fc7\u4e86\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/bb6a49be-00f2-4f27-a0ce-4ed764bc605c-1534158631668.png",width:"600"})),(0,r.kt)("br",null),(0,r.kt)("p",null,"\u4e0b\u56fe\u5de6\u4fa7\u662f\u4e00\u4e2a\u7ebf\u7a0b\u7684\u865a\u62df\u673a\u6808\uff0c\u5176\u4e2d\u6709\u4e00\u90e8\u5206\u79f0\u4e3a Lock Record \u7684\u533a\u57df\uff0c\u8fd9\u662f\u5728\u8f7b\u91cf\u7ea7\u9501\u8fd0\u884c\u8fc7\u7a0b\u521b\u5efa\u7684\uff0c\u7528\u4e8e\u5b58\u653e\u9501\u5bf9\u8c61\u7684 Mark Word\u3002\u800c\u53f3\u4fa7\u5c31\u662f\u4e00\u4e2a\u9501\u5bf9\u8c61\uff0c\u5305\u542b\u4e86 Mark Word \u548c\u5176\u5b83\u4fe1\u606f\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/051e436c-0e46-4c59-8f67-52d89d656182-1534158643175.png",width:"500"})),(0,r.kt)("p",null,"\u8f7b\u91cf\u7ea7\u9501\u662f\u76f8\u5bf9\u4e8e\u4f20\u7edf\u7684\u91cd\u91cf\u7ea7\u9501\u800c\u8a00\uff0c\u5b83\u4f7f\u7528 CAS \u64cd\u4f5c\u6765\u907f\u514d\u91cd\u91cf\u7ea7\u9501\u4f7f\u7528\u4e92\u65a5\u91cf\u7684\u5f00\u9500\u3002\u5bf9\u4e8e\u7edd\u5927\u90e8\u5206\u7684\u9501\uff0c\u5728\u6574\u4e2a\u540c\u6b65\u5468\u671f\u5185\u90fd\u662f\u4e0d\u5b58\u5728\u7ade\u4e89\u7684\uff0c\u56e0\u6b64\u4e5f\u5c31\u4e0d\u9700\u8981\u90fd\u4f7f\u7528\u4e92\u65a5\u91cf\u8fdb\u884c\u540c\u6b65\uff0c\u53ef\u4ee5\u5148\u91c7\u7528 CAS \u64cd\u4f5c\u8fdb\u884c\u540c\u6b65\uff0c\u5982\u679c CAS \u5931\u8d25\u4e86\u518d\u6539\u7528\u4e92\u65a5\u91cf\u8fdb\u884c\u540c\u6b65\u3002"),(0,r.kt)("p",null,"\u5f53\u5c1d\u8bd5\u83b7\u53d6\u4e00\u4e2a\u9501\u5bf9\u8c61\u65f6\uff0c\u5982\u679c\u9501\u5bf9\u8c61\u6807\u8bb0\u4e3a 0 01\uff0c\u8bf4\u660e\u9501\u5bf9\u8c61\u7684\u9501\u672a\u9501\u5b9a\uff08unlocked\uff09\u72b6\u6001\u3002\u6b64\u65f6\u865a\u62df\u673a\u5728\u5f53\u524d\u7ebf\u7a0b\u6808\u4e2d\u521b\u5efa Lock Record\uff0c\u7136\u540e\u4f7f\u7528 CAS \u64cd\u4f5c\u5c06\u5bf9\u8c61\u7684 Mark Word \u66f4\u65b0\u4e3a Lock Record \u6307\u9488\u3002\u5982\u679c CAS \u64cd\u4f5c\u6210\u529f\u4e86\uff0c\u90a3\u4e48\u7ebf\u7a0b\u5c31\u83b7\u53d6\u4e86\u8be5\u5bf9\u8c61\u4e0a\u7684\u9501\uff0c\u5e76\u4e14\u5bf9\u8c61\u7684 Mark Word \u7684\u9501\u6807\u8bb0\u53d8\u4e3a 00\uff0c\u8868\u793a\u8be5\u5bf9\u8c61\u5904\u4e8e\u8f7b\u91cf\u7ea7\u9501\u72b6\u6001\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/baaa681f-7c52-4198-a5ae-303b9386cf47-1534158703049.png",width:"500"})),(0,r.kt)("p",null,"\u5982\u679c CAS \u64cd\u4f5c\u5931\u8d25\u4e86\uff0c\u865a\u62df\u673a\u9996\u5148\u4f1a\u68c0\u67e5\u5bf9\u8c61\u7684 Mark Word \u662f\u5426\u6307\u5411\u5f53\u524d\u7ebf\u7a0b\u7684\u865a\u62df\u673a\u6808\uff0c\u5982\u679c\u662f\u7684\u8bdd\u8bf4\u660e\u5f53\u524d\u7ebf\u7a0b\u5df2\u7ecf\u62e5\u6709\u4e86\u8fd9\u4e2a\u9501\u5bf9\u8c61\uff0c\u90a3\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fdb\u5165\u540c\u6b65\u5757\u7ee7\u7eed\u6267\u884c\uff0c\u5426\u5219\u8bf4\u660e\u8fd9\u4e2a\u9501\u5bf9\u8c61\u5df2\u7ecf\u88ab\u5176\u4ed6\u7ebf\u7a0b\u7ebf\u7a0b\u62a2\u5360\u4e86\u3002\u5982\u679c\u6709\u4e24\u6761\u4ee5\u4e0a\u7684\u7ebf\u7a0b\u4e89\u7528\u540c\u4e00\u4e2a\u9501\uff0c\u90a3\u8f7b\u91cf\u7ea7\u9501\u5c31\u4e0d\u518d\u6709\u6548\uff0c\u8981\u81a8\u80c0\u4e3a\u91cd\u91cf\u7ea7\u9501\u3002"),(0,r.kt)("h4",{id:"\u504f\u5411\u9501"},"\u504f\u5411\u9501"),(0,r.kt)("p",null,"\u504f\u5411\u9501\u7684\u601d\u60f3\u662f\u504f\u5411\u4e8e\u8ba9\u7b2c\u4e00\u4e2a\u83b7\u53d6\u9501\u5bf9\u8c61\u7684\u7ebf\u7a0b\uff0c\u8fd9\u4e2a\u7ebf\u7a0b\u5728\u4e4b\u540e\u83b7\u53d6\u8be5\u9501\u5c31\u4e0d\u518d\u9700\u8981\u8fdb\u884c\u540c\u6b65\u64cd\u4f5c\uff0c\u751a\u81f3\u8fde CAS \u64cd\u4f5c\u4e5f\u4e0d\u518d\u9700\u8981\u3002"),(0,r.kt)("p",null,"\u5f53\u9501\u5bf9\u8c61\u7b2c\u4e00\u6b21\u88ab\u7ebf\u7a0b\u83b7\u5f97\u7684\u65f6\u5019\uff0c\u8fdb\u5165\u504f\u5411\u72b6\u6001\uff0c\u6807\u8bb0\u4e3a 1 01\u3002\u540c\u65f6\u4f7f\u7528 CAS \u64cd\u4f5c\u5c06\u7ebf\u7a0b ID \u8bb0\u5f55\u5230 Mark Word \u4e2d\uff0c\u5982\u679c CAS \u64cd\u4f5c\u6210\u529f\uff0c\u8fd9\u4e2a\u7ebf\u7a0b\u4ee5\u540e\u6bcf\u6b21\u8fdb\u5165\u8fd9\u4e2a\u9501\u76f8\u5173\u7684\u540c\u6b65\u5757\u5c31\u4e0d\u9700\u8981\u518d\u8fdb\u884c\u4efb\u4f55\u540c\u6b65\u64cd\u4f5c\u3002"),(0,r.kt)("p",null,"\u5f53\u6709\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u5c1d\u8bd5\u83b7\u53d6\u8fd9\u4e2a\u9501\u5bf9\u8c61\u65f6\uff0c\u504f\u5411\u72b6\u6001\u5c31\u5ba3\u544a\u7ed3\u675f\uff0c\u6b64\u65f6\u64a4\u9500\u504f\u5411\uff08Revoke Bias\uff09\u540e\u6062\u590d\u5230\u672a\u9501\u5b9a\u72b6\u6001\u6216\u8005\u8f7b\u91cf\u7ea7\u9501\u72b6\u6001\u3002"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/390c913b-5f31-444f-bbdb-2b88b688e7ce-1534158712253.jpg",width:"600"})),(0,r.kt)("h3",{id:"13-\u591a\u7ebf\u7a0b\u5f00\u53d1\u826f\u597d\u7684\u5b9e\u8df5"},"13. \u591a\u7ebf\u7a0b\u5f00\u53d1\u826f\u597d\u7684\u5b9e\u8df5"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7ed9\u7ebf\u7a0b\u8d77\u4e2a\u6709\u610f\u4e49\u7684\u540d\u5b57\uff0c\u8fd9\u6837\u53ef\u4ee5\u65b9\u4fbf\u627e Bug\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7f29\u5c0f\u540c\u6b65\u8303\u56f4\uff0c\u4f8b\u5982\u5bf9\u4e8e synchronized\uff0c\u5e94\u8be5\u5c3d\u91cf\u4f7f\u7528\u540c\u6b65\u5757\u800c\u4e0d\u662f\u540c\u6b65\u65b9\u6cd5\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u591a\u7528\u540c\u6b65\u7c7b\u5c11\u7528 wait() \u548c notify()\u3002\u9996\u5148\uff0cCountDownLatch, CyclicBarrier, Semaphore \u548c Exchanger \u8fd9\u4e9b\u540c\u6b65\u7c7b\u7b80\u5316\u4e86\u7f16\u7801\u64cd\u4f5c\uff0c\u800c\u7528 wait() \u548c notify() \u5f88\u96be\u5b9e\u73b0\u5bf9\u590d\u6742\u7684\u63a7\u5236\u6d41\uff1b\u5176\u6b21\uff0c\u8fd9\u4e9b\u540c\u6b65\u7c7b\u662f\u7531\u6700\u597d\u7684\u4f01\u4e1a\u7f16\u5199\u548c\u7ef4\u62a4\uff0c\u5728\u540e\u7eed\u7684 JDK \u4e2d\u8fd8\u4f1a\u4e0d\u65ad\u4f18\u5316\u548c\u5b8c\u5584\uff0c\u4f7f\u7528\u8fd9\u4e9b\u66f4\u9ad8\u7b49\u7ea7\u7684\u540c\u6b65\u5de5\u5177\u4f60\u7684\u7a0b\u5e8f\u53ef\u4ee5\u4e0d\u8d39\u5439\u7070\u4e4b\u529b\u83b7\u5f97\u4f18\u5316\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u591a\u7528\u5e76\u53d1\u96c6\u5408\u5c11\u7528\u540c\u6b65\u96c6\u5408\uff0c\u4f8b\u5982\u5e94\u8be5\u4f7f\u7528 ConcurrentHashMap \u800c\u4e0d\u662f Hashtable\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u672c\u5730\u53d8\u91cf\u548c\u4e0d\u53ef\u53d8\u7c7b\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u7ebf\u7a0b\u6c60\u800c\u4e0d\u662f\u76f4\u63a5\u521b\u5efa Thread \u5bf9\u8c61\uff0c\u8fd9\u662f\u56e0\u4e3a\u521b\u5efa\u7ebf\u7a0b\u4ee3\u4ef7\u5f88\u9ad8\uff0c\u7ebf\u7a0b\u6c60\u53ef\u4ee5\u6709\u6548\u5730\u5229\u7528\u6709\u9650\u7684\u7ebf\u7a0b\u6765\u542f\u52a8\u4efb\u52a1\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 BlockingQueue \u5b9e\u73b0\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u95ee\u9898\u3002")),(0,r.kt)("h3",{id:"14-\u7ebf\u7a0b\u6c60\u5b9e\u73b0\u539f\u7406"},"14. \u7ebf\u7a0b\u6c60\u5b9e\u73b0\u539f\u7406"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u8611\u83c7\u8857\u9762\u8bd5\uff0c\u8bbe\u8ba1\u4e00\u4e2a\u7ebf\u7a0b\u6c60")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"ThrealpoolExecutor_framework",src:t(9842).Z,width:"1304",height:"480"})),(0,r.kt)("h4",{id:"\u5e76\u53d1\u961f\u5217"},"\u5e76\u53d1\u961f\u5217"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u5165\u961f")),(0,r.kt)("p",null,"\u975e\u963b\u585e\u961f\u5217\uff1a\u5f53\u961f\u5217\u4e2d\u6ee1\u4e86\u65f6\u5019\uff0c\u653e\u5165\u6570\u636e\uff0c\u6570\u636e\u4e22\u5931"),(0,r.kt)("p",null,"\u963b\u585e\u961f\u5217\uff1a\u5f53\u961f\u5217\u6ee1\u4e86\u7684\u65f6\u5019\uff0c\u8fdb\u884c\u7b49\u5f85\uff0c\u4ec0\u4e48\u65f6\u5019\u961f\u5217\u4e2d\u6709\u51fa\u961f\u7684\u6570\u636e\uff0c\u90a3\u4e48\u7b2c11\u4e2a\u518d\u653e\u8fdb\u53bb"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u51fa\u961f")),(0,r.kt)("p",null,"\u975e\u963b\u585e\u961f\u5217\uff1a\u5982\u679c\u73b0\u5728\u961f\u5217\u4e2d\u6ca1\u6709\u5143\u7d20\uff0c\u53d6\u5143\u7d20\uff0c\u5f97\u5230\u7684\u662fnull"),(0,r.kt)("p",null,"\u963b\u585e\u961f\u5217\uff1a\u7b49\u5f85\uff0c\u4ec0\u4e48\u65f6\u5019\u653e\u8fdb\u53bb\uff0c\u518d\u53d6\u51fa\u6765"),(0,r.kt)("p",null,"\u7ebf\u7a0b\u6c60\u4f7f\u7528\u7684\u662f\u963b\u585e\u961f\u5217"),(0,r.kt)("h4",{id:"\u7ebf\u7a0b\u6c60\u6982\u5ff5"},"\u7ebf\u7a0b\u6c60\u6982\u5ff5"),(0,r.kt)("p",null,"\u7ebf\u7a0b\u662f\u7a00\u7f3a\u8d44\u6e90\uff0c\u5982\u679c\u88ab\u65e0\u9650\u5236\u7684\u521b\u5efa\uff0c\u4e0d\u4ec5\u4f1a\u6d88\u8017\u7cfb\u7edf\u8d44\u6e90\uff0c\u8fd8\u4f1a\u964d\u4f4e\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\uff0c\u5408\u7406\u7684\u4f7f\u7528\u7ebf\u7a0b\u6c60\u5bf9\u7ebf\u7a0b\u8fdb\u884c\u7edf\u4e00\u5206\u914d\u3001\u8c03\u4f18\u548c\u76d1\u63a7\uff0c\u6709\u4ee5\u4e0b\u597d\u5904\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u964d\u4f4e\u8d44\u6e90\u6d88\u8017\uff1b"),(0,r.kt)("li",{parentName:"ol"},"\u63d0\u9ad8\u54cd\u5e94\u901f\u5ea6\uff1b"),(0,r.kt)("li",{parentName:"ol"},"\u63d0\u9ad8\u7ebf\u7a0b\u7684\u53ef\u7ba1\u7406\u6027\u3002")),(0,r.kt)("p",null,"Java1.5 \u4e2d\u5f15\u5165\u7684 Executor \u6846\u67b6\u628a\u4efb\u52a1\u7684\u63d0\u4ea4\u548c\u6267\u884c\u8fdb\u884c\u89e3\u8026\uff0c\u53ea\u9700\u8981\u5b9a\u4e49\u597d\u4efb\u52a1\uff0c\u7136\u540e\u63d0\u4ea4\u7ed9\u7ebf\u7a0b\u6c60\uff0c\u800c\u4e0d\u7528\u5173\u5fc3\u8be5\u4efb\u52a1\u662f\u5982\u4f55\u6267\u884c\u3001\u88ab\u54ea\u4e2a\u7ebf\u7a0b\u6267\u884c\uff0c\u4ee5\u53ca\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u3002"),(0,r.kt)("h4",{id:"executor\u7c7b\u56fe"},"Executor\u7c7b\u56fe"),(0,r.kt)("div",{align:"center"},(0,r.kt)("img",{src:"assets/820628cf179f4952812da4e8ca5de672.png",width:""})),(0,r.kt)("h4",{id:"\u7ebf\u7a0b\u6c60\u5de5\u4f5c\u539f\u7406"},"\u7ebf\u7a0b\u6c60\u5de5\u4f5c\u539f\u7406"),(0,r.kt)("p",null,"\u7ebf\u7a0b\u6c60\u4e2d\u7684\u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u5f53\u63d0\u4ea4\u4e00\u4e2a\u4efb\u52a1\u65f6\uff0c\u7ebf\u7a0b\u6c60\u521b\u5efa\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\uff0c\u76f4\u5230\u5f53\u524d\u7ebf\u7a0b\u6570\u7b49\u4e8ecorePoolSize\uff1b\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u6570\u4e3a corePoolSize\uff0c\u7ee7\u7eed\u63d0\u4ea4\u7684\u4efb\u52a1\u88ab\u4fdd\u5b58\u5230\u963b\u585e\u961f\u5217\u4e2d\uff0c\u7b49\u5f85\u88ab\u6267\u884c\uff1b\u5982\u679c\u963b\u585e\u961f\u5217\u6ee1\u4e86\uff0c\u90a3\u5c31\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u6267\u884c\u5f53\u524d\u4efb\u52a1\uff1b\u76f4\u5230\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\u8fbe\u5230 maxPoolSize\uff0c\u8fd9\u65f6\u518d\u6709\u4efb\u52a1\u6765\uff0c\u53ea\u80fd\u6267\u884c reject() \u5904\u7406\u8be5\u4efb\u52a1\u3002"),(0,r.kt)("h4",{id:"\u521d\u59cb\u5316\u7ebf\u7a0b\u6c60"},"\u521d\u59cb\u5316\u7ebf\u7a0b\u6c60"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"newFixedThreadPool()"),"\n\u8bf4\u660e\uff1a",(0,r.kt)("strong",{parentName:"li"},"\u521d\u59cb\u5316\u4e00\u4e2a\u6307\u5b9a\u7ebf\u7a0b\u6570\u7684\u7ebf\u7a0b\u6c60"),"\uff0c\u5176\u4e2d corePoolSize == maxiPoolSize\uff0c\u4f7f\u7528 LinkedBlockingQuene \u4f5c\u4e3a\u963b\u585e\u961f\u5217\n\u7279\u70b9\uff1a\u5373\u4f7f\u5f53\u7ebf\u7a0b\u6c60\u6ca1\u6709\u53ef\u6267\u884c\u4efb\u52a1\u65f6\uff0c\u4e5f\u4e0d\u4f1a\u91ca\u653e\u7ebf\u7a0b\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"newCachedThreadPool()"),"\n\u8bf4\u660e\uff1a",(0,r.kt)("strong",{parentName:"li"},"\u521d\u59cb\u5316\u4e00\u4e2a\u53ef\u4ee5\u7f13\u5b58\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u6c60"),"\uff0c\u9ed8\u8ba4\u7f13\u5b5860s\uff0c\u7ebf\u7a0b\u6c60\u7684\u7ebf\u7a0b\u6570\u53ef\u8fbe\u5230 Integer.MAX_VALUE\uff0c\u5373 2147483647\uff0c\u5185\u90e8\u4f7f\u7528 SynchronousQueue \u4f5c\u4e3a\u963b\u585e\u961f\u5217\uff1b\n\u7279\u70b9\uff1a\u5728\u6ca1\u6709\u4efb\u52a1\u6267\u884c\u65f6\uff0c\u5f53\u7ebf\u7a0b\u7684\u7a7a\u95f2\u65f6\u95f4\u8d85\u8fc7 keepAliveTime\uff0c\u4f1a\u81ea\u52a8\u91ca\u653e\u7ebf\u7a0b\u8d44\u6e90\uff1b\u5f53\u63d0\u4ea4\u65b0\u4efb\u52a1\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u5219\u521b\u5efa\u65b0\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\uff0c\u4f1a\u5bfc\u81f4\u4e00\u5b9a\u7684\u7cfb\u7edf\u5f00\u9500\uff1b\n\u56e0\u6b64\uff0c\u4f7f\u7528\u65f6\u8981\u6ce8\u610f\u63a7\u5236\u5e76\u53d1\u7684\u4efb\u52a1\u6570\uff0c\u9632\u6b62\u56e0\u521b\u5efa\u5927\u91cf\u7684\u7ebf\u7a0b\u5bfc\u81f4\u800c\u964d\u4f4e\u6027\u80fd\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"newSingleThreadExecutor()"),"\n\u8bf4\u660e\uff1a",(0,r.kt)("strong",{parentName:"li"},"\u521d\u59cb\u5316\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u6c60"),"\uff0c\u5185\u90e8\u4f7f\u7528 LinkedBlockingQueue \u4f5c\u4e3a\u963b\u585e\u961f\u5217\u3002\n\u7279\u70b9\uff1a\u5982\u679c\u8be5\u7ebf\u7a0b\u5f02\u5e38\u7ed3\u675f\uff0c\u4f1a\u91cd\u65b0\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u7ee7\u7eed\u6267\u884c\u4efb\u52a1\uff0c\u552f\u4e00\u7684\u7ebf\u7a0b\u53ef\u4ee5\u4fdd\u8bc1\u6240\u63d0\u4ea4\u4efb\u52a1\u7684\u987a\u5e8f\u6267\u884c"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"newScheduledThreadPool()"),"\n\u7279\u70b9\uff1a\u521d\u59cb\u5316\u7684\u7ebf\u7a0b\u6c60\u53ef\u4ee5\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u5185\u5468\u671f\u6027\u7684\u6267\u884c\u6240\u63d0\u4ea4\u7684\u4efb\u52a1\uff0c\u5728\u5b9e\u9645\u7684\u4e1a\u52a1\u573a\u666f\u4e2d\u53ef\u4ee5\u4f7f\u7528\u8be5\u7ebf\u7a0b\u6c60\u5b9a\u671f\u7684\u540c\u6b65\u6570\u636e\u3002")),(0,r.kt)("h5",{id:"\u521d\u59cb\u5316\u65b9\u6cd5"},"\u521d\u59cb\u5316\u65b9\u6cd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// \u4f7f\u7528Executors\u9759\u6001\u65b9\u6cd5\u8fdb\u884c\u521d\u59cb\u5316\nExecutorService service = Executors.newSingleThreadExecutor();\n// \u5e38\u7528\u65b9\u6cd5\nservice.execute(new Thread());\nservice.submit(new Thread());\nservice.shutDown();\nservice.shutDownNow();\n")),(0,r.kt)("h4",{id:"\u5e38\u7528\u65b9\u6cd5"},"\u5e38\u7528\u65b9\u6cd5"),(0,r.kt)("h5",{id:"execute\u4e0esubmit\u7684\u533a\u522b"},"execute\u4e0esubmit\u7684\u533a\u522b"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u63a5\u6536\u7684\u53c2\u6570\u4e0d\u4e00\u6837"),(0,r.kt)("li",{parentName:"ol"},"submit\u6709\u8fd4\u56de\u503c\uff0c\u800cexecute\u6ca1\u6709")),(0,r.kt)("p",null,"\u7528\u5230\u8fd4\u56de\u503c\u7684\u4f8b\u5b50\uff0c\u6bd4\u5982\u8bf4\u6211\u6709\u5f88\u591a\u4e2a\u505a validation \u7684 task\uff0c\u6211\u5e0c\u671b\u6240\u6709\u7684 task \u6267\u884c\u5b8c\uff0c\u7136\u540e\u6bcf\u4e2a task \u544a\u8bc9\u6211\u5b83\u7684\u6267\u884c\u7ed3\u679c\uff0c\u662f\u6210\u529f\u8fd8\u662f\u5931\u8d25\uff0c\u5982\u679c\u662f\u5931\u8d25\uff0c\u539f\u56e0\u662f\u4ec0\u4e48\u3002\u7136\u540e\u6211\u5c31\u53ef\u4ee5\u628a\u6240\u6709\u5931\u8d25\u7684\u539f\u56e0\u7efc\u5408\u8d77\u6765\u53d1\u7ed9\u8c03\u7528\u8005\u3002"),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"submit\u65b9\u4fbfException\u5904\u7406")),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u5728\u4f60\u7684 task \u91cc\u4f1a\u629b\u51fa checked \u6216\u8005 unchecked exception\uff0c\u800c\u4f60\u53c8\u5e0c\u671b\u5916\u9762\u7684\u8c03\u7528\u8005\u80fd\u591f\u611f\u77e5\u8fd9\u4e9b exception \u5e76\u505a\u51fa\u53ca\u65f6\u7684\u5904\u7406\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u7528\u5230 submit\uff0c\u901a\u8fc7\u6355\u83b7 Future.get \u629b\u51fa\u7684\u5f02\u5e38\u3002"),(0,r.kt)("h5",{id:"shutdown\u4e0eshutdownnow\u7684\u533a\u522b"},"shutDown\u4e0eshutDownNow\u7684\u533a\u522b"),(0,r.kt)("p",null,"\u5f53\u7ebf\u7a0b\u6c60\u8c03\u7528\u8be5\u65b9\u6cd5\u65f6,\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001\u5219\u7acb\u523b\u53d8\u6210 SHUTDOWN \u72b6\u6001\u3002\u6b64\u65f6\uff0c\u5219\u4e0d\u80fd\u518d\u5f80\u7ebf\u7a0b\u6c60\u4e2d\u6dfb\u52a0\u4efb\u4f55\u4efb\u52a1\uff0c\u5426\u5219\u5c06\u4f1a\u629b\u51fa RejectedExecutionException \u5f02\u5e38\u3002\u4f46\u662f\uff0c\u6b64\u65f6\u7ebf\u7a0b\u6c60\u4e0d\u4f1a\u7acb\u523b\u9000\u51fa\uff0c\u76f4\u5230\u6dfb\u52a0\u5230\u7ebf\u7a0b\u6c60\u4e2d\u7684\u4efb\u52a1\u90fd\u5df2\u7ecf\u5904\u7406\u5b8c\u6210\uff0c\u624d\u4f1a\u9000\u51fa\u3002"),(0,r.kt)("h4",{id:"\u5185\u90e8\u5b9e\u73b0"},"\u5185\u90e8\u5b9e\u73b0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public ThreadPoolExecutor(\n    int corePoolSize,     // \u6838\u5fc3\u7ebf\u7a0b\u6570\n    int maximumPoolSize,  // \u6700\u5927\u7ebf\u7a0b\u6570\n    long keepAliveTime,   // \u7ebf\u7a0b\u5b58\u6d3b\u65f6\u95f4\uff08\u5728 corePore<*<maxPoolSize \u60c5\u51b5\u4e0b\u6709\u7528\uff09\n    TimeUnit unit,        // \u5b58\u6d3b\u65f6\u95f4\u7684\u65f6\u95f4\u5355\u4f4d\n    BlockingQueue<Runnable> workQueue    // \u963b\u585e\u961f\u5217\uff08\u7528\u6765\u4fdd\u5b58\u7b49\u5f85\u88ab\u6267\u884c\u7684\u4efb\u52a1\uff09\n    ThreadFactory threadFactory,    // \u7ebf\u7a0b\u5de5\u5382\uff0c\u4e3b\u8981\u7528\u6765\u521b\u5efa\u7ebf\u7a0b\uff1b\n    RejectedExecutionHandler handler // \u5f53\u62d2\u7edd\u5904\u7406\u4efb\u52a1\u65f6\u7684\u7b56\u7565\n){\n    \nthis(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,\n         Executors.defaultThreadFactory(), defaultHandler);\n}\n")),(0,r.kt)("p",null,"\u5173\u4e8e workQueue \u53c2\u6570\uff0c\u6709\u56db\u79cd\u961f\u5217\u53ef\u4f9b\u9009\u62e9\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ArrayBlockingQueue\uff1a\u57fa\u4e8e\u6570\u7ec4\u7ed3\u6784\u7684\u6709\u754c\u963b\u585e\u961f\u5217\uff0c\u6309 FIFO \u6392\u5e8f\u4efb\u52a1\uff1b"),(0,r.kt)("li",{parentName:"ul"},"LinkedBlockingQuene\uff1a\u57fa\u4e8e\u94fe\u8868\u7ed3\u6784\u7684\u963b\u585e\u961f\u5217\uff0c\u6309 FIFO \u6392\u5e8f\u4efb\u52a1\uff1b"),(0,r.kt)("li",{parentName:"ul"},"SynchronousQuene\uff1a\u4e00\u4e2a\u4e0d\u5b58\u50a8\u5143\u7d20\u7684\u963b\u585e\u961f\u5217\uff0c\u6bcf\u4e2a\u63d2\u5165\u64cd\u4f5c\u5fc5\u987b\u7b49\u5230\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528\u79fb\u9664\u64cd\u4f5c\uff0c\u5426\u5219\u63d2\u5165\u64cd\u4f5c\u4e00\u76f4\u5904\u4e8e\u963b\u585e\u72b6\u6001\uff0c\u541e\u5410\u91cf\u901a\u5e38\u8981\u9ad8\u4e8e ArrayBlockingQuene\uff1b"),(0,r.kt)("li",{parentName:"ul"},"PriorityBlockingQuene\uff1a\u5177\u6709\u4f18\u5148\u7ea7\u7684\u65e0\u754c\u963b\u585e\u961f\u5217\uff1b")),(0,r.kt)("p",null,"\u5173\u4e8e handler \u53c2\u6570\uff0c\u7ebf\u7a0b\u6c60\u7684\u9971\u548c\u7b56\u7565\uff0c\u5f53\u963b\u585e\u961f\u5217\u6ee1\u4e86\uff0c\u4e14\u6ca1\u6709\u7a7a\u95f2\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u5982\u679c\u7ee7\u7eed\u63d0\u4ea4\u4efb\u52a1\uff0c\u5fc5\u987b\u91c7\u53d6\u4e00\u79cd\u7b56\u7565\u5904\u7406\u8be5\u4efb\u52a1\uff0c\u7ebf\u7a0b\u6c60\u63d0\u4f9b\u4e86 4 \u79cd\u7b56\u7565\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ThreadPoolExecutor.AbortPolicy\uff1a\u4e22\u5f03\u4efb\u52a1\u5e76\u629b\u51faRejectedExecutionException\u5f02\u5e38\u3002"),(0,r.kt)("li",{parentName:"ul"},"ThreadPoolExecutor.DiscardPolicy\uff1a\u4e22\u5f03\u4efb\u52a1\uff0c\u4f46\u662f\u4e0d\u629b\u51fa\u5f02\u5e38\u3002"),(0,r.kt)("li",{parentName:"ul"},"ThreadPoolExecutor.DiscardOldestPolicy\uff1a\u4e22\u5f03\u961f\u5217\u6700\u524d\u9762\u7684\u4efb\u52a1\uff0c\u7136\u540e\u91cd\u65b0\u5c1d\u8bd5\u6267\u884c\u4efb\u52a1\uff08\u91cd\u590d\u6b64\u8fc7\u7a0b\uff09"),(0,r.kt)("li",{parentName:"ul"},"ThreadPoolExecutor.CallerRunsPolicy\uff1a\u7531\u8c03\u7528\u7ebf\u7a0b\u5904\u7406\u8be5\u4efb\u52a1")),(0,r.kt)("p",null,"\u5f53\u7136\u4e5f\u53ef\u4ee5\u6839\u636e\u5e94\u7528\u573a\u666f\u5b9e\u73b0 RejectedExecutionHandler \u63a5\u53e3\uff0c\u81ea\u5b9a\u4e49\u9971\u548c\u7b56\u7565\uff0c\u5982\u8bb0\u5f55\u65e5\u5fd7\u6216\u6301\u4e45\u5316\u5b58\u50a8\u4e0d\u80fd\u5904\u7406\u7684\u4efb\u52a1\u3002"),(0,r.kt)("h4",{id:"\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001"},"\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));\n")),(0,r.kt)("p",null,"\u5176\u4e2d AtomicInteger \u53d8\u91cf ctl \u7684\u529f\u80fd\u975e\u5e38\u5f3a\u5927\uff1a\u5229\u7528\u4f4e 29 \u4f4d\u8868\u793a\u7ebf\u7a0b\u6c60\u4e2d\u7ebf\u7a0b\u6570\uff0c\u901a\u8fc7\u9ad8 3 \u4f4d\u8868\u793a\u7ebf\u7a0b\u6c60\u7684\u8fd0\u884c\u72b6\u6001\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"RUNNING"),"\uff1a-1 << COUNT_BITS\uff0c\u5373\u9ad8 3 \u4f4d\u4e3a 111\uff0c\u8be5\u72b6\u6001\u7684\u7ebf\u7a0b\u6c60\u4f1a\u63a5\u6536\u65b0\u4efb\u52a1\uff0c\u5e76\u5904\u7406\u963b\u585e\u961f\u5217\u4e2d\u7684\u4efb\u52a1\uff1b"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"SHUTDOWN"),"\uff1a 0 << COUNT_BITS\uff0c\u5373\u9ad8 3 \u4f4d\u4e3a 000\uff0c\u8be5\u72b6\u6001\u7684\u7ebf\u7a0b\u6c60\u4e0d\u4f1a\u63a5\u6536\u65b0\u4efb\u52a1\uff0c\u4f46\u4f1a\u5904\u7406\u963b\u585e\u961f\u5217\u4e2d\u7684\u4efb\u52a1\uff1b"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"STOP")," \uff1a 1 << COUNT_BITS\uff0c\u5373\u9ad8 3 \u4f4d\u4e3a 001\uff0c\u8be5\u72b6\u6001\u7684\u7ebf\u7a0b\u4e0d\u4f1a\u63a5\u6536\u65b0\u4efb\u52a1\uff0c\u4e5f\u4e0d\u4f1a\u5904\u7406\u963b\u585e\u961f\u5217\u4e2d\u7684\u4efb\u52a1\uff0c\u800c\u4e14\u4f1a\u4e2d\u65ad\u6b63\u5728\u8fd0\u884c\u7684\u4efb\u52a1\uff1b"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"TIDYING")," \uff1a 2 << COUNT_BITS\uff0c\u5373\u9ad8 3 \u4f4d\u4e3a 010\uff0c\u8be5\u72b6\u6001\u8868\u793a\u7ebf\u7a0b\u6c60\u5bf9\u7ebf\u7a0b\u8fdb\u884c\u6574\u7406\u4f18\u5316\uff1b"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"TERMINATED"),"\uff1a 3 << COUNT_BITS\uff0c\u5373\u9ad8 3 \u4f4d\u4e3a 011\uff0c\u8be5\u72b6\u6001\u8868\u793a\u7ebf\u7a0b\u6c60\u505c\u6b62\u5de5\u4f5c\uff1b")),(0,r.kt)("h4",{id:"\u7ebf\u7a0b\u6c60\u5176\u4ed6\u5e38\u7528\u65b9\u6cd5"},"\u7ebf\u7a0b\u6c60\u5176\u4ed6\u5e38\u7528\u65b9\u6cd5"),(0,r.kt)("p",null,"\u5982\u679c\u6267\u884c\u4e86\u7ebf\u7a0b\u6c60\u7684 prestartAllCoreThreads() \u65b9\u6cd5\uff0c\u7ebf\u7a0b\u6c60\u4f1a\u63d0\u524d\u521b\u5efa\u5e76\u542f\u52a8\u6240\u6709\u6838\u5fc3\u7ebf\u7a0b\u3002\nThreadPoolExecutor \u63d0\u4f9b\u4e86\u52a8\u6001\u8c03\u6574\u7ebf\u7a0b\u6c60\u5bb9\u91cf\u5927\u5c0f\u7684\u65b9\u6cd5\uff1asetCorePoolSize() \u548c setMaximumPoolSize()\u3002"),(0,r.kt)("h4",{id:"\u5982\u4f55\u5408\u7406\u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u7684\u5927\u5c0f"},"\u5982\u4f55\u5408\u7406\u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u7684\u5927\u5c0f"),(0,r.kt)("p",null,"\u4e00\u822c\u9700\u8981\u6839\u636e\u4efb\u52a1\u7684\u7c7b\u578b\u6765\u914d\u7f6e\u7ebf\u7a0b\u6c60\u5927\u5c0f\uff1a\n\u5982\u679c\u662f CPU \u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u5c31\u9700\u8981\u5c3d\u91cf\u538b\u69a8 CPU\uff0c\u53c2\u8003\u503c\u53ef\u4ee5\u8bbe\u4e3a NCPU+1\n\u5982\u679c\u662f IO \u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u53c2\u8003\u503c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a 2*NCPU"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u53c2\u8003\u8d44\u6599",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://tangxiaolin.com/learn/show?id=402881d2651d1bdf01651de142df0000"},"Java\u7ebf\u7a0b\u6c60\u7684\u4f7f\u7528\u53ca\u539f\u7406")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.jianshu.com/p/87bff5cc8d8c"},"\u6df1\u5165\u5206\u6790java\u7ebf\u7a0b\u6c60\u7684\u5b9e\u73b0\u539f\u7406 - \u7b80\u4e66")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.bilibili.com/video/av26354412?p=2"},"\u5c1a\u5b66\u5802\u7ebf\u7a0b\u6c60\u5e76\u53d1\u961f\u5217ThreadPoolExecutor_Callable\u539f\u7406\u89e3\u6790\u54d4\u54e9\u54d4\u54e9 (\u309c-\u309c)\u3064\u30ed \u5e72\u676f~-bilibili"))))),(0,r.kt)("h2",{id:"\u7b2c\u4e8c\u90e8\u5206\u9762\u8bd5\u6307\u5357"},"\u7b2c\u4e8c\u90e8\u5206\uff1a\u9762\u8bd5\u6307\u5357"),(0,r.kt)("p",null,"\u5728\u8fd9\u91cc\u5c06\u603b\u7ed3\u9762\u8bd5\u4e2d\u548c\u5e76\u53d1\u7f16\u7a0b\u76f8\u5173\u7684\u5e38\u89c1\u77e5\u8bc6\u70b9\uff0c\u5982\u5728\u7b2c\u4e00\u90e8\u5206\u4e2d\u51fa\u73b0\u7684\u8fd9\u91cc\u5c06\u4e0d\u8fdb\u884c\u8be6\u7ec6\u9610\u8ff0\u3002\u9762\u8bd5\u6307\u5357\u4e2d\uff0c\u6211\u5c06\u7528\u6700\u7b80\u6d01\u7684\u8bed\u8a00\u63cf\u8ff0\uff0c\u66f4\u591a\u662f\u4ee5\u4e00\u79cd\u5927\u7eb2\u7684\u5f62\u5f0f\u5217\u51fa\u95ee\u7b54\u70b9\uff0c\u6839\u636e\u81ea\u5df1\u638c\u63e1\u7684\u60c5\u51b5\u56de\u7b54\u3002"),(0,r.kt)("p",null,"\u53c2\u8003\u8d44\u6599\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://www.importnew.com/12773.html"},"Java\u7ebf\u7a0b\u9762\u8bd5\u9898 Top 50 - ImportNew"))),(0,r.kt)("h3",{id:"1-volatile-\u4e0e-synchronized-\u7684\u533a\u522b"},"1. volatile \u4e0e synchronized \u7684\u533a\u522b"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\uff081\uff09\u4ec5\u9760volatile\u4e0d\u80fd\u4fdd\u8bc1\u7ebf\u7a0b\u7684\u5b89\u5168\u6027\u3002\uff08\u539f\u5b50\u6027\uff09")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u2460 volatile \u8f7b\u91cf\u7ea7\uff0c\u53ea\u80fd\u4fee\u9970\u53d8\u91cf\u3002synchronized\u91cd\u91cf\u7ea7\uff0c\u8fd8\u53ef\u4fee\u9970\u65b9\u6cd5"),(0,r.kt)("li",{parentName:"ul"},"\u2461 volatile \u53ea\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u53ef\u89c1\u6027\uff0c\u4e0d\u80fd\u7528\u6765\u540c\u6b65\uff0c\u56e0\u4e3a\u591a\u4e2a\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95ee volatile \u4fee\u9970\u7684\u53d8\u91cf\u4e0d\u4f1a\u963b\u585e\u3002")),(0,r.kt)("p",null,"synchronized \u4e0d\u4ec5\u4fdd\u8bc1\u53ef\u89c1\u6027\uff0c\u800c\u4e14\u8fd8\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u56e0\u4e3a\uff0c\u53ea\u6709\u83b7\u5f97\u4e86\u9501\u7684\u7ebf\u7a0b\u624d\u80fd\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e34\u754c\u533a\u4e2d\u7684\u6240\u6709\u8bed\u53e5\u90fd\u5168\u90e8\u6267\u884c\u3002\u591a\u4e2a\u7ebf\u7a0b\u4e89\u62a2 synchronized \u9501\u5bf9\u8c61\u65f6\uff0c\u4f1a\u51fa\u73b0\u963b\u585e\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\uff082\uff09\u7ebf\u7a0b\u5b89\u5168\u6027")),(0,r.kt)("p",null,"\u7ebf\u7a0b\u5b89\u5168\u6027\u5305\u62ec\u4e24\u4e2a\u65b9\u9762\uff0c\u2460\u53ef\u89c1\u6027\u3002\u2461\u539f\u5b50\u6027\u3002"),(0,r.kt)("p",null,"\u4ece\u4e0a\u9762\u81ea\u589e\u7684\u4f8b\u5b50\u4e2d\u53ef\u4ee5\u770b\u51fa\uff1a\u4ec5\u4ec5\u4f7f\u7528 volatile \u5e76\u4e0d\u80fd\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u6027\u3002\u800c synchronized \u5219\u53ef\u5b9e\u73b0\u7ebf\u7a0b\u7684\u5b89\u5168\u6027\u3002"),(0,r.kt)("h3",{id:"2-\u4ec0\u4e48\u662f\u7ebf\u7a0b\u6c60\u5982\u679c\u8ba9\u4f60\u8bbe\u8ba1\u4e00\u4e2a\u52a8\u6001\u5927\u5c0f\u7684\u7ebf\u7a0b\u6c60\u5982\u4f55\u8bbe\u8ba1\u5e94\u8be5\u6709\u54ea\u4e9b\u65b9\u6cd5\u7ebf\u7a0b\u6c60\u521b\u5efa\u7684\u65b9\u5f0f"},"2. \u4ec0\u4e48\u662f\u7ebf\u7a0b\u6c60\uff1f\u5982\u679c\u8ba9\u4f60\u8bbe\u8ba1\u4e00\u4e2a\u52a8\u6001\u5927\u5c0f\u7684\u7ebf\u7a0b\u6c60\uff0c\u5982\u4f55\u8bbe\u8ba1\uff0c\u5e94\u8be5\u6709\u54ea\u4e9b\u65b9\u6cd5\uff1f\u7ebf\u7a0b\u6c60\u521b\u5efa\u7684\u65b9\u5f0f\uff1f"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4ec0\u4e48\u662f\u7ebf\u7a0b\u6c60 "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\u6c60\u987e\u540d\u601d\u4e49\u5c31\u662f\u4e8b\u5148\u521b\u5efa\u82e5\u5e72\u4e2a\u53ef\u6267\u884c\u7684\u7ebf\u7a0b\u653e\u5165\u4e00\u4e2a\u6c60\uff08\u5bb9\u5668\uff09\u4e2d\uff0c\u9700\u8981\u7684\u65f6\u5019\u4ece\u6c60\u4e2d\u83b7\u53d6\u7ebf\u7a0b\u4e0d\u7528\u81ea\u884c\u521b\u5efa\uff0c\u4f7f\u7528\u5b8c\u6bd5\u4e0d\u9700\u8981\u9500\u6bc1\u7ebf\u7a0b\u800c\u662f\u653e\u56de\u6c60\u4e2d\uff0c\u4ece\u800c\u51cf\u5c11\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u5bf9\u8c61\u7684\u5f00\u9500\u3002 "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u8bbe\u8ba1\u4e00\u4e2a\u52a8\u6001\u5927\u5c0f\u7684\u7ebf\u7a0b\u6c60\uff0c\u5982\u4f55\u8bbe\u8ba1\uff0c\u5e94\u8be5\u6709\u54ea\u4e9b\u65b9\u6cd5 "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u5305\u62ec\u4ee5\u4e0b\u56db\u4e2a\u57fa\u672c\u7ec4\u6210\u90e8\u5206\uff1a ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\u7ba1\u7406\u5668 (ThreadPool)\uff1a\u7528\u4e8e\u521b\u5efa\u5e76\u7ba1\u7406\u7ebf\u7a0b\u6c60\uff0c\u5305\u62ec\u521b\u5efa\u7ebf\u7a0b\uff0c\u9500\u6bc1\u7ebf\u7a0b\u6c60\uff0c\u6dfb\u52a0\u65b0\u4efb\u52a1\uff1b "),(0,r.kt)("li",{parentName:"ul"},"\u5de5\u4f5c\u7ebf\u7a0b (PoolWorker)\uff1a\u7ebf\u7a0b\u6c60\u4e2d\u7ebf\u7a0b\uff0c\u5728\u6ca1\u6709\u4efb\u52a1\u65f6\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\uff0c\u53ef\u4ee5\u5faa\u73af\u7684\u6267\u884c\u4efb\u52a1\uff1b "),(0,r.kt)("li",{parentName:"ul"},"\u4efb\u52a1\u63a5\u53e3 (Task)\uff1a\u6bcf\u4e2a\u4efb\u52a1\u5fc5\u987b\u5b9e\u73b0\u7684\u63a5\u53e3\uff0c\u4ee5\u4f9b\u5de5\u4f5c\u7ebf\u7a0b\u8c03\u5ea6\u4efb\u52a1\u7684\u6267\u884c\uff0c\u5b83\u4e3b\u8981\u89c4\u5b9a\u4e86\u4efb\u52a1\u7684\u5165\u53e3\uff0c\u4efb\u52a1\u6267\u884c\u5b8c\u540e\u7684\u6536\u5c3e\u5de5\u4f5c\uff0c\u4efb\u52a1\u7684\u6267\u884c\u72b6\u6001\u7b49\uff1b "),(0,r.kt)("li",{parentName:"ul"},"\u4efb\u52a1\u961f\u5217 (TaskQueue)\uff1a\u7528\u4e8e\u5b58\u653e\u6ca1\u6709\u5904\u7406\u7684\u4efb\u52a1\u3002\u63d0\u4f9b\u4e00\u79cd\u7f13\u51b2\u673a\u5236\uff1b "))),(0,r.kt)("li",{parentName:"ul"},"\u6240\u5305\u542b\u7684\u65b9\u6cd5 ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"private ThreadPool()  \u521b\u5efa\u7ebf\u7a0b\u6c60 "),(0,r.kt)("li",{parentName:"ul"},"public static ThreadPool getThreadPool()  \u83b7\u5f97\u4e00\u4e2a\u9ed8\u8ba4\u7ebf\u7a0b\u4e2a\u6570\u7684\u7ebf\u7a0b\u6c60  "),(0,r.kt)("li",{parentName:"ul"},"public void execute(Runnable task)  \u6267\u884c\u4efb\u52a1,\u5176\u5b9e\u53ea\u662f\u628a\u4efb\u52a1\u52a0\u5165\u4efb\u52a1\u961f\u5217\uff0c\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u6709\u7ebf\u7a0b\u6c60\u7ba1\u7406\u5668\u51b3\u5b9a "),(0,r.kt)("li",{parentName:"ul"},"public void execute(Runnable[] task)  \u6279\u91cf\u6267\u884c\u4efb\u52a1,\u5176\u5b9e\u53ea\u662f\u628a\u4efb\u52a1\u52a0\u5165\u4efb\u52a1\u961f\u5217\uff0c\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u6709\u7ebf\u7a0b\u6c60\u7ba1\u7406\u5668\u51b3\u5b9a "),(0,r.kt)("li",{parentName:"ul"},"public void destroy()  \u9500\u6bc1\u7ebf\u7a0b\u6c60,\u8be5\u65b9\u6cd5\u4fdd\u8bc1\u5728\u6240\u6709\u4efb\u52a1\u90fd\u5b8c\u6210\u7684\u60c5\u51b5\u4e0b\u624d\u9500\u6bc1\u6240\u6709\u7ebf\u7a0b\uff0c\u5426\u5219\u7b49\u5f85\u4efb\u52a1\u5b8c\u6210\u624d\u9500\u6bc1 "),(0,r.kt)("li",{parentName:"ul"},"public int getWorkThreadNumber() \u8fd4\u56de\u5de5\u4f5c\u7ebf\u7a0b\u7684\u4e2a\u6570  "),(0,r.kt)("li",{parentName:"ul"},"public int getFinishedTasknumber() \u8fd4\u56de\u5df2\u5b8c\u6210\u4efb\u52a1\u7684\u4e2a\u6570,\u8fd9\u91cc\u7684\u5df2\u5b8c\u6210\u662f\u53ea\u51fa\u4e86\u4efb\u52a1\u961f\u5217\u7684\u4efb\u52a1\u4e2a\u6570\uff0c\u53ef\u80fd\u8be5\u4efb\u52a1\u5e76\u6ca1\u6709\u5b9e\u9645\u6267\u884c\u5b8c\u6210 "),(0,r.kt)("li",{parentName:"ul"},"public void addThread() \u5728\u4fdd\u8bc1\u7ebf\u7a0b\u6c60\u4e2d\u6240\u6709\u7ebf\u7a0b\u6b63\u5728\u6267\u884c\uff0c\u5e76\u4e14\u8981\u6267\u884c\u7ebf\u7a0b\u7684\u4e2a\u6570\u5927\u4e8e\u67d0\u4e00\u503c\u65f6\u3002\u589e\u52a0\u7ebf\u7a0b\u6c60\u4e2d\u7ebf\u7a0b\u7684\u4e2a\u6570 "),(0,r.kt)("li",{parentName:"ul"},"public void reduceThread() \u5728\u4fdd\u8bc1\u7ebf\u7a0b\u6c60\u4e2d\u6709\u5f88\u5927\u4e00\u90e8\u5206\u7ebf\u7a0b\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\uff0c\u5e76\u4e14\u7a7a\u95f2\u72b6\u6001\u7684\u7ebf\u7a0b\u5728\u5c0f\u4e8e\u67d0\u4e00\u503c\u65f6\uff0c\u51cf\u5c11\u7ebf\u7a0b\u6c60\u4e2d\u7ebf\u7a0b\u7684\u4e2a\u6570  "))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u7ebf\u7a0b\u6c60\u56db\u79cd\u521b\u5efa\u65b9\u5f0f"),(0,r.kt)("p",{parentName:"li"},"Java \u901a\u8fc7 Executors \u63d0\u4f9b\u56db\u79cd\u7ebf\u7a0b\u6c60\uff0c\u5206\u522b\u4e3a\uff1a"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"new CachedThreadPool \u521b\u5efa\u4e00\u4e2a\u53ef\u7f13\u5b58\u7ebf\u7a0b\u6c60\uff0c\u5982\u679c\u7ebf\u7a0b\u6c60\u957f\u5ea6\u8d85\u8fc7\u5904\u7406\u9700\u8981\uff0c\u53ef\u7075\u6d3b\u56de\u6536\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u82e5\u65e0\u53ef\u56de\u6536\uff0c\u5219\u65b0\u5efa\u7ebf\u7a0b\u3002"),(0,r.kt)("li",{parentName:"ul"},"new FixedThreadPool \u521b\u5efa\u4e00\u4e2a\u5b9a\u957f\u7ebf\u7a0b\u6c60\uff0c\u53ef\u63a7\u5236\u7ebf\u7a0b\u6700\u5927\u5e76\u53d1\u6570\uff0c\u8d85\u51fa\u7684\u7ebf\u7a0b\u4f1a\u5728\u961f\u5217\u4e2d\u7b49\u5f85\u3002"),(0,r.kt)("li",{parentName:"ul"},"new ScheduledThreadPool \u521b\u5efa\u4e00\u4e2a\u5b9a\u957f\u7ebf\u7a0b\u6c60\uff0c\u652f\u6301\u5b9a\u65f6\u53ca\u5468\u671f\u6027\u4efb\u52a1\u6267\u884c\u3002"),(0,r.kt)("li",{parentName:"ul"},"new SingleThreadExecutor \u521b\u5efa\u4e00\u4e2a\u5355\u7ebf\u7a0b\u5316\u7684\u7ebf\u7a0b\u6c60\uff0c\u5b83\u53ea\u4f1a\u7528\u552f\u4e00\u7684\u5de5\u4f5c\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1\uff0c\u4fdd\u8bc1\u6240\u6709\u4efb\u52a1\u6309\u7167\u6307\u5b9a\u987a\u5e8f(FIFO, LIFO, \u4f18\u5148\u7ea7)\u6267\u884c\u3002")))),(0,r.kt)("h3",{id:"3-\u4ec0\u4e48\u662f\u5e76\u53d1\u548c\u5e76\u884c"},"3. \u4ec0\u4e48\u662f\u5e76\u53d1\u548c\u5e76\u884c"),(0,r.kt)("div",{align:"center"}," ",(0,r.kt)("img",{src:"assets/concurrent_and_parallel.png",width:""})),(0,r.kt)("br",null),(0,r.kt)("h4",{id:"\u5e76\u53d1"},"\u5e76\u53d1"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5e76\u53d1\u662f\u6307\u4e24\u4e2a\u4efb\u52a1\u90fd\u8bf7\u6c42\u8fd0\u884c\uff0c\u800c\u5904\u7406\u5668\u53ea\u80fd\u6309\u53d7\u4e00\u4e2a\u4efb\u52a1\uff0c\u5c31\u628a\u8fd9\u4e24\u4e2a\u4efb\u52a1\u5b89\u6392\u8f6e\u6d41\u8fdb\u884c\uff0c\u7531\u4e8e\u65f6\u95f4\u95f4\u9694\u8f83\u77ed\uff0c\u4f7f\u4eba\u611f\u89c9\u4e24\u4e2a\u4efb\u52a1\u90fd\u5728\u8fd0\u884c\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u7528\u4e00\u53f0\u7535\u8111\u6211\u5148\u7ed9\u7532\u53d1\u4e2a\u6d88\u606f\uff0c\u7136\u540e\u7acb\u523b\u518d\u7ed9\u4e59\u53d1\u6d88\u606f\uff0c\u7136\u540e\u518d\u8ddf\u7532\u804a\uff0c\u518d\u8ddf\u4e59\u804a\u3002\u8fd9\u5c31\u53eb\u5e76\u53d1\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u591a\u4e2a\u7ebf\u7a0b\u64cd\u4f5c\u76f8\u540c\u7684\u8d44\u6e90\uff0c\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff0c\u5408\u7406\u4f7f\u7528\u8d44\u6e90")),(0,r.kt)("h4",{id:"\u5e76\u884c"},"\u5e76\u884c"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5e76\u884c\u5c31\u662f\u4e24\u4e2a\u4efb\u52a1\u540c\u65f6\u8fd0\u884c\uff0c\u5c31\u662f\u7532\u4efb\u52a1\u8fdb\u884c\u7684\u540c\u65f6\uff0c\u4e59\u4efb\u52a1\u4e5f\u5728\u8fdb\u884c\u3002(\u9700\u8981\u591a\u6838CPU)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6bd4\u5982\u6211\u8ddf\u4e24\u4e2a\u7f51\u53cb\u804a\u5929\uff0c\u5de6\u624b\u64cd\u4f5c\u4e00\u4e2a\u7535\u8111\u8ddf\u7532\u804a\uff0c\u540c\u65f6\u53f3\u624b\u7528\u53e6\u4e00\u53f0\u7535\u8111\u8ddf\u4e59\u804a\u5929\uff0c\u8fd9\u5c31\u53eb\u5e76\u884c\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u670d\u52a1\u80fd\u540c\u65f6\u5904\u7406\u5f88\u591a\u8bf7\u6c42\uff0c\u63d0\u9ad8\u7a0b\u5e8f\u6027\u80fd"))),(0,r.kt)("p",null,"\u53c2\u8003\u8d44\u6599\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/forhappy/Cplusplus-Concurrency-In-Practice/blob/master/zh/chapter1-Introduction/1.1%20What%20is%20concurrency.md"},"Cplusplus-Concurrency-In-Practice/1.1 What is concurrency.md at master \xb7 forhappy/Cplusplus-Concurrency-In-Practice"))),(0,r.kt)("h3",{id:"4-\u4ec0\u4e48\u662f\u7ebf\u7a0b\u5b89\u5168"},"4. \u4ec0\u4e48\u662f\u7ebf\u7a0b\u5b89\u5168"),(0,r.kt)("p",null,"\u5f53\u591a\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u4e2a\u5bf9\u8c61\u65f6\uff0c\u5982\u679c\u4e0d\u7528\u8003\u8651\u8fd9\u4e9b\u7ebf\u7a0b\u5728\u8fd0\u884c\u65f6\u73af\u5883\u4e0b\u7684\u8c03\u5ea6\u548c\u4ea4\u66ff\u8fd0\u884c\uff0c\u4e5f\u4e0d\u9700\u8981\u8fdb\u884c\u989d\u5916\u7684\u540c\u6b65\uff0c\u6216\u8005\u5728\u8c03\u7528\u65b9\u8fdb\u884c\u4efb\u4f55\u5176\u4ed6\u7684\u534f\u8c03\u64cd\u4f5c\uff0c\u8c03\u7528\u8fd9\u4e2a\u5bf9\u8c61\u7684\u884c\u4e3a\u90fd\u53ef\u4ee5\u83b7\u53d6\u6b63\u786e\u7684\u7ed3\u679c\uff0c\u90a3\u8fd9\u4e2a\u5bf9\u8c61\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002\u2014\u2014\u6765\u81ea\u300a\u6df1\u5165\u7406\u89e3Java\u865a\u62df\u673a\u300b"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5b9a\u4e49 "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u67d0\u4e2a\u7c7b\u7684\u884c\u4e3a\u4e0e\u5176\u89c4\u8303\u4e00\u81f4\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\u4e0d\u7ba1\u591a\u4e2a\u7ebf\u7a0b\u662f\u600e\u6837\u7684\u6267\u884c\u987a\u5e8f\u548c\u4f18\u5148\u7ea7,\u6216\u662f wait , sleep , join \u7b49\u63a7\u5236\u65b9\u5f0f\uff0c\u5982\u679c\u4e00\u4e2a\u7c7b\u5728\u591a\u7ebf\u7a0b\u8bbf\u95ee\u4e0b\u8fd0\u8f6c\u4e00\u5207\u6b63\u5e38\uff0c\u5e76\u4e14\u8bbf\u95ee\u7c7b\u4e0d\u9700\u8981\u8fdb\u884c\u989d\u5916\u7684\u540c\u6b65\u5904\u7406\u6216\u8005\u534f\u8c03\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u8ba4\u4e3a\u5b83\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002  "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5982\u4f55\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff1f\uff08\u66f4\u52a0\u8be6\u7ec6\u7684\u8bf7\u8f6c\u5411\u7b2c\u4e00\u90e8\u5206 ",(0,r.kt)("inlineCode",{parentName:"p"},"11. \u7ebf\u7a0b\u5b89\u5168"),"\uff09"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5bf9\u53d8\u91cf\u4f7f\u7528 volitate "),(0,r.kt)("li",{parentName:"ul"},"\u5bf9\u7a0b\u5e8f\u6bb5\u8fdb\u884c\u52a0\u9501 (synchronized , lock) "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u6ce8\u610f "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\u96c6\u5408\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u53ef\u4ee5\u4f7f\u7528\uff0c\u4f46\u5e76\u4e0d\u80fd\u4f5c\u4e3a\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u7684\u5c5e\u6027\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u67d0\u4e2a\u7ebf\u7a0b\u72ec\u4eab\u7684\u5c5e\u6027\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\u4f8b\u5982 Vector \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0cArrayList \u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002\u5982\u679c\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u4e2d new \u4e00\u4e2a ArrayList\uff0c\u800c\u8fd9\u4e2aArrayList \u53ea\u662f\u5728\u8fd9\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u4f7f\u7528\uff0c\u80af\u5b9a\u6ca1\u95ee\u9898\u3002 ")))),(0,r.kt)("h4",{id:"\u975e\u7ebf\u7a0b\u5b89\u5168\u4e0d\u5b89\u5168"},"\u975e\u7ebf\u7a0b\u5b89\u5168!=\u4e0d\u5b89\u5168\uff1f"),(0,r.kt)("p",null,"\u6709\u4eba\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u6709\u4e00\u4e2a\u4e0d\u6b63\u786e\u7684\u89c2\u70b9\uff1a\u6211\u7684\u7a0b\u5e8f\u662f\u591a\u7ebf\u7a0b\u7684\uff0c\u4e0d\u80fd\u4f7f\u7528 ArrayList \u8981\u4f7f\u7528 Vector\uff0c\u8fd9\u6837\u624d\u5b89\u5168\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u975e\u7ebf\u7a0b\u5b89\u5168\u5e76\u4e0d\u662f\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u5c31\u4e0d\u80fd\u4f7f\u7528"),"\u3002\u6ce8\u610f\u6211\u4e0a\u9762\u6709\u8bf4\u5230\uff1a",(0,r.kt)("strong",{parentName:"p"},"\u591a\u7ebf\u7a0b\u64cd\u4f5c\u540c\u4e00\u4e2a\u5bf9\u8c61"),"\u3002\u6ce8\u610f\u662f",(0,r.kt)("strong",{parentName:"p"},"\u540c\u4e00\u4e2a\u5bf9\u8c61"),"\u3002\u6bd4\u5982\u6700\u4e0a\u9762\u90a3\u4e2a\u6a21\u62df\uff0c\u5c31\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d new \u7684\u4e00\u4e2a ArrayList \u7136\u540e\u591a\u4e2a\u7ebf\u7a0b\u64cd\u4f5c\u540c\u4e00\u4e2a ArrayList \u5bf9\u8c61\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u662f\u6bcf\u4e2a\u7ebf\u7a0b\u4e2d new \u4e00\u4e2a ArrayList\uff0c\u800c\u8fd9\u4e2a ArrayList \u53ea\u5728\u8fd9\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u4f7f\u7528\uff0c\u90a3\u4e48\u80af\u5b9a\u662f\u6ca1\u95ee\u9898\u7684\u3002"),(0,r.kt)("h4",{id:"\u7ebf\u7a0b\u5b89\u5168\u5341\u4e07\u4e2a\u4e3a\u4ec0\u4e48"},"\u7ebf\u7a0b\u5b89\u5168\u5341\u4e07\u4e2a\u4e3a\u4ec0\u4e48\uff1f"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u95ee\uff1a\u5e73\u65f6\u9879\u76ee\u4e2d\u4f7f\u7528\u9501\u548c synchronized \u6bd4\u8f83\u591a\uff0c\u800c\u5f88\u5c11\u4f7f\u7528 volatile\uff0c\u96be\u9053\u5c31\u6ca1\u6709\u4fdd\u8bc1\u53ef\u89c1\u6027\uff1f"),"\n\u7b54\uff1a\u9501\u548c synchronized \u5373\u53ef\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u8bc1\u53ef\u89c1\u6027\u3002\u90fd\u662f\u901a\u8fc7\u4fdd\u8bc1\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u76ee\u6807\u4ee3\u7801\u6bb5\u6765\u5b9e\u73b0\u7684\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u95ee\uff1a\u9501\u548c synchronized \u4e3a\u4f55\u80fd\u4fdd\u8bc1\u53ef\u89c1\u6027\uff1f"),"\n\u7b54\uff1a\u6839\u636e ",(0,r.kt)("a",{parentName:"p",href:"http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/package-summary.html#MemoryVisibility"},"JDK 7\u7684Java doc")," \u4e2d\u5bf9 ",(0,r.kt)("inlineCode",{parentName:"p"},"concurrent")," \u5305\u7684\u8bf4\u660e\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u7684\u5199\u7ed3\u679c\u4fdd\u8bc1\u5bf9\u53e6\u5916\u7ebf\u7a0b\u7684\u8bfb\u64cd\u4f5c\u53ef\u89c1\uff0c\u53ea\u8981\u8be5\u5199\u64cd\u4f5c\u53ef\u4ee5\u7531 ",(0,r.kt)("inlineCode",{parentName:"p"},"happen-before")," \u539f\u5219\u63a8\u65ad\u51fa\u5728\u8bfb\u64cd\u4f5c\u4e4b\u524d\u53d1\u751f\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The results of a write by one thread are guaranteed to be ",(0,r.kt)("strong",{parentName:"p"},"visible")," to a read by another thread only if the write operation happens-before the read operation. The synchronized and volatile constructs, as well as the Thread.start() and Thread.join() methods, can form happens-before relationships.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u95ee\uff1a\u65e2\u7136\u9501\u548c synchronized \u5373\u53ef\u4fdd\u8bc1\u539f\u5b50\u6027\u4e5f\u53ef\u4fdd\u8bc1\u53ef\u89c1\u6027\uff0c\u4e3a\u4f55\u8fd8\u9700\u8981 volatile\uff1f"),"\n\u7b54\uff1asynchronized\u548c\u9501\u9700\u8981\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u6765\u4ef2\u88c1\u8c01\u83b7\u5f97\u9501\uff0c\u5f00\u9500\u6bd4\u8f83\u9ad8\uff0c\u800c volatile \u5f00\u9500\u5c0f\u5f88\u591a\u3002\u56e0\u6b64\u5728\u53ea\u9700\u8981\u4fdd\u8bc1\u53ef\u89c1\u6027\u7684\u6761\u4ef6\u4e0b\uff0c\u4f7f\u7528 volatile \u7684\u6027\u80fd\u8981\u6bd4\u4f7f\u7528\u9501\u548c synchronized \u9ad8\u5f97\u591a\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u95ee\uff1a\u65e2\u7136\u9501\u548c synchronized \u53ef\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 AtomicInteger \u8fd9\u79cd\u7684\u7c7b\u6765\u4fdd\u8bc1\u539f\u5b50\u64cd\u4f5c\uff1f"),"\n\u7b54\uff1a\u9501\u548c synchronized \u9700\u8981\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u6765\u4ef2\u88c1\u8c01\u83b7\u5f97\u9501\uff0c\u5f00\u9500\u6bd4\u8f83\u9ad8\uff0c\u800c AtomicInteger \u662f\u901a\u8fc7CPU\u7ea7\u7684CAS\u64cd\u4f5c\u6765\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u5f00\u9500\u6bd4\u8f83\u5c0f\u3002\u6240\u4ee5\u4f7f\u7528 AtomicInteger \u7684\u76ee\u7684\u8fd8\u662f\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u95ee\uff1a\u8fd8\u6709\u6ca1\u6709\u522b\u7684\u529e\u6cd5\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168"),"\n\u7b54\uff1a\u6709\u3002\u5c3d\u53ef\u80fd\u907f\u514d\u5f15\u8d77\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\u6761\u4ef6\u2014\u2014\u5171\u4eab\u53d8\u91cf\u3002\u5982\u679c\u80fd\u4ece\u8bbe\u8ba1\u4e0a\u907f\u514d\u5171\u4eab\u53d8\u91cf\u7684\u4f7f\u7528\uff0c\u5373\u53ef\u907f\u514d\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\u53d1\u751f\uff0c\u4e5f\u5c31\u65e0\u987b\u901a\u8fc7\u9501\u6216\u8005 synchronized \u4ee5\u53ca volatile \u89e3\u51b3\u539f\u5b50\u6027\u3001\u53ef\u89c1\u6027\u548c\u987a\u5e8f\u6027\u7684\u95ee\u9898\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u95ee\uff1asynchronized \u5373\u53ef\u4fee\u9970\u975e\u9759\u6001\u65b9\u5f0f\uff0c\u4e5f\u53ef\u4fee\u9970\u9759\u6001\u65b9\u6cd5\uff0c\u8fd8\u53ef\u4fee\u9970\u4ee3\u7801\u5757\uff0c\u6709\u4f55\u533a\u522b"),"\n\u7b54\uff1asynchronized \u4fee\u9970\u975e\u9759\u6001\u540c\u6b65\u65b9\u6cd5\u65f6\uff0c\u9501\u4f4f\u7684\u662f\u5f53\u524d\u5b9e\u4f8b\uff1bsynchronized \u4fee\u9970\u9759\u6001\u540c\u6b65\u65b9\u6cd5\u65f6\uff0c\u9501\u4f4f\u7684\u662f\u8be5\u7c7b\u7684 Class \u5bf9\u8c61\uff1bsynchronized \u4fee\u9970\u9759\u6001\u4ee3\u7801\u5757\u65f6\uff0c\u9501\u4f4f\u7684\u662f synchronized \u5173\u952e\u5b57\u540e\u9762\u62ec\u53f7\u5185\u7684\u5bf9\u8c61\u3002"),(0,r.kt)("p",null,"\u53c2\u8003\u8d44\u6599\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://www.jasongj.com/java/thread_safe/"},"Java\u8fdb\u9636\uff08\u4e8c\uff09\u5f53\u6211\u4eec\u8bf4\u7ebf\u7a0b\u5b89\u5168\u65f6\uff0c\u5230\u5e95\u5728\u8bf4\u4ec0\u4e48"))),(0,r.kt)("h3",{id:"5-volatile-\u5173\u952e\u5b57\u7684\u5982\u4f55\u4fdd\u8bc1\u5185\u5b58\u53ef\u89c1\u6027"},"5. volatile \u5173\u952e\u5b57\u7684\u5982\u4f55\u4fdd\u8bc1\u5185\u5b58\u53ef\u89c1\u6027"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"volatile \u5173\u952e\u5b57\u7684\u4f5c\u7528 "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4fdd\u8bc1\u5185\u5b58\u7684\u53ef\u89c1\u6027 "),(0,r.kt)("li",{parentName:"ul"},"\u9632\u6b62\u6307\u4ee4\u91cd\u6392 "),(0,r.kt)("li",{parentName:"ul"},"\u6ce8\u610f\uff1avolatile \u5e76\u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027 "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5185\u5b58\u53ef\u89c1\u6027 "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"volatile \u4fdd\u8bc1\u53ef\u89c1\u6027\u7684\u539f\u7406\u662f\u5728\u6bcf\u6b21\u8bbf\u95ee\u53d8\u91cf\u65f6\u90fd\u4f1a\u8fdb\u884c\u4e00\u6b21\u5237\u65b0\uff0c\u56e0\u6b64\u6bcf\u6b21\u8bbf\u95ee\u90fd\u662f\u4e3b\u5185\u5b58\u4e2d\u6700\u65b0\u7684\u7248\u672c\u3002\u6240\u4ee5 volatile \u5173\u952e\u5b57\u7684\u4f5c\u7528\u4e4b\u4e00\u5c31\u662f\u4fdd\u8bc1\u53d8\u91cf\u4fee\u6539\u7684\u5b9e\u65f6\u53ef\u89c1\u6027\u3002 "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5f53\u4e14\u4ec5\u5f53\u6ee1\u8db3\u4ee5\u4e0b\u6240\u6709\u6761\u4ef6\u65f6\uff0c\u624d\u5e94\u8be5\u4f7f\u7528 volatile \u53d8\u91cf "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5bf9\u53d8\u91cf\u7684\u5199\u5165\u64cd\u4f5c\u4e0d\u4f9d\u8d56\u53d8\u91cf\u7684\u5f53\u524d\u503c\uff0c\u6216\u8005\u4f60\u80fd\u786e\u4fdd\u53ea\u6709\u5355\u4e2a\u7ebf\u7a0b\u66f4\u65b0\u53d8\u91cf\u7684\u503c\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\u8be5\u53d8\u91cf\u6ca1\u6709\u5305\u542b\u5728\u5177\u6709\u5176\u4ed6\u53d8\u91cf\u7684\u4e0d\u53d8\u5f0f\u4e2d\u3002 "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"volatile \u4f7f\u7528\u5efa\u8bae "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5728\u4e24\u4e2a\u6216\u8005\u66f4\u591a\u7684\u7ebf\u7a0b\u9700\u8981\u8bbf\u95ee\u7684\u6210\u5458\u53d8\u91cf\u4e0a\u4f7f\u7528 volatile\u3002\u5f53\u8981\u8bbf\u95ee\u7684\u53d8\u91cf\u5df2\u5728 synchronized \u4ee3\u7801\u5757\u4e2d\uff0c\u6216\u8005\u4e3a\u5e38\u91cf\u65f6\uff0c\u6ca1\u5fc5\u8981\u4f7f\u7528volatile\u3002 "),(0,r.kt)("li",{parentName:"ul"},"\u7531\u4e8e\u4f7f\u7528 volatile \u5c4f\u853d\u6389\u4e86 JVM \u4e2d\u5fc5\u8981\u7684\u4ee3\u7801\u4f18\u5316\uff0c\u6240\u4ee5\u5728\u6548\u7387\u4e0a\u6bd4\u8f83\u4f4e\uff0c\u56e0\u6b64\u4e00\u5b9a\u5728\u5fc5\u8981\u65f6\u624d\u4f7f\u7528\u6b64\u5173\u952e\u5b57\u3002 "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"volatile \u548c synchronized\u533a\u522b "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"volatile \u4e0d\u4f1a\u8fdb\u884c\u52a0\u9501\u64cd\u4f5c\uff1a ")),(0,r.kt)("p",{parentName:"li"},"\u3000\u3000volatile \u53d8\u91cf\u662f\u4e00\u79cd\u7a0d\u5f31\u7684\u540c\u6b65\u673a\u5236\u5728\u8bbf\u95ee volatile \u53d8\u91cf\u65f6\u4e0d\u4f1a\u6267\u884c\u52a0\u9501\u64cd\u4f5c\uff0c\u56e0\u6b64\u4e5f\u5c31\u4e0d\u4f1a\u4f7f\u6267\u884c\u7ebf\u7a0b\u963b\u585e\uff0c\u56e0\u6b64 volatile \u53d8\u91cf\u662f\u4e00\u79cd\u6bd4 synchronized \u5173\u952e\u5b57\u66f4\u8f7b\u91cf\u7ea7\u7684\u540c\u6b65\u673a\u5236\u3002 "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"volatile \u53d8\u91cf\u4f5c\u7528\u7c7b\u4f3c\u4e8e\u540c\u6b65\u53d8\u91cf\u8bfb\u5199\u64cd\u4f5c\uff1a ")),(0,r.kt)("p",{parentName:"li"},"\u3000\u3000\u4ece\u5185\u5b58\u53ef\u89c1\u6027\u7684\u89d2\u5ea6\u770b\uff0c\u5199\u5165 volatile \u53d8\u91cf\u76f8\u5f53\u4e8e\u9000\u51fa\u540c\u6b65\u4ee3\u7801\u5757\uff0c\u800c\u8bfb\u53d6 volatile \u53d8\u91cf\u76f8\u5f53\u4e8e\u8fdb\u5165\u540c\u6b65\u4ee3\u7801\u5757\u3002 "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"volatile \u4e0d\u5982 synchronized\u5b89\u5168\uff1a ")),(0,r.kt)("p",{parentName:"li"},"\u3000\u3000\u5728\u4ee3\u7801\u4e2d\u5982\u679c\u8fc7\u5ea6\u4f9d\u8d56 volatile \u53d8\u91cf\u6765\u63a7\u5236\u72b6\u6001\u7684\u53ef\u89c1\u6027\uff0c\u901a\u5e38\u4f1a\u6bd4\u4f7f\u7528\u9501\u7684\u4ee3\u7801\u66f4\u8106\u5f31\uff0c\u4e5f\u66f4\u96be\u4ee5\u7406\u89e3\u3002\u4ec5\u5f53 volatile \u53d8\u91cf\u80fd\u7b80\u5316\u4ee3\u7801\u7684\u5b9e\u73b0\u4ee5\u53ca\u5bf9\u540c\u6b65\u7b56\u7565\u7684\u9a8c\u8bc1\u65f6\uff0c\u624d\u5e94\u8be5\u4f7f\u7528\u5b83\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7528\u540c\u6b65\u673a\u5236\u4f1a\u66f4\u5b89\u5168\u4e9b\u3002 "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"volatile \u65e0\u6cd5\u540c\u65f6\u4fdd\u8bc1\u5185\u5b58\u53ef\u89c1\u6027\u548c\u539f\u5b50\u6027\uff1a ")),(0,r.kt)("p",{parentName:"li"},"\u3000\u3000\u52a0\u9501\u673a\u5236\uff08\u5373\u540c\u6b65\u673a\u5236\uff09\u65e2\u53ef\u4ee5\u786e\u4fdd\u53ef\u89c1\u6027\u53c8\u53ef\u4ee5\u786e\u4fdd\u539f\u5b50\u6027\uff0c\u800c volatile \u53d8\u91cf\u53ea\u80fd\u786e\u4fdd\u53ef\u89c1\u6027\uff0c\u539f\u56e0\u662f\u58f0\u660e\u4e3avolatile\u7684\u7b80\u5355\u53d8\u91cf\u5982\u679c\u5f53\u524d\u503c\u4e0e\u8be5\u53d8\u91cf\u4ee5\u524d\u7684\u503c\u76f8\u5173\uff0c\u90a3\u4e48 volatile \u5173\u952e\u5b57\u4e0d\u8d77\u4f5c\u7528\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u4e0b\u7684\u8868\u8fbe\u5f0f\u90fd\u4e0d\u662f\u539f\u5b50\u64cd\u4f5c\uff1a\u201ccount++\u201d\u3001\u201ccount = count+1\u201d\u3002 "))),(0,r.kt)("h3",{id:"5-\u4ec0\u4e48\u662f\u7ebf\u7a0b\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u6709\u4ec0\u4e48\u533a\u522b\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u591a\u7ebf\u7a0b"},"5. \u4ec0\u4e48\u662f\u7ebf\u7a0b\uff1f\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u6709\u4ec0\u4e48\u533a\u522b\uff1f\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u591a\u7ebf\u7a0b"),(0,r.kt)("p",null,"\uff081\uff09\u7ebf\u7a0b\u548c\u8fdb\u7a0b"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\u662f\u64cd\u4f5c\u7cfb\u7edf",(0,r.kt)("strong",{parentName:"li"},"\u5206\u914d\u8d44\u6e90"),"\u7684\u6700\u5c0f\u5355\u4f4d "),(0,r.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\u662f",(0,r.kt)("strong",{parentName:"li"},"CPU\u8c03\u5ea6"),"\u7684\u6700\u5c0f\u5355\u4f4d  ")),(0,r.kt)("p",null,"\uff082\uff09\u4f7f\u7528\u7ebf\u7a0b\u7684\u539f\u56e0"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u591a\u7ebf\u7a0b\u53ef\u4ee5\u51cf\u5c11\u7a0b\u5e8f\u7684\u54cd\u5e94\u65f6\u95f4\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u4e0e\u8fdb\u7a0b\u76f8\u6bd4\uff0c\u7ebf\u7a0b\u7684\u521b\u5efa\u548c\u5207\u6362\u5f00\u9500\u66f4\u5c0f\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u591a\u6838\u7535\u8111\u4e0a\uff0c\u53ef\u4ee5\u540c\u65f6\u6267\u884c\u591a\u4e2a\u7ebf\u7a0b\uff0c\u63d0\u9ad8\u8d44\u6e90\u5229\u7528\u7387\uff1b"),(0,r.kt)("li",{parentName:"ul"},"\u7b80\u5316\u7a0b\u5e8f\u7684\u7ed3\u6784\uff0c\u4f7f\u7a0b\u5e8f\u4fbf\u4e8e\u7406\u89e3\u548c\u7ef4\u62a4\uff1b")),(0,r.kt)("h3",{id:"6-\u591a\u7ebf\u7a0b\u5171\u7528\u4e00\u4e2a\u6570\u636e\u53d8\u91cf\u9700\u8981\u6ce8\u610f\u4ec0\u4e48"},"6. \u591a\u7ebf\u7a0b\u5171\u7528\u4e00\u4e2a\u6570\u636e\u53d8\u91cf\u9700\u8981\u6ce8\u610f\u4ec0\u4e48\uff1f"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f53\u6211\u4eec\u5728\u7ebf\u7a0b\u5bf9\u8c61\uff08Runnable\uff09\u4e2d\u5b9a\u4e49\u4e86\u5168\u5c40\u53d8\u91cf\uff0crun\u65b9\u6cd5\u4f1a\u4fee\u6539\u8be5\u53d8\u91cf\u65f6\uff0c\u5982\u679c\u6709\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u4f7f\u7528\u8be5\u7ebf\u7a0b\u5bf9\u8c61\uff0c\u90a3\u4e48\u5c31\u4f1a\u9020\u6210\u5168\u5c40\u53d8\u91cf\u7684\u503c\u88ab\u540c\u65f6\u4fee\u6539\uff0c\u9020\u6210\u9519\u8bef. "),(0,r.kt)("li",{parentName:"ul"},"ThreadLocal \u662fJDK\u5f15\u5165\u7684\u4e00\u79cd\u673a\u5236\uff0c\u5b83\u7528\u4e8e\u89e3\u51b3\u7ebf\u7a0b\u95f4\u5171\u4eab\u53d8\u91cf\uff0c\u4f7f\u7528 ThreadLocal \u58f0\u660e\u7684\u53d8\u91cf\uff0c\u5373\u4f7f\u5728\u7ebf\u7a0b\u4e2d\u5c5e\u4e8e\u5168\u5c40\u53d8\u91cf\uff0c\u9488\u5bf9\u6bcf\u4e2a\u7ebf\u7a0b\u6765\u8bb2\uff0c\u8fd9\u4e2a\u53d8\u91cf\u4e5f\u662f\u72ec\u7acb\u7684\u3002 "),(0,r.kt)("li",{parentName:"ul"},"volatile \u53d8\u91cf\u6bcf\u6b21\u88ab\u7ebf\u7a0b\u8bbf\u95ee\u65f6\uff0c\u90fd\u5f3a\u8feb\u7ebf\u7a0b\u4ece\u4e3b\u5185\u5b58\u4e2d\u91cd\u8bfb\u8be5\u53d8\u91cf\u7684\u6700\u65b0\u503c\uff0c\u800c\u5f53\u8be5\u53d8\u91cf\u53d1\u751f\u4fee\u6539\u53d8\u5316\u65f6\uff0c\u4e5f\u4f1a\u5f3a\u8feb\u7ebf\u7a0b\u5c06\u6700\u65b0\u7684\u503c\u5237\u65b0\u56de\u4e3b\u5185\u5b58\u4e2d\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e0d\u540c\u7684\u7ebf\u7a0b\u90fd\u80fd\u53ca\u65f6\u7684\u770b\u5230\u8be5\u53d8\u91cf\u7684\u6700\u65b0\u503c\u3002 ")),(0,r.kt)("h3",{id:"7-\u5185\u5b58\u6cc4\u6f0f\u4e0e\u5185\u5b58\u6ea2\u51fa"},"7. \u5185\u5b58\u6cc4\u6f0f\u4e0e\u5185\u5b58\u6ea2\u51fa"),(0,r.kt)("h4",{id:"java\u5185\u5b58\u56de\u6536\u673a\u5236"},"Java\u5185\u5b58\u56de\u6536\u673a\u5236"),(0,r.kt)("p",null,"\u3000\u3000\u4e0d\u8bba\u54ea\u79cd\u8bed\u8a00\u7684\u5185\u5b58\u5206\u914d\u65b9\u5f0f\uff0c\u90fd\u9700\u8981\u8fd4\u56de\u6240\u5206\u914d\u5185\u5b58\u7684\u771f\u5b9e\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u8fd4\u56de\u4e00\u4e2a\u6307\u9488\u5230\u5185\u5b58\u5757\u7684\u9996\u5730\u5740\u3002Java\u4e2d\u5bf9\u8c61\u662f\u91c7\u7528 new\u3001\u53cd\u5c04\u3001clone\u3001\u53cd\u5e8f\u5217\u5316\u7b49\u65b9\u6cd5\u521b\u5efa\u7684\uff0c \u8fd9\u4e9b\u5bf9\u8c61\u7684\u521b\u5efa\u90fd\u662f\u5728\u5806\uff08Heap\uff09\u4e2d\u5206\u914d\u7684\uff0c\u6240\u6709\u5bf9\u8c61\u7684\u56de\u6536\u90fd\u662f\u7531Java\u865a\u62df\u673a\u901a\u8fc7\u5783\u573e\u56de\u6536\u673a\u5236\u5b8c\u6210\u7684\u3002GC \u4e3a\u4e86\u80fd\u591f\u6b63\u786e\u91ca\u653e\u5bf9\u8c61\uff0c\u4f1a\u76d1\u63a7\u6bcf\u4e2a\u5bf9\u8c61\u7684\u8fd0\u884c\u72b6\u51b5\uff0c\u5bf9\u4ed6\u4eec\u7684\u7533\u8bf7\u3001\u5f15\u7528\u3001\u88ab\u5f15\u7528\u3001\u8d4b\u503c\u7b49\u72b6\u51b5\u8fdb\u884c\u76d1\u63a7\uff0cJava \u4f1a\u4f7f\u7528\u6709\u5411\u56fe\u7684\u65b9\u6cd5\u8fdb\u884c\u7ba1\u7406\u5185\u5b58\uff0c\u5b9e\u65f6\u76d1\u63a7\u5bf9\u8c61\u662f\u5426\u53ef\u4ee5\u8fbe\u5230\uff0c\u5982\u679c\u4e0d\u53ef\u5230\u8fbe\uff0c\u5219\u5c31\u5c06\u5176\u56de\u6536\uff0c\u8fd9\u6837\u4e5f\u53ef\u4ee5\u6d88\u9664\u5f15\u7528\u5faa\u73af\u7684\u95ee\u9898\u3002"),(0,r.kt)("p",null,"\u3000\u3000\u5728 Java \u8bed\u8a00\u4e2d\uff0c\u5224\u65ad\u4e00\u4e2a\u5185\u5b58\u7a7a\u95f4\u662f\u5426\u7b26\u5408\u5783\u573e\u6536\u96c6\u6807\u51c6\u6709\u4e24\u4e2a\uff1a\u4e00\u4e2a\u662f\u7ed9\u5bf9\u8c61\u8d4b\u4e88\u4e86\u7a7a\u503c null\uff0c\u4ee5\u4e0b\u518d\u6ca1\u6709\u8c03\u7528\u8fc7\uff0c\u53e6\u4e00\u4e2a\u662f\u7ed9\u5bf9\u8c61\u8d4b\u4e88\u4e86\u65b0\u503c\uff0c\u8fd9\u6837\u91cd\u65b0\u5206\u914d\u4e86\u5185\u5b58\u7a7a\u95f4\u3002 "),(0,r.kt)("h4",{id:"java\u5185\u5b58\u6cc4\u9732\u5f15\u8d77\u539f\u56e0"},"Java\u5185\u5b58\u6cc4\u9732\u5f15\u8d77\u539f\u56e0"),(0,r.kt)("p",null,"\u3000\u3000\u9996\u5148\uff0c\u4ec0\u4e48\u662f\u5185\u5b58\u6cc4\u9732\uff1f\u7ecf\u5e38\u542c\u4eba\u8c08\u8d77\u5185\u5b58\u6cc4\u9732\uff0c\u4f46\u8981\u95ee\u4ec0\u4e48\u662f\u5185\u5b58\u6cc4\u9732\uff0c\u6ca1\u51e0\u4e2a\u8bf4\u5f97\u6e05\u695a\u3002"),(0,r.kt)("p",null,"\u3000\u3000",(0,r.kt)("strong",{parentName:"p"},"\u5185\u5b58\u6cc4\u9732"),"\uff1a\u662f\u6307\u65e0\u7528\u5bf9\u8c61\uff08\u4e0d\u518d\u4f7f\u7528\u7684\u5bf9\u8c61\uff09\u6301\u7eed\u5360\u6709\u5185\u5b58\u6216\u65e0\u7528\u5bf9\u8c61\u7684\u5185\u5b58\u5f97\u4e0d\u5230\u53ca\u65f6\u91ca\u653e\uff0c\u4ece\u800c\u9020\u6210\u7684\u5185\u5b58\u7a7a\u95f4\u7684\u6d6a\u8d39\u79f0\u4e3a\u5185\u5b58\u6cc4\u9732\u3002\u5185\u5b58\u6cc4\u9732\u6709\u65f6\u4e0d\u4e25\u91cd\u4e14\u4e0d\u6613\u5bdf\u89c9\uff0c\u8fd9\u6837\u5f00\u53d1\u8005\u5c31\u4e0d\u77e5\u9053\u5b58\u5728\u5185\u5b58\u6cc4\u9732\uff0c\u4f46\u6709\u65f6\u4e5f\u4f1a\u5f88\u4e25\u91cd\uff0c\u4f1a\u63d0\u793a ",(0,r.kt)("inlineCode",{parentName:"p"},"Out of memory"),"\u3002"),(0,r.kt)("p",null,"\u3000\u3000",(0,r.kt)("strong",{parentName:"p"},"\u5185\u5b58\u6ea2\u51fa"),"\uff1a\u6307\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d",(0,r.kt)("strong",{parentName:"p"},"\u65e0\u6cd5\u7533\u8bf7\u5230\u8db3\u591f\u7684\u5185\u5b58"),"\u800c\u5bfc\u81f4\u7684\u4e00\u79cd\u9519\u8bef\u3002",(0,r.kt)("strong",{parentName:"p"},"\u5185\u5b58\u6cc4\u9732\u662f\u5185\u5b58\u6ea2\u51fa\u7684\u4e00\u79cd\u8bf1\u56e0"),"\uff0c\u4e0d\u662f\u552f\u4e00\u56e0\u7d20\n\u3000\u3000\u90a3\u4e48\uff0cJava \u5185\u5b58\u6cc4\u9732\u6839\u672c\u539f\u56e0\u662f\u4ec0\u4e48\u5462\uff1f\u957f\u751f\u547d\u5468\u671f\u7684\u5bf9\u8c61\u6301\u6709\u77ed\u751f\u547d\u5468\u671f\u5bf9\u8c61\u7684\u5f15\u7528\u5c31\u5f88\u53ef\u80fd\u53d1\u751f\u5185\u5b58\u6cc4\u9732\uff0c\u5c3d\u7ba1\u77ed\u751f\u547d\u5468\u671f\u5bf9\u8c61\u5df2\u7ecf\u4e0d\u518d\u9700\u8981\uff0c\u4f46\u662f\u56e0\u4e3a\u957f\u751f\u547d\u5468\u671f\u5bf9\u8c61\u6301\u6709\u5b83\u7684\u5f15\u7528\u800c\u5bfc\u81f4\u4e0d\u80fd\u88ab\u56de\u6536\uff0c\u8fd9\u5c31\u662f Java \u4e2d\u5185\u5b58\u6cc4\u9732\u7684\u53d1\u751f\u573a\u666f\u3002\u5177\u4f53\u4e3b\u8981\u6709\u5982\u4e0b\u51e0\u5927\u7c7b"),(0,r.kt)("h5",{id:"\u9759\u6001\u96c6\u5408\u7c7b"},"\u9759\u6001\u96c6\u5408\u7c7b"),(0,r.kt)("p",null,"\u3000\u3000\u9759\u6001\u96c6\u5408\u7c7b\uff0c\u4f7f\u7528Set\u3001Vector\u3001HashMap\u7b49\u96c6\u5408\u7c7b\u7684\u65f6\u5019\u9700\u8981\u7279\u522b\u6ce8\u610f\u3002\u5f53\u8fd9\u4e9b\u7c7b\u88ab\u5b9a\u4e49\u6210\u9759\u6001\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u4ed6\u4eec\u7684\u751f\u547d\u5468\u671f\u8ddf\u5e94\u7528\u7a0b\u5e8f\u4e00\u6837\u957f\uff0c\u8fd9\u65f6\u5019\u5c31\u6709\u53ef\u80fd\u53d1\u751f\u5185\u5b58\u6cc4\u6f0f\u3002 "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// \u4f8b\u5b50 \nclass StaticTest \n{ \n    private static Vector v = new Vector(10); \n    public void init() \n    { \n        for (int i = 1; i < 100; i++) \n        { \n            Object object = new Object(); \n            v.add(object); \n            object = null; \n        } \n    } \n} \n")),(0,r.kt)("p",null,"\u3000\u3000\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u5faa\u73af\u7533\u8bf7object\u5bf9\u8c61\uff0c\u5e76\u6dfb\u52a0\u5230Vector\u4e2d\uff0c\u7136\u540e\u8bbe\u7f6eobject=null\uff08\u5c31\u662f\u6e05\u9664\u6808\u4e2d\u5f15\u7528\u53d8\u91cfobject\uff09,\u4f46\u662f\u8fd9\u4e9b\u5bf9\u8c61\u88abvector\u5f15\u7528\u7740\uff0c\u5fc5\u7136\u4e0d\u80fd\u88abGC\u56de\u6536\uff0c\u9020\u6210\u5185\u5b58\u6cc4\u9732\u3002\u56e0\u6b64\u8981\u91ca\u653e\u8fd9\u4e9b\u5bf9\u8c61\uff0c\u8fd8\u9700\u8981\u5c06\u5b83\u4eec\u4ecevector\u4e2d\u5220\u9664\uff0c\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u5c31\u662f\u5c06vector=null,\u6e05\u7a7a\u96c6\u5408\u7c7b\u4e2d\u7684\u5f15\u7528\u3002 "),(0,r.kt)("h5",{id:"\u76d1\u542c\u5668"},"\u76d1\u542c\u5668"),(0,r.kt)("p",null,"\u3000\u3000\u5728 Java \u7f16\u7a0b\u4e2d\uff0c\u6211\u4eec\u90fd\u9700\u8981\u548c\u76d1\u542c\u5668\u6253\u4ea4\u9053\uff0c\u901a\u5e38\u4e00\u4e2a\u5e94\u7528\u4e2d\u4f1a\u7528\u5230\u5f88\u591a\u76d1\u542c\u5668\uff0c\u6211\u4eec\u4f1a\u8c03\u7528\u4e00\u4e2a\u63a7\u4ef6\uff0c\u8bf8\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"addXXXListener()")," \u7b49\u65b9\u6cd5\u6765\u589e\u52a0\u76d1\u542c\u5668\uff0c\u4f46\u5f80\u5f80\u5728\u91ca\u653e\u7684\u65f6\u5019\u5374\u6ca1\u6709\u53bb\u5220\u9664\u8fd9\u4e9b\u76d1\u542c\u5668\uff0c\u4ece\u800c\u589e\u52a0\u4e86\u5185\u5b58\u6cc4\u6f0f\u7684\u673a\u4f1a\u3002 "),(0,r.kt)("h5",{id:"\u5404\u79cd\u8fde\u63a5"},"\u5404\u79cd\u8fde\u63a5"),(0,r.kt)("p",null,"\u3000\u3000\u6bd4\u5982\u6570\u636e\u5e93\u8fde\u63a5\uff08dataSourse.getConnection()\uff09\uff0c\u7f51\u7edc\u8fde\u63a5 (socket) \u548c IO \u8fde\u63a5\uff0c\u9664\u975e\u5176\u663e\u5f0f\u7684\u8c03\u7528\u4e86\u5176close() \u65b9 \u6cd5\u5c06\u5176\u8fde\u63a5\u5173\u95ed\uff0c\u5426\u5219\u662f\u4e0d\u4f1a\u81ea\u52a8\u88ab GC \u56de\u6536\u7684\u3002\u5bf9\u4e8e Resultset \u548c Statement \u5bf9\u8c61\u53ef\u4ee5\u4e0d\u8fdb\u884c\u663e\u5f0f\u56de\u6536\uff0c\u4f46 Connection \u4e00\u5b9a\u8981\u663e\u5f0f\u56de\u6536\uff0c\u56e0\u4e3a Connection \u5728\u4efb\u4f55\u65f6\u5019\u90fd\u65e0\u6cd5\u81ea\u52a8\u56de\u6536\uff0c\u800c Connection\u4e00\u65e6\u56de\u6536\uff0cResultset \u548c Statement \u5bf9\u8c61\u5c31\u4f1a\u7acb\u5373\u4e3a NULL\u3002\u4f46\u662f\u5982\u679c\u4f7f\u7528\u8fde\u63a5\u6c60\uff0c\u60c5\u51b5\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u9664\u4e86\u8981\u663e\u5f0f\u5730\u5173\u95ed\u8fde\u63a5\uff0c\u8fd8\u5fc5\u987b\u663e\u5f0f\u5730\u5173\u95ed Resultset Statement \u5bf9\u8c61\uff08\u5173\u95ed\u5176\u4e2d\u4e00\u4e2a\uff0c\u53e6\u5916\u4e00\u4e2a\u4e5f\u4f1a\u5173\u95ed\uff09\uff0c\u5426\u5219\u5c31\u4f1a\u9020\u6210\u5927\u91cf\u7684 Statement \u5bf9\u8c61\u65e0\u6cd5\u91ca\u653e\uff0c\u4ece\u800c\u5f15\u8d77\u5185\u5b58\u6cc4\u6f0f\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e00\u822c\u90fd\u4f1a\u5728 try \u91cc\u9762\u53bb\u7684\u8fde\u63a5\uff0c\u5728 finally \u91cc\u9762\u91ca\u653e\u8fde\u63a5\u3002 "),(0,r.kt)("h5",{id:"\u5185\u90e8\u7c7b\u548c\u5916\u90e8\u6a21\u5757\u7b49\u7684\u5f15\u7528"},"\u5185\u90e8\u7c7b\u548c\u5916\u90e8\u6a21\u5757\u7b49\u7684\u5f15\u7528"),(0,r.kt)("p",null,"\u3000\u3000\u5185\u90e8\u7c7b\u7684\u5f15\u7528\u662f\u6bd4\u8f83\u5bb9\u6613\u9057\u5fd8\u7684\u4e00\u79cd\uff0c\u800c\u4e14\u4e00\u65e6\u6ca1\u91ca\u653e\u53ef\u80fd\u5bfc\u81f4\u4e00\u7cfb\u5217\u7684\u540e\u7ee7\u7c7b\u5bf9\u8c61\u6ca1\u6709\u91ca\u653e\u3002\u5728\u8c03\u7528\u5916\u90e8\u6a21\u5757\u7684\u65f6\u5019\uff0c\u4e5f\u5e94\u8be5\u6ce8\u610f\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f\uff0c\u5982\u679c\u6a21\u5757A\u8c03\u7528\u4e86\u5916\u90e8\u6a21\u5757B\u7684\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5982\uff1a ",(0,r.kt)("inlineCode",{parentName:"p"},"public void register(Object o) ")," \u8fd9\u4e2a\u65b9\u6cd5\u6709\u53ef\u80fd\u5c31\u4f7f\u5f97A\u6a21\u5757\u6301\u6709\u4f20\u5165\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u8fd9\u65f6\u5019\u9700\u8981\u67e5\u770bB\u6a21\u5757\u662f\u5426\u63d0\u4f9b\u4e86\u51fa\u53bb\u5f15\u7528\u7684\u65b9\u6cd5\uff0c\u8fd9\u79cd\u60c5\u51b5\u5bb9\u6613\u5ffd\u7565\uff0c\u800c\u4e14\u53d1\u751f\u5185\u5b58\u6cc4\u6f0f\u7684\u8bdd\uff0c\u8fd8\u6bd4\u8f83\u96be\u5bdf\u89c9\u3002 "),(0,r.kt)("h5",{id:"\u5355\u4f8b\u6a21\u5f0f"},"\u5355\u4f8b\u6a21\u5f0f"),(0,r.kt)("p",null,"\u3000\u3000\u56e0\u4e3a\u5355\u5229\u5bf9\u8c61\u521d\u59cb\u5316\u540e\u5c06\u5728 JVM \u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\u5185\u5b58\u5728\uff0c\u5982\u679c\u5b83\u6301\u6709\u4e00\u4e2a\u5916\u90e8\u5bf9\u8c61\u7684\uff08\u751f\u547d\u5468\u671f\u6bd4\u8f83\u77ed\uff09\u5f15\u7528\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5916\u90e8\u5bf9\u8c61\u5c31\u4e0d\u80fd\u88ab\u56de\u6536\uff0c\u4ece\u800c\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002\u5982\u679c\u8fd9\u4e2a\u5916\u90e8\u5bf9\u8c61\u8fd8\u6301\u6709\u5176\u4ed6\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u90a3\u4e48\u5185\u5b58\u6cc4\u6f0f\u66f4\u4e25\u91cd\u3002 "),(0,r.kt)("h3",{id:"8-\u5982\u4f55\u51cf\u5c11\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362"},"8. \u5982\u4f55\u51cf\u5c11\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362"),(0,r.kt)("p",null,"\u4f7f\u7528\u591a\u7ebf\u7a0b\u65f6\uff0c",(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u662f\u591a\u7ebf\u7a0b\u80fd\u63d0\u5347\u7a0b\u5e8f\u7684\u6267\u884c\u901f\u5ea6"),"\uff0c\u4f7f\u7528\u591a\u7ebf\u7a0b\u662f\u4e3a\u4e86",(0,r.kt)("strong",{parentName:"p"},"\u66f4\u597d\u5730\u5229\u7528 CPU \u8d44\u6e90"),"\uff01"),(0,r.kt)("p",null,"\u7a0b\u5e8f\u5728\u6267\u884c\u65f6\uff0c\u591a\u7ebf\u7a0b\u662f CPU \u901a\u8fc7\u7ed9\u6bcf\u4e2a\u7ebf\u7a0b",(0,r.kt)("strong",{parentName:"p"},"\u5206\u914d CPU \u65f6\u95f4\u7247\u6765\u5b9e\u73b0"),"\u7684\uff0c\u65f6\u95f4\u7247\u662fCPU\u5206\u914d\u7ed9\u6bcf\u4e2a\u7ebf\u7a0b\u6267\u884c\u7684\u65f6\u95f4\uff0c\u56e0\u65f6\u95f4\u7247\u975e\u5e38\u77ed\uff0c\u6240\u4ee5",(0,r.kt)("strong",{parentName:"p"},"CPU \u901a\u8fc7\u4e0d\u505c\u5730\u5207\u6362\u7ebf\u7a0b\u6267\u884c"),"\u3002"),(0,r.kt)("p",null,"\u7ebf\u7a0b",(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u662f\u8d8a\u591a\u5c31\u8d8a\u597d"),"\u7684\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u662f\u6709",(0,r.kt)("strong",{parentName:"p"},"\u6027\u80fd\u635f\u8017"),"\u7684\uff0c\u5728\u4f7f\u7528\u591a\u7ebf\u7a0b\u7684\u540c\u65f6\u9700\u8981\u8003\u8651\u5982\u4f55\u51cf\u5c11\u4e0a\u4e0b\u6587\u5207\u6362"),(0,r.kt)("p",null,"\u4e00\u822c\u6765\u8bf4\u6709\u4ee5\u4e0b\u51e0\u6761\u7ecf\u9a8c"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u65e0\u9501\u5e76\u53d1\u7f16\u7a0b"),"\u3002\u591a\u7ebf\u7a0b\u7ade\u4e89\u65f6\uff0c\u4f1a\u5f15\u8d77\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u6240\u4ee5\u591a\u7ebf\u7a0b\u5904\u7406\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u7528\u4e00\u4e9b\u529e\u6cd5\u6765\u907f\u514d\u4f7f\u7528\u9501\uff0c\u5982\u5c06\u6570\u636e\u7684 ID \u6309\u7167Hash\u53d6\u6a21\u5206\u6bb5\uff0c\u4e0d\u540c\u7684\u7ebf\u7a0b\u5904\u7406\u4e0d\u540c\u6bb5\u7684\u6570\u636e"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"CAS\u7b97\u6cd5"),"\u3002Java \u7684 Atomic \u5305\u4f7f\u7528 CAS \u7b97\u6cd5\u6765\u66f4\u65b0\u6570\u636e\uff0c",(0,r.kt)("strong",{parentName:"li"},"\u800c\u4e0d\u9700\u8981\u52a0\u9501"),"\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u63a7\u5236\u7ebf\u7a0b\u6570\u91cf"),"\u3002\u907f\u514d\u521b\u5efa\u4e0d\u9700\u8981\u7684\u7ebf\u7a0b\uff0c\u6bd4\u5982\u4efb\u52a1\u5f88\u5c11\uff0c\u4f46\u662f\u521b\u5efa\u4e86\u5f88\u591a\u7ebf\u7a0b\u6765\u5904\u7406\uff0c\u8fd9\u6837\u4f1a\u9020\u6210\u5927\u91cf\u7ebf\u7a0b\u90fd\u5904\u4e8e\u7b49\u5f85\u72b6\u6001"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u534f\u7a0b"),"\u3002\u5728\u5355\u7ebf\u7a0b\u91cc\u5b9e\u73b0\u591a\u4efb\u52a1\u7684\u8c03\u5ea6\uff0c\u5e76\u5728\u5355\u7ebf\u7a0b\u91cc\u7ef4\u6301\u591a\u4e2a\u4efb\u52a1\u95f4\u7684\u5207\u6362"),(0,r.kt)("li",{parentName:"ul"},"\u534f\u7a0b\u53ef\u4ee5\u770b\u6210\u662f\u7528\u6237\u6001",(0,r.kt)("strong",{parentName:"li"},"\u81ea\u7ba1\u7406\u7684\u201c\u7ebf\u7a0b\u201d"),"\u3002",(0,r.kt)("strong",{parentName:"li"},"\u4e0d\u4f1a\u53c2\u4e0e"),"CPU\u65f6\u95f4\u8c03\u5ea6\uff0c\u6ca1\u6709\u5747\u8861\u5206\u914d\u5230\u65f6\u95f4\u3002",(0,r.kt)("strong",{parentName:"li"},"\u975e\u62a2\u5360\u5f0f"),"\u7684")),(0,r.kt)("p",null,"\u8fd8\u53ef\u4ee5\u8003\u8651\u6211\u4eec\u7684\u5e94\u7528\u662f",(0,r.kt)("strong",{parentName:"p"},"IO\u5bc6\u96c6\u578b\u7684\u8fd8\u662fCPU\u5bc6\u96c6\u578b"),"\u7684\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u662fIO\u5bc6\u96c6\u578b\u7684\u8bdd\uff0c\u7ebf\u7a0b\u53ef\u4ee5\u591a\u4e00\u4e9b\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u662fCPU\u5bc6\u96c6\u578b\u7684\u8bdd\uff0c\u7ebf\u7a0b\u4e0d\u5b9c\u592a\u591a\u3002")),(0,r.kt)("h3",{id:"9-\u7ebf\u7a0b\u95f4\u901a\u4fe1\u548c\u8fdb\u7a0b\u95f4\u901a\u4fe1"},"9. \u7ebf\u7a0b\u95f4\u901a\u4fe1\u548c\u8fdb\u7a0b\u95f4\u901a\u4fe1"),(0,r.kt)("h4",{id:"\u7ebf\u7a0b\u95f4\u901a\u4fe1"},"\u7ebf\u7a0b\u95f4\u901a\u4fe1"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"synchronized \u540c\u6b65")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u8fd9\u79cd\u65b9\u5f0f\uff0c\u672c\u8d28\u4e0a\u5c31\u662f \u201c\u5171\u4eab\u5185\u5b58\u201d \u5f0f\u7684\u901a\u4fe1\u3002\u591a\u4e2a\u7ebf\u7a0b\u9700\u8981\u8bbf\u95ee\u540c\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf\uff0c\u8c01\u62ff\u5230\u4e86\u9501\uff08\u83b7\u5f97\u4e86\u8bbf\u95ee\u6743\u9650\uff09\uff0c\u8c01\u5c31\u53ef\u4ee5\u6267\u884c\u3002"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"while \u8f6e\u8be2\u7684\u65b9\u5f0f")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u5728\u8fd9\u79cd\u65b9\u5f0f\u4e0b\uff0c\u7ebf\u7a0bA\u4e0d\u65ad\u5730\u6539\u53d8\u6761\u4ef6\uff0c\u7ebf\u7a0b ThreadB \u4e0d\u505c\u5730\u901a\u8fc7 while \u8bed\u53e5\u68c0\u6d4b\u8fd9\u4e2a\u6761\u4ef6",(0,r.kt)("inlineCode",{parentName:"li"},"(list.size()==5)")," \u662f\u5426\u6210\u7acb \uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u7ebf\u7a0b\u95f4\u7684\u901a\u4fe1\u3002\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u4f1a\u6d6a\u8d39 CPU \u8d44\u6e90\u3002\u4e4b\u6240\u4ee5\u8bf4\u5b83\u6d6a\u8d39\u8d44\u6e90\uff0c\u662f\u56e0\u4e3a JVM \u8c03\u5ea6\u5668\u5c06 CPU \u4ea4\u7ed9\u7ebf\u7a0bB\u6267\u884c\u65f6\uff0c\u5b83\u6ca1\u505a\u5565\u201c\u6709\u7528\u201d\u7684\u5de5\u4f5c\uff0c\u53ea\u662f\u5728\u4e0d\u65ad\u5730\u6d4b\u8bd5\u67d0\u4e2a\u6761\u4ef6\u662f\u5426\u6210\u7acb\u3002\u5c31\u7c7b\u4f3c\u4e8e\u73b0\u5b9e\u751f\u6d3b\u4e2d\uff0c\u67d0\u4e2a\u4eba\u4e00\u76f4\u770b\u7740\u624b\u673a\u5c4f\u5e55\u662f\u5426\u6709\u7535\u8bdd\u6765\u4e86\uff0c\u800c\u4e0d\u662f\uff1a \u5728\u5e72\u522b\u7684\u4e8b\u60c5\uff0c\u5f53\u6709\u7535\u8bdd\u6765\u65f6\uff0c\u54cd\u94c3\u901a\u77e5TA\u7535\u8bdd\u6765\u4e86\u3002"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"wait/notify \u673a\u5236")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5f53\u6761\u4ef6\u672a\u6ee1\u8db3\u65f6\uff0c\u7ebf\u7a0bA\u8c03\u7528 wait() \u653e\u5f03CPU\uff0c\u5e76\u8fdb\u5165\u963b\u585e\u72b6\u6001\u3002\uff08\u4e0d\u50cf while \u8f6e\u8be2\u90a3\u6837\u5360\u7528 CPU\uff09"),(0,r.kt)("p",{parentName:"li"},"\u5f53\u6761\u4ef6\u6ee1\u8db3\u65f6\uff0c\u7ebf\u7a0bB\u8c03\u7528 notify() \u901a\u77e5\u7ebf\u7a0bA\uff0c\u6240\u8c13\u901a\u77e5\u7ebf\u7a0bA\uff0c\u5c31\u662f\u5524\u9192\u7ebf\u7a0bA\uff0c\u5e76\u8ba9\u5b83\u8fdb\u5165\u53ef\u8fd0\u884c\u72b6\u6001\u3002")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"\u7ba1\u9053\u901a\u4fe1")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"java.io.PipedInputStream \u548c java.io.PipedOutputStream \u8fdb\u884c\u901a\u4fe1")))),(0,r.kt)("h4",{id:"\u8fdb\u7a0b\u95f4\u901a\u4fe1"},"\u8fdb\u7a0b\u95f4\u901a\u4fe1"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u7ba1\u9053\uff08Pipe\uff09")," \uff1a\u7ba1\u9053\u53ef\u7528\u4e8e\u5177\u6709\u4eb2\u7f18\u5173\u7cfb\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\uff0c\u5141\u8bb8\u4e00\u4e2a\u8fdb\u7a0b\u548c\u53e6\u4e00\u4e2a\u4e0e\u5b83\u6709\u5171\u540c\u7956\u5148\u7684\u8fdb\u7a0b\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u547d\u540d\u7ba1\u9053\uff08named pipe\uff09")," \uff1a\u547d\u540d\u7ba1\u9053\u514b\u670d\u4e86\u7ba1\u9053\u6ca1\u6709\u540d\u5b57\u7684\u9650\u5236\uff0c\u56e0\u6b64\uff0c\u9664\u5177\u6709\u7ba1\u9053\u6240\u5177\u6709\u7684\u529f\u80fd\u5916\uff0c\u5b83\u8fd8\u5141\u8bb8\u65e0\u4eb2\u7f18\u5173 \u7cfb \u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u3002\u547d\u540d\u7ba1\u9053\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u5bf9\u5e94\u7684\u6587\u4ef6\u540d\u3002\u547d\u540d\u7ba1\u9053\u901a\u8fc7\u547d\u4ee4mkfifo\u6216\u7cfb\u7edf\u8c03\u7528mkfifo\u6765\u521b\u5efa\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u4fe1\u53f7\uff08Signal\uff09")," \uff1a\u4fe1\u53f7\u662f\u6bd4\u8f83\u590d\u6742\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u7528\u4e8e\u901a\u77e5\u63a5\u53d7\u8fdb\u7a0b\u6709\u67d0\u79cd\u4e8b\u4ef6\u53d1\u751f\uff0c\u9664\u4e86\u7528\u4e8e\u8fdb\u7a0b\u95f4\u901a\u4fe1\u5916\uff0c\u8fdb\u7a0b\u8fd8\u53ef\u4ee5\u53d1\u9001 \u4fe1\u53f7\u7ed9\u8fdb\u7a0b\u672c\u8eab\uff1bLinux\u9664\u4e86\u652f\u6301Unix\u65e9\u671f\u4fe1\u53f7\u8bed\u4e49\u51fd\u6570sigal\u5916\uff0c\u8fd8\u652f\u6301\u8bed\u4e49\u7b26\u5408Posix.1\u6807\u51c6\u7684\u4fe1\u53f7\u51fd\u6570sigaction\uff08\u5b9e\u9645\u4e0a\uff0c\u8be5\u51fd\u6570\u662f\u57fa\u4e8eBSD\u7684\uff0cBSD\u4e3a\u4e86\u5b9e\u73b0\u53ef\u9760\u4fe1\u53f7\u673a\u5236\uff0c\u53c8\u80fd\u591f\u7edf\u4e00\u5bf9\u5916\u63a5\u53e3\uff0c\u7528sigaction\u51fd\u6570\u91cd\u65b0\u5b9e\u73b0\u4e86signal\u51fd\u6570\uff09\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u6d88\u606f\uff08Message\uff09\u961f\u5217")," \uff1a\u6d88\u606f\u961f\u5217\u662f\u6d88\u606f\u7684\u94fe\u63a5\u8868\uff0c\u5305\u62ecPosix\u6d88\u606f\u961f\u5217system V\u6d88\u606f\u961f\u5217\u3002\u6709\u8db3\u591f\u6743\u9650\u7684\u8fdb\u7a0b\u53ef\u4ee5\u5411\u961f\u5217\u4e2d\u6dfb\u52a0\u6d88\u606f\uff0c\u88ab\u8d4b\u4e88\u8bfb\u6743\u9650\u7684\u8fdb\u7a0b\u5219\u53ef\u4ee5\u8bfb\u8d70\u961f\u5217\u4e2d\u7684\u6d88\u606f\u3002\u6d88\u606f\u961f\u5217\u514b\u670d\u4e86\u4fe1\u53f7\u627f\u8f7d\u4fe1\u606f\u91cf\u5c11\uff0c\u7ba1\u9053\u53ea\u80fd\u627f\u8f7d\u65e0\u683c\u5f0f\u5b57\u8282\u6d41\u4ee5\u53ca\u7f13\u51b2\u533a\u5927\u5c0f\u53d7\u9650\u7b49\u7f3a"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u5171\u4eab\u5185\u5b58")," \uff1a\u4f7f\u5f97\u591a\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u540c\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\uff0c\u662f\u6700\u5feb\u7684\u53ef\u7528IPC\u5f62\u5f0f\u3002\u662f\u9488\u5bf9\u5176\u4ed6\u901a\u4fe1\u673a\u5236\u8fd0\u884c\u6548\u7387\u8f83\u4f4e\u800c\u8bbe\u8ba1\u7684\u3002\u5f80\u5f80\u4e0e\u5176\u5b83\u901a\u4fe1\u673a\u5236\uff0c\u5982\u4fe1\u53f7\u91cf\u7ed3\u5408\u4f7f\u7528\uff0c\u6765\u8fbe\u5230\u8fdb\u7a0b\u95f4\u7684\u540c\u6b65\u53ca\u4e92\u65a5\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u5185\u5b58\u6620\u5c04\uff08mapped memory\uff09")," \uff1a\u5185\u5b58\u6620\u5c04\u5141\u8bb8\u4efb\u4f55\u591a\u4e2a\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u6bcf\u4e00\u4e2a\u4f7f\u7528\u8be5\u673a\u5236\u7684\u8fdb\u7a0b\u901a\u8fc7\u628a\u4e00\u4e2a\u5171\u4eab\u7684\u6587\u4ef6\u6620\u5c04\u5230\u81ea\u5df1\u7684\u8fdb\u7a0b\u5730\u5740\u7a7a\u95f4\u6765\u5b9e\u73b0\u5b83\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u4fe1\u53f7\u91cf\uff08semaphore\uff09")," \uff1a\u4e3b\u8981\u4f5c\u4e3a\u8fdb\u7a0b\u95f4\u4ee5\u53ca\u540c\u4e00\u8fdb\u7a0b\u4e0d\u540c\u7ebf\u7a0b\u4e4b\u95f4\u7684\u540c\u6b65\u624b\u6bb5\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u5957\u63a5\u53e3\uff08Socket\uff09")," \uff1a\u66f4\u4e3a\u4e00\u822c\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\uff0c\u53ef\u7528\u4e8e\u4e0d\u540c\u673a\u5668\u4e4b\u95f4\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002\u8d77\u521d\u662f\u7531Unix\u7cfb\u7edf\u7684BSD\u5206\u652f\u5f00\u53d1\u51fa\u6765\u7684\uff0c\u4f46\u73b0\u5728\u4e00\u822c\u53ef\u4ee5\u79fb\u690d\u5230\u5176\u5b83\u7c7bUnix\u7cfb\u7edf\u4e0a\uff1alinux\u548cSystem V\u7684\u53d8\u79cd\u90fd\u652f\u6301\u5957\u63a5\u5b57\u3002")),(0,r.kt)("p",null,"\u53c2\u8003\u8d44\u6599\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.tuhd.top/2017/08/04/2017-08-04-threadandprocess/"},"Java\u7ebf\u7a0b\u4e0e\u7ebf\u7a0b\u3001\u8fdb\u7a0b\u4e0e\u8fdb\u7a0b\u4e4b\u95f4\u901a\u4fe1\u65b9\u5f0f | \u7406\u60f3\u6751 | \u5c60\u676d\u955d\u7684\u535a\u5ba2")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.cnblogs.com/hapjin/p/5492619.html"},"JAVA\u591a\u7ebf\u7a0b\u4e4b\u7ebf\u7a0b\u95f4\u7684\u901a\u4fe1\u65b9\u5f0f - hapjin - \u535a\u5ba2\u56ed"))),(0,r.kt)("h3",{id:"10-\u4ec0\u4e48\u662f\u540c\u6b65\u548c\u5f02\u6b65\u963b\u585e\u548c\u975e\u963b\u585e"},"10. \u4ec0\u4e48\u662f\u540c\u6b65\u548c\u5f02\u6b65\uff0c\u963b\u585e\u548c\u975e\u963b\u585e\uff1f"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u540c\u6b65\u548c\u5f02\u6b65\u5173\u6ce8\u7684\u662f\u6d88\u606f\u901a\u4fe1\u673a\u5236 (synchronous communication/ asynchronous communication)")),(0,r.kt)("h4",{id:"\u540c\u6b65"},"\u540c\u6b65"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5728\u53d1\u51fa\u4e00\u4e2a\u540c\u6b65\u8c03\u7528\u65f6\uff0c\u5728\u6ca1\u6709\u5f97\u5230\u7ed3\u679c\u4e4b\u524d\uff0c\u8be5\u8c03\u7528\u5c31\u4e0d\u8fd4\u56de\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u4f8b\u5982\uff1a\u6309\u4e0b\u7535\u996d\u9505\u7684\u716e\u996d\u6309\u94ae\uff0c\u7136\u540e\u7b49\u5f85\u996d\u716e\u597d\uff0c\u628a\u996d\u76db\u51fa\u6765\uff0c\u7136\u540e\u518d\u53bb\u7092\u83dc\u3002")),(0,r.kt)("h4",{id:"\u5f02\u6b65"},"\u5f02\u6b65"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5728\u53d1\u51fa\u4e00\u4e2a\u5f02\u6b65\u8c03\u7528\u540e\uff0c\u8c03\u7528\u8005\u4e0d\u4f1a\u7acb\u523b\u5f97\u5230\u7ed3\u679c\uff0c\u8be5\u8c03\u7528\u5c31\u8fd4\u56de\u4e86\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u4f8b\u5982\uff1a\u6309\u4e0b\u7535\u94ae\u9505\u7684\u716e\u996d\u6309\u94ae\uff0c\u76f4\u63a5\u53bb\u7092\u83dc\u6216\u8005\u505a\u522b\u7684\u4e8b\u60c5\uff0c\u5f53\u7535\u996d\u9505\u201c\u6ef4\u6ef4\u6ef4\u201d\u54cd\u7684\u65f6\u5019\uff0c\u518d\u56de\u53bb\u628a\u996d\u76db\u51fa\u6765\u3002\u663e\u7136\uff0c\u5f02\u6b65\u5f0f\u7f16\u7a0b\u8981\u6bd4\u540c\u6b65\u5f0f\u7f16\u7a0b\u9ad8\u6548\u5f97\u591a\u3002")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u963b\u585e\u548c\u975e\u963b\u585e\u5173\u6ce8\u7684\u662f\u7a0b\u5e8f\u5728\u7b49\u5f85\u8c03\u7528\u7ed3\u679c\uff08\u6d88\u606f\uff0c\u8fd4\u56de\u503c\uff09\u65f6\u7684\u72b6\u6001.")),(0,r.kt)("h4",{id:"\u963b\u585e"},"\u963b\u585e"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8c03\u7528\u7ed3\u679c\u8fd4\u56de\u4e4b\u524d\uff0c\u5f53\u524d\u7ebf\u7a0b\u4f1a\u88ab\u6302\u8d77\u3002\u8c03\u7528\u7ebf\u7a0b\u53ea\u6709\u5728\u5f97\u5230\u7ed3\u679c\u4e4b\u540e\u624d\u4f1a\u8fd4\u56de\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u4f8b\u5b50\uff1a\u4f60\u6253\u7535\u8bdd\u95ee\u4e66\u5e97\u8001\u677f\u6709\u6ca1\u6709\u300a\u5206\u5e03\u5f0f\u7cfb\u7edf\u300b\u8fd9\u672c\u4e66\uff0c\u4f60\u5982\u679c\u662f\u963b\u585e\u5f0f\u8c03\u7528\uff0c\u4f60\u4f1a\u4e00\u76f4\u628a\u81ea\u5df1\u201c\u6302\u8d77\u201d\uff0c\u76f4\u5230\u5f97\u5230\u8fd9\u672c\u4e66\u6709\u6ca1\u6709\u7684\u7ed3\u679c ")),(0,r.kt)("h4",{id:"\u975e\u963b\u585e"},"\u975e\u963b\u585e"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5728\u4e0d\u80fd\u7acb\u523b\u5f97\u5230\u7ed3\u679c\u4e4b\u524d\uff0c\u8be5\u8c03\u7528\u4e0d\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u4f8b\u5b50\uff1a\u4f60\u6253\u7535\u8bdd\u95ee\u4e66\u5e97\u8001\u677f\u6709\u6ca1\u6709\u300a\u5206\u5e03\u5f0f\u7cfb\u7edf\u300b\u8fd9\u672c\u4e66\uff0c\u4f60\u4e0d\u7ba1\u8001\u677f\u6709\u6ca1\u6709\u544a\u8bc9\u4f60\uff0c\u4f60\u81ea\u5df1\u5148\u4e00\u8fb9\u53bb\u73a9\u4e86\uff0c \u5f53\u7136\u4f60\u4e5f\u8981\u5076\u5c14\u8fc7\u51e0\u5206\u949fcheck\u4e00\u4e0b\u8001\u677f\u6709\u6ca1\u6709\u8fd4\u56de\u7ed3\u679c\u3002 ")),(0,r.kt)("p",null,"\u53c2\u8003\u8d44\u6599\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://juejin.im/entry/58ae4636b123db0052b1caf8"},"\u6df1\u5165\u7406\u89e3\u5e76\u53d1 / \u5e76\u884c\uff0c\u963b\u585e / \u975e\u963b\u585e\uff0c\u540c\u6b65 / \u5f02\u6b65 - \u540e\u7aef - \u6398\u91d1"))),(0,r.kt)("h3",{id:"11-java\u4e2d\u7684\u9501"},"11. Java\u4e2d\u7684\u9501"),(0,r.kt)("p",null,"\u672c\u5c0f\u7ed3\u53c2\u8003\uff1a",(0,r.kt)("a",{parentName:"p",href:"http://wiki.jikexueyuan.com/project/java-concurrent/locks-in-java.html"},"Java \u4e2d\u7684\u9501 - Java \u5e76\u53d1\u6027\u548c\u591a\u7ebf\u7a0b - \u6781\u5ba2\u5b66\u9662Wiki")),(0,r.kt)("p",null,"\u3000\u3000\u9501\u50cf synchronized \u540c\u6b65\u5757\u4e00\u6837\uff0c\u662f\u4e00\u79cd\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\uff0c\u4f46\u6bd4 Java \u4e2d\u7684 synchronized \u540c\u6b65\u5757\u66f4\u590d\u6742\u3002\u56e0\u4e3a\u9501\uff08\u4ee5\u53ca\u5176\u5b83\u66f4\u9ad8\u7ea7\u7684\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\uff09\u662f\u7531 synchronized \u540c\u6b65\u5757\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u4e0d\u80fd\u5b8c\u5168\u6446\u8131 synchronized \u5173\u952e\u5b57\uff08\u8bd1\u8005\u6ce8\uff1a\u8fd9\u8bf4\u7684\u662f Java 5 \u4e4b\u524d\u7684\u60c5\u51b5\uff09\u3002"),(0,r.kt)("p",null,"\u3000\u3000\u81ea Java 5 \u5f00\u59cb\uff0cjava.util.concurrent.locks \u5305\u4e2d\u5305\u542b\u4e86\u4e00\u4e9b\u9501\u7684\u5b9e\u73b0\uff0c\u56e0\u6b64\u4f60\u4e0d\u7528\u53bb\u5b9e\u73b0\u81ea\u5df1\u7684\u9501\u4e86\u3002\u4f46\u662f\u4f60\u4ecd\u7136\u9700\u8981\u53bb\u4e86\u89e3\u600e\u6837\u4f7f\u7528\u8fd9\u4e9b\u9501\uff0c\u4e14\u4e86\u89e3\u8fd9\u4e9b\u5b9e\u73b0\u80cc\u540e\u7684\u7406\u8bba\u4e5f\u662f\u5f88\u6709\u7528\u5904\u7684\u3002\u53ef\u4ee5\u53c2\u8003\u6211\u5bf9 java.util.concurrent.locks.Lock \u7684\u4ecb\u7ecd\uff0c\u4ee5\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u9501\u7684\u4fe1\u606f\u3002"),(0,r.kt)("h4",{id:"\u4e00\u4e2a\u7b80\u5355\u7684\u9501"},"\u4e00\u4e2a\u7b80\u5355\u7684\u9501"),(0,r.kt)("p",null,"\u8ba9\u6211\u4eec\u4ece java \u4e2d\u7684\u4e00\u4e2a\u540c\u6b65\u5757\u5f00\u59cb\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class Counter{\n    private int count = 0;\n\n    public int inc(){\n        synchronized(this){\n            return ++count;\n        }\n    }\n}\n")),(0,r.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u5728 inc()\u65b9\u6cd5\u4e2d\u6709\u4e00\u4e2a synchronized(this)\u4ee3\u7801\u5757\u3002\u8be5\u4ee3\u7801\u5757\u53ef\u4ee5\u4fdd\u8bc1\u5728\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u6267\u884c return ++count\u3002\u867d\u7136\u5728 synchronized \u7684\u540c\u6b65\u5757\u4e2d\u7684\u4ee3\u7801\u53ef\u4ee5\u66f4\u52a0\u590d\u6742\uff0c\u4f46\u662f++count \u8fd9\u79cd\u7b80\u5355\u7684\u64cd\u4f5c\u5df2\u7ecf\u8db3\u4ee5\u8868\u8fbe\u51fa\u7ebf\u7a0b\u540c\u6b65\u7684\u610f\u601d\u3002"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u7684 Counter \u7c7b\u7528 Lock \u4ee3\u66ff synchronized \u8fbe\u5230\u4e86\u540c\u6837\u7684\u76ee\u7684\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class Counter{\n    private Lock lock = new Lock();\n    private int count = 0;\n\n    public int inc(){\n        lock.lock();\n        int newCount = ++count;\n        lock.unlock();\n        return newCount;\n    }\n}\n")),(0,r.kt)("p",null,"lock()\u65b9\u6cd5\u4f1a\u5bf9 Lock \u5b9e\u4f8b\u5bf9\u8c61\u8fdb\u884c\u52a0\u9501\uff0c\u56e0\u6b64\u6240\u6709\u5bf9\u8be5\u5bf9\u8c61\u8c03\u7528 lock()\u65b9\u6cd5\u7684\u7ebf\u7a0b\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u8be5 Lock \u5bf9\u8c61\u7684 unlock()\u65b9\u6cd5\u88ab\u8c03\u7528\u3002"),(0,r.kt)("p",null,"\u8fd9\u91cc\u6709\u4e00\u4e2a Lock \u7c7b\u7684\u7b80\u5355\u5b9e\u73b0\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class Counter{\npublic class Lock{\n    private boolean isLocked = false;\n\n    public synchronized void lock()\n        throws InterruptedException{\n        while(isLocked){\n            wait();\n        }\n        isLocked = true;\n    }\n\n    public synchronized void unlock(){\n        isLocked = false;\n        notify();\n    }\n}\n")),(0,r.kt)("p",null,"\u6ce8\u610f\u5176\u4e2d\u7684 while(isLocked) \u5faa\u73af\uff0c\u5b83\u53c8\u88ab\u53eb\u505a \u201c",(0,r.kt)("strong",{parentName:"p"},"\u81ea\u65cb\u9501"),"\u201d\u3002\u81ea\u65cb\u9501\u4ee5\u53ca wait() \u548c notify() \u65b9\u6cd5\u5728",(0,r.kt)("a",{parentName:"p",href:"http://wiki.jikexueyuan.com/project/java-concurrent/thread-communication.html"},"\u7ebf\u7a0b\u901a\u4fe1"),"\u8fd9\u7bc7\u6587\u7ae0\u4e2d\u6709\u66f4\u52a0\u8be6\u7ec6\u7684\u4ecb\u7ecd\u3002\u5f53 isLocked \u4e3a true \u65f6\uff0c\u8c03\u7528 lock() \u7684\u7ebf\u7a0b\u5728 wait() \u8c03\u7528\u4e0a\u963b\u585e\u7b49\u5f85\u3002\u4e3a\u9632\u6b62\u8be5\u7ebf\u7a0b\u6ca1\u6709\u6536\u5230 notify() \u8c03\u7528\u4e5f\u4ece wait() \u4e2d\u8fd4\u56de\uff08\u4e5f\u79f0\u4f5c",(0,r.kt)("a",{parentName:"p",href:"http://wiki.jikexueyuan.com/project/java-concurrent/race-conditions-and-critical-sections.html"},"\u865a\u5047\u5524\u9192"),"\uff09\uff0c\u8fd9\u4e2a\u7ebf\u7a0b\u4f1a\u91cd\u65b0\u53bb\u68c0\u67e5 isLocked \u6761\u4ef6\u4ee5\u51b3\u5b9a\u5f53\u524d\u662f\u5426\u53ef\u4ee5\u5b89\u5168\u5730\u7ee7\u7eed\u6267\u884c\u8fd8\u662f\u9700\u8981\u91cd\u65b0\u4fdd\u6301\u7b49\u5f85\uff0c\u800c\u4e0d\u662f\u8ba4\u4e3a\u7ebf\u7a0b\u88ab\u5524\u9192\u4e86\u5c31\u53ef\u4ee5\u5b89\u5168\u5730\u7ee7\u7eed\u6267\u884c\u4e86\u3002\u5982\u679c isLocked \u4e3a false\uff0c\u5f53\u524d\u7ebf\u7a0b\u4f1a\u9000\u51fa while(isLocked) \u5faa\u73af\uff0c\u5e76\u5c06 isLocked \u8bbe\u56de true\uff0c\u8ba9\u5176\u5b83\u6b63\u5728\u8c03\u7528 lock() \u65b9\u6cd5\u7684\u7ebf\u7a0b\u80fd\u591f\u5728 Lock \u5b9e\u4f8b\u4e0a\u52a0\u9501\u3002"),(0,r.kt)("p",null,"\u5f53\u7ebf\u7a0b\u5b8c\u6210\u4e86",(0,r.kt)("a",{parentName:"p",href:"http://wiki.jikexueyuan.com/project/java-concurrent/race-conditions-and-critical-sections.html"},"\u4e34\u754c\u533a"),"\uff08\u4f4d\u4e8e lock()\u548c unlock()\u4e4b\u95f4\uff09\u4e2d\u7684\u4ee3\u7801\uff0c\u5c31\u4f1a\u8c03\u7528 unlock()\u3002\u6267\u884c unlock()\u4f1a\u91cd\u65b0\u5c06 isLocked \u8bbe\u7f6e\u4e3a false\uff0c\u5e76\u4e14\u901a\u77e5\uff08\u5524\u9192\uff09\u5176\u4e2d\u4e00\u4e2a\uff08\u82e5\u6709\u7684\u8bdd\uff09\u5728 lock()\u65b9\u6cd5\u4e2d\u8c03\u7528\u4e86 wait()\u51fd\u6570\u800c\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u7684\u7ebf\u7a0b\u3002"),(0,r.kt)("h4",{id:"\u9501\u7684\u53ef\u91cd\u5165\u6027"},"\u9501\u7684\u53ef\u91cd\u5165\u6027"),(0,r.kt)("p",null,"Java \u4e2d\u7684 synchronized \u540c\u6b65\u5757\u662f\u53ef\u91cd\u5165\u7684\u3002\u8fd9\u610f\u5473\u7740\u5982\u679c\u4e00\u4e2a Java \u7ebf\u7a0b\u8fdb\u5165\u4e86\u4ee3\u7801\u4e2d\u7684 synchronized \u540c\u6b65\u5757\uff0c\u5e76\u56e0\u6b64\u83b7\u5f97\u4e86\u8be5\u540c\u6b65\u5757\u4f7f\u7528\u7684\u540c\u6b65\u5bf9\u8c61\u5bf9\u5e94\u7684\u7ba1\u7a0b\u4e0a\u7684\u9501\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u8fdb\u5165\u7531\u540c\u4e00\u4e2a\u7ba1\u7a0b\u5bf9\u8c61\u6240\u540c\u6b65\u7684\u53e6\u4e00\u4e2a java \u4ee3\u7801\u5757\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class Reentrant{\n    public synchronized outer(){\n        inner();\n    }\n\n    public synchronized inner(){\n        //do something\n    }\n}\n")),(0,r.kt)("p",null,"\u6ce8\u610f outer()\u548c inner()\u90fd\u88ab\u58f0\u660e\u4e3a synchronized\uff0c\u8fd9\u5728 Java \u4e2d\u548c synchronized(this) \u5757\u7b49\u6548\u3002\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528\u4e86 outer()\uff0c\u5728 outer()\u91cc\u8c03\u7528 inner()\u5c31\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u65b9\u6cd5\uff08\u4ee3\u7801\u5757\uff09\u90fd\u7531\u540c\u4e00\u4e2a\u7ba1\u7a0b\u5bf9\u8c61\uff08\u201dthis\u201d) \u6240\u540c\u6b65\u3002\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u5df2\u7ecf\u62e5\u6709\u4e86\u4e00\u4e2a\u7ba1\u7a0b\u5bf9\u8c61\u4e0a\u7684\u9501\uff0c\u90a3\u4e48\u5b83\u5c31\u6709\u6743\u8bbf\u95ee\u88ab\u8fd9\u4e2a\u7ba1\u7a0b\u5bf9\u8c61\u540c\u6b65\u7684\u6240\u6709\u4ee3\u7801\u5757\u3002\u8fd9\u5c31\u662f\u53ef\u91cd\u5165\u3002\u7ebf\u7a0b\u53ef\u4ee5\u8fdb\u5165\u4efb\u4f55\u4e00\u4e2a\u5b83\u5df2\u7ecf\u62e5\u6709\u7684\u9501\u6240\u540c\u6b65\u7740\u7684\u4ee3\u7801\u5757\u3002"),(0,r.kt)("p",null,"\u524d\u9762\u7ed9\u51fa\u7684\u9501\u5b9e\u73b0\u4e0d\u662f\u53ef\u91cd\u5165\u7684\u3002\u5982\u679c\u6211\u4eec\u50cf\u4e0b\u9762\u8fd9\u6837\u91cd\u5199 Reentrant \u7c7b\uff0c\u5f53\u7ebf\u7a0b\u8c03\u7528 outer() \u65f6\uff0c\u4f1a\u5728 inner()\u65b9\u6cd5\u7684 lock.lock() \u5904\u963b\u585e\u4f4f\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class Reentrant2{\n    Lock lock = new Lock();\n\n    public outer(){\n        lock.lock();\n        inner();\n        lock.unlock();\n    }\n\n    public synchronized inner(){\n        lock.lock();\n        //do something\n        lock.unlock();\n    }\n}\n")),(0,r.kt)("p",null,"\u8c03\u7528 outer() \u7684\u7ebf\u7a0b\u9996\u5148\u4f1a\u9501\u4f4f Lock \u5b9e\u4f8b\uff0c\u7136\u540e\u7ee7\u7eed\u8c03\u7528 inner()\u3002inner()\u65b9\u6cd5\u4e2d\u8be5\u7ebf\u7a0b\u5c06\u518d\u4e00\u6b21\u5c1d\u8bd5\u9501\u4f4f Lock \u5b9e\u4f8b\uff0c\u7ed3\u679c\u8be5\u52a8\u4f5c\u4f1a\u5931\u8d25\uff08\u4e5f\u5c31\u662f\u8bf4\u8be5\u7ebf\u7a0b\u4f1a\u88ab\u963b\u585e\uff09\uff0c\u56e0\u4e3a\u8fd9\u4e2a Lock \u5b9e\u4f8b\u5df2\u7ecf\u5728 outer()\u65b9\u6cd5\u4e2d\u88ab\u9501\u4f4f\u4e86\u3002"),(0,r.kt)("p",null,"\u4e24\u6b21 lock()\u4e4b\u95f4\u6ca1\u6709\u8c03\u7528 unlock()\uff0c\u7b2c\u4e8c\u6b21\u8c03\u7528 lock \u5c31\u4f1a\u963b\u585e\uff0c\u770b\u8fc7 lock() \u5b9e\u73b0\u540e\uff0c\u4f1a\u53d1\u73b0\u539f\u56e0\u5f88\u660e\u663e\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class Lock{\n    boolean isLocked = false;\n\n    public synchronized void lock()\n        throws InterruptedException{\n        while(isLocked){\n            wait();\n        }\n        isLocked = true;\n    }\n\n    ...\n}\n")),(0,r.kt)("p",null,"\u4e00\u4e2a\u7ebf\u7a0b\u662f\u5426\u88ab\u5141\u8bb8\u9000\u51fa lock()\u65b9\u6cd5\u662f\u7531 while \u5faa\u73af\uff08\u81ea\u65cb\u9501\uff09\u4e2d\u7684\u6761\u4ef6\u51b3\u5b9a\u7684\u3002\u5f53\u524d\u7684\u5224\u65ad\u6761\u4ef6\u662f\u53ea\u6709\u5f53 isLocked \u4e3a false \u65f6 lock \u64cd\u4f5c\u624d\u88ab\u5141\u8bb8\uff0c\u800c\u6ca1\u6709\u8003\u8651\u662f\u54ea\u4e2a\u7ebf\u7a0b\u9501\u4f4f\u4e86\u5b83\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u8ba9\u8fd9\u4e2a Lock \u7c7b\u5177\u6709\u53ef\u91cd\u5165\u6027\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5b83\u505a\u4e00\u70b9\u5c0f\u7684\u6539\u52a8\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class Lock{\n    boolean isLocked = false;\n    Thread  lockedBy = null;\n    int lockedCount = 0;\n\n    public synchronized void lock()\n        throws InterruptedException{\n        Thread callingThread =\n            Thread.currentThread();\n        while(isLocked && lockedBy != callingThread){\n            wait();\n        }\n        isLocked = true;\n        lockedCount++;\n        lockedBy = callingThread;\n  }\n\n    public synchronized void unlock(){\n        if(Thread.curentThread() ==\n            this.lockedBy){\n            lockedCount--;\n\n            if(lockedCount == 0){\n                isLocked = false;\n                notify();\n            }\n        }\n    }\n\n    ...\n}\n")),(0,r.kt)("p",null,"\u6ce8\u610f\u5230\u73b0\u5728\u7684 while \u5faa\u73af\uff08\u81ea\u65cb\u9501\uff09\u4e5f\u8003\u8651\u5230\u4e86\u5df2\u9501\u4f4f\u8be5 Lock \u5b9e\u4f8b\u7684\u7ebf\u7a0b\u3002\u5982\u679c\u5f53\u524d\u7684\u9501\u5bf9\u8c61\u6ca1\u6709\u88ab\u52a0\u9501(isLocked = false)\uff0c\u6216\u8005\u5f53\u524d\u8c03\u7528\u7ebf\u7a0b\u5df2\u7ecf\u5bf9\u8be5 Lock \u5b9e\u4f8b\u52a0\u4e86\u9501\uff0c\u90a3\u4e48 while \u5faa\u73af\u5c31\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u8c03\u7528 lock()\u7684\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u9000\u51fa\u8be5\u65b9\u6cd5\uff08\u8bd1\u8005\u6ce8\uff1a\u201c\u88ab\u5141\u8bb8\u9000\u51fa\u8be5\u65b9\u6cd5\u201d\u5728\u5f53\u524d\u8bed\u4e49\u4e0b\u5c31\u662f\u6307\u4e0d\u4f1a\u8c03\u7528 wait()\u800c\u5bfc\u81f4\u963b\u585e\uff09\u3002"),(0,r.kt)("p",null,"\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u4eec\u9700\u8981\u8bb0\u5f55\u540c\u4e00\u4e2a\u7ebf\u7a0b\u91cd\u590d\u5bf9\u4e00\u4e2a\u9501\u5bf9\u8c61\u52a0\u9501\u7684\u6b21\u6570\u3002\u5426\u5219\uff0c\u4e00\u6b21 unblock()\u8c03\u7528\u5c31\u4f1a\u89e3\u9664\u6574\u4e2a\u9501\uff0c\u5373\u4f7f\u5f53\u524d\u9501\u5df2\u7ecf\u88ab\u52a0\u9501\u8fc7\u591a\u6b21\u3002\u5728 unlock()\u8c03\u7528\u6ca1\u6709\u8fbe\u5230\u5bf9\u5e94 lock()\u8c03\u7528\u7684\u6b21\u6570\u4e4b\u524d\uff0c\u6211\u4eec\u4e0d\u5e0c\u671b\u9501\u88ab\u89e3\u9664\u3002"),(0,r.kt)("p",null,"\u73b0\u5728\u8fd9\u4e2a Lock \u7c7b\u5c31\u662f\u53ef\u91cd\u5165\u7684\u4e86\u3002"),(0,r.kt)("h4",{id:"\u9501\u7684\u516c\u5e73\u6027"},"\u9501\u7684\u516c\u5e73\u6027"),(0,r.kt)("p",null,"Java \u7684 synchronized \u5757\u5e76\u4e0d\u4fdd\u8bc1\u5c1d\u8bd5\u8fdb\u5165\u5b83\u4eec\u7684\u7ebf\u7a0b\u7684\u987a\u5e8f\u3002\u56e0\u6b64\uff0c\u5982\u679c\u591a\u4e2a\u7ebf\u7a0b\u4e0d\u65ad\u7ade\u4e89\u8bbf\u95ee\u76f8\u540c\u7684 synchronized \u540c\u6b65\u5757\uff0c\u5c31\u5b58\u5728\u4e00\u79cd\u98ce\u9669\uff0c\u5176\u4e2d\u4e00\u4e2a\u6216\u591a\u4e2a\u7ebf\u7a0b\u6c38\u8fdc\u4e5f\u5f97\u4e0d\u5230\u8bbf\u95ee\u6743 \u2014\u2014 \u4e5f\u5c31\u662f\u8bf4\u8bbf\u95ee\u6743\u603b\u662f\u5206\u914d\u7ed9\u4e86\u5176\u5b83\u7ebf\u7a0b\u3002\u8fd9\u79cd\u60c5\u51b5\u88ab\u79f0\u4f5c\u7ebf\u7a0b\u9965\u997f\u3002\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u95ee\u9898\uff0c\u9501\u9700\u8981\u5b9e\u73b0\u516c\u5e73\u6027\u3002\u672c\u6587\u6240\u5c55\u73b0\u7684\u9501\u5728\u5185\u90e8\u662f\u7528 synchronized \u540c\u6b65\u5757\u5b9e\u73b0\u7684\uff0c\u56e0\u6b64\u5b83\u4eec\u4e5f\u4e0d\u4fdd\u8bc1\u516c\u5e73\u6027\u3002",(0,r.kt)("a",{parentName:"p",href:"http://wiki.jikexueyuan.com/project/java-concurrent/starvation-and-fairness.html"},"\u9965\u997f\u548c\u516c\u5e73"),"\u4e2d\u6709\u66f4\u591a\u5173\u4e8e\u8be5\u5185\u5bb9\u7684\u8ba8\u8bba\u3002"),(0,r.kt)("h4",{id:"\u5728-finally-\u8bed\u53e5\u4e2d\u8c03\u7528-unlock"},"\u5728 finally \u8bed\u53e5\u4e2d\u8c03\u7528 unlock()"),(0,r.kt)("p",null,"\u5982\u679c\u7528 Lock \u6765\u4fdd\u62a4\u4e34\u754c\u533a\uff0c\u5e76\u4e14\u4e34\u754c\u533a\u6709\u53ef\u80fd\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u90a3\u4e48\u5728 finally \u8bed\u53e5\u4e2d\u8c03\u7528 unlock()\u5c31\u663e\u5f97\u975e\u5e38\u91cd\u8981\u4e86\u3002\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u8fd9\u4e2a\u9501\u5bf9\u8c61\u53ef\u4ee5\u88ab\u89e3\u9501\u4ee5\u4fbf\u5176\u5b83\u7ebf\u7a0b\u80fd\u7ee7\u7eed\u5bf9\u5176\u52a0\u9501\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"lock.lock();\ntry{\n    //do critical section code,\n    //which may throw exception\n} finally {\n    lock.unlock();\n}\n")),(0,r.kt)("p",null,"\u8fd9\u4e2a\u7b80\u5355\u7684\u7ed3\u6784\u53ef\u4ee5\u4fdd\u8bc1\u5f53\u4e34\u754c\u533a\u629b\u51fa\u5f02\u5e38\u65f6 Lock \u5bf9\u8c61\u53ef\u4ee5\u88ab\u89e3\u9501\u3002\u5982\u679c\u4e0d\u662f\u5728 finally \u8bed\u53e5\u4e2d\u8c03\u7528\u7684 unlock()\uff0c\u5f53\u4e34\u754c\u533a\u629b\u51fa\u5f02\u5e38\u65f6\uff0cLock \u5bf9\u8c61\u5c06\u6c38\u8fdc\u505c\u7559\u5728\u88ab\u9501\u4f4f\u7684\u72b6\u6001\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u5176\u5b83\u6240\u6709\u5728\u8be5 Lock \u5bf9\u8c61\u4e0a\u8c03\u7528 lock()\u7684\u7ebf\u7a0b\u4e00\u76f4\u963b\u585e\u3002"),(0,r.kt)("h3",{id:"12-\u5e76\u53d1\u5305juc\u4e0b\u9762\u90fd\u7528\u8fc7\u4ec0\u4e48"},"12. \u5e76\u53d1\u5305(J.U.C)\u4e0b\u9762\uff0c\u90fd\u7528\u8fc7\u4ec0\u4e48"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"concurrent\u4e0b\u9762\u7684\u5305 ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Executor  \u7528\u6765\u521b\u5efa\u7ebf\u7a0b\u6c60\uff0c\u5728\u5b9e\u73b0Callable\u63a5\u53e3\u65f6\uff0c\u6dfb\u52a0\u7ebf\u7a0b\u3002 "),(0,r.kt)("li",{parentName:"ul"},"FeatureTask \u6b64 FutureTask \u7684 get \u65b9\u6cd5\u6240\u8fd4\u56de\u7684\u7ed3\u679c\u7c7b\u578b\u3002 "),(0,r.kt)("li",{parentName:"ul"},"TimeUnit "),(0,r.kt)("li",{parentName:"ul"},"Semaphore  "),(0,r.kt)("li",{parentName:"ul"},"LinkedBlockingQueue  "))),(0,r.kt)("li",{parentName:"ul"},"\u6240\u7528\u8fc7\u7684\u7c7b ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Executor   ")))),(0,r.kt)("h3",{id:"13-\u4ecevolatile\u8bf4\u5230i\u539f\u5b50\u64cd\u4f5c\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898"},"13. \u4ecevolatile\u8bf4\u5230,i++\u539f\u5b50\u64cd\u4f5c,\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898"),(0,r.kt)("p",null,"\u4ece volatile \u8bf4\u5230\uff0ci++\u539f\u5b50\u64cd\u4f5c\uff0c\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898 - CSDN\u535a\u5ba2\n",(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/zbw18297786698/article/details/53420780"},"https://blog.csdn.net/zbw18297786698/article/details/53420780")),(0,r.kt)("h2",{id:"\u53c2\u8003\u8d44\u6599"},"\u53c2\u8003\u8d44\u6599"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/CyC2018/Interview-Notebook/blob/master/notes/Java%20%E5%B9%B6%E5%8F%91.md"},"Interview-Notebook/Java \u5e76\u53d1.md at master \xb7 CyC2018/Interview-Notebook"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"http://wiki.jikexueyuan.com/project/java-concurrency/"},"Java \u5e76\u53d1\u7f16\u7a0b-\u6781\u5ba2\u5b66\u9662Wiki")))),(0,r.kt)("h2",{id:"\u66f4\u65b0\u65e5\u5fd7"},"\u66f4\u65b0\u65e5\u5fd7"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"2018/9/2 v3.0")))}s.isMDXComponent=!0},9842:function(e,n,t){n.Z=t.p+"assets/images/ThrealpoolExecutor_framework-e9742548c21bc45f82eef708b8cff961.jpg"}}]);